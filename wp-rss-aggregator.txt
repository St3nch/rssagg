File Name:
uninstall.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\uninstall.php
Code:
<?php

// If uninstall not called from WordPress exit
if ( !defined( 'WP_UNINSTALL_PLUGIN' ) ) {
    exit ();
}

// Remove capabilities
if ( function_exists( 'wprss_remove_caps' ) ) {
    wprss_remove_caps();
}

// Delete options from options table
delete_option( 'wprss_options' );
delete_option( 'wprss_addon_notices' );
delete_option( 'wprss_admin_notices' );
delete_option( 'wprss_db_version' );
delete_option( 'wprss_did_intro' );
delete_option( 'wprss_first_activation_time' );
delete_option( 'wprss_hs_beacon_enabled' );
delete_option( 'wprss_intro_feed_id' );
delete_option( 'wprss_settings_notices' );


File Name:
admin-3.8.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\admin-3.8.css
Code:
#menu-posts-wprss_feed .menu-icon-post div.wp-menu-image:before {
    content: "\f303" !important;
}
.welcome-page-tile {
	display: inline-block;
	padding: 15px 0;
	margin: 15px 0;
	width: 30%;
	text-align: left;
	vertical-align: top;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
}
.welcome-page-tile:first-child {
	margin-left: 0;
}
.welcome-page-tile:last-child {
	margin-right: 0;
}
.welcome-page-tile > h4 {
	margin: 1.4em 0 .6em;
	font-size: 1.2em;
}
.welcome-page-tile > p {
	margin: 0;
}
.wprss-about-text {
	color: #777;
	line-height: 1.6em;
	margin: 15px 0;
	font-size: 1.2em;
}

#check-out-addons {
	margin-top: 15px;
}

/* WP 3.8+ Settings Page */

body.wprss_feed_page_wprss-aggregator-settings .wrap h3 {
	font-size: 1.5em;
	margin-top: 1.8em;
	margin-bottom: 0.6em;
}
body.wprss_feed_page_wprss-aggregator-settings .wrap h3 + p {
	margin-top: 0.4em;
}

File Name:
admin-editor.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\admin-editor.css
Code:
/* EDITOR BUTTON AND DIALOG STYLES */

#wprss-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(120, 120, 120, 0.36);
    z-index: 1000;
}

#wprss-editor-dialog {
	position: absolute;
	top: 0;
	bottom: 0;
	left: 0;
	right: 0;
	width: 500px;
	height: 660px;
	margin: auto;
	border: 0;
}

.wprss-dialog-header {
	background: #ff792b;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	padding: 10px 3px;
}

.wprss-dialog-header,
.wprss-dialog-header > * {
	line-height: 1.5em;
}

.wprss-dialog-header h1 {
	color: #fff;
	font-size: 16px;
	margin: 0 15px 0;
	line-height: 1.5em;
	display: inline-block;
}

.wprss-dialog-header .close-btn {
	position: absolute;
	top: 8px;
	right: 15px;
	color: #fff;
	font-size: 12px;
	cursor: pointer;
	line-height: 2em;
	padding: 3px 8px;
	border-radius: 3px;
}
.wprss-dialog-header .close-btn:hover {
	background: rgba(173, 83, 28, 0.49);
}

.wprss-dialog-inside {
	position: absolute;
	top: 44px;
	bottom: 0;
	left: 0;
	right: 0;
	overflow: auto;
}

.wprss-dialog-inside table {
	position: absolute;
	display: inline-block;
	top: 0;
	left: 0;
	right: 0;
	height: auto;
	padding: 10px;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
}

.wprss-dialog-inside table p {
	margin: 0 0 5px;
}

.wprss-dialog-inside table tr td {
	vertical-align: baseline;
	line-height: 1.5em;
}

.wprss-dialog-inside table tr td:first-child {
	min-width: 85px;
	font-weight: bold;
}

#wprss-dialog-feed-source-list,
#wprss-dialog-exclude-list {
	min-width: 100px;
	min-height: 100px;
	max-height: 100px;
}

#wprss-dialog-exclude-row td p:first-child {
	margin-top: 0;
}

#wprss-dialog-exclude-label {
	vertical-align: top;
}

.wprss-after-url-link {
	font-size: 0.85em;
	text-decoration: none;
}
#validate-feed-link {
	margin-left: 3px;
}

#wprss-dialog-submit {
	padding: 7px 14px;
	color: #ff792b;
	font-weight: bold;
	background: #fff;
	border: 3px solid #ff792b;
	border-radius: 4px;
	box-shadow: 0 0 transparent;
	outline: 0;
	cursor: pointer;
	transition: 0.15s;
}
#wprss-dialog-submit:hover {
	background: #ff792b;
	color: #fff;
}


File Name:
admin-general-styles.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\admin-general-styles.css
Code:
/*
 * These are the styles that get enqueued by WP RSS Aggregator on all pages of
 * the admin panel.
 */

#menu-posts-wprss_feed .dashicons {
    vertical-align: text-top;
}

.dashicons-star-filled.wprss-more-features-glyph {
    color: #ffd700;
    margin-left: 5px;
    font-size: 12pt;
}

table.plugins tbody tr[data-slug="wp-rss-aggregator-excerpts-and-thumbnails"] > td,
table.plugins tbody tr[data-slug="wp-rss-aggregator-excerpts-and-thumbnails"] > th {
    box-shadow: none !important;
}

table.plugins tbody tr.wprss-et-plugin-row-msg > td > div > p::before {
    content: "\f348";
    color: #00a0d2;
}

/* Hide the image options in the new/edit page */
.postbox-container #wpra-images {
    display: none;
}


File Name:
admin-notifications.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\admin-notifications.css
Code:
/* Admin Notifications ====================================================== */
.wprss_admin-notice {
    position: relative;
}

.wprss_admin-notice .notice-content {
    margin-right: 200px;
}

.wprss_admin-notice .notice-inside {
    margin-right: 200px;
}

.wprss_admin-notice .btn-close {
    position: absolute;
    right: 15px;
    top: 10px;
    text-decoration: none;
}


File Name:
admin-styles.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\admin-styles.css
Code:
body.post-type-wprss_feed q {
    font-style: italic;
}
body.post-type-wprss_feed q:before {
    content: '"';
}
body.post-type-wprss_feed q:after {
    content: '"';
}

span.wp-rss-footer-text {
    font-style: italic;
}

.wprss-input {
    background: none repeat scroll 0 0 #EAF2FA;
    margin-bottom: 20px;
    padding-bottom: 10px;
    padding-left: 10px;
    padding-top: 10px;
    width: 600px;
}

.wprss-input p { line-height: 28px; }

.wprss-input label {
    float: left;
    width: 95px !important;
}

.wprss-input input {
    height: 28px;
    margin-bottom: 0;
    padding: 0 0 0 5px;
    width: 400px;
}

.wprss-text-input {
    display: inline-block;
    width: 400px;
    max-width: 100%;
}

label.description {
    font-size: 13px;
    font-style: italic;
}

span.wprss-row-id {
	color: #8f8f8f;
}

#icon-wprss-aggregator {
    background: transparent url( '../images/icon-adminpage32.png' ) no-repeat !important;
}

body.post-type-wprss_feed #titlediv div.inside { display: none !important; }

#misc-publishing-actions,
#minor-publishing-actions { display: none; }

div#force-feed-container {
    border-top: 1px solid #ddd;
}


/* FORM TABLES */
.wprss-form-table th {
    width: 160px;
    max-width: 200px;
    padding: 10px;
}
.wprss-form-table th label {
    padding-top: 7px;
}
.wprss-form-table td {
    padding: 8px 10px;
}
.wprss-form-table td label {
    line-height: 15px;
}
@media screen and (max-width: 1025px) {
    .wprss-form-table th {
        display: block;
        padding: 0;
    }
    .wprss-form-table td {
        display: block;
        padding-left: 0;
        padding-right: 0;
    }

    .wprss-form-table td input[type="text"],
    .wprss-form-table td input[type="url"],
    .wprss-form-table td select {
        display: block;
        width: 100%;
    }

    .wprss-form-table td span.description {
        display: inline;
    }

    .wprss-form-table td input[type="checkbox"] + label {
        display: inline !important;
    }

    .wprss-form-table td input {
        line-height: normal;
    }
}



body.post-type-wprss_feed_item .add-new-h2,
body.post-type-wprss_feed_item .tablenav select[name="m"],
body.post-type-wprss_feed_item #post-query-submit
{ display: none; }

body.post-type-wprss_feed_item a.row-title {
            cursor: default;
            font-weight: normal;
            color: #555;
}

#latest-news-cpac-settings li {
list-style: none;
line-height: 16px;
}

li.twitter a {
background: transparent url('../images/twitter.png') no-repeat 0;
padding-left: 20px;
}

li.facebook a {
background: transparent url('../images/facebook.png') no-repeat 0;
padding-left: 20px;
}

li.donate_link a:hover {
color: darkGreen;
}

#preview_meta_box ul {
    list-style: disc;
    margin-left: 16px;
}

#preview_meta_box .invalid-feed-url {
    color: red;
}

#preview_meta_box .rss-date {
    color: #666;

}

/*.rss-aggregator_page_wprss-aggregator-settings .form-table th { width: 80px; }*/


/* For excerpts and thumbnails admin screens
.wprss_feed_page_wprss-aggregator-settings input,
.wprss_feed_page_wprss-aggregator-settings input[type="checkbox"], 
.wprss_feed_page_wprss-aggregator-settings input[type="radio"] {
    margin-right: 8px; 
}
*/

input#default-thumbnail,
input#wprss-et-license-key,
input#wprss-c-license-key,
input#wprss-kf-license-key,
input#wprss-ftp-license-key {
    width: 300px;
}

input#thumbnails-height,
input#thumbnails-width {
    /*width: 29px;*/
}


/* Red Button */

.wp-core-ui .button-red {
    background: #BD2B2B;
    border-color: transparent;
    color: #fff;
    text-decoration: none;
    text-shadow: none;
}

.wp-core-ui .button-red.hover,
.wp-core-ui .button-red:hover {
    color: #fff;
    border-color: transparent;
    background-color: #AC0F0F;
}

.wp-core-ui .button-red.focus,
.wp-core-ui .button-red:focus {
    color: #fff;
    background-color: #AC0F0F;
    border-color: transparent;
    box-shadow: 0 0 0 1px #fff,0 0 0 3px #AC0F0F;
}

.wp-core-ui .button-red.active,
.wp-core-ui .button-red:active {
    color: #fff;
    background-color: #A20909;
    border-color: transparent;
}

.wp-core-ui .button-red[disabled],
.wp-core-ui .button-red:disabled,
.wp-core-ui .button-red-disabled {
    color: #fba6a8 !important;
    background: #DD383A !important;
    box-shadow: 0 0 0 transparent !important;
    border-color: transparent !important;
    text-shadow: 0 0 0 transparent !important;
}

#wpra-system-info-textarea,
#wprss-error-log-textarea {
    width: 800px;
    height: 400px;
    font-family: Menlo, Monaco, monospace;
    white-space: pre;
    overflow: auto;
    display: block;
}

#wpra-system-info-textarea {
    display: block;
    width: 100%;
    height: 600px;
    font-family: Menlo, Monaco, monospace;
    white-space: pre;
    overflow: auto;
}

.wprss-error-log-action {
    display: inline-block;
}

#wprss-clear-error-log-form {
    display: inline-block;
}
#wprss-clear-error-log-form,
#wprss-clear-error-log-form > button {
    vertical-align: baseline;
}

form.wprss-error-log-action input[type="submit"]:active {
    vertical-align: baseline;
}
/* The debug log root element */
div.wpra-log {
    display: block;
    position: relative;
    width: 100%;
}

/* The "Filters" label */
div.wpra-log > p > strong:first-child {
    text-decoration: underline;
    margin-right: 10px;
}

/* The debug log filters separator */
div.wpra-log .wpra-toggle-logs:not(:last-of-type)::after {
    content: ' | ';
    color: #3c3c3c;
    pointer-events: none;
}
/* The debug log filters */
div.wpra-log .wpra-toggle-logs a {
    text-decoration: none;
    outline: none;
    box-shadow: 0 0 transparent;
}
/* The debug log filters when not selected */
div.wpra-log .wpra-toggle-logs:not(.wpra-selected):not(.wpra-log-filter-disabled) a {
    color: #626262;
}
/* The debug log filters when selected */
div.wpra-log .wpra-toggle-logs.wpra-selected:not(.wpra-log-filter-disabled) a {
    font-weight: bold;
}

/* The debug log "error" filter text color when there are errors */
div.wpra-log .wpra-toggle-logs.wpra-selected[data-level="error"]:not(.wpra-log-filter-disabled) a {
    color: #d40000;
}
/* The debug log "warning" filter text color when there are warnings */
div.wpra-log .wpra-toggle-logs.wpra-selected[data-level="warning"]:not(.wpra-log-filter-disabled) a {
    color: #d45500;
}
/* The debug log "notice" filter text color when there are notices */
div.wpra-log .wpra-toggle-logs.wpra-selected[data-level="notice"]:not(.wpra-log-filter-disabled) a {
    color: #d48a00;
}
/* The debug log "info" filter text color when there are info logs */
div.wpra-log .wpra-toggle-logs.wpra-selected[data-level="info"]:not(.wpra-log-filter-disabled) a {
    color: #009cd6;
}
/* The debug log "debug" filter text color when there are debug logs */
div.wpra-log .wpra-toggle-logs.wpra-selected[data-level="debug"]:not(.wpra-log-filter-disabled) a {
    color: #8242d4;
}

/* Disabled debug log filters */
div.wpra-log .wpra-toggle-logs.wpra-log-filter-disabled a {
    color: #8b8b8b !important;
    font-style: italic;
    text-decoration: none;
    cursor: not-allowed;
}

/* The debug log */
div.wpra-log-container {
    width: 100%;
    max-height: 600px;
    border: 1px solid #d1d1d1;
    padding: 5px;
    margin-bottom: 15px;
    overflow: auto;
    background: #222833;
}

/* The debug log & empty log notice */
div.wpra-log-container,
.notice.wpra-empty-log-notice {
    display: block;
    box-sizing: border-box;
}
.notice.wpra-empty-log-notice {
    width: 400px;
}

/* The log table */
div.wpra-log-container > table {
    font-family: monospace;
    min-width: 100%;
    border: 0;
    border-collapse: collapse;
}
/* Log table: row formatting */
div.wpra-log-container > table > tbody > tr {
}
/* Log table: cell formatting */
div.wpra-log-container > table > tbody > tr > td {
    color: #cbcdda;
    vertical-align: baseline;
    padding: 4px 10px;
    border-bottom: 2px solid #222833;
}

/* Log table: row on hover */
div.wpra-log-container > table > tbody > tr:hover {
    background: rgba(200, 200, 200, 0.1);
}

/* Log table: date and level cells do not wrap */
div.wpra-log-container > table > tbody > tr > td.wpra-log-date,
div.wpra-log-container > table > tbody > tr > td.wpra-log-level {
    white-space: nowrap;
    overflow: hidden;
}
div.wpra-log-container > table > tbody > tr > td.wpra-log-date {
    width: 150px;
}
div.wpra-log-container > table > tbody > tr > td.wpra-log-level {
    text-align: center;
    width: 60px;
}
div.wpra-log-container > table > tbody > tr > td.wpra-log-feed {
    width: 150px;
}

/* Log table: styling for DEBUG log messages */
div.wpra-log-container > table > tbody > tr.wpra-log-debug > td:not(.wpra-log-date) {
    color: #b695e6;
}
/* Log table: styling for INFO log messages */
div.wpra-log-container > table > tbody > tr.wpra-log-info > td:not(.wpra-log-date) {
    color: #38eaff;
}
/* Log table: styling for NOTICE log messages */
div.wpra-log-container > table > tbody > tr.wpra-log-notice > td:not(.wpra-log-date) {
    color: #ffea00;
}
/* Log table: styling for WARNING log messages */
div.wpra-log-container > table > tbody > tr.wpra-log-warning > td {
    color: #000;
    background-color: #ffea00;
    font-weight: bold;
}
/* Log table: styling for ERROR log messages */
div.wpra-log-container > table > tbody > tr.wpra-log-error > td {
    color: white;
    background-color: #b90000;
    font-weight: bold;
}

@media screen and (min-width: 782px) {
    #custom_feed_title {
        width: 400px;
    }
}

/* Number Roller for Feed Source Limit */
.wprss-number-roller {
    width: 80px;
    vertical-align: middle;
}
@media screen and (max-width: 782px) {
    .wprss-number-roller {
        width: 100px;
    }
}

/* Welcome Screen */
.about-wrap ul {
    list-style: disc;
    padding-left: 30px;
}

/* Excerpts and Thumbnails */

input#thumbnails-height,
input#thumbnails-width {
    margin-right: 2px;
}

label[for=thumbnails-height],
label[for=thumbnails-width] {
    margin-left: 8px;
}

.wp-list-table > thead > tr > th#thumbnail[scope="col"] {
    width: 95px;
}

select + label.description {
    margin-left: 8px;
}

input#title-limit {
    width: 100px;
}

.wprss-form-table th,
.wprss-form-table tr,
.wprss-form-table td {
    border: 0 transparent !important;
}

.wprss-indicator-green,
.wprss-indicator-red,
.wprss-indicator-grey {
    font-size: 1.6em;
    vertical-align: middle;
    margin-right: 10px;
    line-height: 30px;
}
.wprss-indicator-green {
    color: #009922;
}
.wprss-indicator-grey {
    color: #888;
}
.wprss-indicator-red {
    color: #EB442A;
}


.wprss-meta-slider {
    display: none;
    margin-top: 5px;
}

.wprss-slider-button {
    cursor: pointer;
    margin-right: 8px !important;
}

#wprss_activate_feed,
#wprss_pause_feed {
    display: block;
}

.wprss-date-error {
    background: rgba( 245, 45, 45, 0.6 );
}

div.wprss-meta-side-setting {
    display: block;
    padding: 8px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

div.wprss-meta-side-setting > p {
    margin: 2px 0;
}
div.wprss-meta-side-setting > p > label {
    vertical-align: baseline;
}
div.wprss-meta-side-setting a.wprss-slider-button {
    vertical-align: middle;
}

div.inside .wprss-meta-side-setting:last-child {
    border-bottom: 0 solid transparent;
}

input[type="checkbox"]#wprss-force-feed {
    margin-left: 10px;
}

/******************************
 * FEED SOURCES PAGE COLUMNS
 */
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th {
    text-align: left;
    overflow: hidden;
}
/* CHECKBOX */
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead td#cb {
    width: 30px !important;
}
/* STATE */
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#state {
    width: 70px !important;
}
/* NAME */
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#title {
    width: auto;
}
/* NEXT UPDATE */
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#updates {
    width: 300px !important;
}
body.post-type-wprss_feed.edit-php table.wp-list-table.posts td.column-updates p {
    margin-bottom: 0 !important;
}
/* FEED COUNT */
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#feed-count {
    width: 200px !important;
}
/* CATEGORIES */
body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts thead th#category,
body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#category {
    width: 130px !important;
}

/* FEED ITEM IMAGE */
body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts thead th#image {
    width: 120px;
}
body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tbody img.wpra-item-ft-image {
    width: 100px;
}

@media screen and (max-width: 660px) {
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#id,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts tfoot th.column-id,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts tbody td.column-id,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#state,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts tfoot th.column-state,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts tbody td.column-state {
        display: none;
    }
}
@media only screen and (max-width: 782px) {
    /* WIDEN CHECKBOX COLUMN */
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead td#cb {
        width: 50px !important;
    }

    /* HIDE STATE COLUMN */
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts thead th#state,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts tfoot th.column-state,
    body.post-type-wprss_feed.edit-php table.wp-list-table.posts tbody td.column-state {
        display: none;
        padding: 8px 10px;
    }

    /* HIDE ITEM IMAGE COLUMN */
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts thead th#image,
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tfoot th.column-image,
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tbody td.column-image {
        display: none;
    }

    /* IMAGE IS LARGER IN RESPONSIVE MOBILE VIEW */
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tbody img.wpra-item-ft-image {
        width: 350px;
    }

    /* HIDE INLINE IMAGE COLUMN NAME IN RESPONSIVE MOBILE VIEW */
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tbody td.column-image::before {
        display: none;
    }
}

@media only screen and (max-width: 1200px) {
    /* HIDE ITEM PERMALINK COLUMN */
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts thead th#permalink,
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tfoot th.column-permalink,
    body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts tbody td.column-permalink {
        display: none;
    }
}

/* For feed items */
body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts thead th#publishdate {
	width: 150px;
}
body.post-type-wprss_feed_item.edit-php table.wp-list-table.posts thead th#source {
	width: 200px;
}



i.wprss-feed-error-symbol {
    display: none;
    font-size: 1.2em;
    vertical-align: middle;
    color: rgb(200,0,0);
    margin-left: 8px;
}

i.wprss-updating-feed-icon {
    margin-left: 8px;
    display: none;
}

i.wprss-feed-error-symbol.wprss-show,
i.wprss-updating-feed-icon.wprss-show {
    display: inline-block;
}

/* Log textarea styles */
#wprss-log-textarea {
    width: 800px;
    height: 400px;
    font-family: Menlo, Monaco, monospace;
    background: none;
    white-space: pre-wrap;
    overflow: auto;
    display: block;
    background: rgb( 255, 245, 245 );
}



/*--------------------------------------------------------------------------
*
*   Add-Ons
*   
*-------------------------------------------------------------------------*/

#add-ons {
    margin-bottom: 20px;
}

#add-ons .add-on-group {
    display: flex;
    flex-flow: row wrap;
    justify-content: flex-start;
    align-items: flex-start;
}

#add-ons .add-on-group:first-child {
    margin-top: 0;
    padding-top: 0;
}

#add-ons .add-on {
    display: inline-block;
    position: relative;
    flex: 0 0 220px;
    width: 220px;
    margin: 10px 20px 10px 0;
    background: #FFFFFF;
    border: 1px solid #E5E5E5;
    border-radius: 3px;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.04);
    box-sizing: border-box;
    min-height: 320px;
    overflow: hidden;
}

#add-ons .add-on h3 {
    margin: 0.5em 0 1.5em;
}

#add-ons .add-on h3 a {
    color: inherit;
    text-decoration: none;
}

#add-ons .add-on .inner {
    min-height: 170px;
    padding: 20px 15px;
}

#add-ons .add-on .footer {
    overflow: hidden;
    position: absolute;
    width: 100%;
    bottom: 0;
    padding: 15px 0;
}

#add-ons .add-on .footer .button {
    float: left;
    margin-left: 15px;
}

.add-on .corner-ribbon {
    position: absolute;
    top: 18px;
    right: -47px;
    font-size: 12px;
    width: 150px;
    padding: 2px 0;
    color: #fff;
    background: #333;
    text-align: center;
    transform: rotate(45deg);
    transform-origin: center center;
}

#add-ons .add-on.bundle-plan {
    border: 2px solid #ff792b;
    box-shadow: 0 0 25px -12px rgba(255, 121, 43, 0.6);
}

#add-ons .add-on.bundle-plan .corner-ribbon {
    background: #ff792b;
}

#add-ons .add-on.spotlight .corner-ribbon {
    background: #DD234B;
}

#add-ons .add-on.bundle-plan .footer,
#add-ons .add-on.spotlight .footer {
    background: transparent;
    border-top: 0;
}


#add-ons .add-on-active .button-disabled:focus,
#add-ons .add-on-active .button-disabled:active {
    background: #fafafa;
}

#add-ons .add-on-title {
    float: left;
    width: 100%;
    margin: 25px 0 25px;
    border-top: #F5F5F5 solid 1px;
}

/*== BLACKLIST */
body.post-type-wprss_blacklist .add-new-h2,
body.post-type-wprss_blacklist ul.subsubsub,
body.post-type-wprss_blacklist .alignleft.actions {
    display: none;
}

body.post-type-wprss_blacklist .alignleft.actions.bulkactions {
    display: inline-block;
}

.wprss-header-small {
	color: #777;
	font-size: 0.7em;
}

/* Inline Help ============================================================== */

.wprss-tooltip-handle,
.wprss-tooltip-handle:hover,
.wprss-tooltip-handle:focus {
    text-decoration: none;
    color: #aaaaaa;
    outline: none;
}

.wprss-tooltip-handle {
    margin-left: 5px;
    font-size: 15px;
    color: rgb(190, 190, 190);
    vertical-align: middle;
}

.wprss-tooltip-handle-side {
    float: right;
}

.wprss-tooltip-content {
    display: none;
}

.wprss-ui-tooltip {
    color: #444 !important;
    padding: 8px 10px !important;
    background: #fefefe !important;
    border: 1px solid #ccc !important;
    border-radius: 1px !important;
    font-family: "Open Sans", sans-serif !important;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.17) !important;
}
.wprss-ui-tooltip p:first-child {
    margin-top: 0;
}
.wprss-ui-tooltip p:last-child {
    margin-bottom: 0;
}
.wprss-ui-tooltip p {
    margin: 8px 0;
}
.wprss-ui-tooltip p, code {
    font-size: 0.9em !important;
}
.wprss-ui-tooltip hr {
    margin: 0;
}

.wprss-section-tooltip-handle,
.wprss-section-tooltip-handle:hover,
.wprss-section-tooltip-handle:active,
.wprss-section-tooltip-handle:visited,
.wprss-section-tooltip-handle:link,
.wprss-section-tooltip-handle:focus {
    color: #006799;
    margin-left: 5px;
    text-decoration: none;
    outline: none;
    cursor: help;
    font-size: 15px;
}

/* For non settings page screens */
@media only screen and (max-width: 850px) {

    body:not(.wprss_feed_page_wprss-aggregator-settings) .wprss-tooltip-handle {
        color: #999;
        font-size: 1em;
        padding: 6px 10px;
        margin-left: 0;
        background: #e5e5e5;
        border-radius: 3px;
        vertical-align: middle;
    }

    body:not(.wprss_feed_page_wprss-aggregator-settings) select + .wprss-tooltip-handle,
    body:not(.wprss_feed_page_wprss-aggregator-settings) input[type="input"] + .wprss-tooltip-handle,
    body:not(.wprss_feed_page_wprss-aggregator-settings) input[type="password"] + .wprss-tooltip-handle {
        margin-top: 5px;
    }

    body:not(.wprss_feed_page_wprss-aggregator-settings) .wprss-tooltip-handle:after {
        content: 'Help';
        margin-left: 5px;
        font-family: 'Open Sans', sans-serif;
    }

}


/* For settings page screens */
@media only screen and (max-width: 782px) {

    body.wprss_feed_page_wprss-aggregator-settings .wprss-tooltip-handle {
        color: #999;
        font-size: 1em;
        padding: 6px 10px;
        margin-left: 0;
        background: #e5e5e5;
        border-radius: 3px;
        vertical-align: middle;
    }

    body.wprss_feed_page_wprss-aggregator-settings select + .wprss-tooltip-handle,
    body.wprss_feed_page_wprss-aggregator-settings input[type="input"] + .wprss-tooltip-handle,
    body.wprss_feed_page_wprss-aggregator-settings input[type="password"] + .wprss-tooltip-handle {
        margin-top: 5px;
    }

    body.wprss_feed_page_wprss-aggregator-settings .wprss-tooltip-handle:after {
        content: 'Help';
        margin-left: 5px;
        font-family: 'Open Sans', sans-serif;
    }

}


@media only screen and (max-width: 1026px) {
    .wprss-tr-hr th {
        padding-top: 10px;
    }
}

.ajax-error,
.ajax-error:hover,
.ajax-error:visited,
.ajax-error:link,
.ajax-error:active {
    color: #a00;
}

/* Removes the "Add New" button for Feed Items */
.post-type-wprss_feed_item .page-title-action {
    display: none
}

/* Changelog styles */
.wpra-changelog-container h2 {
    font-size: 1.4em;
}
.wpra-changelog-container h3 {
    font-weight: normal;
    font-size: 1.2em;
}
.wpra-changelog-container ul {
    list-style: disc;
    list-style-position: inside;
}

.wpra_ft_image_option {
    margin-top: 10px;
}

#wpra_image_min_size_row {
    display: none;
}

/* Spacing between image width and height fields */
#wpra_image_min_size_row > td > label {
    margin-right: 10px;
}

#wprss-feed-def-ft-image-preview {
    width: 220px;
}

#wprss-feed-def-ft-image-preview-hint {
    margin-bottom: 8px;
}


/*
 * The Feed Source List Table styles that mimic the plugins table
 */

.post-type-wprss_feed table.wp-list-table.posts tbody tr th,
.post-type-wprss_feed table.wp-list-table.posts tbody tr td
{
    box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .1);
}

/* Feed updating/deleting animation in feed sources table */
.post-type-wprss_feed table.wp-list-table.posts tbody tr.wpra-feed-is-updating,
.post-type-wprss_feed table.wp-list-table.posts tbody tr.wpra-feed-is-deleting {
    /*background-image: linear-gradient(-45deg, rgba(30, 30, 30, 0.05) 25%, transparent 0, transparent 50%, rgba(50, 50, 50, 0.05) 50%, rgba(30, 30, 30, 0.05) 75%, transparent 0, #0000);*/
    /*background-image: linear-gradient(*/
    /*        -45deg, rgba(0, 0, 0, 0.9) 25%,*/
    /*        transparent 0,*/
    /*        transparent 50%,*/
    /*        rgba(0, 0, 0, 0.9) 50%,*/
    /*        rgba(0, 0, 0, 0.9) 75%,*/
    /*        transparent 0, #0000*/
    /*);*/
    background-size: 80px 80px;
    background-blend-mode: overlay;
}

.post-type-wprss_feed table.wp-list-table.posts tbody tr.wpra-feed-is-updating > *,
.post-type-wprss_feed table.wp-list-table.posts tbody tr.wpra-feed-is-deleting > * {
    background: transparent !important;
}

.post-type-wprss_feed table.wp-list-table.posts tbody tr.wpra-feed-is-updating {
    animation: wpra-feed-updating-animation 1.3s linear infinite;
    background-color: #e9f9ee;
}
.post-type-wprss_feed table.wp-list-table.posts tbody tr.wpra-feed-is-deleting {
    animation: wpra-feed-updating-animation 1s linear infinite;
    background-color: #f8eaea;
}

@keyframes wpra-feed-updating-animation {
    0% {
        background-position: 0 0;
    }
    50% {
        background-position: 80px 80px;
    }
    100% {
        background-position: 160px 160px;
    }
}

/*
 * Styles for the Feed Source List Table "State" column
 */
div.wprss-feed-state-container,
div.wprss-feed-source-type
{
    display: inline-block;
}

/* the feed type icon */
div.wprss-feed-source-type {
    float: right;
}
/* inactive color */
.post-type-wprss_feed table.wp-list-table tr div.wprss-feed-source-type {
    color: #aaa;
}
/* active color */
.post-type-wprss_feed table.wp-list-table tr.active div.wprss-feed-source-type {
    color: #ff792b;
}
/* youtube color */
.post-type-wprss_feed table.wp-list-table tr.active div.wprss-feed-source-type.wprss-feed-source-type-yt {
    color: #ff0000;
}

.post-type-wprss_feed table.wp-list-table tbody td.column-state {
    padding-right: 0;
}

.column-updates > p {
    margin: 0 !important;
}
.post-type-wprss_feed table.wp-list-table.posts tbody tr .next-update-container {
    font-weight: bold;
}
.post-type-wprss_feed table.wp-list-table.posts tbody tr:not(.active) .next-update-container {
    display: none;
}

/* The last update time in the feed sources page table */
.post-type-wprss_feed table.wp-list-table.posts .last-update-num-items-container {
    color: #666;
    font-style: italic;
    font-size: 90%;
}

/* The imported items link in the feed sources page - disabled when 0 items */
.post-type-wprss_feed table.wp-list-table.posts .items-imported-link.has-imported-items {
    font-weight: bold;
    line-height: 20px;
}
.post-type-wprss_feed table.wp-list-table.posts .items-imported-link:not(.has-imported-items) {
    color: #777;
    pointer-events: none;
}

/* The delete items row action in the feed sources page - hidden when 0 items */
.post-type-wprss_feed table.wp-list-table.posts .row-actions .purge-posts:not(.has-imported-items) {
    display: none;
}

/* Styles for the disabled "Fetch" and "Delete" feed source row actions */
.post-type-wprss_feed table.wp-list-table.posts .row-actions a.wprss_fetch_items_ajax_action[disabled] {
    color: #555;
}
.post-type-wprss_feed table.wp-list-table.posts .row-actions a.wprss_delete_items_ajax_action[disabled] {
    color: #666;
}

/* The feed updating/deleting spinner icon */
.post-type-wprss_feed table.wp-list-table.posts .column-feed-count .spinner {
    float: none;
    vertical-align: bottom;
}
.post-type-wprss_feed table.wp-list-table.posts tr.wpra-feed-is-updating .column-feed-count .spinner,
.post-type-wprss_feed table.wp-list-table.posts tr.wpra-feed-is-deleting .column-feed-count .spinner {
    visibility: visible;
}

/*
 * TOGGLE SWITCH
 */
.wprss-switch {
    position: relative;
    display: inline-block;
    width: 34px;
    height: 18px;
}
.wprss-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}
.wprss-switch-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 34px;
    background-color: #ccc;
    transition: .2s;
    -webkit-transition: .2s;
}
.wprss-switch-slider:before {
    position: absolute;
    content: "";
    width: 12px;
    height: 12px;
    left: 4px;
    bottom: 3px;
    border-radius: 50%;
    background-color: white;
    transition: .2s;
    -webkit-transition: .2s;
}
input:checked + .wprss-switch-slider {
    background-color: #0baa3c;
}
input:focus + .wprss-switch-slider {
    box-shadow: 0 0 1px #2196F3;
}
input:checked + .wprss-switch-slider:before {
    -webkit-transform: translateX(14px);
    -ms-transform: translateX(14px);
    transform: translateX(14px);
}

.postbox .inside .wpra-feed-save-meta-box {
    border-bottom: 1px solid #ccc;
    padding: 10px;
    margin: 0 -10px;
    margin-top: -11px;
    margin-bottom: 10px;
    background: #fff;
}

.postbox .inside .wpra-feed-save-meta-box label span {
    font-weight: bold;
    font-size: 14px;
}

.postbox .inside .wpra-feed-save-meta-box input[type="text"] {
    text-align: left !important;
}

/* -- INLINE STYLES -- */

form.wpra-inline-form {
    display: inline-block;
}

form.wpra-header-form {
    display: inline-block;
    margin: 0;
    padding: 0;
    border: 0;
}

h1.wpra-inline-header,
h2.wpra-inline-header,
h3.wpra-inline-header,
h4.wpra-inline-header
{
    display: inline-block;
    margin-right: 5px;
}

button.button.wpra-header-button {
    position: relative;
    vertical-align: baseline;
    top: -1px;
}

/* -- SLIDE BOX -- */

div.wpra-slide-box {
    display: none;
    margin: 10px 0;
    padding: 15px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 2px;
}

div.wpra-slide-box.wpra-slide-box-open {
    display: block;
}

div.wpra-slide-box form {
    display: block;
}

div.wpra-slide-box h4 {
    font-size: 16px;
    margin: 0;
    margin-bottom: 15px;
    padding-bottom: 5px;
    border-bottom: 1px solid #ddd;
}

div.wpra-slide-box form label {
    display: flex;
    flex-direction: row;
    align-items: center;
    line-height: 1;
    font-size: 1em;
    margin: 5px 0;
}

div.wpra-slide-box label > * {
    flex-grow: 1;
}

div.wpra-slide-box label > span {
    display: inline-block;
    flex-grow: 0;
    width: 200px;
    font-size: 1em;
}
div.wpra-slide-box label input[type="text"],
div.wpra-slide-box label input[type="number"],
div.wpra-slide-box label input[type="text"]
{
    height: 28px;
    min-height: 28px;
}

div.wpra-slide-box div.wpra-submit-wrap {
    margin-top: 10px;
}
div.wpra-slide-box div.wpra-submit-wrap.right {
    text-align: right;
}

div.wpra-slide-box div.wpra-submit-wrap > button {
    text-align: center;
}

/* -- ERROR LOG OPTIONS (SLIDE BOX) -- */

#wprss-log-options-form input[name="logging_limit_days"] {
    width: 80px;
}

/* -- BLACKLIST TOOL -- */

#wpra-add-blacklist-container form label span:first-child {
    width: 120px;
}

/* -- LOG TOOL -- */

#wprss-error-log-options {
    margin: 15px 0;
}

#wprss-clear-error-log-form {
    float: right;
    position: relative;
    top: -3px;
}

.wpra-log-filters {
    padding: 2px 0;
    margin: 0;
}
p.wpra-logs-shown-msg {
    margin: 5px 0;
}

/* -- MISC -- */
.wpra-no-margin {
    margin: 0;
}


File Name:
admin-tracking-styles.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\admin-tracking-styles.css
Code:
#wprss_tracking_notice {
    position: fixed;
    display: inline-block;

    top: 45px;
    left: 50%;

    width: 300px;
    height: auto;
    padding: 40px 10px 10px;
    margin-left: -150px;

    background: white;
    border: 1px solid #ccc;
    border-radius: 3px;
    box-shadow: 0px 0px 6px rgba(0,0,0,0.2);
    z-index: 20000;

    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -o-box-sizing: border-box;
}

#wprss_tracking_notice > p {
    margin: 0;
}
#wprss_tracking_notice > p:first-child {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding: 6px 10px;
    font-weight: bold;
    background: #008BC2;
    color: white;
}

#wprss_tracking_notice > p:nth-child(2) {
    padding-bottom: 5px;
    margin-bottom: 12px;
    border-bottom: 1px solid #ccc;
}

File Name:
beacon.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\beacon.css
Code:
#HSBeaconFabButton {
    bottom: 16px !important;
    right: 20px !important;
}

#HSBeaconContainerFrame {
    bottom: 86px !important;
    right: 20px !important;
}

#beacon-container iframe {
    z-index: 1000000 !important;
}


File Name:
colorbox.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\colorbox.css
Code:
/*
    ColorBox Core Style:
    The following CSS is consistent between example themes and should not be altered.
*/
#colorbox, #cboxOverlay, #cboxWrapper{position:absolute; top:0; left:0; z-index:9999; overflow:hidden;}
#cboxOverlay{position:fixed; width:100%; height:100%;}
#cboxMiddleLeft, #cboxBottomLeft{clear:left;}
#cboxContent{position:relative;}
#cboxLoadedContent{overflow:auto; -webkit-overflow-scrolling: touch;}
#cboxTitle{margin:0;}
#cboxLoadingOverlay, #cboxLoadingGraphic{position:absolute; top:0; left:0; width:100%; height:100%;}
#cboxPrevious, #cboxNext, #cboxClose, #cboxSlideshow{cursor:pointer;}
.cboxPhoto{float:left; margin:auto; border:0; display:block; max-width:none;}
.cboxIframe{width:100%; height:100%; display:block; border:0;}
#colorbox, #cboxContent, #cboxLoadedContent{box-sizing:content-box; -moz-box-sizing:content-box; -webkit-box-sizing:content-box;}

/* 
    User Style:
    Change the following styles to modify the appearance of ColorBox.  They are
    ordered & tabbed in a way that represents the nesting of the generated HTML.
*/
#cboxOverlay{background:url(../images/colorbox/overlay.png) repeat 0 0;}
#colorbox{outline:0;}
    #cboxTopLeft{width:21px; height:21px; background:url(../images/colorbox/controls.png) no-repeat -101px 0;}
    #cboxTopRight{width:21px; height:21px; background:url(../images/colorbox/controls.png) no-repeat -130px 0;}
    #cboxBottomLeft{width:21px; height:21px; background:url(../images/colorbox/controls.png) no-repeat -101px -29px;}
    #cboxBottomRight{width:21px; height:21px; background:url(../images/colorbox/controls.png) no-repeat -130px -29px;}
    #cboxMiddleLeft{width:21px; background:url(../images/colorbox/controls.png) left top repeat-y;}
    #cboxMiddleRight{width:21px; background:url(../images/colorbox/controls.png) right top repeat-y;}
    #cboxTopCenter{height:21px; background:url(../images/colorbox/border.png) 0 0 repeat-x;}
    #cboxBottomCenter{height:21px; background:url(../images/colorbox/border.png) 0 -29px repeat-x;}
    #cboxContent{background:#fff; overflow:hidden;}
        .cboxIframe{background:#fff;}
        #cboxError{padding:50px; border:1px solid #ccc;}
        #cboxLoadedContent{margin-bottom:28px;}
        #cboxTitle{position:absolute; bottom:4px; left:0; text-align:center; width:100%; color:#949494;}
        #cboxCurrent{position:absolute; bottom:4px; left:58px; color:#949494;}
        #cboxLoadingOverlay{background:url(../images/colorbox/loading_background.png) no-repeat center center;}
        #cboxLoadingGraphic{background:url(../images/colorbox/loading.gif) no-repeat center center;}

        /* these elements are buttons, and may need to have additional styles reset to avoid unwanted base styles */
        #cboxPrevious, #cboxNext, #cboxSlideshow, #cboxClose {border:0; padding:0; margin:0; overflow:visible; width:auto; background:none; }
        
        /* avoid outlines on :active (mouseclick), but preserve outlines on :focus (tabbed navigating) */
        #cboxPrevious:active, #cboxNext:active, #cboxSlideshow:active, #cboxClose:active {outline:0;}

        #cboxSlideshow{position:absolute; bottom:4px; right:30px; color:#0092ef;}
        #cboxPrevious{position:absolute; bottom:0; left:0; background:url(../images/colorbox/controls.png) no-repeat -75px 0; width:25px; height:25px; text-indent:-9999px;}
        #cboxPrevious:hover{background-position:-75px -25px;}
        #cboxNext{position:absolute; bottom:0; left:27px; background:url(../images/colorbox/controls.png) no-repeat -50px 0; width:25px; height:25px; text-indent:-9999px;}
        #cboxNext:hover{background-position:-50px -25px;}
        #cboxClose{position:absolute; bottom:0; right:0; background:url(../images/colorbox/controls.png) no-repeat -25px 0; width:25px; height:25px; text-indent:-9999px;}
        #cboxClose:hover{background-position:-25px -25px;}

/*
  The following fixes a problem where IE7 and IE8 replace a PNG's alpha transparency with a black fill
  when an alpha filter (opacity change) is set on the element or ancestor element.  This style is not applied to or needed in IE9.
  See: http://jacklmoore.com/notes/ie-transparency-problems/
*/
.cboxIE #cboxTopLeft,
.cboxIE #cboxTopCenter,
.cboxIE #cboxTopRight,
.cboxIE #cboxBottomLeft,
.cboxIE #cboxBottomCenter,
.cboxIE #cboxBottomRight,
.cboxIE #cboxMiddleLeft,
.cboxIE #cboxMiddleRight {
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#00FFFFFF,endColorstr=#00FFFFFF);
}

/*
  The following provides PNG transparency support for IE6
  Feel free to remove this and the /ie6/ directory if you have dropped IE6 support.
*/
.cboxIE6 #cboxTopLeft{background:url(../images/colorbox/ie6/borderTopLeft.png);}
.cboxIE6 #cboxTopCenter{background:url(../images/colorbox/ie6/borderTopCenter.png);}
.cboxIE6 #cboxTopRight{background:url(../images/colorbox/ie6/borderTopRight.png);}
.cboxIE6 #cboxBottomLeft{background:url(../images/colorbox/ie6/borderBottomLeft.png);}
.cboxIE6 #cboxBottomCenter{background:url(../images/colorbox/ie6/borderBottomCenter.png);}
.cboxIE6 #cboxBottomRight{background:url(../images/colorbox/ie6/borderBottomRight.png);}
.cboxIE6 #cboxMiddleLeft{background:url(../images/colorbox/ie6/borderMiddleLeft.png);}
.cboxIE6 #cboxMiddleRight{background:url(../images/colorbox/ie6/borderMiddleRight.png);}

.cboxIE6 #cboxTopLeft,
.cboxIE6 #cboxTopCenter,
.cboxIE6 #cboxTopRight,
.cboxIE6 #cboxBottomLeft,
.cboxIE6 #cboxBottomCenter,
.cboxIE6 #cboxBottomRight,
.cboxIE6 #cboxMiddleLeft,
.cboxIE6 #cboxMiddleRight {
    _behavior: expression(this.src = this.src ? this.src : this.currentStyle.backgroundImage.split('"')[1], this.style.background = "none", this.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src=" + this.src + ", sizingMethod='scale')");
}


File Name:
font-awesome.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\font-awesome.min.css
Code:
/*!
 *  Font Awesome 4.0.3 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */@font-face{font-family:'FontAwesome';src:url('../fonts/fontawesome-webfont.eot?v=4.0.3');src:url('../fonts/fontawesome-webfont.eot?#iefix&v=4.0.3') format('embedded-opentype'),url('../fonts/fontawesome-webfont.woff?v=4.0.3') format('woff'),url('../fonts/fontawesome-webfont.ttf?v=4.0.3') format('truetype'),url('../fonts/fontawesome-webfont.svg?v=4.0.3#fontawesomeregular') format('svg');font-weight:normal;font-style:normal}.fa{display:inline-block;font-family:FontAwesome;font-style:normal;font-weight:normal;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.3333333333333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.2857142857142858em;text-align:center}.fa-ul{padding-left:0;margin-left:2.142857142857143em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.142857142857143em;width:2.142857142857143em;top:.14285714285714285em;text-align:center}.fa-li.fa-lg{left:-1.8571428571428572em}.fa-border{padding:.2em .25em .15em;border:solid .08em #eee;border-radius:.1em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:spin 2s infinite linear;-moz-animation:spin 2s infinite linear;-o-animation:spin 2s infinite linear;animation:spin 2s infinite linear}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg)}100%{-moz-transform:rotate(359deg)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg)}100%{-o-transform:rotate(359deg)}}@-ms-keyframes spin{0%{-ms-transform:rotate(0deg)}100%{-ms-transform:rotate(359deg)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(359deg)}}.fa-rotate-90{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-ms-transform:rotate(90deg);-o-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2);-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-webkit-transform:rotate(270deg);-moz-transform:rotate(270deg);-ms-transform:rotate(270deg);-o-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=0,mirror=1);-webkit-transform:scale(-1,1);-moz-transform:scale(-1,1);-ms-transform:scale(-1,1);-o-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2,mirror=1);-webkit-transform:scale(1,-1);-moz-transform:scale(1,-1);-ms-transform:scale(1,-1);-o-transform:scale(1,-1);transform:scale(1,-1)}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:"\f000"}.fa-music:before{content:"\f001"}.fa-search:before{content:"\f002"}.fa-envelope-o:before{content:"\f003"}.fa-heart:before{content:"\f004"}.fa-star:before{content:"\f005"}.fa-star-o:before{content:"\f006"}.fa-user:before{content:"\f007"}.fa-film:before{content:"\f008"}.fa-th-large:before{content:"\f009"}.fa-th:before{content:"\f00a"}.fa-th-list:before{content:"\f00b"}.fa-check:before{content:"\f00c"}.fa-times:before{content:"\f00d"}.fa-search-plus:before{content:"\f00e"}.fa-search-minus:before{content:"\f010"}.fa-power-off:before{content:"\f011"}.fa-signal:before{content:"\f012"}.fa-gear:before,.fa-cog:before{content:"\f013"}.fa-trash-o:before{content:"\f014"}.fa-home:before{content:"\f015"}.fa-file-o:before{content:"\f016"}.fa-clock-o:before{content:"\f017"}.fa-road:before{content:"\f018"}.fa-download:before{content:"\f019"}.fa-arrow-circle-o-down:before{content:"\f01a"}.fa-arrow-circle-o-up:before{content:"\f01b"}.fa-inbox:before{content:"\f01c"}.fa-play-circle-o:before{content:"\f01d"}.fa-rotate-right:before,.fa-repeat:before{content:"\f01e"}.fa-refresh:before{content:"\f021"}.fa-list-alt:before{content:"\f022"}.fa-lock:before{content:"\f023"}.fa-flag:before{content:"\f024"}.fa-headphones:before{content:"\f025"}.fa-volume-off:before{content:"\f026"}.fa-volume-down:before{content:"\f027"}.fa-volume-up:before{content:"\f028"}.fa-qrcode:before{content:"\f029"}.fa-barcode:before{content:"\f02a"}.fa-tag:before{content:"\f02b"}.fa-tags:before{content:"\f02c"}.fa-book:before{content:"\f02d"}.fa-bookmark:before{content:"\f02e"}.fa-print:before{content:"\f02f"}.fa-camera:before{content:"\f030"}.fa-font:before{content:"\f031"}.fa-bold:before{content:"\f032"}.fa-italic:before{content:"\f033"}.fa-text-height:before{content:"\f034"}.fa-text-width:before{content:"\f035"}.fa-align-left:before{content:"\f036"}.fa-align-center:before{content:"\f037"}.fa-align-right:before{content:"\f038"}.fa-align-justify:before{content:"\f039"}.fa-list:before{content:"\f03a"}.fa-dedent:before,.fa-outdent:before{content:"\f03b"}.fa-indent:before{content:"\f03c"}.fa-video-camera:before{content:"\f03d"}.fa-picture-o:before{content:"\f03e"}.fa-pencil:before{content:"\f040"}.fa-map-marker:before{content:"\f041"}.fa-adjust:before{content:"\f042"}.fa-tint:before{content:"\f043"}.fa-edit:before,.fa-pencil-square-o:before{content:"\f044"}.fa-share-square-o:before{content:"\f045"}.fa-check-square-o:before{content:"\f046"}.fa-arrows:before{content:"\f047"}.fa-step-backward:before{content:"\f048"}.fa-fast-backward:before{content:"\f049"}.fa-backward:before{content:"\f04a"}.fa-play:before{content:"\f04b"}.fa-pause:before{content:"\f04c"}.fa-stop:before{content:"\f04d"}.fa-forward:before{content:"\f04e"}.fa-fast-forward:before{content:"\f050"}.fa-step-forward:before{content:"\f051"}.fa-eject:before{content:"\f052"}.fa-chevron-left:before{content:"\f053"}.fa-chevron-right:before{content:"\f054"}.fa-plus-circle:before{content:"\f055"}.fa-minus-circle:before{content:"\f056"}.fa-times-circle:before{content:"\f057"}.fa-check-circle:before{content:"\f058"}.fa-question-circle:before{content:"\f059"}.fa-info-circle:before{content:"\f05a"}.fa-crosshairs:before{content:"\f05b"}.fa-times-circle-o:before{content:"\f05c"}.fa-check-circle-o:before{content:"\f05d"}.fa-ban:before{content:"\f05e"}.fa-arrow-left:before{content:"\f060"}.fa-arrow-right:before{content:"\f061"}.fa-arrow-up:before{content:"\f062"}.fa-arrow-down:before{content:"\f063"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-expand:before{content:"\f065"}.fa-compress:before{content:"\f066"}.fa-plus:before{content:"\f067"}.fa-minus:before{content:"\f068"}.fa-asterisk:before{content:"\f069"}.fa-exclamation-circle:before{content:"\f06a"}.fa-gift:before{content:"\f06b"}.fa-leaf:before{content:"\f06c"}.fa-fire:before{content:"\f06d"}.fa-eye:before{content:"\f06e"}.fa-eye-slash:before{content:"\f070"}.fa-warning:before,.fa-exclamation-triangle:before{content:"\f071"}.fa-plane:before{content:"\f072"}.fa-calendar:before{content:"\f073"}.fa-random:before{content:"\f074"}.fa-comment:before{content:"\f075"}.fa-magnet:before{content:"\f076"}.fa-chevron-up:before{content:"\f077"}.fa-chevron-down:before{content:"\f078"}.fa-retweet:before{content:"\f079"}.fa-shopping-cart:before{content:"\f07a"}.fa-folder:before{content:"\f07b"}.fa-folder-open:before{content:"\f07c"}.fa-arrows-v:before{content:"\f07d"}.fa-arrows-h:before{content:"\f07e"}.fa-bar-chart-o:before{content:"\f080"}.fa-twitter-square:before{content:"\f081"}.fa-facebook-square:before{content:"\f082"}.fa-camera-retro:before{content:"\f083"}.fa-key:before{content:"\f084"}.fa-gears:before,.fa-cogs:before{content:"\f085"}.fa-comments:before{content:"\f086"}.fa-thumbs-o-up:before{content:"\f087"}.fa-thumbs-o-down:before{content:"\f088"}.fa-star-half:before{content:"\f089"}.fa-heart-o:before{content:"\f08a"}.fa-sign-out:before{content:"\f08b"}.fa-linkedin-square:before{content:"\f08c"}.fa-thumb-tack:before{content:"\f08d"}.fa-external-link:before{content:"\f08e"}.fa-sign-in:before{content:"\f090"}.fa-trophy:before{content:"\f091"}.fa-github-square:before{content:"\f092"}.fa-upload:before{content:"\f093"}.fa-lemon-o:before{content:"\f094"}.fa-phone:before{content:"\f095"}.fa-square-o:before{content:"\f096"}.fa-bookmark-o:before{content:"\f097"}.fa-phone-square:before{content:"\f098"}.fa-twitter:before{content:"\f099"}.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-unlock:before{content:"\f09c"}.fa-credit-card:before{content:"\f09d"}.fa-rss:before{content:"\f09e"}.fa-hdd-o:before{content:"\f0a0"}.fa-bullhorn:before{content:"\f0a1"}.fa-bell:before{content:"\f0f3"}.fa-certificate:before{content:"\f0a3"}.fa-hand-o-right:before{content:"\f0a4"}.fa-hand-o-left:before{content:"\f0a5"}.fa-hand-o-up:before{content:"\f0a6"}.fa-hand-o-down:before{content:"\f0a7"}.fa-arrow-circle-left:before{content:"\f0a8"}.fa-arrow-circle-right:before{content:"\f0a9"}.fa-arrow-circle-up:before{content:"\f0aa"}.fa-arrow-circle-down:before{content:"\f0ab"}.fa-globe:before{content:"\f0ac"}.fa-wrench:before{content:"\f0ad"}.fa-tasks:before{content:"\f0ae"}.fa-filter:before{content:"\f0b0"}.fa-briefcase:before{content:"\f0b1"}.fa-arrows-alt:before{content:"\f0b2"}.fa-group:before,.fa-users:before{content:"\f0c0"}.fa-chain:before,.fa-link:before{content:"\f0c1"}.fa-cloud:before{content:"\f0c2"}.fa-flask:before{content:"\f0c3"}.fa-cut:before,.fa-scissors:before{content:"\f0c4"}.fa-copy:before,.fa-files-o:before{content:"\f0c5"}.fa-paperclip:before{content:"\f0c6"}.fa-save:before,.fa-floppy-o:before{content:"\f0c7"}.fa-square:before{content:"\f0c8"}.fa-bars:before{content:"\f0c9"}.fa-list-ul:before{content:"\f0ca"}.fa-list-ol:before{content:"\f0cb"}.fa-strikethrough:before{content:"\f0cc"}.fa-underline:before{content:"\f0cd"}.fa-table:before{content:"\f0ce"}.fa-magic:before{content:"\f0d0"}.fa-truck:before{content:"\f0d1"}.fa-pinterest:before{content:"\f0d2"}.fa-pinterest-square:before{content:"\f0d3"}.fa-google-plus-square:before{content:"\f0d4"}.fa-google-plus:before{content:"\f0d5"}.fa-money:before{content:"\f0d6"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-up:before{content:"\f0d8"}.fa-caret-left:before{content:"\f0d9"}.fa-caret-right:before{content:"\f0da"}.fa-columns:before{content:"\f0db"}.fa-unsorted:before,.fa-sort:before{content:"\f0dc"}.fa-sort-down:before,.fa-sort-asc:before{content:"\f0dd"}.fa-sort-up:before,.fa-sort-desc:before{content:"\f0de"}.fa-envelope:before{content:"\f0e0"}.fa-linkedin:before{content:"\f0e1"}.fa-rotate-left:before,.fa-undo:before{content:"\f0e2"}.fa-legal:before,.fa-gavel:before{content:"\f0e3"}.fa-dashboard:before,.fa-tachometer:before{content:"\f0e4"}.fa-comment-o:before{content:"\f0e5"}.fa-comments-o:before{content:"\f0e6"}.fa-flash:before,.fa-bolt:before{content:"\f0e7"}.fa-sitemap:before{content:"\f0e8"}.fa-umbrella:before{content:"\f0e9"}.fa-paste:before,.fa-clipboard:before{content:"\f0ea"}.fa-lightbulb-o:before{content:"\f0eb"}.fa-exchange:before{content:"\f0ec"}.fa-cloud-download:before{content:"\f0ed"}.fa-cloud-upload:before{content:"\f0ee"}.fa-user-md:before{content:"\f0f0"}.fa-stethoscope:before{content:"\f0f1"}.fa-suitcase:before{content:"\f0f2"}.fa-bell-o:before{content:"\f0a2"}.fa-coffee:before{content:"\f0f4"}.fa-cutlery:before{content:"\f0f5"}.fa-file-text-o:before{content:"\f0f6"}.fa-building-o:before{content:"\f0f7"}.fa-hospital-o:before{content:"\f0f8"}.fa-ambulance:before{content:"\f0f9"}.fa-medkit:before{content:"\f0fa"}.fa-fighter-jet:before{content:"\f0fb"}.fa-beer:before{content:"\f0fc"}.fa-h-square:before{content:"\f0fd"}.fa-plus-square:before{content:"\f0fe"}.fa-angle-double-left:before{content:"\f100"}.fa-angle-double-right:before{content:"\f101"}.fa-angle-double-up:before{content:"\f102"}.fa-angle-double-down:before{content:"\f103"}.fa-angle-left:before{content:"\f104"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-angle-down:before{content:"\f107"}.fa-desktop:before{content:"\f108"}.fa-laptop:before{content:"\f109"}.fa-tablet:before{content:"\f10a"}.fa-mobile-phone:before,.fa-mobile:before{content:"\f10b"}.fa-circle-o:before{content:"\f10c"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-spinner:before{content:"\f110"}.fa-circle:before{content:"\f111"}.fa-mail-reply:before,.fa-reply:before{content:"\f112"}.fa-github-alt:before{content:"\f113"}.fa-folder-o:before{content:"\f114"}.fa-folder-open-o:before{content:"\f115"}.fa-smile-o:before{content:"\f118"}.fa-frown-o:before{content:"\f119"}.fa-meh-o:before{content:"\f11a"}.fa-gamepad:before{content:"\f11b"}.fa-keyboard-o:before{content:"\f11c"}.fa-flag-o:before{content:"\f11d"}.fa-flag-checkered:before{content:"\f11e"}.fa-terminal:before{content:"\f120"}.fa-code:before{content:"\f121"}.fa-reply-all:before{content:"\f122"}.fa-mail-reply-all:before{content:"\f122"}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:"\f123"}.fa-location-arrow:before{content:"\f124"}.fa-crop:before{content:"\f125"}.fa-code-fork:before{content:"\f126"}.fa-unlink:before,.fa-chain-broken:before{content:"\f127"}.fa-question:before{content:"\f128"}.fa-info:before{content:"\f129"}.fa-exclamation:before{content:"\f12a"}.fa-superscript:before{content:"\f12b"}.fa-subscript:before{content:"\f12c"}.fa-eraser:before{content:"\f12d"}.fa-puzzle-piece:before{content:"\f12e"}.fa-microphone:before{content:"\f130"}.fa-microphone-slash:before{content:"\f131"}.fa-shield:before{content:"\f132"}.fa-calendar-o:before{content:"\f133"}.fa-fire-extinguisher:before{content:"\f134"}.fa-rocket:before{content:"\f135"}.fa-maxcdn:before{content:"\f136"}.fa-chevron-circle-left:before{content:"\f137"}.fa-chevron-circle-right:before{content:"\f138"}.fa-chevron-circle-up:before{content:"\f139"}.fa-chevron-circle-down:before{content:"\f13a"}.fa-html5:before{content:"\f13b"}.fa-css3:before{content:"\f13c"}.fa-anchor:before{content:"\f13d"}.fa-unlock-alt:before{content:"\f13e"}.fa-bullseye:before{content:"\f140"}.fa-ellipsis-h:before{content:"\f141"}.fa-ellipsis-v:before{content:"\f142"}.fa-rss-square:before{content:"\f143"}.fa-play-circle:before{content:"\f144"}.fa-ticket:before{content:"\f145"}.fa-minus-square:before{content:"\f146"}.fa-minus-square-o:before{content:"\f147"}.fa-level-up:before{content:"\f148"}.fa-level-down:before{content:"\f149"}.fa-check-square:before{content:"\f14a"}.fa-pencil-square:before{content:"\f14b"}.fa-external-link-square:before{content:"\f14c"}.fa-share-square:before{content:"\f14d"}.fa-compass:before{content:"\f14e"}.fa-toggle-down:before,.fa-caret-square-o-down:before{content:"\f150"}.fa-toggle-up:before,.fa-caret-square-o-up:before{content:"\f151"}.fa-toggle-right:before,.fa-caret-square-o-right:before{content:"\f152"}.fa-euro:before,.fa-eur:before{content:"\f153"}.fa-gbp:before{content:"\f154"}.fa-dollar:before,.fa-usd:before{content:"\f155"}.fa-rupee:before,.fa-inr:before{content:"\f156"}.fa-cny:before,.fa-rmb:before,.fa-yen:before,.fa-jpy:before{content:"\f157"}.fa-ruble:before,.fa-rouble:before,.fa-rub:before{content:"\f158"}.fa-won:before,.fa-krw:before{content:"\f159"}.fa-bitcoin:before,.fa-btc:before{content:"\f15a"}.fa-file:before{content:"\f15b"}.fa-file-text:before{content:"\f15c"}.fa-sort-alpha-asc:before{content:"\f15d"}.fa-sort-alpha-desc:before{content:"\f15e"}.fa-sort-amount-asc:before{content:"\f160"}.fa-sort-amount-desc:before{content:"\f161"}.fa-sort-numeric-asc:before{content:"\f162"}.fa-sort-numeric-desc:before{content:"\f163"}.fa-thumbs-up:before{content:"\f164"}.fa-thumbs-down:before{content:"\f165"}.fa-youtube-square:before{content:"\f166"}.fa-youtube:before{content:"\f167"}.fa-xing:before{content:"\f168"}.fa-xing-square:before{content:"\f169"}.fa-youtube-play:before{content:"\f16a"}.fa-dropbox:before{content:"\f16b"}.fa-stack-overflow:before{content:"\f16c"}.fa-instagram:before{content:"\f16d"}.fa-flickr:before{content:"\f16e"}.fa-adn:before{content:"\f170"}.fa-bitbucket:before{content:"\f171"}.fa-bitbucket-square:before{content:"\f172"}.fa-tumblr:before{content:"\f173"}.fa-tumblr-square:before{content:"\f174"}.fa-long-arrow-down:before{content:"\f175"}.fa-long-arrow-up:before{content:"\f176"}.fa-long-arrow-left:before{content:"\f177"}.fa-long-arrow-right:before{content:"\f178"}.fa-apple:before{content:"\f179"}.fa-windows:before{content:"\f17a"}.fa-android:before{content:"\f17b"}.fa-linux:before{content:"\f17c"}.fa-dribbble:before{content:"\f17d"}.fa-skype:before{content:"\f17e"}.fa-foursquare:before{content:"\f180"}.fa-trello:before{content:"\f181"}.fa-female:before{content:"\f182"}.fa-male:before{content:"\f183"}.fa-gittip:before{content:"\f184"}.fa-sun-o:before{content:"\f185"}.fa-moon-o:before{content:"\f186"}.fa-archive:before{content:"\f187"}.fa-bug:before{content:"\f188"}.fa-vk:before{content:"\f189"}.fa-weibo:before{content:"\f18a"}.fa-renren:before{content:"\f18b"}.fa-pagelines:before{content:"\f18c"}.fa-stack-exchange:before{content:"\f18d"}.fa-arrow-circle-o-right:before{content:"\f18e"}.fa-arrow-circle-o-left:before{content:"\f190"}.fa-toggle-left:before,.fa-caret-square-o-left:before{content:"\f191"}.fa-dot-circle-o:before{content:"\f192"}.fa-wheelchair:before{content:"\f193"}.fa-vimeo-square:before{content:"\f194"}.fa-turkish-lira:before,.fa-try:before{content:"\f195"}.fa-plus-square-o:before{content:"\f196"}

File Name:
jquery-ui-smoothness.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\jquery-ui-smoothness.css
Code:
/*! jQuery UI - v1.10.4 - 2014-01-17
* http://jqueryui.com
* Includes: jquery.ui.core.css, jquery.ui.accordion.css, jquery.ui.autocomplete.css, jquery.ui.button.css, jquery.ui.datepicker.css, jquery.ui.dialog.css, jquery.ui.menu.css, jquery.ui.progressbar.css, jquery.ui.resizable.css, jquery.ui.selectable.css, jquery.ui.slider.css, jquery.ui.spinner.css, jquery.ui.tabs.css, jquery.ui.tooltip.css, jquery.ui.theme.css
* To view and modify this theme, visit http://jqueryui.com/themeroller/?ffDefault=Verdana%2CArial%2Csans-serif&fwDefault=normal&fsDefault=1.1em&cornerRadius=4px&bgColorHeader=cccccc&bgTextureHeader=highlight_soft&bgImgOpacityHeader=75&borderColorHeader=aaaaaa&fcHeader=222222&iconColorHeader=222222&bgColorContent=ffffff&bgTextureContent=flat&bgImgOpacityContent=75&borderColorContent=aaaaaa&fcContent=222222&iconColorContent=222222&bgColorDefault=e6e6e6&bgTextureDefault=glass&bgImgOpacityDefault=75&borderColorDefault=d3d3d3&fcDefault=555555&iconColorDefault=888888&bgColorHover=dadada&bgTextureHover=glass&bgImgOpacityHover=75&borderColorHover=999999&fcHover=212121&iconColorHover=454545&bgColorActive=ffffff&bgTextureActive=glass&bgImgOpacityActive=65&borderColorActive=aaaaaa&fcActive=212121&iconColorActive=454545&bgColorHighlight=fbf9ee&bgTextureHighlight=glass&bgImgOpacityHighlight=55&borderColorHighlight=fcefa1&fcHighlight=363636&iconColorHighlight=2e83ff&bgColorError=fef1ec&bgTextureError=glass&bgImgOpacityError=95&borderColorError=cd0a0a&fcError=cd0a0a&iconColorError=cd0a0a&bgColorOverlay=aaaaaa&bgTextureOverlay=flat&bgImgOpacityOverlay=0&opacityOverlay=30&bgColorShadow=aaaaaa&bgTextureShadow=flat&bgImgOpacityShadow=0&opacityShadow=30&thicknessShadow=8px&offsetTopShadow=-8px&offsetLeftShadow=-8px&cornerRadiusShadow=8px
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

/* Layout helpers
----------------------------------*/
.ui-helper-hidden {
	display: none;
}
.ui-helper-hidden-accessible {
	border: 0;
	clip: rect(0 0 0 0);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
}
.ui-helper-reset {
	margin: 0;
	padding: 0;
	border: 0;
	outline: 0;
	line-height: 1.3;
	text-decoration: none;
	font-size: 100%;
	list-style: none;
}
.ui-helper-clearfix:before,
.ui-helper-clearfix:after {
	content: "";
	display: table;
	border-collapse: collapse;
}
.ui-helper-clearfix:after {
	clear: both;
}
.ui-helper-clearfix {
	min-height: 0; /* support: IE7 */
}
.ui-helper-zfix {
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	position: absolute;
	opacity: 0;
	filter:Alpha(Opacity=0);
}

.ui-front {
	z-index: 100;
}


/* Interaction Cues
----------------------------------*/
.ui-state-disabled {
	cursor: default !important;
}


/* Icons
----------------------------------*/

/* states and images */
.ui-icon {
	display: block;
	text-indent: -99999px;
	overflow: hidden;
	background-repeat: no-repeat;
}


/* Misc visuals
----------------------------------*/

/* Overlays */
.ui-widget-overlay {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
.ui-accordion .ui-accordion-header {
	display: block;
	cursor: pointer;
	position: relative;
	margin-top: 2px;
	padding: .5em .5em .5em .7em;
	min-height: 0; /* support: IE7 */
}
.ui-accordion .ui-accordion-icons {
	padding-left: 2.2em;
}
.ui-accordion .ui-accordion-noicons {
	padding-left: .7em;
}
.ui-accordion .ui-accordion-icons .ui-accordion-icons {
	padding-left: 2.2em;
}
.ui-accordion .ui-accordion-header .ui-accordion-header-icon {
	position: absolute;
	left: .5em;
	top: 50%;
	margin-top: -8px;
}
.ui-accordion .ui-accordion-content {
	padding: 1em 2.2em;
	border-top: 0;
	overflow: auto;
}
.ui-autocomplete {
	position: absolute;
	top: 0;
	left: 0;
	cursor: default;
}
.ui-button {
	display: inline-block;
	position: relative;
	padding: 0;
	line-height: normal;
	margin-right: .1em;
	cursor: pointer;
	vertical-align: middle;
	text-align: center;
	overflow: visible; /* removes extra width in IE */
}
.ui-button,
.ui-button:link,
.ui-button:visited,
.ui-button:hover,
.ui-button:active {
	text-decoration: none;
}
/* to make room for the icon, a width needs to be set here */
.ui-button-icon-only {
	width: 2.2em;
}
/* button elements seem to need a little more width */
button.ui-button-icon-only {
	width: 2.4em;
}
.ui-button-icons-only {
	width: 3.4em;
}
button.ui-button-icons-only {
	width: 3.7em;
}

/* button text element */
.ui-button .ui-button-text {
	display: block;
	line-height: normal;
}
.ui-button-text-only .ui-button-text {
	padding: .4em 1em;
}
.ui-button-icon-only .ui-button-text,
.ui-button-icons-only .ui-button-text {
	padding: .4em;
	text-indent: -9999999px;
}
.ui-button-text-icon-primary .ui-button-text,
.ui-button-text-icons .ui-button-text {
	padding: .4em 1em .4em 2.1em;
}
.ui-button-text-icon-secondary .ui-button-text,
.ui-button-text-icons .ui-button-text {
	padding: .4em 2.1em .4em 1em;
}
.ui-button-text-icons .ui-button-text {
	padding-left: 2.1em;
	padding-right: 2.1em;
}
/* no icon support for input elements, provide padding by default */
input.ui-button {
	padding: .4em 1em;
}

/* button icon element(s) */
.ui-button-icon-only .ui-icon,
.ui-button-text-icon-primary .ui-icon,
.ui-button-text-icon-secondary .ui-icon,
.ui-button-text-icons .ui-icon,
.ui-button-icons-only .ui-icon {
	position: absolute;
	top: 50%;
	margin-top: -8px;
}
.ui-button-icon-only .ui-icon {
	left: 50%;
	margin-left: -8px;
}
.ui-button-text-icon-primary .ui-button-icon-primary,
.ui-button-text-icons .ui-button-icon-primary,
.ui-button-icons-only .ui-button-icon-primary {
	left: .5em;
}
.ui-button-text-icon-secondary .ui-button-icon-secondary,
.ui-button-text-icons .ui-button-icon-secondary,
.ui-button-icons-only .ui-button-icon-secondary {
	right: .5em;
}

/* button sets */
.ui-buttonset {
	margin-right: 7px;
}
.ui-buttonset .ui-button {
	margin-left: 0;
	margin-right: -.3em;
}

/* workarounds */
/* reset extra padding in Firefox, see h5bp.com/l */
input.ui-button::-moz-focus-inner,
button.ui-button::-moz-focus-inner {
	border: 0;
	padding: 0;
}
.ui-datepicker {
	width: 17em;
	padding: .2em .2em 0;
	display: none;
}
.ui-datepicker .ui-datepicker-header {
	position: relative;
	padding: .2em 0;
}
.ui-datepicker .ui-datepicker-prev,
.ui-datepicker .ui-datepicker-next {
	position: absolute;
	top: 2px;
	width: 1.8em;
	height: 1.8em;
}
.ui-datepicker .ui-datepicker-prev-hover,
.ui-datepicker .ui-datepicker-next-hover {
	top: 1px;
}
.ui-datepicker .ui-datepicker-prev {
	left: 2px;
}
.ui-datepicker .ui-datepicker-next {
	right: 2px;
}
.ui-datepicker .ui-datepicker-prev-hover {
	left: 1px;
}
.ui-datepicker .ui-datepicker-next-hover {
	right: 1px;
}
.ui-datepicker .ui-datepicker-prev span,
.ui-datepicker .ui-datepicker-next span {
	display: block;
	position: absolute;
	left: 50%;
	margin-left: -8px;
	top: 50%;
	margin-top: -8px;
}
.ui-datepicker .ui-datepicker-title {
	margin: 0 2.3em;
	line-height: 1.8em;
	text-align: center;
}
.ui-datepicker .ui-datepicker-title select {
	font-size: 1em;
	margin: 1px 0;
}
.ui-datepicker select.ui-datepicker-month,
.ui-datepicker select.ui-datepicker-year {
	width: 49%;
}
.ui-datepicker table {
	width: 100%;
	font-size: .9em;
	border-collapse: collapse;
	margin: 0 0 .4em;
}
.ui-datepicker th {
	padding: .7em .3em;
	text-align: center;
	font-weight: bold;
	border: 0;
}
.ui-datepicker td {
	border: 0;
	padding: 1px;
}
.ui-datepicker td span,
.ui-datepicker td a {
	display: block;
	padding: .2em;
	text-align: right;
	text-decoration: none;
}
.ui-datepicker .ui-datepicker-buttonpane {
	background-image: none;
	margin: .7em 0 0 0;
	padding: 0 .2em;
	border-left: 0;
	border-right: 0;
	border-bottom: 0;
}
.ui-datepicker .ui-datepicker-buttonpane button {
	float: right;
	margin: .5em .2em .4em;
	cursor: pointer;
	padding: .2em .6em .3em .6em;
	width: auto;
	overflow: visible;
}
.ui-datepicker .ui-datepicker-buttonpane button.ui-datepicker-current {
	float: left;
}

/* with multiple calendars */
.ui-datepicker.ui-datepicker-multi {
	width: auto;
}
.ui-datepicker-multi .ui-datepicker-group {
	float: left;
}
.ui-datepicker-multi .ui-datepicker-group table {
	width: 95%;
	margin: 0 auto .4em;
}
.ui-datepicker-multi-2 .ui-datepicker-group {
	width: 50%;
}
.ui-datepicker-multi-3 .ui-datepicker-group {
	width: 33.3%;
}
.ui-datepicker-multi-4 .ui-datepicker-group {
	width: 25%;
}
.ui-datepicker-multi .ui-datepicker-group-last .ui-datepicker-header,
.ui-datepicker-multi .ui-datepicker-group-middle .ui-datepicker-header {
	border-left-width: 0;
}
.ui-datepicker-multi .ui-datepicker-buttonpane {
	clear: left;
}
.ui-datepicker-row-break {
	clear: both;
	width: 100%;
	font-size: 0;
}

/* RTL support */
.ui-datepicker-rtl {
	direction: rtl;
}
.ui-datepicker-rtl .ui-datepicker-prev {
	right: 2px;
	left: auto;
}
.ui-datepicker-rtl .ui-datepicker-next {
	left: 2px;
	right: auto;
}
.ui-datepicker-rtl .ui-datepicker-prev:hover {
	right: 1px;
	left: auto;
}
.ui-datepicker-rtl .ui-datepicker-next:hover {
	left: 1px;
	right: auto;
}
.ui-datepicker-rtl .ui-datepicker-buttonpane {
	clear: right;
}
.ui-datepicker-rtl .ui-datepicker-buttonpane button {
	float: left;
}
.ui-datepicker-rtl .ui-datepicker-buttonpane button.ui-datepicker-current,
.ui-datepicker-rtl .ui-datepicker-group {
	float: right;
}
.ui-datepicker-rtl .ui-datepicker-group-last .ui-datepicker-header,
.ui-datepicker-rtl .ui-datepicker-group-middle .ui-datepicker-header {
	border-right-width: 0;
	border-left-width: 1px;
}
.ui-dialog {
	overflow: hidden;
	position: absolute;
	top: 0;
	left: 0;
	padding: .2em;
	outline: 0;
}
.ui-dialog .ui-dialog-titlebar {
	padding: .4em 1em;
	position: relative;
}
.ui-dialog .ui-dialog-title {
	float: left;
	margin: .1em 0;
	white-space: nowrap;
	width: 90%;
	overflow: hidden;
	text-overflow: ellipsis;
}
.ui-dialog .ui-dialog-titlebar-close {
	position: absolute;
	right: .3em;
	top: 50%;
	width: 20px;
	margin: -10px 0 0 0;
	padding: 1px;
	height: 20px;
}
.ui-dialog .ui-dialog-content {
	position: relative;
	border: 0;
	padding: .5em 1em;
	background: none;
	overflow: auto;
}
.ui-dialog .ui-dialog-buttonpane {
	text-align: left;
	border-width: 1px 0 0 0;
	background-image: none;
	margin-top: .5em;
	padding: .3em 1em .5em .4em;
}
.ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset {
	float: right;
}
.ui-dialog .ui-dialog-buttonpane button {
	margin: .5em .4em .5em 0;
	cursor: pointer;
}
.ui-dialog .ui-resizable-se {
	width: 12px;
	height: 12px;
	right: -5px;
	bottom: -5px;
	background-position: 16px 16px;
}
.ui-draggable .ui-dialog-titlebar {
	cursor: move;
}
.ui-menu {
	list-style: none;
	padding: 2px;
	margin: 0;
	display: block;
	outline: none;
}
.ui-menu .ui-menu {
	margin-top: -3px;
	position: absolute;
}
.ui-menu .ui-menu-item {
	margin: 0;
	padding: 0;
	width: 100%;
	/* support: IE10, see #8844 */
	list-style-image: url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7);
}
.ui-menu .ui-menu-divider {
	margin: 5px -2px 5px -2px;
	height: 0;
	font-size: 0;
	line-height: 0;
	border-width: 1px 0 0 0;
}
.ui-menu .ui-menu-item a {
	text-decoration: none;
	display: block;
	padding: 2px .4em;
	line-height: 1.5;
	min-height: 0; /* support: IE7 */
	font-weight: normal;
}
.ui-menu .ui-menu-item a.ui-state-focus,
.ui-menu .ui-menu-item a.ui-state-active {
	font-weight: normal;
	margin: -1px;
}

.ui-menu .ui-state-disabled {
	font-weight: normal;
	margin: .4em 0 .2em;
	line-height: 1.5;
}
.ui-menu .ui-state-disabled a {
	cursor: default;
}

/* icon support */
.ui-menu-icons {
	position: relative;
}
.ui-menu-icons .ui-menu-item a {
	position: relative;
	padding-left: 2em;
}

/* left-aligned */
.ui-menu .ui-icon {
	position: absolute;
	top: .2em;
	left: .2em;
}

/* right-aligned */
.ui-menu .ui-menu-icon {
	position: static;
	float: right;
}
.ui-progressbar {
	height: 2em;
	text-align: left;
	overflow: hidden;
}
.ui-progressbar .ui-progressbar-value {
	margin: -1px;
	height: 100%;
}
.ui-progressbar .ui-progressbar-overlay {
	background: url("images/animated-overlay.gif");
	height: 100%;
	filter: alpha(opacity=25);
	opacity: 0.25;
}
.ui-progressbar-indeterminate .ui-progressbar-value {
	background-image: none;
}
.ui-resizable {
	position: relative;
}
.ui-resizable-handle {
	position: absolute;
	font-size: 0.1px;
	display: block;
}
.ui-resizable-disabled .ui-resizable-handle,
.ui-resizable-autohide .ui-resizable-handle {
	display: none;
}
.ui-resizable-n {
	cursor: n-resize;
	height: 7px;
	width: 100%;
	top: -5px;
	left: 0;
}
.ui-resizable-s {
	cursor: s-resize;
	height: 7px;
	width: 100%;
	bottom: -5px;
	left: 0;
}
.ui-resizable-e {
	cursor: e-resize;
	width: 7px;
	right: -5px;
	top: 0;
	height: 100%;
}
.ui-resizable-w {
	cursor: w-resize;
	width: 7px;
	left: -5px;
	top: 0;
	height: 100%;
}
.ui-resizable-se {
	cursor: se-resize;
	width: 12px;
	height: 12px;
	right: 1px;
	bottom: 1px;
}
.ui-resizable-sw {
	cursor: sw-resize;
	width: 9px;
	height: 9px;
	left: -5px;
	bottom: -5px;
}
.ui-resizable-nw {
	cursor: nw-resize;
	width: 9px;
	height: 9px;
	left: -5px;
	top: -5px;
}
.ui-resizable-ne {
	cursor: ne-resize;
	width: 9px;
	height: 9px;
	right: -5px;
	top: -5px;
}
.ui-selectable-helper {
	position: absolute;
	z-index: 100;
	border: 1px dotted black;
}
.ui-slider {
	position: relative;
	text-align: left;
}
.ui-slider .ui-slider-handle {
	position: absolute;
	z-index: 2;
	width: 1.2em;
	height: 1.2em;
	cursor: default;
}
.ui-slider .ui-slider-range {
	position: absolute;
	z-index: 1;
	font-size: .7em;
	display: block;
	border: 0;
	background-position: 0 0;
}

/* For IE8 - See #6727 */
.ui-slider.ui-state-disabled .ui-slider-handle,
.ui-slider.ui-state-disabled .ui-slider-range {
	filter: inherit;
}

.ui-slider-horizontal {
	height: .8em;
}
.ui-slider-horizontal .ui-slider-handle {
	top: -.3em;
	margin-left: -.6em;
}
.ui-slider-horizontal .ui-slider-range {
	top: 0;
	height: 100%;
}
.ui-slider-horizontal .ui-slider-range-min {
	left: 0;
}
.ui-slider-horizontal .ui-slider-range-max {
	right: 0;
}

.ui-slider-vertical {
	width: .8em;
	height: 100px;
}
.ui-slider-vertical .ui-slider-handle {
	left: -.3em;
	margin-left: 0;
	margin-bottom: -.6em;
}
.ui-slider-vertical .ui-slider-range {
	left: 0;
	width: 100%;
}
.ui-slider-vertical .ui-slider-range-min {
	bottom: 0;
}
.ui-slider-vertical .ui-slider-range-max {
	top: 0;
}
.ui-spinner {
	position: relative;
	display: inline-block;
	overflow: hidden;
	padding: 0;
	vertical-align: middle;
}
.ui-spinner-input {
	border: none;
	background: none;
	color: inherit;
	padding: 0;
	margin: .2em 0;
	vertical-align: middle;
	margin-left: .4em;
	margin-right: 22px;
}
.ui-spinner-button {
	width: 16px;
	height: 50%;
	font-size: .5em;
	padding: 0;
	margin: 0;
	text-align: center;
	position: absolute;
	cursor: default;
	display: block;
	overflow: hidden;
	right: 0;
}
/* more specificity required here to override default borders */
.ui-spinner a.ui-spinner-button {
	border-top: none;
	border-bottom: none;
	border-right: none;
}
/* vertically center icon */
.ui-spinner .ui-icon {
	position: absolute;
	margin-top: -8px;
	top: 50%;
	left: 0;
}
.ui-spinner-up {
	top: 0;
}
.ui-spinner-down {
	bottom: 0;
}

/* TR overrides */
.ui-spinner .ui-icon-triangle-1-s {
	/* need to fix icons sprite */
	background-position: -65px -16px;
}
.ui-tabs {
	position: relative;/* position: relative prevents IE scroll bug (element with position: relative inside container with overflow: auto appear as "fixed") */
	padding: .2em;
}
.ui-tabs .ui-tabs-nav {
	margin: 0;
	padding: .2em .2em 0;
}
.ui-tabs .ui-tabs-nav li {
	list-style: none;
	float: left;
	position: relative;
	top: 0;
	margin: 1px .2em 0 0;
	border-bottom-width: 0;
	padding: 0;
	white-space: nowrap;
}
.ui-tabs .ui-tabs-nav .ui-tabs-anchor {
	float: left;
	padding: .5em 1em;
	text-decoration: none;
}
.ui-tabs .ui-tabs-nav li.ui-tabs-active {
	margin-bottom: -1px;
	padding-bottom: 1px;
}
.ui-tabs .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor,
.ui-tabs .ui-tabs-nav li.ui-state-disabled .ui-tabs-anchor,
.ui-tabs .ui-tabs-nav li.ui-tabs-loading .ui-tabs-anchor {
	cursor: text;
}
.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor {
	cursor: pointer;
}
.ui-tabs .ui-tabs-panel {
	display: block;
	border-width: 0;
	padding: 1em 1.4em;
	background: none;
}
.ui-tooltip {
	padding: 8px;
	position: absolute;
	z-index: 9999;
	max-width: 300px;
	-webkit-box-shadow: 0 0 5px #aaa;
	box-shadow: 0 0 5px #aaa;
  /* Custom by WPRA: */ opacity: 1 !important;
}
body .ui-tooltip {
	border-width: 2px;
}

/* Component containers
----------------------------------*/
.ui-widget {
	font-family: Verdana,Arial,sans-serif;
	font-size: 1.1em;
}
.ui-widget .ui-widget {
	font-size: 1em;
}
.ui-widget input,
.ui-widget select,
.ui-widget textarea,
.ui-widget button {
	font-family: Verdana,Arial,sans-serif;
	font-size: 1em;
}
.ui-widget-content {
	border: 1px solid #aaaaaa;
	background: #ffffff url(images/ui-bg_flat_75_ffffff_40x100.png) 50% 50% repeat-x;
	color: #222222;
}
.ui-widget-content a {
	color: #222222;
}
.ui-widget-header {
	border: 1px solid #aaaaaa;
	background: #cccccc url(images/ui-bg_highlight-soft_75_cccccc_1x100.png) 50% 50% repeat-x;
	color: #222222;
	font-weight: bold;
}
.ui-widget-header a {
	color: #222222;
}

/* Interaction states
----------------------------------*/
.ui-state-default,
.ui-widget-content .ui-state-default,
.ui-widget-header .ui-state-default {
	border: 1px solid #d3d3d3;
	background: #e6e6e6 url(images/ui-bg_glass_75_e6e6e6_1x400.png) 50% 50% repeat-x;
	font-weight: normal;
	color: #555555;
}
.ui-state-default a,
.ui-state-default a:link,
.ui-state-default a:visited {
	color: #555555;
	text-decoration: none;
}
.ui-state-hover,
.ui-widget-content .ui-state-hover,
.ui-widget-header .ui-state-hover,
.ui-state-focus,
.ui-widget-content .ui-state-focus,
.ui-widget-header .ui-state-focus {
	border: 1px solid #999999;
	background: #dadada url(images/ui-bg_glass_75_dadada_1x400.png) 50% 50% repeat-x;
	font-weight: normal;
	color: #212121;
}
.ui-state-hover a,
.ui-state-hover a:hover,
.ui-state-hover a:link,
.ui-state-hover a:visited,
.ui-state-focus a,
.ui-state-focus a:hover,
.ui-state-focus a:link,
.ui-state-focus a:visited {
	color: #212121;
	text-decoration: none;
}
.ui-state-active,
.ui-widget-content .ui-state-active,
.ui-widget-header .ui-state-active {
	border: 1px solid #aaaaaa;
	background: #ffffff url(images/ui-bg_glass_65_ffffff_1x400.png) 50% 50% repeat-x;
	font-weight: normal;
	color: #212121;
}
.ui-state-active a,
.ui-state-active a:link,
.ui-state-active a:visited {
	color: #212121;
	text-decoration: none;
}

/* Interaction Cues
----------------------------------*/
.ui-state-highlight,
.ui-widget-content .ui-state-highlight,
.ui-widget-header .ui-state-highlight {
	border: 1px solid #fcefa1;
	background: #fbf9ee url(images/ui-bg_glass_55_fbf9ee_1x400.png) 50% 50% repeat-x;
	color: #363636;
}
.ui-state-highlight a,
.ui-widget-content .ui-state-highlight a,
.ui-widget-header .ui-state-highlight a {
	color: #363636;
}
.ui-state-error,
.ui-widget-content .ui-state-error,
.ui-widget-header .ui-state-error {
	border: 1px solid #cd0a0a;
	background: #fef1ec url(images/ui-bg_glass_95_fef1ec_1x400.png) 50% 50% repeat-x;
	color: #cd0a0a;
}
.ui-state-error a,
.ui-widget-content .ui-state-error a,
.ui-widget-header .ui-state-error a {
	color: #cd0a0a;
}
.ui-state-error-text,
.ui-widget-content .ui-state-error-text,
.ui-widget-header .ui-state-error-text {
	color: #cd0a0a;
}
.ui-priority-primary,
.ui-widget-content .ui-priority-primary,
.ui-widget-header .ui-priority-primary {
	font-weight: bold;
}
.ui-priority-secondary,
.ui-widget-content .ui-priority-secondary,
.ui-widget-header .ui-priority-secondary {
	opacity: .7;
	filter:Alpha(Opacity=70);
	font-weight: normal;
}
.ui-state-disabled,
.ui-widget-content .ui-state-disabled,
.ui-widget-header .ui-state-disabled {
	opacity: .35;
	filter:Alpha(Opacity=35);
	background-image: none;
}
.ui-state-disabled .ui-icon {
	filter:Alpha(Opacity=35); /* For IE8 - See #6059 */
}

/* Icons
----------------------------------*/

/* states and images */
.ui-icon {
	width: 16px;
	height: 16px;
}
.ui-icon,
.ui-widget-content .ui-icon {
	background-image: url(images/ui-icons_222222_256x240.png);
}
.ui-widget-header .ui-icon {
	background-image: url(images/ui-icons_222222_256x240.png);
}
.ui-state-default .ui-icon {
	background-image: url(images/ui-icons_888888_256x240.png);
}
.ui-state-hover .ui-icon,
.ui-state-focus .ui-icon {
	background-image: url(images/ui-icons_454545_256x240.png);
}
.ui-state-active .ui-icon {
	background-image: url(images/ui-icons_454545_256x240.png);
}
.ui-state-highlight .ui-icon {
	background-image: url(images/ui-icons_2e83ff_256x240.png);
}
.ui-state-error .ui-icon,
.ui-state-error-text .ui-icon {
	background-image: url(images/ui-icons_cd0a0a_256x240.png);
}

/* positioning */
.ui-icon-blank { background-position: 16px 16px; }
.ui-icon-carat-1-n { background-position: 0 0; }
.ui-icon-carat-1-ne { background-position: -16px 0; }
.ui-icon-carat-1-e { background-position: -32px 0; }
.ui-icon-carat-1-se { background-position: -48px 0; }
.ui-icon-carat-1-s { background-position: -64px 0; }
.ui-icon-carat-1-sw { background-position: -80px 0; }
.ui-icon-carat-1-w { background-position: -96px 0; }
.ui-icon-carat-1-nw { background-position: -112px 0; }
.ui-icon-carat-2-n-s { background-position: -128px 0; }
.ui-icon-carat-2-e-w { background-position: -144px 0; }
.ui-icon-triangle-1-n { background-position: 0 -16px; }
.ui-icon-triangle-1-ne { background-position: -16px -16px; }
.ui-icon-triangle-1-e { background-position: -32px -16px; }
.ui-icon-triangle-1-se { background-position: -48px -16px; }
.ui-icon-triangle-1-s { background-position: -64px -16px; }
.ui-icon-triangle-1-sw { background-position: -80px -16px; }
.ui-icon-triangle-1-w { background-position: -96px -16px; }
.ui-icon-triangle-1-nw { background-position: -112px -16px; }
.ui-icon-triangle-2-n-s { background-position: -128px -16px; }
.ui-icon-triangle-2-e-w { background-position: -144px -16px; }
.ui-icon-arrow-1-n { background-position: 0 -32px; }
.ui-icon-arrow-1-ne { background-position: -16px -32px; }
.ui-icon-arrow-1-e { background-position: -32px -32px; }
.ui-icon-arrow-1-se { background-position: -48px -32px; }
.ui-icon-arrow-1-s { background-position: -64px -32px; }
.ui-icon-arrow-1-sw { background-position: -80px -32px; }
.ui-icon-arrow-1-w { background-position: -96px -32px; }
.ui-icon-arrow-1-nw { background-position: -112px -32px; }
.ui-icon-arrow-2-n-s { background-position: -128px -32px; }
.ui-icon-arrow-2-ne-sw { background-position: -144px -32px; }
.ui-icon-arrow-2-e-w { background-position: -160px -32px; }
.ui-icon-arrow-2-se-nw { background-position: -176px -32px; }
.ui-icon-arrowstop-1-n { background-position: -192px -32px; }
.ui-icon-arrowstop-1-e { background-position: -208px -32px; }
.ui-icon-arrowstop-1-s { background-position: -224px -32px; }
.ui-icon-arrowstop-1-w { background-position: -240px -32px; }
.ui-icon-arrowthick-1-n { background-position: 0 -48px; }
.ui-icon-arrowthick-1-ne { background-position: -16px -48px; }
.ui-icon-arrowthick-1-e { background-position: -32px -48px; }
.ui-icon-arrowthick-1-se { background-position: -48px -48px; }
.ui-icon-arrowthick-1-s { background-position: -64px -48px; }
.ui-icon-arrowthick-1-sw { background-position: -80px -48px; }
.ui-icon-arrowthick-1-w { background-position: -96px -48px; }
.ui-icon-arrowthick-1-nw { background-position: -112px -48px; }
.ui-icon-arrowthick-2-n-s { background-position: -128px -48px; }
.ui-icon-arrowthick-2-ne-sw { background-position: -144px -48px; }
.ui-icon-arrowthick-2-e-w { background-position: -160px -48px; }
.ui-icon-arrowthick-2-se-nw { background-position: -176px -48px; }
.ui-icon-arrowthickstop-1-n { background-position: -192px -48px; }
.ui-icon-arrowthickstop-1-e { background-position: -208px -48px; }
.ui-icon-arrowthickstop-1-s { background-position: -224px -48px; }
.ui-icon-arrowthickstop-1-w { background-position: -240px -48px; }
.ui-icon-arrowreturnthick-1-w { background-position: 0 -64px; }
.ui-icon-arrowreturnthick-1-n { background-position: -16px -64px; }
.ui-icon-arrowreturnthick-1-e { background-position: -32px -64px; }
.ui-icon-arrowreturnthick-1-s { background-position: -48px -64px; }
.ui-icon-arrowreturn-1-w { background-position: -64px -64px; }
.ui-icon-arrowreturn-1-n { background-position: -80px -64px; }
.ui-icon-arrowreturn-1-e { background-position: -96px -64px; }
.ui-icon-arrowreturn-1-s { background-position: -112px -64px; }
.ui-icon-arrowrefresh-1-w { background-position: -128px -64px; }
.ui-icon-arrowrefresh-1-n { background-position: -144px -64px; }
.ui-icon-arrowrefresh-1-e { background-position: -160px -64px; }
.ui-icon-arrowrefresh-1-s { background-position: -176px -64px; }
.ui-icon-arrow-4 { background-position: 0 -80px; }
.ui-icon-arrow-4-diag { background-position: -16px -80px; }
.ui-icon-extlink { background-position: -32px -80px; }
.ui-icon-newwin { background-position: -48px -80px; }
.ui-icon-refresh { background-position: -64px -80px; }
.ui-icon-shuffle { background-position: -80px -80px; }
.ui-icon-transfer-e-w { background-position: -96px -80px; }
.ui-icon-transferthick-e-w { background-position: -112px -80px; }
.ui-icon-folder-collapsed { background-position: 0 -96px; }
.ui-icon-folder-open { background-position: -16px -96px; }
.ui-icon-document { background-position: -32px -96px; }
.ui-icon-document-b { background-position: -48px -96px; }
.ui-icon-note { background-position: -64px -96px; }
.ui-icon-mail-closed { background-position: -80px -96px; }
.ui-icon-mail-open { background-position: -96px -96px; }
.ui-icon-suitcase { background-position: -112px -96px; }
.ui-icon-comment { background-position: -128px -96px; }
.ui-icon-person { background-position: -144px -96px; }
.ui-icon-print { background-position: -160px -96px; }
.ui-icon-trash { background-position: -176px -96px; }
.ui-icon-locked { background-position: -192px -96px; }
.ui-icon-unlocked { background-position: -208px -96px; }
.ui-icon-bookmark { background-position: -224px -96px; }
.ui-icon-tag { background-position: -240px -96px; }
.ui-icon-home { background-position: 0 -112px; }
.ui-icon-flag { background-position: -16px -112px; }
.ui-icon-calendar { background-position: -32px -112px; }
.ui-icon-cart { background-position: -48px -112px; }
.ui-icon-pencil { background-position: -64px -112px; }
.ui-icon-clock { background-position: -80px -112px; }
.ui-icon-disk { background-position: -96px -112px; }
.ui-icon-calculator { background-position: -112px -112px; }
.ui-icon-zoomin { background-position: -128px -112px; }
.ui-icon-zoomout { background-position: -144px -112px; }
.ui-icon-search { background-position: -160px -112px; }
.ui-icon-wrench { background-position: -176px -112px; }
.ui-icon-gear { background-position: -192px -112px; }
.ui-icon-heart { background-position: -208px -112px; }
.ui-icon-star { background-position: -224px -112px; }
.ui-icon-link { background-position: -240px -112px; }
.ui-icon-cancel { background-position: 0 -128px; }
.ui-icon-plus { background-position: -16px -128px; }
.ui-icon-plusthick { background-position: -32px -128px; }
.ui-icon-minus { background-position: -48px -128px; }
.ui-icon-minusthick { background-position: -64px -128px; }
.ui-icon-close { background-position: -80px -128px; }
.ui-icon-closethick { background-position: -96px -128px; }
.ui-icon-key { background-position: -112px -128px; }
.ui-icon-lightbulb { background-position: -128px -128px; }
.ui-icon-scissors { background-position: -144px -128px; }
.ui-icon-clipboard { background-position: -160px -128px; }
.ui-icon-copy { background-position: -176px -128px; }
.ui-icon-contact { background-position: -192px -128px; }
.ui-icon-image { background-position: -208px -128px; }
.ui-icon-video { background-position: -224px -128px; }
.ui-icon-script { background-position: -240px -128px; }
.ui-icon-alert { background-position: 0 -144px; }
.ui-icon-info { background-position: -16px -144px; }
.ui-icon-notice { background-position: -32px -144px; }
.ui-icon-help { background-position: -48px -144px; }
.ui-icon-check { background-position: -64px -144px; }
.ui-icon-bullet { background-position: -80px -144px; }
.ui-icon-radio-on { background-position: -96px -144px; }
.ui-icon-radio-off { background-position: -112px -144px; }
.ui-icon-pin-w { background-position: -128px -144px; }
.ui-icon-pin-s { background-position: -144px -144px; }
.ui-icon-play { background-position: 0 -160px; }
.ui-icon-pause { background-position: -16px -160px; }
.ui-icon-seek-next { background-position: -32px -160px; }
.ui-icon-seek-prev { background-position: -48px -160px; }
.ui-icon-seek-end { background-position: -64px -160px; }
.ui-icon-seek-start { background-position: -80px -160px; }
/* ui-icon-seek-first is deprecated, use ui-icon-seek-start instead */
.ui-icon-seek-first { background-position: -80px -160px; }
.ui-icon-stop { background-position: -96px -160px; }
.ui-icon-eject { background-position: -112px -160px; }
.ui-icon-volume-off { background-position: -128px -160px; }
.ui-icon-volume-on { background-position: -144px -160px; }
.ui-icon-power { background-position: 0 -176px; }
.ui-icon-signal-diag { background-position: -16px -176px; }
.ui-icon-signal { background-position: -32px -176px; }
.ui-icon-battery-0 { background-position: -48px -176px; }
.ui-icon-battery-1 { background-position: -64px -176px; }
.ui-icon-battery-2 { background-position: -80px -176px; }
.ui-icon-battery-3 { background-position: -96px -176px; }
.ui-icon-circle-plus { background-position: 0 -192px; }
.ui-icon-circle-minus { background-position: -16px -192px; }
.ui-icon-circle-close { background-position: -32px -192px; }
.ui-icon-circle-triangle-e { background-position: -48px -192px; }
.ui-icon-circle-triangle-s { background-position: -64px -192px; }
.ui-icon-circle-triangle-w { background-position: -80px -192px; }
.ui-icon-circle-triangle-n { background-position: -96px -192px; }
.ui-icon-circle-arrow-e { background-position: -112px -192px; }
.ui-icon-circle-arrow-s { background-position: -128px -192px; }
.ui-icon-circle-arrow-w { background-position: -144px -192px; }
.ui-icon-circle-arrow-n { background-position: -160px -192px; }
.ui-icon-circle-zoomin { background-position: -176px -192px; }
.ui-icon-circle-zoomout { background-position: -192px -192px; }
.ui-icon-circle-check { background-position: -208px -192px; }
.ui-icon-circlesmall-plus { background-position: 0 -208px; }
.ui-icon-circlesmall-minus { background-position: -16px -208px; }
.ui-icon-circlesmall-close { background-position: -32px -208px; }
.ui-icon-squaresmall-plus { background-position: -48px -208px; }
.ui-icon-squaresmall-minus { background-position: -64px -208px; }
.ui-icon-squaresmall-close { background-position: -80px -208px; }
.ui-icon-grip-dotted-vertical { background-position: 0 -224px; }
.ui-icon-grip-dotted-horizontal { background-position: -16px -224px; }
.ui-icon-grip-solid-vertical { background-position: -32px -224px; }
.ui-icon-grip-solid-horizontal { background-position: -48px -224px; }
.ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }
.ui-icon-grip-diagonal-se { background-position: -80px -224px; }


/* Misc visuals
----------------------------------*/

/* Corner radius */
.ui-corner-all,
.ui-corner-top,
.ui-corner-left,
.ui-corner-tl {
	border-top-left-radius: 4px;
}
.ui-corner-all,
.ui-corner-top,
.ui-corner-right,
.ui-corner-tr {
	border-top-right-radius: 4px;
}
.ui-corner-all,
.ui-corner-bottom,
.ui-corner-left,
.ui-corner-bl {
	border-bottom-left-radius: 4px;
}
.ui-corner-all,
.ui-corner-bottom,
.ui-corner-right,
.ui-corner-br {
	border-bottom-right-radius: 4px;
}

/* Overlays */
.ui-widget-overlay {
	background: #aaaaaa url(images/ui-bg_flat_0_aaaaaa_40x100.png) 50% 50% repeat-x;
	opacity: .3;
	filter: Alpha(Opacity=30);
}
.ui-widget-shadow {
	margin: -8px 0 0 -8px;
	padding: 8px;
	background: #aaaaaa url(images/ui-bg_flat_0_aaaaaa_40x100.png) 50% 50% repeat-x;
	opacity: .3;
	filter: Alpha(Opacity=30);
	border-radius: 8px;
}


File Name:
legacy-styles.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\legacy-styles.css
Code:
li.feed-item { margin-bottom: 10px; }

.thumbnail-excerpt {
    overflow:hidden;
    margin-bottom: 5px;
}

.thumbnail-excerpt img {
    max-width:100%; float:left; margin-top: 0.5em; margin-right:10px;
}

.green {
    color: #0BD600;
}

.nav-links {
    overflow: hidden;
    margin-bottom: 20px;
}

div.wprss-feed-meta > span {
    font-size: 90%;
    clear: both;
}
div.wprss-feed-meta > span:not(:last-child):after {
    content: ' | ';
}


File Name:
common.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\common.min.css
Code:
.mobile-collapsed{display:inherit}.mobile-only{display:none!important}@media (max-width:782px){.mobile-only{display:inherit!important}.mobile-collapsed{display:none!important}}.wpra-notice-block{background-color:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,.1);padding:12px 16px;margin-top:.5rem;margin-bottom:.15rem}.wpra-notice-block.postbox{margin-top:0;margin-bottom:20px;box-shadow:0}.wpra-notice-block.postbox .wpra-notice-block__body{font-size:14px;opacity:.8}.wpra-notice-block__title{font-size:22px;padding:.5rem 0 1rem;max-width:65rem}.wpra-notice-block__body{line-height:1.5;font-size:16px;opacity:.7;max-width:65rem}.wpra-notice-block__buttons{padding:1rem 0 .5rem}.wpra-notice-block__buttons .button{height:34px;line-height:32px;padding:0 16px 2px}.wpra-notice-block__buttons .button .dashicons{font-size:16px;vertical-align:middle;opacity:.75;margin-left:2px}.wpra-notice-block__buttons .button-clear{margin-left:8px;font-weight:500;color:#0085ba}.wpra-notice-block__buttons .button-clear,.wpra-notice-block__buttons .button-clear:active,.wpra-notice-block__buttons .button-clear:focus,.wpra-notice-block__buttons .button-clear:hover{border:none;background:none;box-shadow:none}.wpra-info-box{background:#daf4ff;padding:8px 12px;border-radius:3px;display:flex}.wpra-info-box__icon{opacity:.4;flex-shrink:0}.wpra-info-box__text{flex-grow:1;padding-left:8px}

File Name:
gutenberg-block.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\gutenberg-block.min.css
Code:
.wpra-gutenberg-block .wpra-item a,[data-type="wpra-shortcode/wpra-shortcode"] .wpra-item a{pointer-events:none!important}.nav-links:after{display:block;content:"";clear:both}

File Name:
intro.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\intro.min.css
Code:
.wrpa-expander{will-change:height;transform:translateZ(0);backface-visibility:hidden;perspective:1000px}.expand-enter-active,.expand-leave-active{transition:height .35s ease;overflow:hidden}.expand-enter,.expand-leave-to{height:0}.fade-enter,.fade-leave-to{opacity:0}.fade-enter-active,.fade-leave-active{transition:opacity .3s ease}.slide-up-enter{transform:translateY(10px);opacity:0}.slide-up-leave-to{transform:translateY(-10px);opacity:0}.slide-up-enter-active,.slide-up-leave-active{transition:all .3s ease}.slide-down-enter{transform:translateY(-10px);opacity:0}.slide-down-leave-to{transform:translateY(10px);opacity:0}.slide-down-enter-active,.slide-down-leave-active{transition:all .3s ease}.wpra-expander__title{cursor:pointer;user-select:none}.wpra-expander__title span{opacity:.5;vertical-align:bottom;transition:transform .3s ease}.wpra-expander__content{padding:0 .5rem;opacity:0;transition:opacity .3s ease}.wpra-expander--expanded .wpra-expander__content{opacity:1}.wpra-expander--expanded .wpra-expander__title span{transform:rotate(180deg)}[v-cloak] .vcloak--visible{display:block}[v-cloak] .vcloak--hidden{display:none}.vcloak--visible{min-height:60px;display:none}.loading-container{position:relative}.loading-container:before{display:block;content:"";position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);box-sizing:border-box;height:40px;width:40px;border:0 solid #d0d0d0;border-radius:50%;box-shadow:inset 0 -12px 0 16px #d0d0d0;animation:rotate 1s infinite linear;z-index:3}.loading-container:after{display:block;content:"";position:absolute;z-index:2;background-color:hsla(0,0%,95%,.5);width:100%;height:100%;left:0;top:0}.loading-container--white:after{background-color:#fff}.loading-button{pointer-events:none;position:relative}.loading-button:before{display:block;content:"";position:absolute;left:calc(50% - 8px);top:calc(50% - 8px);box-sizing:border-box;height:16px;width:16px;border:0 solid #fff;border-radius:50%;box-shadow:inset 0 -4px 0 6px #fff;animation:rotate 1s infinite linear;z-index:3}.loading-button:after{display:block;content:"";position:absolute;z-index:2;background-color:inherit;width:100%;height:100%;left:0;top:0}.button-default.loading-button:before{box-shadow:inset 0 -4px 0 6px #6f6f6f}.loading-inline{display:inline-block;pointer-events:none;position:relative}.loading-inline:before{display:block;content:"";position:absolute;left:calc(50% + 1px);top:calc(50% - 11px);box-sizing:border-box;height:14px;width:14px;border:0 solid #d0d0d0;border-radius:50%;box-shadow:inset 0 -3px 0 5px #d0d0d0;animation:rotate 1s infinite linear;z-index:3}.loading-inline:after{display:block;content:"";position:absolute;z-index:2;background-color:inherit;width:100%;height:100%;left:0;top:0}@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.wpra-wizard-head{display:flex;padding-bottom:1.5rem;padding-top:.75rem}.wpra-wizard-head__logo{flex-shrink:0}.wpra-wizard-head__logo img{width:57px}.wpra-wizard-head__copy{flex-grow:1;padding-left:1rem;display:flex;flex-direction:column;justify-content:center}.wpra-wizard-head__title{font-size:1.25rem;font-weight:500;padding-bottom:12px}.wpra-wizard-head__subtitle{font-size:1rem;opacity:.85}.wpra-cols{display:flex;margin:0 -.5rem;border-top:2px solid rgba(0,0,0,.05);padding-top:1.45rem}.wpra-cols-title{font-weight:400;font-size:1rem;padding-bottom:1rem}@media (max-width:50em){.wpra-cols{flex-wrap:wrap}}.wpra-cols .col{flex-basis:50%;padding:0 .5rem}@media (max-width:50em){.wpra-cols .col{flex-basis:100%;padding-bottom:1rem}}.wpra-cols .col img{max-width:100%}.wpra-cols .col p{font-size:14px;line-height:1.6}.wpra-cols .col p:first-child{margin-top:0}.wpra-feed-input{width:26rem;padding:6px 10px;max-width:100%}.wpra-feedback{display:flex}.wpra-feedback__photo{flex-shrink:0}.wpra-feedback__photo img{width:70px;border-radius:100%}.wpra-feedback__copy{padding-left:.5rem;flex-grow:1}.wpra-feedback__text{font-size:1rem;font-family:Georgia,serif;font-style:italic;line-height:1.5}.wpra-feedback__rating{padding:.25rem 0 .45rem}.wpra-feedback__rating span{color:#f8ca29}.wpra-feedback__by{opacity:.85}.wpra-feedback__by a{color:#617181}.wpra-demo-photo{margin-bottom:1rem;border-radius:4px;border:1px solid rgba(0,0,0,.15)}.wpra-feed-items{padding-left:.5rem;margin-bottom:1rem;border-left:4px solid #ff792b}.wpra-feed-items .wpra-feed-item{padding:.75rem}.wpra-feed-items .wpra-feed-item__link{padding-bottom:4px}.step-items{display:flex;position:relative;flex-direction:column;align-items:flex-end}.step-items .step-progress{position:absolute;width:3px;height:0;background-color:#00b479;left:17.5px;top:0;transition:height .3s ease;z-index:-1}.step-items .step-progress--1{height:50%}.step-items .step-progress--2{height:100%}@media (max-width:50em){.step-items .step-progress{display:none}}@media (max-width:50em){.step-items{padding:.625rem;flex-direction:row;align-items:flex-start}}.step-items .step-item{font-size:16px;width:15rem;margin-bottom:2.25rem;display:flex;background-color:#f1f1f1}.step-items .step-item:last-child{margin-bottom:0}@media (max-width:50em){.step-items .step-item{flex-direction:column;margin-bottom:0;align-items:center}}.step-items .step-item_active,.step-items .step-item_active .step-item__info,.step-items .step-item_active .step-item__status{opacity:1}@media (max-width:50em){.step-items .step-item_active{flex-grow:1}}.step-items .step-item__description{font-size:14px}.step-items .step-item__info{display:flex;align-items:center;padding-left:.75rem;opacity:.5}@media (max-width:50em){.step-items .step-item__info{padding-left:0;padding-top:.3rem;display:none}}.step-items .step-item__status{width:35px;height:35px;border-radius:50%;border:2px dashed rgba(0,0,0,.5);flex-shrink:0;opacity:.5;text-align:center;font-size:1.25rem;line-height:2.375rem;color:#00b479}.step-items .step-item__status span{display:block;margin:0!important;width:100%;line-height:35px;font-size:26px}.step-items .step-item_completed{opacity:1}.step-items .step-item_completed .step-item__status{border-style:solid;border-color:#00b479;opacity:1}.step-items .step-item_completed .step-item__status span{position:relative}.step-items .step-item_completed .step-item__info{opacity:.5}.wizard{width:100%;margin-left:1rem}@media (max-width:50em){.wizard{margin-left:0}}.wizard ol{margin-left:1.5rem;line-height:1.5;font-size:13px}.wizard ol ul{margin-bottom:1rem}.wizard .form-group{display:flex;align-items:center}@media (max-width:50em){.wizard .form-group{display:block;align-items:unset}.wizard .form-group input{margin-bottom:8px}}.wizard .form-group input{flex-shrink:0}.wizard .form-group .warning-icon{padding-left:4px;color:#ee5a65}.wizard .form-group a{flex-shrink:0;margin-left:6px}.wizard .button-clear{background-color:transparent;border:none;cursor:pointer;height:30px;line-height:28px;padding:0 12px 2px;vertical-align:baseline;opacity:.55}.wizard .button-clear:hover{opacity:.8}.wizard .button{vertical-align:baseline!important}.wizard .pad{display:flex}.wizard .pad-item--grow{flex-grow:1}.wizard .pad-item--no-shrink{flex-shrink:0}.wizard .wpra-success{padding-right:1rem;font-size:14px}.wizard_content{padding:1rem;font-size:14px;max-width:42rem;min-height:16rem;padding-top:12px}@media (max-width:50em){.wizard_content{padding:0}}.wizard-holder{width:100%;position:relative;display:flex}@media (max-width:50em){.wizard-holder{flex-direction:column}}.wizard-holder .connect-steps{flex-shrink:0;max-width:450px;padding:1rem}@media (max-width:50em){.wizard-holder .connect-steps{max-width:100%;flex-basis:auto;padding:.5rem}}.wizard-holder .wizard{flex-grow:1}.wizard_text{padding:0 0 25px;max-width:480px;font-size:14px}.wizard_more{user-select:none;display:inline-block;color:rgba(0,0,0,.5);font-size:12px;margin-top:20px}.wizard_more:hover{cursor:pointer;text-decoration:underline}.wizard_hello{font-size:18px;margin:15px 0 10px}.wizard_hello img{height:26px;vertical-align:sub;margin-right:3px}.wizard_button{min-width:137px;margin:0 .3rem 1rem}.wizard_buttons{margin:0 -.5rem;display:flex}@media (max-width:50em){.wizard_buttons{flex-direction:row;flex-wrap:wrap}}.wizard_network{padding:0 .5rem;margin-bottom:.35rem}.wizard_network .button{min-width:145px;text-align:center}.wizard_network .button i{margin-left:4px}.wizard_network .button-transparent{margin-bottom:10px}.wizard_network-icon{width:50px;height:50px;border-radius:100%;background-color:hsla(0,0%,7%,.05);margin:0 auto .8rem}.wizard_network-icon i{font-size:22px;line-height:50px}.wizard_list{padding:10px 0;display:flex;flex-wrap:wrap;margin:0 -.3125rem;max-width:49rem}.wizard_item{padding:5px;margin:5px;border:1px solid rgba(0,0,0,.05);display:flex;width:31%;align-items:center;vertical-align:middle;border-radius:4px;text-align:left}@media (max-width:50em){.wizard_item{width:100%;margin:0;margin-bottom:.625rem}}.wizard_item .description{font-size:12px;color:rgba(0,0,0,.75);margin-top:2px}.wizard_item .account-item_picture{float:none;margin-right:10px;flex-shrink:0}.wizard_info{max-width:20rem;text-align:left}.wizard_info .form-group{margin-bottom:1rem}.wizard_label{font-size:1rem;padding-top:.2rem;padding-bottom:.75rem}.wrpa-shortcode{display:flex}.wrpa-shortcode-form,.wrpa-shortcode-preview{padding-bottom:10px;padding-right:75px;flex-basis:50%}.wrpa-shortcode-form .wrpa-shortcode-label,.wrpa-shortcode-preview .wrpa-shortcode-label{font-size:1rem;padding-bottom:12px;line-height:1.5}.wrpa-shortcode-form .button.loading-button:before,.wrpa-shortcode-preview .button.loading-button:before{box-shadow:inset 0 -4px 0 6px #797979!important}.wrpa-shortcode .wrpa-shortcode-form{cursor:pointer}.wrpa-shortcode .wrpa-shortcode-form .wrpa-shortcode-form__shortcode{display:inline-block}.wrpa-shortcode .wrpa-shortcode-form .wrpa-shortcode-form__button{display:inline-block;opacity:.65;font-size:11px;font-style:italic;padding-right:3px}.connect_progress{position:absolute;left:calc(50% - 22px);top:30px}.connect_progress:after{clear:both;display:block;content:""}.connect_progress-point{display:block;float:left;margin-left:5px;width:8px;height:8px;border-radius:100%;background-color:rgba(26,83,230,.3)}.connect_progress-point__active{border:1px solid #1a53e6}.connect_progress-point__done{background-color:#1a53e6}.connect-actions{width:100%;max-width:42rem;border-top:2px solid rgba(0,0,0,.05);padding:1rem 0}.connect-actions .button{margin:0}@media (max-width:50em){.connect-actions{padding-bottom:2rem}}.connect-actions .fa-animated{font-size:2rem;color:rgba(26,83,230,.65);vertical-align:middle;margin-right:5px}@keyframes moveRightLeftLoop{0%{transform:translateX(-10px)}50%{transform:translateX(0)}to{transform:translateX(-10px)}}.moveRightLeftLoop{animation-iteration-count:infinite;animation-name:moveRightLeftLoop;animation-duration:1s}

File Name:
pagination.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\pagination.min.css
Code:
.wpra-loading{animation:pulse 1s infinite ease-in-out;pointer-events:none}.nav-links a{cursor:pointer}@keyframes pulse{0%{opacity:.25}50%{opacity:.6}to{opacity:.25}}

File Name:
plugins.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\plugins.min.css
Code:
[v-cloak] .vcloak--visible{display:block}[v-cloak] .vcloak--hidden{display:none}.vcloak--visible{min-height:60px;display:none}.loading-container{position:relative}.loading-container:before{display:block;content:"";position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);box-sizing:border-box;height:40px;width:40px;border:0 solid #d0d0d0;border-radius:50%;box-shadow:inset 0 -12px 0 16px #d0d0d0;animation:rotate 1s infinite linear;z-index:3}.loading-container:after{display:block;content:"";position:absolute;z-index:2;background-color:hsla(0,0%,95%,.5);width:100%;height:100%;left:0;top:0}.loading-container--white:after{background-color:#fff}.loading-button{pointer-events:none;position:relative}.loading-button:before{display:block;content:"";position:absolute;left:calc(50% - 8px);top:calc(50% - 8px);box-sizing:border-box;height:16px;width:16px;border:0 solid #fff;border-radius:50%;box-shadow:inset 0 -4px 0 6px #fff;animation:rotate 1s infinite linear;z-index:3}.loading-button:after{display:block;content:"";position:absolute;z-index:2;background-color:inherit;width:100%;height:100%;left:0;top:0}.button-default.loading-button:before{box-shadow:inset 0 -4px 0 6px #6f6f6f}.loading-inline{display:inline-block;pointer-events:none;position:relative}.loading-inline:before{display:block;content:"";position:absolute;left:calc(50% + 1px);top:calc(50% - 11px);box-sizing:border-box;height:14px;width:14px;border:0 solid #d0d0d0;border-radius:50%;box-shadow:inset 0 -3px 0 5px #d0d0d0;animation:rotate 1s infinite linear;z-index:3}.loading-inline:after{display:block;content:"";position:absolute;z-index:2;background-color:inherit;width:100%;height:100%;left:0;top:0}@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.modal{position:fixed;background-color:rgba(0,0,0,.65);width:100%;height:100%;left:0;top:0;z-index:9999;overflow-y:auto}.modal-opened{overflow:hidden}.modal__body{width:100%;max-width:30rem;margin:5rem auto;background-color:#fff;border-radius:4px}.modal__body--no-content-padding .modal__content{padding:0}.modal__body--wide{max-width:50rem}.modal__header{padding:.5rem 1rem;font-size:20px;font-weight:700;line-height:1.5;border-bottom:1px solid #eee}.modal__header.invisible-header{border:none;font-size:unset;font-weight:unset;padding-top:12px!important}.modal__header.invisible-header h3{margin-top:0;line-height:1.5;margin-bottom:0}.modal__header.invisible-header p{margin-top:.25rem;font-size:14px;opacity:.6;margin-bottom:0}.modal__header.invisible-header+.modal__content{padding-top:6px!important}.modal__header-buttons{font-weight:400}.modal__close{opacity:.5;cursor:pointer}.modal__close:hover{opacity:.8}.modal--right{float:right}.modal__content{padding:1rem}.modal__footer{padding:1rem;border-top:1px solid #eee;text-align:right}.modal__footer .button{display:inline-block!important;margin-left:4px!important}.modal__footer .footer-confirm{margin:0;padding:0;display:flex;align-items:center}.modal__footer .footer-confirm__buttons{flex-shrink:0}.modal__footer .footer-confirm__buttons--left{margin-right:auto;flex-grow:1;text-align:left}.modal__footer .footer-confirm__message{margin-right:auto}.modal__footer .footer-confirm__message.__right{flex-grow:1;padding-right:10px;text-align:right}.modal-transition-enter,.modal-transition-leave-to{opacity:0}.modal-transition-enter .modal__body,.modal-transition-leave-to .modal__body{opacity:0;transform:scaleX(.8) scaleY(.7)}.modal-transition-enter-active,.modal-transition-leave-active{transition:opacity .25s ease-out}.modal-transition-enter-active .modal__body,.modal-transition-leave-active .modal__body{transition:all .25s cubic-bezier(.665,1.65,0,.845)}.button-clear{border:none!important;background:transparent!important;box-shadow:none!important}.form-check{padding:4px 0}.form-check input{width:auto!important;margin:0 4px 0 0}.form-check input,.form-check label{display:inline-block!important}.form-group{padding-bottom:8px}.form-group label{display:block}.form-group>label{margin-bottom:2px}.form-group input,.form-group textarea{display:block;width:100%}.form-group:last-child{padding-bottom:0}.form-group p:first-child{margin-top:0}.form-group p:last-child{margin-bottom:0}.form-group .error{margin:0!important}.wpra-plugin-disable-poll__logo img{max-height:40px}

File Name:
templates.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\templates.min.css
Code:
.mobile-collapsed{display:inherit}.mobile-only{display:none!important}@media (max-width:782px){.mobile-only{display:inherit!important}.mobile-collapsed{display:none!important}}.wpra-bottom-panel{position:sticky;bottom:0;z-index:9;background-color:#fffce9;padding:1rem;border:1px solid #e5e5e5;box-shadow:0 1px 1px rgba(0,0,0,.04)}.wpra-bottom-panel__title{font-size:1rem;font-weight:500;padding-bottom:8px}a.disabled{color:#9c9c9c;pointer-events:none}[v-cloak] .vcloak--visible{display:block}[v-cloak] .vcloak--hidden{display:none}.vcloak--visible{min-height:60px;display:none}.loading-container{min-height:5rem;position:relative}.loading-container:before{display:block;content:"";position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);box-sizing:border-box;height:40px;width:40px;border:0 solid #d0d0d0;border-radius:50%;box-shadow:inset 0 -12px 0 16px #d0d0d0;animation:rotate 1s infinite linear;z-index:3}.loading-container:after{display:block;content:"";position:absolute;z-index:2;background-color:hsla(0,0%,95%,.5);width:100%;height:100%;left:0;top:0}.loading-container--white:after{background-color:#fff}.loading-button{pointer-events:none;position:relative}.loading-button:before{display:block;content:"";position:absolute;left:calc(50% - 8px);top:calc(50% - 8px);box-sizing:border-box;height:16px;width:16px;border:0 solid #aaa;border-radius:50%;box-shadow:inset 0 -4px 0 6px #aaa;animation:rotate 1s infinite linear;z-index:3}.loading-button:after{display:block;content:"";position:absolute;z-index:2;background-color:inherit;width:100%;height:100%;left:0;top:0}.button-default.loading-button:before{box-shadow:inset 0 -4px 0 6px #6f6f6f}.loading-inline{display:inline-block;pointer-events:none;position:relative}.loading-inline:before{display:block;content:"";position:absolute;left:calc(50% + 1px);top:calc(50% - 11px);box-sizing:border-box;height:14px;width:14px;border:0 solid #d0d0d0;border-radius:50%;box-shadow:inset 0 -3px 0 5px #d0d0d0;animation:rotate 1s infinite linear;z-index:3}.loading-inline:after{display:block;content:"";position:absolute;z-index:2;background-color:inherit;width:100%;height:100%;left:0;top:0}@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.table-loading{position:relative}.table-loading .table-loader-wrap{position:absolute;width:100%;height:100%;z-index:9}.table-loading .table-loader-wrap .table-loader-center{position:absolute;top:50%;transform:translateY(-50%);width:100%}.table-loading .tablenav,.table-loading .wp-list-table{opacity:.4}.table-loader{font-size:10px;margin:50px auto;text-indent:-9999em;width:11em;height:11em;border-radius:50%;background:#fff;background:-moz-linear-gradient(left,#fff 10%,hsla(0,0%,100%,0) 42%);background:-webkit-linear-gradient(left,#fff 10%,hsla(0,0%,100%,0) 42%);background:-o-linear-gradient(left,#fff 10%,hsla(0,0%,100%,0) 42%);background:-ms-linear-gradient(left,#fff 10%,hsla(0,0%,100%,0) 42%);background:linear-gradient(90deg,#fff 10%,hsla(0,0%,100%,0) 42%);position:relative;-webkit-animation:tableLoading 1s infinite linear;animation:tableLoading 1s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}.table-loader:before{width:50%;height:50%;background:#fff;border-radius:100% 0 0 0}.table-loader:after,.table-loader:before{position:absolute;top:0;left:0;content:""}.table-loader:after{background:#f4f4f4;width:75%;height:75%;border-radius:50%;margin:auto;bottom:0;right:0}@-webkit-keyframes tableLoading{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes tableLoading{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.toasted-container.top-center{top:44px!important}.toasted{background:#23282d!important;color:#e5e5e5!important;font-size:inherit!important;font-weight:inherit!important;justify-content:start!important;border-left:none!important}.toasted.error .dashicons{color:#ff7781}.toasted .dashicons{margin-right:12px;margin-left:-8px;display:inline-block;opacity:.65}.flex-row{display:flex}.flex-col{box-sizing:border-box;padding:0 10px;flex:1 1 0}.flex-col:first-child{padding-left:0}.flex-col:last-child{padding-right:0}.wpra-postbox .hndle{cursor:unset!important}.wpra-shortcode-copy{font-size:13px;background-color:#fff;margin-left:auto;padding:9px 14px;box-shadow:0 1px 1px 0 rgba(0,0,0,.1);border-left:4px solid #0085ba;display:flex;align-items:center}@media (max-width:782px){.wpra-shortcode-copy{display:block}}.wpra-shortcode-copy__icon{padding-left:16px}@media (max-width:782px){.wpra-shortcode-copy__icon{padding-left:0;margin-top:1rem}}.page-title{display:flex;align-items:center;padding:9px 0 4px}@media (max-width:782px){.page-title{display:block}}.page-title a:focus{text-decoration:none}.page-title h1{margin-left:6px;padding:0}.back-button{opacity:.75;text-decoration:none;font-size:20px;display:flex;align-items:center;padding-right:10px;margin-right:4px;border-right:1px solid #b4b4b4}@media (max-width:782px){.back-button{border-right:none;margin-bottom:.5rem}}.back-button .dashicons{margin-right:8px}.tippy-tooltip.light-theme{font-size:13px!important;font-family:unset!important;text-align:left!important}.tippy-tooltip.light-theme hr{border:none;height:1px;background-color:#efefef}.form-input{display:flex;margin:.75rem 0}.form-input--disabled{pointer-events:none}.form-input--disabled .form-input__label :not(.disable-ignored){opacity:.5;user-select:none}.form-input .disable-ignored{opacity:1}.form-input--vertical{flex-direction:column}.form-input--vertical .form-input__label{padding-right:0;padding-bottom:4px;flex-basis:100%}@media (max-width:782px){.form-input{flex-direction:column}.form-input .form-input__label{padding-right:0;padding-bottom:4px;flex-basis:100%}}.form-input:last-child{margin-bottom:0}.form-input__tip{cursor:pointer;display:inline-block;margin-left:4px;opacity:.25;vertical-align:middle}.form-input__tip:hover{opacity:.85}.form-input__tip .dashicons{font-size:18px}.form-input__label{padding-right:12px;flex-basis:260px}.form-input__label-description{padding-top:2px;padding-right:10px;line-height:1.65;opacity:.6;font-size:12px}.form-input__label-description a{pointer-events:auto!important}.form-input__field{flex-grow:1}.form-input__field input:not([type=checkbox]),.form-input__field select,.form-input__field textarea{width:100%;max-width:325px}.built-in{background:#f1f1f1}.built-in [type=checkbox]{display:none}.wpra-preview-link{vertical-align:middle}.wpra-preview-link span.dashicons{opacity:.75;font-size:16px;vertical-align:middle}.wpra-no-cb .column-cb input[type=checkbox]{display:none}@media (max-width:782px){.column.name small{display:block}}@media (max-width:782px){.inside .wpra-preview-link{float:none}}@media (max-width:782px){.wpra-postbox-container{display:flex;flex-direction:column}.wpra-postbox-container .wpra-postbox-last{order:100}}

File Name:
update.min.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\build\update.min.css
Code:
.mobile-collapsed{display:inherit}.mobile-only{display:none!important}@media (max-width:782px){.mobile-only{display:inherit!important}.mobile-collapsed{display:none!important}}.wrap--wpra-update{padding-top:1rem}@media (min-width:782px){.wrap--wpra-update{width:100%;max-width:1400px;margin:0 auto;padding-right:20px;box-sizing:border-box}}.wpra-text-center{text-align:center}.wpra-updates ul{list-style:disc;padding:0 1.25rem}.wpra-inline-form{display:flex;align-items:baseline}.wpra-inline-form button{margin-right:12px!important}.wpra-inline-form small{font-size:12px;opacity:.75}.wpra-update-head__title{font-size:24px;font-weight:500;padding:1.5rem 0;line-height:1.4}.wpra-update__logo img{width:56px}.button-icon span{vertical-align:baseline;margin-right:-7px;opacity:.6;font-size:16px;top:4px;position:relative}.wpra-links{padding-top:.5rem}.wpra-update-head__link{font-size:1rem;padding-bottom:1.5rem;line-height:1.5}.wpra-update-feature{display:flex;padding:0 18px 12px!important}@media (max-width:782px){.wpra-update-feature{flex-direction:column-reverse}}@media (min-width:782px){.wpra-update-feature__text{padding-right:12px}}.wpra-update-feature__text h3{margin-top:8px}@media (max-width:782px){.wpra-update-feature__text h3{margin-top:16px}}.wpra-update-feature__text p{font-size:14px}.wpra-update-feature__image{flex-shrink:0;width:30rem;overflow:hidden;min-height:336px;position:relative;margin:-11px -18px -23px 0;cursor:pointer;transition-duration:.5s}.wpra-update-feature__image:hover{transition-duration:.2s;background-color:#111}.wpra-update-feature__image:hover img{opacity:.95}.wpra-update-feature__image:hover:before{content:"\F177";display:block;position:absolute;top:calc(50% - 45px);width:100%;height:90px;font-size:5em;font-family:dashicons;text-align:center;z-index:100;opacity:.5}@media (max-width:782px){.wpra-update-feature__image{flex-shrink:unset;width:unset;min-height:unset;max-height:15rem;margin:-11px -18px 0}}.wpra-update-feature__image img{max-height:29rem;position:absolute}@media (max-width:782px){.wpra-update-feature__image img{max-height:unset;position:unset;max-width:100%}}

File Name:
styles.css
Directory Path:
sourcecodefiles\wp-rss-aggregator\css\templates\list\styles.css
Code:
/* An item in the list */
div.wpra-list-template .wpra-item-list > li.wpra-item {
	margin-top: 0px;
	margin-bottom: 10px;
}

/* Separators between source, date and author */
div.wpra-list-template .wpra-item-list > li.wpra-item > div.wprss-feed-meta > span {
	font-size: 90%;
	clear: both;
}
div.wpra-list-template .wpra-item-list > li.wpra-item > div.wprss-feed-meta > span:not(:last-child):after {
	content: ' | ';
}

/* Bullet types */
.wpra-item-list {
	list-style: none;
}
.wpra-item-list:not(.wpra-item-list--bullets) li {
	margin-left: 0;
}
.wpra-item-list--bullets.wpra-item-list--default {
	list-style-type: disc;
}
.wpra-item-list--bullets.wpra-item-list--numbers {
	list-style: decimal;
}

/* Audio player */
.wpra-feed-audio {
	display: block;
	margin: 0 5px;
}

.wpra-feed-audio audio {
	width: 100%;
}

/**
 * Old styles
 */

.thumbnail-excerpt {
	overflow:hidden;
	margin-bottom: 5px;
}

.thumbnail-excerpt img {
	max-width:100%; float:left; margin-top: 0.5em; margin-right:10px;
}

.green {
	color: #0BD600;
}

.nav-links {
	overflow: hidden;
	margin-bottom: 20px;
}

.nav-links::after {
	display: block;
	content: '';
	clear: both;
}


File Name:
admin-activate.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-activate.php
Code:
<?php

if (wprss_can_use_twig()) {
    /* The introduction page module */
    require_once(WPRSS_INC . 'admin-intro-page.php');
    /* The update page module */
    require_once(WPRSS_INC . 'admin-update-page.php');
}

/**
 * Detects an activation and redirects the user to the correct page (intro or update).
 *
 * @since 4.12.1
 */
add_action('admin_init', function () {
    // Continue only if during an activation redirect
    if (!get_transient('_wprss_activation_redirect')) {
        return;
    }

    // Delete the redirect transient
    delete_transient('_wprss_activation_redirect');

    // Continue only if activating from a non-network site and not bulk activating plugins
    if (is_network_admin() || isset($_GET['activate-multi'])) {
        return;
    }

    if (wprss_should_do_intro_page()) {
        wp_safe_redirect(wprss_get_intro_page_url());
        return;
    }

    if (wprss_should_do_update_page()) {
        wp_safe_redirect(wprss_get_update_page_url());
        return;
    }
});


File Name:
admin-ajax-notice.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-ajax-notice.php
Code:
<?php

use Aventura\Wprss\Core\Model\AdminAjaxNotice\ServiceProvider;
use Dhii\Di\WritableContainerInterface;
use Aventura\Wprss\Core\Model\AdminAjaxNotice\NoticeInterface;

define ('WPRSS_NOTICE_SERVICE_ID_PREFIX', WPRSS_SERVICE_ID_PREFIX . 'notice.');


    add_action( 'wp_ajax_wprss_hide_admin_notification', 'wprss_hide_admin_notification' );
    /**
     * JavaScript callback used to hide the administration notice when the 'Dismiss' anchor is clicked on the front end.
     *
     * @since 3.0
     */
    function wprss_hide_admin_notification() {

        // First, check the nonce to make sure it matches what we created when displaying the message.
        // If not, we won't do anything.
        if( wp_verify_nonce( $_REQUEST['nonce'], 'ajax-notification-nonce' ) ) {

            // If the update to the option is successful, send 1 back to the browser;
            // Otherwise, send 0.
            $general_settings = get_option( 'wprss_settings_notices' );
            $general_settings = true;

            if( update_option( 'wprss_settings_notices', $general_settings ) ) {
                die( '1' );
            } else {
                die( '0' );
            }
        }
    }



    /**
     * Checks if the addon notices option exists in the database, and creates it
     * if it does not.
     *
     * @return The addon notices option
     * @since 3.4.2
     */
    function wprss_check_addon_notice_option() {
        $option = get_option( 'wprss_addon_notices' );
        if ( $option === FALSE ) {
            update_option( 'wprss_addon_notices', array() );
            return array();
        }
        return $option;
    }



    /**
     * This function is called through AJAX to dismiss a particular addon notification.
     *
     * @since 3.4.2
     */
    function wprss_dismiss_addon_notice() {
        $addon = ( isset( $_POST['addon'] ) === TRUE )? $_POST['addon'] : null;
        if ( $addon === null ) {
            echo 'false';
            die();
        }
        $notice = ( isset( $_POST['notice'] ) === TRUE )? $_POST['notice'] : null;
        if ( $notice === null ){
            echo 'false';
            die();
        }

        $notices = wprss_check_addon_notice_option();
        if ( isset( $notices[$addon] ) === FALSE ) {
            $notices[$addon] = array();
        }
        if ( isset( $notices[$addon][$addon] ) === FALSE ) {
            $notices[$addon][$notice] = '1';
        }
        update_option( 'wprss_addon_notices', $notices );
        echo 'true';

        die();
    }

    add_action( 'wp_ajax_wprss_dismiss_addon_notice', 'wprss_dismiss_addon_notice' );




    /**
     * AJAX action for the tracking pointer
     *
     * @since 3.6
     */
    function wprss_tracking_ajax_opt() {
        if ( isset( $_POST['opted'] ) ){
            $opted = $_POST['opted'];
            $settings = get_option( 'wprss_settings_general' );
            $settings['tracking'] = $opted;
            update_option( 'wprss_settings_general', $settings );
        }
        die();
    }

    add_action( 'wp_ajax_wprss_tracking_ajax_opt', 'wprss_tracking_ajax_opt' );


/**
 * Responsible for tracking and outputting admin notices
 *
 * Usage:
 * Initialize by calling {@see init()} early, before `admin_init`. On `plugins_loaded`
 * is a good place.
 * Do not add notices conditionally. Instead, add them always, but specify
 * the `condition` index to {@see add_notice()}.
 *
 * @since 4.7.4
 */
class WPRSS_Admin_Notices {

	// How should a set of conditions be evaluated
	const CONDITION_TYPE_ALL = 'all'; // Requires all conditions to be true
	const CONDITION_TYPE_ANY = 'any'; // Requires one condition to be true
	const CONDITION_TYPE_NONE = 'none'; // Requires none of the conditions to be true
	const CONDITION_TYPE_ALMOST = 'almost'; // Requires at least one of the conditions to be false

	// What happens if a condition encounters an error
//	const CONDITION_ON_ERROR_STOP_FALSE = 'stop_false'; // Assume that the condition was not satisfied, and do not evaluate other conditions
//	const CONDITION_ON_ERROR_STOP_TRUE = 'stop_true'; // Assume that the condition was satisfied, and do not evaluate other conditions
//	const CONDITION_ON_ERROR_CONTINUE_FALSE = 'continue_false'; // Assume that the condition was not satisfied, and continue evaluating
//	const CONDITION_ON_ERROR_CONTINUE_TRUE = 'continue_true'; // Assume that the condition was satisfied, and continue evaluating
	const CONDITION_ON_ERROR_THROW_EXCEPTION = 'throw_exception'; // Just halt


	protected $_notices = array();
	protected $_setting_code;
	protected $_id_prefix;
	protected $_text_domain;
	protected $_notice_base_class;
	protected $_nonce_base_class;
	protected $_btn_close_base_class;
        protected $_dismiss_mode_class_prefix;


	/**
	 *
	 * @since 4.7.4
	 * @param null|array The settings of this instance.
	 *  Possible values are:
	 *		- 'setting_code': The code of the database setting used for storing and managing notices of this instance.
	 *			See {@link set_setting_code()}.
	 *			If a string is passed as data, this is what it is assumed to be.
	 *		- 'id_prefix': The prefix of all IDs generated by this instance.
	 *			See {@link set_id_prefix()}.
	 *		- 'text_domain': The text domain to use for translation.
	 *			See {@link set_text_domain()}.
	 *		- 'notice_base_class': The class for all notice elements.
	 *			See {@link set_notice_base_class()}.
	 *		- 'nonce_base_class': The class for all notice nonce elements.
	 *			See {@link set_nonce_base_class()}.
	 */
	public function __construct( $data = array() ) {
		if ( is_string( $data ) )
			$data = array( 'setting_code' => $data );

		if ( isset( $data['setting_code'] ) )
			$this->set_setting_code (  $data['setting_code'] );

		if ( isset( $data['id_prefix'] ) )
			$this->set_id_prefix( $data['id_prefix'] );

		if ( isset( $data['text_domain'] ) )
			$this->set_text_domain( $data['text_domain'] );

		// Common class for all notices
		if ( !isset( $data['notice_base_class'] ) )
			$data['notice_base_class'] = $this->prefix( 'admin-notice' );
		$this->set_notice_base_class( $data['notice_base_class'] );

		// Common class for all nonces
		if ( !isset( $data['nonce_base_class'] ) )
			$data['nonce_base_class'] = $this->prefix( 'admin-notice-nonce' );
		$this->set_nonce_base_class( $data['nonce_base_class'] );

		// Common class for all close buttons
		if ( !isset( $data['btn_close_base_class'] ) )
			$data['btn_close_base_class'] = $this->prefix( 'admin-notice-btn-close' );
		$this->set_btn_close_base_class( $data['btn_close_base_class'] );

                // Class prefix for dismiss mode
                if ( !isset( $data['dismiss_mode_class_prefix'] ) )
                        $data['dismiss_mode_class_prefix'] = 'dismiss-mode-';
                $this->set_dismiss_mode_class_prefix($data['dismiss_mode_class_prefix']);

		$this->_construct();
	}


	/**
	 * Internal, parameter-less constructor.
	 *
	 * @since 4.7.4
	 */
	protected function _construct() {

	}


	/**
	 * Initializes the instance for use with WP.
	 *
	 * Essentially, this is what prepares it and hooks the handlers in.
	 *
	 * @since 4.7.4
	 * @uses-action admin_notice_before_init To expose the object before initialization
	 * @uses-action admin_notice_before_init To expose the object after initialization
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function init() {
		do_action( $this->prefix( 'admin_notice_before_init' ), $this );
		add_action( 'admin_notices', array( $this, 'output_allowed_notices' ) );
		do_action( $this->prefix( 'admin_notice_after_init' ), $this );

		return $this;
	}


        /**
         * Sets the prefix for dismiss mode class name.
         *
         * @since 4.11
         *
         * @param string $prefix The prefix.
         * @return $this This instance.
         */
        public function set_dismiss_mode_class_prefix($prefix) {
            $this->_dismiss_mode_class_prefix = trim($prefix);
            return $this;
        }


        /**
         * Sets the prefix for dismiss mode class name.
         *
         * @since 4.11
         *
         * @return string The prefix.
         */
        public function get_dismiss_mode_class_prefix() {
            return $this->_dismiss_mode_class_prefix;
        }

	/**
	 * Get the ID prefix, or a prefixed string.
	 *
	 * This function is also used internally by this class to prefix generated
	 * IDs that are specific to this instance.
	 * Currently, this prefix is used in HTML of the notices, and in names
	 * of hooks.
	 *
	 * @param null|string $string The string to prefix.
	 * @return string The prefix, or prefixed string
	 */
	public function prefix( $string = null ) {
		$prefix = (string)$this->_id_prefix;
		return is_null( $string ) ? $prefix : $prefix . $string;
	}


	/**
	 * Sets a prefix that will be added to IDs specific to this collection.
	 *
	 * @since 4.7.4
	 * @param string $prefix The prefix to set.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_id_prefix( $prefix ) {
		$this->_id_prefix = $prefix;
		return $this;
	}


	/**
	 * Set the name of the setting to store the notices in.
	 *
	 * @since 4.7.4
	 * @see get_setting_name()
	 * @param string $name The name of the notices setting to use.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_setting_code( $name ) {
		$this->_setting_code = $name;
		return $this;
	}


	/**
	 * Get the name of the notices setting.
	 *
	 * @since 4.7.4
	 * @see set_setting_name()
	 * @return string The name of the setting which stores notices and their states.
	 */
	public function get_setting_name() {
		return $this->_setting_code;
	}


	/**
	 * Retrieve the text domain that is used for translation by this instance.
	 *
	 * @since 4.7.4
	 * @return string The text domain.
	 */
	public function get_text_domain() {
		return $this->_text_domain;
	}


	/**
	 * Set the text domain that is used for translation by this instance.
	 *
	 * @since 4.7.4
	 * @param string $text_domain The text domain.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_text_domain( $text_domain ) {
		$this->_text_domain = $text_domain;
		return $this;
	}


	/**
	 * Get the class that is the base, common class for all notices' top HTML elements.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_base_class To modify return value.
	 * @return string The class common to all notices
	 */
	public function get_notice_base_class() {
		return apply_filters( $this->prefix( 'admin_notice_base_class' ), $this->_notice_base_class );
	}


	/**
	 * Set the class that will be the base, common class for all notices' top HTML elements.
	 *
	 * @since 4.7.4
	 * @param string $class The class name that will be common to all notices.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_notice_base_class( $class ) {
		$this->_notice_base_class = $class;
		return $this;
	}


	/**
	 * Get the class that is the base, common class for all notices' nonces' HTML elements.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_nonce_base_class To modify return value.
	 * @return string The class common to all nonces
	 */
	public function get_nonce_base_class() {
		return apply_filters( $this->prefix( 'admin_notice_nonce_base_class' ), $this->_nonce_base_class );
	}


	/**
	 * Set the class that will be the base, common class for all notices' nonces' HTML elements.
	 *
	 * @since 4.7.4
	 * @param string $class The class name that will be common to all nonces.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_nonce_base_class( $class ) {
		$this->_nonce_base_class = $class;
		return $this;
	}


	/**
	 * Get the class that is the base, common class for all notices' close buttons' HTML elements.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_btn_close_base_class To modify return value.
	 * @return string The class common to all close buttons
	 */
	public function get_btn_close_base_class() {
		return apply_filters( $this->prefix( 'admin_notice_btn_close_base_class' ), $this->_btn_close_base_class );
	}


	/**
	 * Set the class that will be the base, common class for all notices' close buttons' HTML elements.
	 *
	 * @since 4.7.4
	 * @param string $class The class name that will be common to close buttons.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_btn_close_base_class( $class ) {
		$this->_btn_close_base_class = $class;
		return $this;
	}


	/**
	 * Adds an admin notice.
	 *
	 * - If 'id' is not passed, a unique ID will be auto-generated.
	 * - If 'nonce' is not passed, a nonce will be auto-generated based on the ID.
	 * - A 'condition' is one or more callbacks. If none are passed, the notice will be displayed on all admin pages.
	 * - A 'condition_type' is one of the CONDITION_TYPE_* class constants. By default, all conditions have to be true.
	 * - The 'class' index determinces what type of notice it is. Currently, the valid values are 'updated', 'error'  and 'update-nag'.
	 *		See https://codex.wordpress.org/Plugin_API/Action_Reference/admin_notices
	 * - The 'content' index is the literal content of the notice.
	 * - If 'btn_close_id' is not passed, it will be auto-generated based on the ID.
	 * - The 'btn_close_class' index determines the class that the close button will have, in addition to the default 'btn-close'.
	 * - The 'btn_close_content' index determines the literal content of the element of the close button. HTML allowed.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_add_before_normalize To allow pre-normalization modification of notice.
	 * @uses-filter admin_notice_add_before To allow post-normalization modification of notice.
	 * @uses-action admin_notice_add_after To expose data of added notice. This will not be fired if notice was not added.
	 * @param array $notice Data of the notice to add.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function add_notice( $notice ) {
		$notice = apply_filters( $this->prefix( 'admin_notice_add_before_normalize' ), $notice, $this );
		$notice = $this->normalize_notice_data( $notice );
		$notice = apply_filters( $this->prefix( 'admin_notice_add_before' ), $notice, $this );
		$this->set_notice( $notice );
		do_action( $this->prefix( 'admin_notice_add_after' ), $notice, $this );

		return $this;
	}


	/**
	 * Sets the data for a notice with the specified ID.
	 *
	 * No normalization or checks are made, except for the presence of an ID.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_set_before To alter the data of the notice before setting.
	 * @uses-action admin_notice_set_after To expose the data of the notice after setting.
	 * @param array $notice Data of the notice.
	 * @param null|string $id The ID of the notice. If set, overrides 'id' index in notice data.
	 * @return \WPRSS_Admin_Notices This instance.
	 * @throws Exception If ID is missing.
	 */
	public function set_notice( $notice, $id = null ) {
		$notice = apply_filters( $this->prefix( 'admin_notice_set_before' ), $notice, $id, $this );
		$id = isset( $notice['id'] ) ? $notice['id'] : $id;
		if ( is_null( $id ) )
			throw new Exception( 'Could not set admin notice: ID must be specified in either notice data, or as separate argument' );

		$this->_notices[ $id ] = $notice;
		do_action( $this->prefix( 'admin_notice_set_after' ), $notice, $id, $this );
		return $this;
	}


	/**
	 * Normalize data of a notice, adding defaults.
	 *
	 * Auto-generating 'id', 'nonce', 'btn_close_id', 'nonce_element_id', 'btn_close_id'.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_defaults Default values, before addin auto-generated values.
	 * @uses-filter admin_notice_defaults_autogenerated Default values, after adding auto-generated values.
	 * @param array $data The notice data to normalize
	 * @return array $data The normalized data of a notice
	 */
	public function normalize_notice_data( $data ) {
		$data = wp_parse_args( $data, apply_filters( $this->prefix( 'admin_notice_defaults' ), array(
			'id'					=> null, // ID of the notice. Unique for the notice in this collection.
			'nonce'					=> null, // Nonce for the notice. Prevents unauthorised manipulation.
			'condition'				=> array(), // These callbacks will decide whether or not the nonce is to be displayed
			'condition_type'		=> self::CONDITION_TYPE_ALL, // Which of the conditions have to be satisfied
			'conditon_on_error'		=> self::CONDITION_ON_ERROR_THROW_EXCEPTION,
			'is_active'				=> true, // Whether this notice should be assumed to be active, unless set otherwise
			'nonce_element_class'	=> $this->prefix( 'admin-notice-nonce' ), // HTML class for the element that contains the nonce
			'nonce_element_id'		=> null,
			'class'					=> '', // HTML class for the element of the notice
			'notice_type'			=> 'updated', // Type of the notice.
			'notice_element_class'	=> $this->prefix( 'admin-notice' ),
			'content'				=> '', // The content of this notice
			'btn_close_id'			=> null, // The HTML ID for the close button
			'btn_close_class'		=> 'btn-close', // The HTML class for the close button, in addition to default
			'btn_close_content'	 => __( 'Dismiss this notification', $this->get_text_domain() ), // The content of the close button. HTML allowed.
                        'dismiss_mode'          => NoticeInterface::DISMISS_MODE_AJAX
		)));

		// Auto-generate ID
		if ( is_null( $data['id'] ) )
			$data['id'] = $this->generate_unique_id( 'admin-notice-', $data );

		// Prefix ID
		$data['id'] = $this->prefix( $data['id'] );

		// Auto-generate nonce
		if ( is_null( $data['nonce'] ) && !is_null( $data['id'] ) ) {
            $me = $this;
			$data['nonce'] = wprss()->getAdminHelper()->createCommand(function() use ($me, $data) {
                $nonce = $me->generate_nonce_for_notice( $data['id'] );
                return $nonce;
            });
		}

		// Auto-generate nonce element ID
		if ( is_null( $data['nonce_element_id'] ) && !is_null( $data['id'] ) )
			$data['nonce_element_id'] = sprintf( '%1$s-nonce', $data['id'] );

		// Auto-generate close button ID
		if ( is_null( $data['btn_close_id'] ) && !is_null( $data['id'] ) )
			$data['btn_close_id'] = sprintf( 'close-%1$s', $data['id'] );

		return apply_filters( $this->prefix( 'admin_notice_defaults_autogenerated' ), $data );
	}


	/**
	 * Removes a notice from this collection.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_remove_before To modify the notice ID that will be removed. Returning falsy value prevents removal.
	 * @uses-action admin_notice_remove_after To expose notice ID after removal.
	 * @param array|int $notice A notice, or notice ID.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function remove_notice( $notice ) {
		if ( is_array( $notice ) )
			$notice = isset( $notice['id'] ) ? $notice['id'] : null;

		if ( is_null( $notice ) )
			return $this;

		if ( !$this->has_notice( $notice ) )
			return $this;

		$notice = apply_filters( $this->prefix( 'admin_notice_remove_before' ), $notice, $this );
		if( !$notice ) return $this;

		$this->_remove_notice ( $notice, $this->_notices);
		do_action( $this->prefix( 'admin_notice_remove_after' ), $notice, $this );

		return $this;
	}


	/**
	 * Removes a notice by ID from the supplied array.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_internal_remove_before To modify notice before removal. Returning falsy value prevents removal.
	 * @uses-action admin_notice_internal_remove_after To expose data of notice after removal.
	 * @param array|string $notice A notice, or notice ID
	 * @param array $array The array, from which to remove the notice.
	 * @return \WPRSS_Admin_Notices This instance.
	 * @throws Exception If no ID specified.
	 */
	protected function _remove_notice( $notice, &$array = null ) {
		if ( is_array( $notice ) )
			$notice = isset( $notice['id'] ) ? $notice['id'] : null;

		if ( is_null( $notice ) )
			throw new Exception( 'Could not remove notice: an ID must be specified' );

		if ( is_null( $array ) )
			$array = &$this->_notices;

		if ( !array_key_exists( $notice, $array ) )
			return $this;

		$notice = apply_filters( $this->prefix( 'admin_notice_internal_remove_before' ), $notice, $array, $this );
		if ( !$notice ) return $this;

		unset( $array[ $notice ] );
		do_action( $this->prefix( 'admin_notice_internal_remove_after' ), $notice, $array, $this );

		return $this;
	}


	/**
	 * Checks whether a notice already exists.
	 *
	 * @since 4.7.4
	 * @param array|int $notice A notice, or notice ID to check for.
	 * @return boolean True if notice already exists; false otherwise.
	 */
	public function has_notice( $notice ) {
		if ( is_array( $notice ) )
			$notice = isset( $notice['id'] ) ? $notice['id'] : null;

		return array_key_exists( $notice , $this->_notices );
	}


	/**
	 * Get all notices, or a notice with the specified ID.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_get_all To modify all notices returned.
	 * @uses-filter admin_notice_get To modify single returned notice.
	 * @param null|string $id The ID of a notice to retrieve.
	 * @param null $default What to return if notice not found.
	 * @return array Retrieve all or one notice. See {@link normalize_notice_data()} for data keys.
	 */
	public function get_notices( $id = null, $default = null ) {
		if ( is_null( $id ) )
			return apply_filters( $this->prefix( 'admin_notice_get_all' ), $this->_notices, $this );

		return apply_filters( $this->prefix( 'admin_notice_get' ),
				isset( $this->_notices[ $id ] ) ? $this->_notices[ $id ] : $default,
				$id,
				$default,
				$this );
	}


	/**
	 * Get all notices that are active.
	 *
	 * @since 4.7.4
	 * @see is_notice_active()
	 * @return array Notices that are currently active;
	 */
	public function get_active_notices( $is_default_active = null ) {
		if ( is_null( $is_default_active ) )
			$is_default_active = true;

		$active_notices = array();
		foreach ( $this->get_notices() as $_id => $_notice ) {
			if ( $this->is_notice_active( $_notice, $is_default_active ) )
				$active_notices[ $_id ] = $_notice;
		}

		return $active_notices;
	}


	/**
	 * Determine whether the specified notice is active.
	 *
	 * If data array is passed, it's 'is_active' key will be used as default.
	 * Otherwise, data will be retrieved by ID and compared to database.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_is_active To modify return value. Used in several places.
	 * @param array|string $notice Notice or notice ID.
	 * @param boolean $default What to return if no notice state data exists.
	 * @return boolean Whether or not the specified notice is active.
	 * @throws Exception If ID not specified.
	 */
	public function is_notice_active( $notice, $default = null ) {
		// State if no state provided
		if ( is_null( $default ) )
			$default = true;

		// If ID passed, retrieve the notice
		if ( !is_array( $notice ) )
			$notice = $this->get_notices( $notice, array() );
		// Last resort defaults
		$id = isset( $notice['id'] ) ? $notice['id'] : null;
		$is_active_default = isset( $notice['is_active'] ) ? (bool)$notice['is_active'] : $default;

		if ( is_null( $id ) )
			throw new Exception( 'Could not determine notice state: ID must be specified' );

		// Settings from DB
		$settings = $this->get_notices_settings( $id );

		// If no state, assume default
		if ( !isset( $settings['is_active'] ) )
			return apply_filters( $this->prefix( 'admin_notice_is_active' ), $is_active_default, $id, $this );

		return apply_filters( $this->prefix( 'admin_notice_is_active' ), (bool)$settings['is_active'], $id, $this );
	}


	/**
	 * Set notice active state.
	 *
	 * @since 4.7.4
	 * @param array|string $notice Notice data or ID.
	 * @param null|boolean $is_active If true, notice state will be set to active; if false - to inactive. Default: true.
	 */
	public function set_notice_active( $notice, $is_active = null ) {
		if ( is_null( $is_active ) )
			$is_active = true;

		$this->set_notices_settings( $notice, (bool)$is_active );
		return $this;
	}


	/**
	 * Gets all notices that pass their conditions according to the condition type.
	 *
	 * Allowed notices are also only active ones. Inactive notices are not evaluated.
	 *
	 * @since 4.7.4
	 * @see is_notice_allowed()
	 * @uses-filter admin_notice_all_allowed To modify return value.
	 * @return array Allowed notices.
	 */
	public function get_allowed_notices() {
		$allowed_notices = array();
		foreach ( $this->get_active_notices() as $_id => $_notice ) {
			if ( $this->is_notice_allowed( $_notice) )
				$allowed_notices[ $_id ] = $_notice;
		}

		return apply_filters( $this->prefix( 'admin_notice_all_allowed' ), $allowed_notices, $this );
	}


	/**
	 * Checks if the specified notice is allowed.
	 *
	 * To determine that, the notice's conditions are evaluated according
	 * to the condition type.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_is_allowed To modify return value.
	 * @param array|string $notice Notice or notice ID.
	 * @return bool Whether or not the specified notice passed it's conditions to be allowed.
	 * @throws Exception If ID not specified.
	 */
	public function is_notice_allowed( $notice ) {
		if ( !is_array( $notice ) )
			$notice = $this->get_notices( $notice );

		$conditions = isset( $notice['condition'] ) ? $notice['condition'] : array();
		$condition_type = isset( $notice['condition_type'] ) ? $notice['condition_type'] : self::CONDITION_TYPE_ALL;
		$is_allowed = $this->evaluate_conditions( $conditions, $condition_type, array( $notice ) );
		return apply_filters( $this->prefix( 'admin_notice_is_allowed' ), $is_allowed, $notice );
	}


	/**
	 * Generates a nonce for a notice ID.
	 *
	 * @since 4.7.4
	 * @see wp_create_nonce()
	 * @see generate_nonce_code()
	 * @uses-filter admin_notice_nonce_for_notice
	 * @param array|string $notice Notice or notice ID.
	 * @return string The nonce.
	 * @throws Exception If ID not specified.
	 */
	public function generate_nonce_for_notice( $notice ) {
		if ( is_array( $notice ) )
			$notice = isset( $notice['id'] ) ? $notice['id'] : null;

		if ( is_null( $notice ) )
			throw new Exception( 'Could not get nonce for notice: notice ID must be specified' );

		$nonce_code = $this->generate_nonce_code( $notice );
		$nonce = wp_create_nonce( $nonce_code );

		return apply_filters( $this->prefix( 'admin_notice_nonce_for_notice' ), $nonce, $notice, $nonce_code, $this );
	}


	/**
	 * Generates a code that is used to generate a nonce for a notice.
	 *
	 * @since 4.7.4
	 * @see wp_create_nonce()
	 * @see generate_nonce_for_notice()
	 * @uses-filter admin_notice_nonce_code To modify return value.
	 * @param array|string $notice Notice or notice ID;
	 * @return string Code (action) for the nonce.
	 * @throws Exception If nonce ID not specified.
	 */
	public function generate_nonce_code( $notice ) {
		if ( is_array( $notice ) )
			$notice = isset( $notice['id'] ) ? $notice['id'] : null;

		if ( is_null( $notice ) )
			throw new Exception( 'Could not generate nonce code for notice: notice ID must be specified' );

		return apply_filters( $this->prefix( 'admin_notice_nonce_code' ), sprintf( '%1$s-nonce', $notice ), $notice, $this );
	}


	/**
	 * Evaluates a condition or group of conditions based on the condition type.
	 *
	 * A condition is a callable that returns true or false (no type checking is done here).
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_conditions_evaluated To modify the return value.
	 * @uses-filter admin_notice_condition_result To alter the result of each condition's evaluated.
	 * @param array|callable $conditions A callable or an array of callables.
	 * @param string $condition_type One of the CONDITION_TYPE_* class constants. Default: CONDITION_TYPE_ALL.
	 * @param array $args These args will be passed to the condition callable.
	 * @return boolean Whether or not the conditions evaluate according to the condition type.
	 * @throws Exception If a condition cannot be called.
	 */
	public function evaluate_conditions( $conditions, $condition_type = self::CONDITION_TYPE_ALL, $args = array() ) {
		$event_name = $this->prefix( 'admin_notice_conditions_evaluated' );
		$result = true; // By default, evaluation passes
		if ( empty( $conditions ) ) return apply_filters ( $event_name, $result, $condition_type, $this ); // Unconditional ;)
		if ( !is_array( $conditions ) ) $conditions = array($conditions); // Normalizing

		foreach ( $conditions as $_idx => $_condition ) {
			$func = is_array( $_condition ) && isset( $_condition['func'] )
					? $_condition['func']
					: $_condition;
			$args = array_merge( // Appending our args to the passed args
						array_values( isset( $_condition['args'] ) ? (array)$_condition['args'] : array() ),
						array_values( $args ));

			if ( !is_callable( $func ) )
				throw new Exception ( sprintf( 'Could not evaluate condition %1$d: condition must contain a callable', $_idx ) );

			$_value = call_user_func_array( $func, $args );
			$_value = apply_filters( $this->prefix( 'admin_notice_condition_result' ), $_value, $_idx, $condition_type, $_condition, $args, $this );
			switch ( $condition_type ) {
				case self::CONDITION_TYPE_ANY: // At least one must be true
					if ( (bool)$_value ) return apply_filters ( $event_name, true, $condition_type, $this );
					$result = false;
					break;

				case self::CONDITION_TYPE_ALMOST: // At least one must be false
					if ( !(bool)$_value ) return  apply_filters ( $event_name, true, $condition_type, $this );
					$result = false;
					break;

				case self::CONDITION_TYPE_NONE: // All must be false
					if ( (bool)$_value ) return apply_filters ( $event_name, false, $condition_type, $this );
					$result = true;
					break;

				default:
				case self::CONDITION_TYPE_ALL: // All must be true
					if ( !(bool)$_value ) return apply_filters ( $event_name, false, $condition_type, $this );
					$result = true;
					break;
			}
		}

		return apply_filters ( $event_name, $result, $condition_type, $this );
	}


	/**
	 * Get settings for all notices, or just one.
	 *
	 * It appears that options are already being cached by WP.
	 * Also, some notices in the returned array may not be registered for display,
	 * in which case they will not be displayed. And vice-versa: some of the registered
	 * notices will not have any settings associated with them, in which case
	 * defaults are assumed. See {@link is_notice_active()} for information.
	 * The settings contain states, not notice information.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_get_notices_settings_all To modify settings of all notices.
	 * @uses-filter admin_notice_get_notices_settings To modify settings of just one notice. May have been modified by admin_notice_get_notices_settings_all.
	 * @param null|string $id Notice ID
	 * @param null|mixed $default What to return if no settings for notice. Default: empty array.
	 * @return array An array, where key is notice ID, and value is boolean indicating whether or not it is active.
	 */
	public function get_notices_settings( $id = null, $default = null ) {
		if( is_null( $default ) )
			$default = array();

		$settings = apply_filters( $this->prefix( 'admin_notice_get_notices_settings_all' ),
				get_option( $this->get_setting_name(), array() ),
				$this );

		if ( is_null( $id ) )
			return $settings;

		// Normalize
		$settings = isset( $settings[ $id ] ) ? $settings[ $id ] : $default;
		$settings = $this->normalize_notice_data_from_db( $settings );

		return apply_filters( $this->prefix( 'admin_notice_get_notices_settings' ),
				$settings,
				$id,
				$default,
				$this );
	}


	/**
	 *
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_set_settings_before To modify what gets saved. Also see {@link prepare_notice_data_for_db()}.
	 * @uses-action admin_notice_set_settings_after To expose data that has been saved.
	 * @param string|array $notice The notice data, or notice ID, to save.
	 * @param null|array|boolean $settings The settings, or just the active state, to save.
	 * @return \WPRSS_Admin_Notices This instance.
	 * @throws Exception If an ID is nowhere to be found. How to save? :S
	 */
	public function set_notices_settings( $notice, $settings = null ) {
		// Normalizing notice data
		if ( !is_array( $notice ) )
			$notice = array( 'id' => $notice );
		// If using just the notice data to save everything
		if ( is_null( $settings ) )
			$settings = $notice;
		// If saving just the active state
		if ( is_bool( $settings ) )
			$settings = array( 'is_active' => $settings );

		// Making sure notice ID isn't overwritten
		if( isset( $settings['id'] ) )
			unset( $settings['id'] );

		// Merging the data together to get all data to save
		$settings = wp_parse_args( $settings, $notice );

		// Making sure that an ID ultimately exists
		if ( !isset( $settings['id'] ) )
			throw new Exception( 'Could not set notice settings: ID must be specified' );

		$id = $settings['id'];
		$db_settings = $this->get_notices_settings( $id );

		// Merge again to only update what is in the database
		$settings = wp_parse_args( $settings, $db_settings );

		// Get all settings data
		$all_settings = $this->get_notices_settings();
		// Set and finally save
		$settings = apply_filters( $this->prefix( 'admin_notice_set_settings_before' ), $settings, $id, $this );
		$settings = $this->prepare_notice_data_for_db( $settings );
		$all_settings[ $id ] = $settings;
		$this->set_notices_settings_all( $all_settings );
		do_action( $this->prefix( 'admin_notice_set_settings_after' ), $settings, $id, $this );

		return $this;
	}


	/**
	 * Saves the data of all specified notices to the database.
	 *
	 * The passed data will replace all data currently stored in the option.
	 *
	 * @since 4.7.4
	 * @see get_setting_name()
	 * @uses-filter admin_notice_set_settings_all_before To modify what gets saved.
	 * @uses-action admin_notice_set_settings_all_after To expose saved data.
	 * @param array $settings An array containing data of all notices.
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function set_notices_settings_all( $settings ) {
		$settings = apply_filters( $this->prefix( 'admin_notice_set_settings_all_before' ), $settings, $this );
		update_option( $this->get_setting_name(), $settings );
		do_action( $this->prefix( 'admin_notice_set_settings_all_after' ), $settings, $this );

		return $this;
	}


	/**
	 * Normalize a single notice's data that was returned from the database.
	 *
	 * @since4.8.2
	 * @uses-filter admin_notice_normalize_notice_data_from_db To modify the return value.
	 * @param null|mixed|array $data The individual notice's data to normalize.
	 * @return array The notice data returned from the database.
	 */
	public function normalize_notice_data_from_db( $data ) {
		if ( is_null( $data ) )
			$data = array();

		if ( !is_array( $data ) )
			$data = array( 'is_active' => (bool)$data );

		return apply_filters( $this->prefix( 'admin_notice_normalize_notice_data_from_db' ), $data, $this );
	}


	/**
	 * Prepares data of a single notice to be saved to the database.
	 *
	 * Is responsible for preserving only allowed fields, and adding some
	 * required ones, if necessary and possible.
	 *
	 * @since4.8.2
	 * @uses-filter admin_notice_prepare_notice_data_for_db To modify the resulting prepared data.
	 * @param array $data The data to prepare.
	 * @return array The data that should be saved to the database.
	 */
	public function prepare_notice_data_for_db( $data ) {
		$prepared_data = array();
		if ( isset( $data['is_active'] ) )
			$prepared_data['is_active'] = (bool)$data['is_active'];

		return apply_filters( $this->prefix( 'admin_notice_prepare_notice_data_for_db' ), $prepared_data, $data, $this );
	}


	/**
	 * Generates a unique ID.
	 *
	 * This ID will be unique to this collection.
	 *
	 * @since 4.7.4
	 * @see uniqid()
	 * @uses-filter admin_notice_generate_unique_id To allow modification of ID.
	 * @param string $prefix The prefix to give to the generated ID.
	 * @return string A notice ID unique to this instance in the scope of this collection.
	 */
	public function generate_unique_id( $prefix = '', $data = null ) {
		do {
			$id = is_null($data) ? uniqid( $prefix ) : $prefix . $this->hash($data);
		} while ( $this->has_notice( $id ) );

		return apply_filters( $this->prefix( 'admin_notice_generate_unique_id' ), $id, $prefix, $this );
	}

    public function hash($data) {
        return md5(serialize($data));
    }


	/**
	 * Generate the HTML for all allowed notices, sequentially.
	 *
	 * @since 4.7.4
	 * @return string The rendered HTML.
	 */
	public function render_allowed_notices() {
		$output = '';
		foreach ( $this->get_allowed_notices() as $_id => $_notice ) {
			$output .= $this->render_notice( $_notice );
		}

		return $output;
	}


	/**
	 * Directly output the rendered HTML of all allowed notices.
	 *
	 * @since 4.7.4
	 * @return \WPRSS_Admin_Notices This instance.
	 */
	public function output_allowed_notices() {
		echo $this->render_allowed_notices();
		return $this;
	}


	/**
	 * Generate the HTML of a notice.
	 *
	 * @since 4.7.4
	 * @uses-filter admin_notice_render_before To allow modification of notice data before rendering.
	 * @uses-action admin_notice_render_after To allow injection inside the notice HTML.
	 * @uses-filter admin_notice_rendered To allow modification of rendered HTML.
	 * @param array|string $id Notice, or notice ID.
	 * @return string The HTML output of the notice.
	 * @throws Exception If no notice found for ID.
	 */
	public function render_notice( $id ) {
		$notice = is_array( $id )
				? $id
				: $this->get_notices( $id );

		if ( !$notice )
			throw new Exception( sprintf( 'Could not render notice: no notice found for ID "%1$s"', $id ) );

        $helper = wprss()->getAdminHelper();

		ob_start();
		$notice = apply_filters( $this->prefix( 'admin_notice_render_before' ), $notice, $this );
		?>

		<div id="<?php echo $notice['id'] ?>" class="<?php echo $notice['notice_type'] ?> <?php echo $notice['notice_element_class'] ?> <?php echo $this->get_notice_base_class() ?> dismiss-mode-<?php echo $notice['dismiss_mode'] ?>">
			<div class="notice-inside">
				<?php echo $notice['content'] ?>
			</div>
                        <?php if ($notice['dismiss_mode'] !== NoticeInterface::DISMISS_MODE_NONE): ?>
			<a href="javascript:;" id="<?php echo $notice['btn_close_id'] ?>" style="float:right;" class="<?php echo $this->get_btn_close_base_class() ?> <?php echo $notice['btn_close_class'] ?>"><?php echo $notice['btn_close_content'] ?></a>
                        <?php endif ?>
            <span id="<?php echo $notice['nonce_element_id'] ?>" class="hidden <?php echo $notice['nonce_element_class'] ?> <?php echo $this->get_nonce_base_class() ?>"><?php echo $helper->resolveValue($notice['nonce']) ?></span>
		</div>
		<?php
		do_action( $this->prefix( 'admin_notice_render_after' ), $notice, $this );
		$output = ob_get_clean();

		return apply_filters( $this->prefix( 'admin_notice_rendered' ), $output, $notice, $this );
	}


	/**
	 * Used to hide a notice, typically responding to a frontend event.
	 *
	 * @since 4.7.4
	 * @param array|string $notice Notice or notice ID.
	 * @param string $nonce The nonce from the frontend.
	 * @return \WPRSS_Admin_Notices This instance.
	 * @throws Exception If no notice ID specified, or no notice found for it,
	 *	or specified nonce does not belong to the notice, or the nonce is not right.
	 */
	public function hide_notice( $notice, $nonce ) {
		if ( is_array( $notice ) )
			$notice = isset( $notice['id'] ) ? $notice['id'] : null;

        $notice_id = $notice;
		if ( is_null( $notice ) )
			throw new Exception( sprintf( 'Could not hide notice: Notice ID must be specified' ) );
		if ( is_null( $nonce ) )
			throw new Exception( sprintf( 'Could not hide notice: nonce must be specified' ) );
		if ( !($notice = $this->get_notices( $notice ) ) )
			throw new Exception( sprintf( 'Could not hide notice: No notice found for ID "%1$s"', $notice_id ) );

		// Is it the right nonce?
        $noticeNonce = wprss()->getAdminHelper()->resolveValue($notice['nonce']);
		if ( $noticeNonce !== $nonce )
			throw new Exception( sprintf( 'Could not hide notice: Nonce "%1$s" does not belong to notice "%2$s"', $nonce, $notice_id ) );

		// Verify nonce
		if( !wp_verify_nonce( $nonce, $this->generate_nonce_code( $notice ) ) )
			throw new Exception( sprintf( 'Could not hide notice: Nonce "%1$s" is incorrect', $nonce ) );

		wprss_admin_notice_get_collection()->set_notice_active( $notice, false );

		return $this;
	}
}


// This should initialize the notice collection before anything can use it
add_action( 'init', 'wprss_admin_notice_get_collection', 9 );

// Trigger the component to initialize
add_action('wprss_pre_init', function() {
    wprss_wp_container()->get(\WPRSS_SERVICE_ID_PREFIX.'admin_ajax_notices');
});


/**
 * Returns the singleton, plugin-wide instane of the admin notices controller.
 * Initializes it if necessary.
 *
 * @since 4.7.4
 * @staticvar WPRSS_Admin_Notices $collection The singleton instance.
 * @return \WPRSS_Admin_Notices|null The singleton instance of notice collection, or null if it is unavailable.
 */
function wprss_admin_notice_get_collection() {
	static $collection = null;

	if ( is_null( $collection ) && is_admin() ) {
        $collection = wprss_wp_container()->get(\WPRSS_SERVICE_ID_PREFIX.'admin_ajax_notice_controller');
        add_action( \WPRSS_EVENT_PREFIX.'admin_exclusive_scripts_styles', 'wprss_admin_notices_collection_enqueue_scripts' );
	}

	return $collection;
}

/**
 * Enqueues the scripts for a notice collection.
 *
 * @since 4.7.8
 */
function wprss_admin_notices_collection_enqueue_scripts() {
    $notices = wprss()->getAdminAjaxNotices();
    $notices->_registerAssets();
    $notices->enqueueAssets();
}

/**
 * Centralizes access to the name of the AJAX action handler for dismissing admin notices.
 *
 * This is necessary for configuration of the frontend.
 *
 * @since 4.7.4
 * @uses-filter wprss_admin_notice_action_code To modify return value.
 * @return string The action code
 */
function wprss_admin_notice_get_action_code() {
	return apply_filters( 'wprss_admin_notice_action_code', 'wprss_admin_notice_hide' );
}


/**
 * Adds a notice to be displayed on top of an admin page.
 *
 * @since 4.7.4
 * @param array $notice Data of the notice
 * @return bool|WP_Error True if notice added, false if collection unavailable, or WP_Error if something went wrong.
 */
function wprss_admin_notice_add( $notice ) {
	try {
		if ( !($collection = wprss_admin_notice_get_collection()) )
			return false;

		$collection->add_notice( $notice );
	} catch ( Exception $e ) {
		return new WP_Error( 'could_not_add_admin_notice', $e->getMessage() );
	}

	return true;
}


add_action( sprintf( 'wp_ajax_%1$s', wprss_admin_notice_get_action_code() ), 'wprss_admin_notice_hide' );
/**
 * This is what handles the AJAX action of dismissing admin notices.
 *
 * @see WPRSS_Admin_Notices::hide_notice()
 * @since 4.7.4
 */
function wprss_admin_notice_hide() {
	$notice_id = isset( $_REQUEST['notice_id'] ) ? $_REQUEST['notice_id'] : null;
	$nonce = isset( $_REQUEST['nonce'] ) ? $_REQUEST['nonce'] : null;

	try {
		wprss_admin_notice_get_collection()->hide_notice( $notice_id, $nonce );
	} catch (Exception $e) {
		// Failure
		echo $e->getMessage();
		exit();
	}

	// Success
	exit( '1' );
}


/**
 * Check whether the current page is related to WP RSS Aggregator.
 *
 * @since 4.7.4
 * @uses-filter wprss_is_wprss_page To modify return value.
 * @global string $typenow Post type of the current page.
 * @return boolean True if the current page is a WPRSS-related page; false otherwise.
 */
function wprss_is_wprss_page() {
	global $typenow;

    $postType = $typenow;
	if ( empty( $postType ) && isset( $_GET['post'] ) && !empty( $_GET['post'] ) ) {
        $post = get_post(filter_var($_GET['post'], FILTER_SANITIZE_NUMBER_INT));
        if ( $post !== NULL && !is_wp_error( $post ) )
            $postType = $post->post_type;
	}

    $filterFlags = FILTER_FLAG_STRIP_BACKTICK | FILTER_FLAG_STRIP_LOW | FILTER_FLAG_STRIP_HIGH;
    if (empty($postType) && isset($_GET['post_type'])) {
        $postType = filter_var(trim($_GET['post_type']), FILTER_SANITIZE_STRING, $filterFlags);
    }

    $pagenow = isset($_GET['page']) ? filter_var($_GET['page'], FILTER_SANITIZE_STRING, $filterFlags) : null;
    $wprss_post_types = apply_filters('wprss_post_types', array(
        'wprss_feed',
        'wprss_feed_item',
        'wprss_blacklist',
    ));
    $wprss_pages = apply_filters('wprss_page_slugs', array(
        'wprss-aggregator',
        'wprss-aggregator-settings',
        'wprss-import-export-settings',
        'wprss-debugging',
        'wprss-addons',
        'wprss-welcome',
        'wprss-help',
        'wpra-intro',
        'wpra-update',
    ));

	$is_wprss_post = in_array($postType, $wprss_post_types, true);
    $is_wprss_page = in_array($pagenow, $wprss_pages, true);
	return apply_filters( 'wprss_is_wprss_page',  $is_wprss_post || $is_wprss_page );
}


/**
 * Check whether the currently logged in user can manage WP options.
 *
 * This normally describes the administrator.
 *
 * @since 4.7.4
 * @uses-filter wprss_user_can_manage_options To modify return value.
 * @return bool True if the currently logged in user has the 'manage_options' privilege; false otherwise.
 */
function wprss_user_can_manage_options() {
	return apply_filters( 'wprss_user_can_manage_options', current_user_can( 'manage_options' ) );
}

// Adds the AJAX notice service provider to the core container
add_filter(WPRSS_EVENT_PREFIX .'core_container_init', function(WritableContainerInterface $container) {
    $noticeProvider = wprss_core_admin_ajax_notices_service_provider();
    $container->register($noticeProvider);
});

/**
 * Retrieves the service provider that provides notice service definitions.
 *
 * @since 4.11
 *
 * @staticvar ServiceProvider $provider
 * @return ServiceProvider
 */
function wprss_core_admin_ajax_notices_service_provider()
{
    static $provider = null;

    if(is_null($provider)) {
        $provider = new ServiceProvider(array(
            'notice_service_id_prefix'  => \WPRSS_NOTICE_SERVICE_ID_PREFIX,
            'service_id_prefix'         => \WPRSS_SERVICE_ID_PREFIX,
            'event_prefix'              => \WPRSS_EVENT_PREFIX,
        ));
    }

    return $provider;
}


File Name:
admin-display.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-display.php
Code:
<?php
    /**
     * Functions for the admin section, columns and row actions
     *
     * @package WP RSS Aggregator
     */

    // Adds the "active" class to the feed source list table rows, for active feed sources
    add_filter( 'post_class', function( $classes, $class, $postId ) {
        $post = get_post($postId);

        if ($post->post_type !== 'wprss_feed') {
            return $classes;
        }

        if (wprss_is_feed_source_active($postId)) {
            $classes[] = 'active';
        }

        return $classes;
    }, 10, 3 );

    add_filter( 'manage_wprss_feed_posts_columns', 'wprss_set_feed_custom_columns', 20, 1 );
    /**
     * Set up the custom columns for the wprss_feed list
     *
     * @since 2.0
     */
    function wprss_set_feed_custom_columns( $columns ) {
        $isTrashPage = filter_input(INPUT_GET, 'post_status') === 'trash';

        $columns = array(
            'cb'          =>  '<input type="checkbox" />',
        );


        if (!$isTrashPage) {
            $columns['state'] =  __( 'State', WPRSS_TEXT_DOMAIN );
        }

        $columns['title'] = __( 'Name', WPRSS_TEXT_DOMAIN );

        $columns = apply_filters( 'wprss_set_feed_custom_columns', $columns );

        if (!$isTrashPage) {
            $columns['updates'] = __( 'Updates', WPRSS_TEXT_DOMAIN );
            $columns['feed-count'] = __( apply_filters( 'wprss_feed_items_count_column', 'Imported items' ), WPRSS_TEXT_DOMAIN );
        }

        return apply_filters( 'wprss_feed_columns', $columns );
    }


    add_action( "manage_wprss_feed_posts_custom_column", "wprss_show_custom_columns", 10, 2 );
    /**
     * Show up the custom columns for the wprss_feed list
     *
     * @since 2.0
     */
    function wprss_show_custom_columns( $column, $post_id ) {

      switch ( $column ) {
        case 'state':
            $switch_title = __('Activate or pause auto importing for this feed', 'wprss');
            ?>
            <div class="wprss-feed-state-container" title="<?php echo esc_attr($switch_title); ?>">
                <label class="wprss-switch">
                    <input type="checkbox"
                           class="wprss-toggle-feed-state"
                           autocomplete="off"
                           value="<?php echo esc_attr($post_id); ?>"
                           <?php checked(true, wprss_is_feed_source_active($post_id)) ?>
                    />
                    <span class="wprss-switch-slider"></span>
                </label>
            </div>

            <?php
            $feed_type = 'rss';
            $feed_icon = 'rss';
            $icon_title = __('Normal RSS Feed', 'wprss');

            if (wprss_is_feed_youtube($post_id)) {
                $feed_type = 'yt';
                $feed_icon = 'video-alt3';
                $icon_title = __('YouTube Feed', 'wprss');
            }
            ?>

            <div class="wprss-feed-source-type wprss-feed-source-type-<?php echo $feed_type ?>"
                 title="<?php echo esc_attr($icon_title) ?>"
            >
                <span class="dashicons dashicons-<?php echo $feed_icon ?>"></span>
            </div>
            <?php

          break;

        case 'updates':
            // Get the update interval
            $update_interval = get_post_meta( $post_id, 'wprss_update_interval', TRUE );
            // Get the last updated and next update data
            $last_update = get_post_meta( $post_id, 'wprss_last_update', TRUE );
            $last_update_items = get_post_meta( $post_id, 'wprss_last_update_items', TRUE );
            $next_update = wprss_get_next_feed_source_update( $post_id );

            // If using the global interval, get the timestamp of the next global update
            if ( $update_interval === wprss_get_default_feed_source_update_interval() || $update_interval === '' ) {
              $next_update = wp_next_scheduled( 'wprss_fetch_all_feeds_hook', array() );
            }

		  	// Update the meta field
		  	if ( wprss_is_feed_source_active( $post_id ) ) {
				$next_update_text = $next_update === FALSE ? __( 'None', WPRSS_TEXT_DOMAIN ) : human_time_diff( $next_update, time() );
			} else {
				$next_update_text = __( '...', 'wprss' );
			}
		  	update_post_meta( $post_id, 'wprss_next_update', $next_update_text );

            $timeago = empty($last_update) ? '' : human_time_diff( $last_update, time() );
            ?>

            <p class="next-update-container">
                <?php _e( 'Next update in', WPRSS_TEXT_DOMAIN ) ?>
                <code class="next-update">
                   	<?php echo $next_update_text; ?>
                </code>
            </p>

            <p class="last-update-container"
               style="display: <?php echo empty($timeago) ? 'none' : 'inline-block'; ?>">
                <span class="last-update-num-items-container">
                    <?php echo _x( 'Updated', 'Example: "Updated 2 days ago"', 'wprss' ); ?>
                    <span class="last-update-time-container">
                        <code class="last-update-time"><?php printf(__('%1$s ago', 'wprss'), $timeago) ?></code>
                    </span>
                    (<span class="last-update-num-items"><?php echo
                        $last_update_items ?></span>
                    <?php echo _x('items', 'Example: "15 new"', 'wprss'); ?>)
                </span>
            </p>

            <?php
            break;

        case 'feed-count':
            $items = wprss_get_feed_items_for_source( $post_id );
            $has_items_class = ($items->post_count > 0) ? 'has-imported-items' : '';

            $errors = get_post_meta( $post_id, 'wprss_error_last_import', true );
            $errorShowClass = ( $errors !== '' )? 'wprss-show' : '';
            $default_msg = __( "This feed source experienced an error during the last feed fetch or validation check. Re-check the feed source URL or check the Error Log in the Debugging page for more details.", WPRSS_TEXT_DOMAIN );
            $msg = strlen( $errors ) > 0 ? $errors : $default_msg;
            $errorIcon = sprintf(
                '<i title="%1$s" class="fa fa-warning fa-fw wprss-feed-error-symbol %2$s"></i>',
                esc_attr($msg),
                $errorShowClass
            );

            $view_items_url = admin_url( 'edit.php?post_type=wprss_feed_item&wprss_feed=' . $post_id );
            $view_items_url = apply_filters( 'wprss_view_feed_items_row_action_link', $view_items_url, $post_id );
            ?>
                <a href="<?php echo esc_attr($view_items_url); ?>"
                   class="items-imported-link <?php echo $has_items_class; ?>"
                   title="<?php echo esc_attr(__('View the imported items for this feed source', 'wprss')); ?>"
                >
                    <span class="items-imported"><?php echo $items->post_count ?></span>
                    <?php _e('items', 'wprss') ?>
                </a>
            <div class="spinner"></div>

                <?php echo $errorIcon; ?>

                <div class="row-actions">
                    <span class="fetch">
                        <a href="javascript:;"
                           class="wprss_fetch_items_ajax_action"
                           pid="<?php echo esc_attr ($post_id); ?>"
                           purl="<?php echo admin_url('admin-ajax.php'); ?>">
                            <?php _e('Fetch', 'wprss'); ?>
                        </a>
                    </span>
                    <span class="purge-posts trash <?php echo $has_items_class; ?>">
                        |
                        <a href="javascript:;"
                           class="wprss_delete_items_ajax_action"
                           pid="<?php echo esc_attr ($post_id); ?>"
                           purl="<?php echo admin_url('admin-ajax.php'); ?>">
                            <?php _e('Delete items', 'wprss'); ?>
                        </a>
                    </span>
                </div>
			<?php

		  	// Set meta field for items imported
		  	update_post_meta( $post_id, 'wprss_items_imported', $items->post_count );

            break;
      }
    }


	add_filter( "manage_edit-wprss_feed_sortable_columns", "wprss_feed_sortable_columns" );
    /**
     * Make the custom columns sortable for wprss_feed post type
     *
     * @since 2.0
     */
    function wprss_feed_sortable_columns() {
        $sortable_columns = array(
            // meta column id => sortby value used in query
            'state'			=> 'state',
            'title'			=> 'title',
			'updates'		=>	'updates',
			'feed-count'	=>	'feed-count'
        );
        return apply_filters( 'wprss_feed_sortable_columns', $sortable_columns );
    }


    add_action( 'pre_get_posts', 'wprss_feed_source_order' );
    /**
     * Change order of feed sources to alphabetical ascending according to feed name
     *
     * @since 2.2
     */
    function wprss_feed_source_order( $query ) {
		// Check if the query is being processed in WP Admin, is the main query, and is targetted
		// for the wprss_feed CPT. If not, stop
        if ( !is_admin() || !$query->is_main_query() || $query->get('post_type') !== 'wprss_feed' ) {
            return;
        }

		// Get the sorting query args
		$order = strtoupper($query->get('order'));
		$orderby = $query->get('orderby');

		// If order is not specified, default to ascending
		if ($order !== 'ASC' && $order !== 'DESC') {
			$order = 'ASC';
		}

		$query->set('order', $order);

		// If not explicitly sorting or sorting by title, sort by title
		if (!$orderby || $orderby === 'title') {
			$query->set('orderby', 'title');
		}

		// Check what we are sorting by
		switch ( $orderby ) {
			case 'state':
				$query->set('meta_key', 'wprss_state');
				$query->set('orderby', 'meta_value');
				break;

			case 'updates':
				$query->set('meta_key', 'wprss_next_update');
				$query->set('orderby', 'meta_value');

				break;
			case 'feed-count':
				$query->set('meta_key', 'wprss_items_imported');
				$query->set('orderby', 'meta_value_num');

				break;
		}
	}


    add_filter( 'manage_wprss_feed_item_posts_columns', 'wprss_set_feed_item_custom_columns', 20, 1 );
    /**
     * Set up the custom columns for the wprss_feed source list
     *
     * @since 2.0
     */
    function wprss_set_feed_item_custom_columns( $columns ) {

        $columns = array (
            'cb'          => '<input type="checkbox" />',
            'title'       => __( 'Name', WPRSS_TEXT_DOMAIN ),
            'permalink'   => __( 'Permalink', WPRSS_TEXT_DOMAIN ),
            'publishdate' => __( 'Date published', WPRSS_TEXT_DOMAIN ),
            'source'      => __( 'Source', WPRSS_TEXT_DOMAIN )
        );
        return apply_filters( 'wprss_set_feed_item_custom_columns', $columns );
    }


    add_action( "manage_wprss_feed_item_posts_custom_column", "wprss_show_feed_item_custom_columns", 10, 2 );
    /**
     * Show up the custom columns for the wprss_feed list
     *
     * @since 2.0
     */
    function wprss_show_feed_item_custom_columns( $column, $post_id ) {

        switch ( $column ) {
            case "permalink":
                $url = get_post_meta( $post_id, 'wprss_item_permalink', true);
                echo '<a href="' . $url . '">' . $url. '</a>';
                break;

            case "publishdate":
                $item_date = get_the_time( 'U', get_the_ID() );
                $item_date = ( $item_date === '' )? date('U') : $item_date;
                $publishdate = date( 'Y-m-d H:i:s', $item_date ) ;
                echo $publishdate;
                break;

            case "source":
                $query = new WP_Query();
                $source = '<a href="' . get_edit_post_link( get_post_meta( $post_id, 'wprss_feed_id', true ) ) . '">' . get_the_title( get_post_meta( $post_id, 'wprss_feed_id', true ) ) . '</a>';
                echo $source;
                break;
        }
    }


    add_filter( "manage_edit-wprss_feed_item_sortable_columns", "wprss_feed_item_sortable_columns" );
    /**
     * Make the custom columns sortable
     *
     * @since 2.0
     */
    function wprss_feed_item_sortable_columns() {
        $sortable_columns = array(
            // meta column id => sortby value used in query
            'publishdate' => 'publishdate',
            'source'      => 'source'
        );
        return apply_filters( 'wprss_feed_item_sortable_columns', $sortable_columns );
    }


    add_action( 'pre_get_posts', 'wprss_feed_item_orderby' );
    /**
     * Change ordering of posts on wprss_feed_item screen
     *
     * @since 2.0
     */
    function wprss_feed_item_orderby( $query ) {
        if( ! is_admin() )
            return;

        $post_type = $query->get('post_type');

        // If we're on the feed listing admin page
        if ( $post_type == 'wprss_feed_item') {
            // Set general orderby to date the feed item was published
            $query->set('orderby','publishdate');
            // If user clicks on the reorder link, implement reordering
            $orderby = $query->get( 'orderby');
            if( 'publishdate' == $orderby ) {
                $query->set( 'order', 'DESC' );
                $query->set( 'orderby', 'date' );
            }
        }
    }


    add_filter( 'post_updated_messages', 'wprss_feed_updated_messages' );
    /**
     * Change default notification message when new feed is added or updated
     *
     * @since 2.0
     */
    function wprss_feed_updated_messages( $messages ) {
        global $post, $post_ID;

        $messages[ 'wprss_feed' ] = array(
            0  => '', // Unused. Messages start at index 1.
            1  => __( 'Feed source updated. ', WPRSS_TEXT_DOMAIN ),
            2  => __( 'Custom field updated.', WPRSS_TEXT_DOMAIN ),
            3  => __( 'Custom field deleted.', WPRSS_TEXT_DOMAIN ),
            4  => __( 'Feed source updated.', WPRSS_TEXT_DOMAIN ),
            5  => '',
            6  => __( 'Feed source saved.', WPRSS_TEXT_DOMAIN ),
            7  => __( 'Feed source saved.', WPRSS_TEXT_DOMAIN ),
            8  => __( 'Feed source submitted.', WPRSS_TEXT_DOMAIN ),
            9  => '',
            10 => __( 'Feed source updated.', WPRSS_TEXT_DOMAIN )
        );

        return apply_filters( 'wprss_feed_updated_messages', $messages );
    }


    add_filter( 'post_row_actions', 'wprss_remove_row_actions', 10, 2 );
    /**
     * Remove actions row for imported feed items, we don't want them to be editable or viewable
     *
     * @since 2.0
     */
    function wprss_remove_row_actions( $actions, $post )
    {

        $page = isset( $_GET['paged'] )? '&paged=' . $_GET['paged'] : '';
        if ( get_post_type($post) === 'wprss_feed_item' )  {
            if (!wpra_is_dev_mode()) {
                unset($actions['edit']);
            }
            unset( $actions[ 'view' ] );
            //unset( $actions[ 'trash' ] );
            unset( $actions[ 'inline hide-if-no-js' ] );
        }
        elseif ( get_post_type($post) === 'wprss_feed' ) {
    		$actions = array_reverse( $actions );
    		$actions['id'] = '<span class="wprss-row-id">' . sprintf( __( 'ID: %1$s', WPRSS_TEXT_DOMAIN ), $post->ID ) . '</span>';
    		$actions = array_reverse( $actions );

            unset( $actions[ 'view'] );
            unset( $actions[ 'inline hide-if-no-js'] );
        }
        return apply_filters( 'wprss_remove_row_actions', $actions );
    }



    add_action( 'wprss_delete_feed_items_from_source_hook', 'wprss_delete_feed_items_of_feed_source', 10 , 1 );
    /**
     * Deletes the feed items of the feed source identified by the given ID.
     *
     * @since 3.5
     * @param int $source_id The ID of the feed source
     */
    function wprss_delete_feed_items_of_feed_source($source_id) {
        wprss_delete_feed_items($source_id);

        update_post_meta($source_id, 'wprss_feed_is_deleting_items', '');
    }


    /**
     * Shows a notification that tells the user that feed items for a particular source are being deleted
     *
     * @since 3.5
     */
    function wprss_notify_about_deleting_source_feed_items() {
        $message = __( apply_filters( 'wprss_notify_about_deleting_source_feed_items_message', 'The feed items for this feed source are being deleted in the background.' ), WPRSS_TEXT_DOMAIN );
        echo '<div class="updated"><p>' . $message . '</p></div>';
    }


    add_action( 'wp_ajax_wprss_fetch_items_row_action', 'wprss_fetch_feeds_action_hook' );
    /**
     * The AJAX function for the 'Fetch Feed Items' row action on the
     * 'All Feed Sources' page.
     *
     * @since 3.3
     */
    function wprss_fetch_feeds_action_hook() {
        $response = wprss()->createAjaxResponse();
        $wprss = wprss();
        $kFeedSourceId = 'feed_source_id';
        try {
            $kId = 'id';
            if (!isset( $_POST[$kId] ) || empty( $_POST[$kId] )) {
                throw new Exception($wprss->__('Could not schedule fetch: source ID must be specified'));
            }
            $id = $_POST['id'];
            $response->setAjaxData($kFeedSourceId, $id);

            if (!current_user_can('edit_feed_sources')) {
                throw new Exception($wprss->__(array('Could not schedule fetch for source #%1$s: user must have sufficient privileges', $id)));
            }

            // Verify admin referer
            if (!wprss_verify_nonce( 'wprss_feed_source_action', 'wprss_admin_ajax_nonce' )) {
                throw new Exception($wprss->__(array('Could not schedule fetch for source #%1$s: nonce is expired', $id)));
            }

            update_post_meta( $id, 'wprss_force_next_fetch', '1' );

            // Prepare the schedule args
            $schedule_args = array( strval( $id ) );

            // Get the current schedule - do nothing if not scheduled
            $next_scheduled = wp_next_scheduled( 'wprss_fetch_single_feed_hook', $schedule_args );
            if ( $next_scheduled !== FALSE ) {
                // If scheduled, unschedule it
                wp_unschedule_event( $next_scheduled, 'wprss_fetch_single_feed_hook', $schedule_args );

                // Get the interval option for the feed source
                $interval = get_post_meta( $id, 'wprss_update_interval', TRUE );
                // if the feed source uses its own interval
                if ( $interval !== '' && $interval !== wprss_get_default_feed_source_update_interval() ) {
                    // Add meta in feed source. This is used to notify the source that it needs to reschedule it
                    update_post_meta( $id, 'wprss_reschedule_event', $next_scheduled );
                }
            }

            // Schedule the event for 5 seconds from now
            $offset = floor(count(wpra_get_ready_cron_jobs()) / 2);
            $success = wp_schedule_single_event( time() + $offset, 'wprss_fetch_single_feed_hook', $schedule_args );
            if (!$success) {
                throw new Exception(__('Failed to schedule cron', 'wprss'));
            }
            wprss_flag_feed_as_updating( $id );
        } catch (Exception $e) {
            $response = wprss()->createAjaxErrorResponse($e);
            if (isset($id)) {
                $response->setAjaxData($kFeedSourceId, $id);
            }
            echo $response->getBody();
            exit();
        }

        $response->setAjaxData('message', $wprss->__(array('Fetch for feed source #%1$s successfully scheduled', $id)));
        $response->setAjaxData('success', $success);
        echo $response->getBody();
        exit();
    }
    
    add_action( 'wp_ajax_wprss_delete_items_row_action', 'wprss_delete_items_ajax_action_hook' );
    /**
     * The AJAX function for the 'Delete Items' row action on the 'All Feed Sources' page.
     *
     * @since 4.14
     */
    function wprss_delete_items_ajax_action_hook() {
        $kFeedSourceId = 'feed_source_id';
        $response = wprss()->createAjaxResponse();
        $wprss = wprss();
        try {
            $id = filter_input(INPUT_POST, 'id', FILTER_DEFAULT);
            if (empty($id)) {
                throw new Exception($wprss->__('Source ID was not specified'));
            }

            $response->setAjaxData($kFeedSourceId, $id);

            if (!current_user_can('edit_feed_sources')) {
                throw new Exception($wprss->__(array('User must have sufficient privileges', $id)));
            }

            // Verify admin referer
            if (!wprss_verify_nonce( 'wprss_feed_source_action', 'wprss_admin_ajax_nonce' )) {
                throw new Exception($wprss->__(array('Nonce has expired - Please refresh the page.', $id)));
            }

            // Schedule a job that runs this function with the source id parameter
            $offset = floor(count(wpra_get_ready_cron_jobs()) / 2);
            $success = wp_schedule_single_event( time() + $offset, 'wprss_delete_feed_items_from_source_hook', array( $id ) );
            if (!$success) {
                throw new Exception(__('Failed to schedule cron', 'wprss'));
            }
            // Mark feed as deleting its items
            update_post_meta( $id, 'wprss_feed_is_deleting_items', time() );
        } catch (Exception $e) {
            $response = wprss()->createAjaxErrorResponse($e);
            if (isset($id)) {
                $response->setAjaxData($kFeedSourceId, $id);
            }
            echo $response->getBody();
            exit();
        }

        $response->setAjaxData('message', $wprss->__(array('Items are being deleted', $id)));
        $response->setAjaxData('success', $success);
        echo $response->getBody();
        exit();
    }


    add_action( 'wp_ajax_wprss_toggle_feed_state', 'wprss_ajax_toggle_feed_state' );
    /**
     * The AJAX function for toggling a feed's state from the 'All Feed Sources' page.
     *
     * @since 4.14
     */
    function wprss_ajax_toggle_feed_state() {
        $kFeedSourceId = 'feed_source_id';
        $response = wprss()->createAjaxResponse();
        $wprss = wprss();
        try {
            $id = filter_input(INPUT_POST, 'id', FILTER_DEFAULT);
            if (empty($id)) {
                throw new Exception($wprss->__('Source ID was not specified'));
            }

            $response->setAjaxData($kFeedSourceId, $id);

            if (!current_user_can('edit_feed_sources')) {
                throw new Exception($wprss->__(array('User must have sufficient privileges', $id)));
            }

            // Verify admin referer
            if (!wprss_verify_nonce( 'wprss_feed_source_action', 'wprss_admin_ajax_nonce' )) {
                throw new Exception($wprss->__(array('Nonce has expired - Please refresh the page.', $id)));
            }

            $active = wprss_is_feed_source_active( $id );

            if ( $active ) {
                wprss_pause_feed_source( $id );
            } else {
                wprss_activate_feed_source( $id );
            }

            $response->setAjaxData('active', !$active);
        } catch (Exception $e) {
            $response = wprss()->createAjaxErrorResponse($e);
            if (isset($id)) {
                $response->setAjaxData($kFeedSourceId, $id);
            }
            echo $response->getBody();
            exit();
        }

        $response->setAjaxData('message', $wprss->__(array('Feed state changed successfully', $id)));
        echo $response->getBody();
        exit();
    }

    add_action('manage_posts_extra_tablenav', function($which) {
        $screen = get_current_screen();
        $postType = $screen->post_type;
        // Only add on feed source list
        if ($postType !== 'wprss_feed') {
            return;
        }

        $nonceEl = new \Aventura\Wprss\Core\Block\Html\Span(array(
            'data-value'    => wp_create_nonce('wprss_feed_source_action'),
            'id'            => 'wprss_feed_source_action_nonce',
            'class'         => 'hidden'
        ));
        echo (string) $nonceEl;
//        wp_nonce_field('wprss_feed_source_action', 'wprss_feed_source_action_nonce', false);
    });


    add_filter( 'bulk_actions-edit-wprss_feed_item', 'wprss_custom_feed_item_bulk_actions' );
    /**
     * Allow filtering bulk actions for feed items
     *
     * @since 2.0
     */
    function wprss_custom_feed_item_bulk_actions( $actions ) {
        if (!wpra_is_dev_mode()) {
            unset($actions['edit']);
        }

        return apply_filters( 'wprss_custom_feed_item_bulk_actions', $actions );
    }


    add_action( 'admin_footer-edit.php', 'wprss_remove_a_from_feed_title' );
    /**
     * Remove hyperlink from imported feed titles in list posts screen
     *
     * @since 2.0
     */
    function wprss_remove_a_from_feed_title() {
        if ( 'edit-wprss_feed_item' !== get_current_screen()->id )
        return;
        ?>

        <script type="text/javascript">
            jQuery('table.wp-list-table a.row-title').contents().unwrap();
        </script>
        <?php
    }


    add_action( 'wp_before_admin_bar_render', 'wprss_modify_admin_bar' );
    /**
     * Removes the old "View Source" menu item from the admin bar and adds a new
     * "View items" menu bar item, that opens a new tab, showing the items imported
     * from that feed source.
     *
     * Only shown on the wprss_feed edit page.
     *
     * @since 4.2
     */
    function wprss_modify_admin_bar() {
      global $wp_admin_bar;
      if ( !is_admin() ) return;
      $screen = get_current_screen();
      // Check if we are in the wprss_feed edit page
      if ( $screen->base == 'post' && $screen->post_type == 'wprss_feed' && !empty( $_GET['action'] ) && $_GET['action'] == 'edit' ) {
        // Remove the old 'View Source' menu item
        $wp_admin_bar->remove_node( 'view' );

        // Prepare the view items link and text
        $view_items_link = apply_filters(
          'wprss_view_feed_items_row_action_link',
          admin_url( 'edit.php?post_type=wprss_feed_item&wprss_feed=' . get_the_ID() ),
          get_the_ID()
        );
        $view_items_text = apply_filters( 'wprss_view_feed_items_row_action_text', 'View Items' );

        // Prepare the link target
        $link_target = 'wprss-view-items-' . get_the_ID();

        // Add the new menu item
        $wp_admin_bar->add_node( array(
          'href'    =>  $view_items_link,
          'id'      =>  'view',
          'title'   =>  __( $view_items_text, WPRSS_TEXT_DOMAIN ),
          'meta'    =>  array(
            'target'  =>  $link_target
          )
        ));
      }
    }




    if ( is_admin() ){
      add_filter('pre_get_posts', 'wprss_view_feed_items_query');
      /**
       * Alters the main query in the WordPress admin, when the wprss_feed GET parameter is set.
       * The queried items are then filtered down to the items imported by the feed source with
       * the ID given in the wprss_feed GET parameter.
       *
       * @since 4.2
       */
      function wprss_view_feed_items_query( $query ) {
        if ( is_admin() && $query->is_main_query() && !empty($_GET['wprss_feed']) ) {
          // Get the ID from the GET param
          $id = $_GET['wprss_feed'];
          // Get the existing meta query
          $mq = $query->get('meta_query');
          // If the meta query is not yet set
          if ( !is_array($mq) ) {
            // initialize it
            $mq = array(
              'relation'  =>  'AND',
            );
          }
          // Add the custom meta query
          $mq[] = apply_filters(
            'wprss_view_feed_items_meta_query',
            array(
              'key'   =>  'wprss_feed_id',
              'value'   =>  $id,
              'compare' =>  '='
            ),
            $id
          );
          // Set the new meta query
          $query->set('meta_query', $mq);
        }
        // Return the query
        return $query;
      }
    }


File Name:
admin-editor.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-editor.php
Code:
<?php

/**
 * This file contains code related to the custom button added to Wordpress' TinyMCE editor.
 *
 * @since 3.5
 */

add_action('admin_init', 'wprss_add_editor_button');
/**
 * Adds the WPRSS button to WordPress' editor
 *
 * @since 3.5
 */
function wprss_add_editor_button()
{
    if (current_user_can('edit_posts') && current_user_can('edit_pages') && get_user_option('rich_editing') == 'true') {
        add_filter('mce_external_plugins', 'wpra_register_tinymce_plugin', 0);
        add_filter('mce_buttons', 'wpra_register_tinymce_button', 0);
    }
}

/**
 * Adds a separator and the wprss button to the buttons array.
 *
 * @since 3.5
 */
function wpra_register_tinymce_button($buttons)
{
    $buttons[] = "|";
    $buttons[] = "wprss";

    return $buttons;
}

/**
 * Adds the button action JS file to TinyMCE's plugin list
 *
 * @since 3.5
 * @todo  add filter to skip showing the editor button
 */
function wpra_register_tinymce_plugin($plugin_array)
{
    // add filter here
    $plugin_array['wprss'] = WPRSS_JS . 'editor.js';
    return $plugin_array;
}

add_filter('tiny_mce_version', 'wprss_tinymce_version');
/**
 * Intercepts TinyMCE's version check and increments its version by 3.
 *
 * This is a hack used to work around TinyMCE's caching, that might prevent the
 * new wprss button from appearing on the editor.
 *
 * @since 3.5
 */
function wprss_tinymce_version($ver)
{
    $ver += 3;
    return $ver;
}

add_action('wp_ajax_wprss_editor_dialog', 'wprss_return_dialog_contents');
/**
 * Renders the TinyMCE button dialog contents.
 */
	function wprss_return_dialog_contents() {
		$templates_collection = wpra_get('feeds/templates/collection');
		$templates_options = [];
		foreach ($templates_collection as $template) {
		    $template_name = $template['name'];
		    $template_slug = ($template['type'] === '__built_in')
                ? ''
                : $template['slug'];

		    $templates_options[$template_slug] = $template_name;
        }
		$templates_select = wprss_settings_render_select(
            'wprss-dialog-templates',
            '',
            $templates_options,
            '',
            ['class' => 'widefat']
        );

		$feed_sources = get_posts( array(
			'post_type'			=> 'wprss_feed',
			'post_status'		=> 'publish',
			'posts_per_page'	=> -1,
			'no_found_rows'		=>	true
		));
		$feed_sources_names = [];
        foreach ( $feed_sources as $source ) {
            $feed_sources_names[$source->ID] = $source->post_title;
        }
		$feed_sources_select = wprss_settings_render_select(
            'wprss-dialog-feed-source-list',
            '',
            $feed_sources_names,
            '',
            ['multiple' => 'multiple', 'class' => 'widefat']
        );
        $feed_sources_exclude_select = wprss_settings_render_select(
            'wprss-dialog-exclude-list',
            '',
            $feed_sources_names,
            '',
            ['multiple' => 'multiple', 'class' => 'widefat']
        );

		$feed_sources_both_select = '<p>' . __( 'To select more than one feed source, click and drag with your mouse pointer or click individual feed sources while holding down the Ctrl (Windows) or Command (Mac) key.' , WPRSS_TEXT_DOMAIN ) . '</p>';
		$feed_sources_select .= $feed_sources_both_select;
		$feed_sources_exclude_select .= $feed_sources_both_select;

		?>
		<table cellspacing="20">
			<tbody>
                <tr>
                    <td id="wprss-dialog-templates-label">
                        <label for="wprss-dialog-templates">
                            <?php _e( 'Template', WPRSS_TEXT_DOMAIN ) ?>
                        </label>
                    </td>
                    <td>
                        <?php echo $templates_select; ?>
                    </td>
                </tr>
				<tr>
					<td id="wprss-dialog-all-sources-label">
                        <?php _e( 'Sources', WPRSS_TEXT_DOMAIN ) ?>
                    </td>
					<td>
						<input id="wprss-dialog-all-sources" type="checkbox" checked>
                        <label for="wprss-dialog-all-sources">
                            <?php _e( 'All feed sources', WPRSS_TEXT_DOMAIN ) ?>
                        </label>
					</td>
				</tr>

				<tr id="wprss-dialog-exclude-row">
					<td id="wprss-dialog-exclude-label">
                        <label id="wprss-dialog-exclude-list-label" for="wprss-dialog-exclude-list">
                            <?php _e( 'Exclude', WPRSS_TEXT_DOMAIN ) ?>
                        </label>
                    </td>
					<td>
                        <div id="wprss-dialog-excludes-container">
						    <p><?php _e( 'You may choose to exclude some feed sources:', WPRSS_TEXT_DOMAIN ) ?></p>
						    <?php echo $feed_sources_exclude_select; ?>
                        </div>

                        <div id="wprss-dialog-sources-container" style="display:none">
                            <p><?php _e( 'Choose which feed sources to show:', WPRSS_TEXT_DOMAIN ) ?></p>
                            <?php echo $feed_sources_select; ?>
                        </div>

                        <script type="text/javascript">
                            jQuery('#wprss-dialog-all-sources').click( function(){
                                if ( jQuery(this).is(':checked') ) {
                                    jQuery( '#wprss-dialog-sources-container' ).hide();
                                    jQuery( '#wprss-dialog-excludes-container' ).show();
                                    jQuery( '#wprss-dialog-exclude-list-label' ).show();
                                } else {
                                    jQuery( '#wprss-dialog-sources-container' ).show();
                                    jQuery( '#wprss-dialog-excludes-container' ).hide();
                                    jQuery( '#wprss-dialog-exclude-list-label' ).hide();
                                }
                            });
                            jQuery('#wprss-dialog-submit').click( wprss_dialog_submit );
                        </script>
					</td>
				</tr>

				<tr>
					<td><?php _e( 'Number of items', WPRSS_TEXT_DOMAIN ) ?></td>
					<td>
                        <input id="wprss-dialog-feed-limit"
                               type="number"
                               class="wprss-number-roller widefat"
                               placeholder="<?php _e( 'Use template setting', WPRSS_TEXT_DOMAIN ) ?>"
                               min="0"
                        />
                    </td>
				</tr>

                <tr>
                    <td><?php _e( 'Pagination', WPRSS_TEXT_DOMAIN ) ?></td>
                    <td>
                        <label>
                            <select id="wprss-dialog-pagination">
                                <option value=""><?php _e( 'Use template setting', WPRSS_TEXT_DOMAIN ) ?></option>
                                <option value="on"><?php _e( 'Enabled', WPRSS_TEXT_DOMAIN ) ?></option>
                                <option value="off"><?php _e( 'Disabled', WPRSS_TEXT_DOMAIN ) ?></option>
                            </select>
                            <br/>
                            <span>
                                <?php _e( 'Choose whether to show or hide pagination controls', WPRSS_TEXT_DOMAIN ) ?>
                            </span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td><?php _e( 'Starting page', WPRSS_TEXT_DOMAIN ) ?></td>
                    <td>
                        <input id="wprss-dialog-start-page"
                               type="number"
                               class="wprss-number-roller widefat"
                               placeholder="<?php _e( 'Use template setting', WPRSS_TEXT_DOMAIN ) ?>"
                               min="1"
                        />
                    </td>
                </tr>

				<?php do_action( 'wprss_return_dialog_contents' ); ?>

				<tr>
					<td></td>
					<td>
						<button id="wprss-dialog-submit">
                            <?php _e( 'Add shortcode', WPRSS_TEXT_DOMAIN ) ?>
                        </button>
					</td>
				</tr>

			</tbody>
		</table>
		<?php
		die();
	}


File Name:
admin-heartbeat.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-heartbeat.php
Code:
<?php

add_action('wp_ajax_wprss_feed_source_table_ajax', function () {
    $response = [];

    if (!current_user_can('edit_feed_sources') || empty($_POST['wprss_heartbeat'])) {
        return [];
    }

    $request = $_POST['wprss_heartbeat'];
    $action = isset($request['action']) ? $request['action'] : '';
    $params = isset($request['params']) ? $request['params'] : '';

    switch ($action) {
        case 'feed_sources':
        {
            $feeds = [];

            foreach ($params as $feedId) {
                $nextFetch = wprss_get_next_feed_source_update($feedId, false);
                $isFetching = wprss_is_feed_source_updating($feedId);
                $isDeleting = wprss_is_feed_source_deleting($feedId);
                $fetchesSoon = $nextFetch !== false && $nextFetch < 2 && $nextFetch > 0;
                $isActive = wprss_is_feed_source_active($feedId);
                $numItems = wprss_get_feed_items_for_source($feedId)->post_count;
                $lastUpdateTime = get_post_meta($feedId, 'wprss_last_update', true);
                $lastUpdateItems = get_post_meta($feedId, 'wprss_last_update_items', true);
                $errors = get_post_meta($feedId, 'wprss_error_last_import', true);

                if ($nextFetch === false) {
                    $nextFetchText = __('None', 'wprss');
                } elseif ($isActive) {
                    $nextFetchText = $fetchesSoon
                        ? _x('now', 'Next update: now', 'wprss')
                        : human_time_diff($nextFetch, time());
                } else {
                    $nextFetchText = __('...', 'wprss');
                }

                $feeds[$feedId] = [
                    'active' => $isActive,
                    'fetching' => $isFetching || $fetchesSoon,
                    'deleting' => $isDeleting,
                    'items' => $numItems,
                    'next-update' => $nextFetchText,
                    'last-update' => empty($lastUpdateTime) ? '' : human_time_diff($lastUpdateTime, time()),
                    'last-update-imported' => $lastUpdateItems,
                    'errors' => $errors,
                ];

                update_post_meta($feedId, 'wprss_items_imported', $numItems);
                update_post_meta($feedId, 'wprss_next_update', $nextFetchText);
            }

            $response = [
                'wprss_feed_sources_data' => $feeds,
            ];
            break;
        }
    }

    echo json_encode($response);
    die;
});


File Name:
admin-help-metaboxes.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-help-metaboxes.php
Code:
<?php

	add_action( 'plugins_loaded', 'wprss_metaboxes_add_tooltips', 11 );
	function wprss_metaboxes_add_tooltips() {

	if( class_exists('WPRSS_Help') ) {
		$help = WPRSS_Help::get_instance();

		// Feed source setting fields
		$prefix = 'field_';
			$tooltips = array(
				/* -----------------------------
				 *  Feed Source Details Metabox
				 * -----------------------------
				 */
				// Feed Source URL
				'wprss_url'             => __('The URL of the feed source. In most cases, the URL of the site will also work, but for best results we recommend trying to find the URL of the RSS feed.

' .											'Also include the <code>http://</code> or <code>https://</code> prefix in the URL.', WPRSS_TEXT_DOMAIN),
				// Feed limit
				'wprss_limit'           => __('The maximum number of imported items from this feed to keep stored.

'.											'When new items are imported and the limit is exceeded, the oldest feed items will be deleted to make room for new ones.

'.											'If you already have items imported from this feed source, setting this option now may delete some of your items, in order to comply with the limit.', WPRSS_TEXT_DOMAIN),
				// Link to Enclosure
				'wprss_enclosure'       => __('Tick this box to make imported items link to their enclosure, rather than to the original article.

'.											'Enclosures are typically links to attachments, such as images, audio, videos, documents or flash content.

'.											'If you are not sure, leave this option unticked', WPRSS_TEXT_DOMAIN),

				'wprss_unique_titles'   => __('Whether to allow multiple feed items to have the same title. When checked, if a feed item has the same title as a previously-imported feed item, it will not be imported.

'.											'This can be useful in cases where permalinks change, or where multiple permalinks refer to the same item.', WPRSS_TEXT_DOMAIN),

				'wprss_source_link'     => __('Enable this option to link the feed source name to the RSS feed\'s source site.

' .                                           'Selecting "Default" will cause the value chosen in the general Source Display Settings to be used.

' .                                           'This option only applies when using the shortcode to output feed items.', WPRSS_TEXT_DOMAIN),

                'wprss_import_source'   => __('Tick this box to get the site name and URL from the RSS feed, for each item individually.

' .                                         'This option is useful when importing from aggregated RSS feeds that have items from different sources.

' .                                         'If the RSS feed does not provide source information for its items, the name and URL that you have given for the feed source will be used instead.'
                                            , 'wprss'),

				/* -------------------------
				 *  Feed Processing Metabox
				 * -------------------------
				 */
				// Feed State
				'wprss_state'           => __('State of the feed, active or paused.

'.											'If active, the feed source will fetch items periodically, according to the settings below.

'.											'If paused, the feed source will not fetch feed items periodically.', WPRSS_TEXT_DOMAIN),
				// Activate Feed: [date]
				'wprss_activate_feed'   => __('You can set a time, in UTC, in the future when the feed source will become active, if it is paused.

'.											'Leave blank to activate immediately.', WPRSS_TEXT_DOMAIN),
				// Pause Feed: [date]
				'wprss_pause_feed'      => __('You can set a time, in UTC, in the future when the feed source will become paused, if it is active.

'.											'Leave blank to never pause.', WPRSS_TEXT_DOMAIN),
				// Update Interval
				'wprss_update_interval' => __('How frequently the feed source should check for new items and fetch if needed.

'.											'If left as <em>Default</em>, the interval in the global settings is used.', WPRSS_TEXT_DOMAIN),
				// Delete items older than: [date]
				'wprss_age_limit'       => __('The maximum age allowed for feed items. Very useful if you are only concerned with, say, last week\'s news.

'.											'Items already imported will be deleted if they eventually exceed this age limit.

'.											'Also, items in the RSS feed that are already older than this age will not be imported at all.

'.											'Leave empty to use the <em>Limit feed items by age</em> option in the general settings.', WPRSS_TEXT_DOMAIN),

				/* ----------------------
				 *  Feed Preview Metabox
				 * ----------------------
				 */
				// Force Feed
				'wprss_force_feed'      => __('Use this option if you are seeing an <q>Invalid feed URL</q> error in the Feed Preview above, but you are sure that the URL is correct.

'.											'Note, however, that this will disable auto-discovery, meaning that the given URL must be an RSS feed URL. Using the site\'s URL will not work.', WPRSS_TEXT_DOMAIN)
		);
		$help->add_tooltips( $tooltips, $prefix );
	}
}


File Name:
admin-help-settings.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-help-settings.php
Code:
<?php

add_action( 'plugins_loaded', 'wprss_settings_add_tooltips', 11 );
function wprss_settings_add_tooltips() {
	if( class_exists('WPRSS_Help') ) {
                $wprss = wprss();
		$help = WPRSS_Help::get_instance();

		// Feed source setting fields
		$prefix = 'setting-';
		$tooltips = array(
				/* -----------------
				 *  General Section
				 * -----------------
				 */ // Limit feed items by age
				'limit-feed-items-by-age'   => __( 'The maximum age allowed for feed items.
'.											'<hr/>

'.											'Items already imported will be deleted if they eventually exceed this age limit.

'.											'Also, items in the RSS feed that are already older than this age will not be imported at all.
'.											'<hr/>

'.											'<em>Leave empty for no limit.</em>', WPRSS_TEXT_DOMAIN),
				// Limit feed items per feed
				'limit-feed-items-imported' => __('The maximum number of imported items to keep stored, for feed sources that do not have their own limit.
'.											'<hr/>

'.											'When new items are imported and the limit for a feed source is exceeded, the oldest feed items for that feed source will be deleted to make room for the new ones.

'.											'If you already have items imported from this feed source, setting this option now may delete some of your items, in order to comply with the limit.
'.											'<hr/>

'.											'<em>Use 0 or leave empty for no limit.</em>', WPRSS_TEXT_DOMAIN),
                // Limit feed items per import
                'limit_feed_items_per_import' => __('The maximum amount of items to process per import.
'.                                           '<hr />

'.                                           'Will not process more than this amount of items every time the feed source updates, regardless of other settings.
'.                                           'The frequency of updates is determined by the feed processing interval.
'.                                           '<hr />

'.                                           '<em>Leave empty for no limit.</em>',
                                             WPRSS_TEXT_DOMAIN),
                // Feed items import order
                'feed_items_import_order'    => __('The order in which feed items will be imported.
'.                                           '<hr />

'.                                           '<strong>Latest items first</strong> will import the most recent items in the feed first.
'.                                           '<strong>Oldest items first</strong> will import the oldest items in the feed first.
'.                                           '<strong>Original feed order</strong> only works well on PHP7 or later.
'.                                           '
'.                                           'This setting is very useful in combination with the per-import limit.
'.                                           '<hr />

'.                                           'Default: <em>Latest items first</em>',
                                             WPRSS_TEXT_DOMAIN),
				// Schedule future items
                'schedule_future_items'     => __('If ticked, items with future dates will be scheduled to be published later. Leave unticked to always publish items immediately.
                                                 <hr/>
                                                 Default: <em>Off</em>',
                                                'wprss'),
				// Feed processing interval
				'cron-interval'             => __('How frequently should the feed sources (that do not have their own update interval) check for updates and fetch items accordingly.

'.											'It is recommended to not have more than 20 feed sources that use this global update interval. Having too many feed sources updating precisely at the same time can cause the WP Cron System to crash.', WPRSS_TEXT_DOMAIN),
				// Unique titles only
				'unique-titles'             => __('Whether to allow multiple feed items to have the same title. When checked, if a feed item has the same title as a previously-imported feed item from any feed source, it will not be imported.

'.											'This can be useful in cases where permalinks change, or where multiple permalinks refer to the same item.

'.											'Since this feature requires checking every post title, WordPress installs with a significant amount of posts may notice a slight slowdown of the post import process.', WPRSS_TEXT_DOMAIN),
				// Custom Feed URL
				'custom-feed-url'           => __('The URL of the custom feed, located at <code>https://yoursite.com/[custom feed url]</code>.
'.											'<hr/>

'.											'WP RSS Aggregator allows you to create a custom RSS feed, that contains all of your imported feed items. This setting allows you to change the URL of this custom feed.

'.											'<hr/>

'.											'<strong>Note:</strong> You may be required to refresh you Permalinks after you change this setting, by going to <em>Settings <i class="fa fa-angle-right"></i> Permalinks</e> and clicking <em>Save</em>.', WPRSS_TEXT_DOMAIN),
				// Custom Feed Title
				'custom-feed-title'         => __('The title of the custom feed.

'.											'This title will be included in the RSS source of the custom feed, in a <code>&lt;title&gt;</code> tag.', WPRSS_TEXT_DOMAIN),
				// Custom Feed Limit
				'custom-feed-limit'         => __('The maximum number of feed items in the custom feed.', WPRSS_TEXT_DOMAIN),

				/* --------------------------
				 *  General Display Settings
				 * --------------------------
				 */ // Link titles
				'link-enable'               => __('Check this box to make the feed item titles link to the original article.', WPRSS_TEXT_DOMAIN),
				// Title Maximum length
				'title-limit'               => __('Set the maximum number of characters to show for feed item titles.
'.											'<hr/>

'.											'<em>Leave empty for no limit.</em>', WPRSS_TEXT_DOMAIN),
				// Show Authors
				'authors-enable'            => __('Check this box to show the author for each feed item, if it is available.', WPRSS_TEXT_DOMAIN),
				// Video Links
				'video-links'               => __('For feed items from YouTube, Vimeo or Dailymotion, you can choose whether you want to have the items link to the original page link, or a link to the embedded video player only.', WPRSS_TEXT_DOMAIN),
				// Pagination Type
				'pagination'                => __('The type of pagination to use when showing feed items on multiple pages.

'.											'The first shows two links, "Older" and "Newer", which allow you to navigate through the pages.

'.											'The second shows links for all the pages, together with links for the next and previous pages.', WPRSS_TEXT_DOMAIN),
				// Feed Limit
				'feed-limit'                => __('The maximum number of feed items to display when using the shortcode.

'.											'This enables pagination if set to a number smaller than the number of items to be displayed.', WPRSS_TEXT_DOMAIN),
				// Open Links Behaviour
				'open-dd'                   => __('Choose how you want links to be opened. This applies to the feed item title and the source link.', WPRSS_TEXT_DOMAIN),
				// Set links as no follow
				'follow-dd'                 => __('Enable this option to set all links displayed as "NoFollow".
'.											'<hr/>

'.											'"Nofollow" provides a way to tell search engines to <em>not</em> follow certain links, such as links to feed items in this case.', WPRSS_TEXT_DOMAIN),

				/* -------------------------
				 *  Source Display Settings
				 * -------------------------
				 */ // Source Enabled
				'source-enable'             => __('Enable this option to show the feed source name for each feed item.', WPRSS_TEXT_DOMAIN),
				// Text preceding source
				'text-preceding-source'     => __('Enter the text that you want to show before the source name. A space is automatically added between this text and the feed source name.', WPRSS_TEXT_DOMAIN),
				// Source Link
				'source-link'               => __('Enable this option to link the feed source name to the RSS feed\'s source site.', WPRSS_TEXT_DOMAIN),

				/* -------------------------
				 *  Date Display Settings
				 * -------------------------
				 */ // Source Enabled
				'date-enable'               => __('Enable this to show the feed item\'s date.', WPRSS_TEXT_DOMAIN),
				// Text preceding date
				'text-preceding-date'       => __('Enter the text that you want to show before the feed item date. A space is automatically added between this text and the date.', WPRSS_TEXT_DOMAIN),
				// Date Format
				'date-format'               => __('The format to use for the feed item dates, as a PHP date format.', WPRSS_TEXT_DOMAIN),
				// Time Ago Format Enable
				'time-ago-format-enable'    => __('Enable this option to show the elapsed time from the feed item\'s date and time to the present time.
'.											'<em>Eg. 2 hours ago</em>', WPRSS_TEXT_DOMAIN),

				/* --------
				 *  Styles
				 * --------
				 */ // Styles Disable
				'styles-disable'            => __('Check this box to disable all plugin styles used for displaying feed items.

'.											'This will allow you to provide your own custom CSS styles for displaying the feed items.', WPRSS_TEXT_DOMAIN),
		
				/*
				 * -------
				 *  Other
				 * -------
				 */ // Certificate Path
				'certificate-path'			=> __( 'Path to the file containing one or more certificates.

'.											'These will be used to verify certificates over secure connection, such as when fetching a remote resource over HTTPS.

'.											'Relative path will be relative to the WordPress root.

'.											'<strong>Default:</strong> path to certificate file bundled with WordPress.', WPRSS_TEXT_DOMAIN ),

                /** @since 4.8.2 */
                'feed_request_useragent'    => __( 'The string to be used as the useragent for feed requests.

'.                                          'If non-empty, this exact string will be sent with every request made by WP RSS Aggregator for a feed source XML document.

'.                                          'Some servers react in unexpected ways to the default value. In such cases, try changing this to something else.

'.                                          'The default value is the useragent that the Chrome Browser uses.'),
		        'feed_cache_enabled' => __( 'Tick this box to enable caching for a small performance gain.

'.                                          'When enabled, websites may ignore the plugin if their RSS feed did not change. So we suggest testing it out first to ensure that your RSS feeds work well with this option enabled.

'.                                          'If you encounter problems or weird behavior, we suggest turning this option off.',
                                            'wprss')
		);
		$help->add_tooltips( $tooltips, $prefix );

                // Feed source specific
                $prefix = 'field_';
                $help->add_tooltips(array(
                    WPRSS_Feed_Access::SETTING_KEY_FEED_REQUEST_USERAGENT           => $wprss->__( array('The string to be used as the useragent for feed requests.

'.                                                                                  'If non-empty, this exact string will be sent with every request made by %1$s for a feed source XML document.

'.                                                                                  'Leave this empty to inherit the general setting.

'.                                                                                  'Some servers react in unexpected ways to the default value. In such cases, try changing this to something else.

'.                                                                                  'The default value is the useragent that the Chrome browser uses.',
                                                                                    $wprss->getName()))
                ), $prefix);
	}
}


File Name:
admin-help.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-help.php
Code:
<?php

	use Aventura\Wprss\Core\Licensing\License\Status as License_Status;

    /**
     * Checks if the HS becaon is enabled or not.
     *
     * @since 4.12.1
     *
     * @return bool True if enabled, false if not.
     */
    function wprss_is_help_beacon_enabled() {
        return (int) get_option('wprss_hs_beacon_enabled', 1) === 1;
    }

	/**
	 * Build the Help page
	 *
	 * @since 4.2
	 */
	function wprss_help_page_display() {
	    ?>

		<div class="wrap">
			<h2><?php _e( 'Help & Support', WPRSS_TEXT_DOMAIN ); ?></h2>
            <?php do_action('wpra/help_page/after_title') ?>
			<h3><?php _e( 'Knowledge Base', WPRSS_TEXT_DOMAIN ) ?></h3>
			<?php
				printf(
					wpautop(
						__( 'In the <a href="%s">WP RSS Aggregator knowledge base</a> you will find comprehensive details and tutorials on how to use the core plugin and all the add-ons.

							There are also some videos to help you make a quick start to setting up and enjoying this plugin.',
							WPRSS_TEXT_DOMAIN
						)
					),
					'https://kb.wprssaggregator.com/'
				);
			?>
			<h3><?php _e( 'Frequently Asked Questions (FAQ)', WPRSS_TEXT_DOMAIN ) ?></h3>
			<?php
				printf(
					wpautop(
						__( 'If after going through the knowledge base you still have questions, please take a look at the <a href="%s">FAQ section</a>. We set this up purposely to answer the most commonly asked questions from our users.',
							WPRSS_TEXT_DOMAIN
						)
					),
					'https://kb.wprssaggregator.com/category/359-faqs'
				)
			?>

			<?php
			if ( wprss_licensing_get_manager()->licenseWithStatusExists( License_Status::VALID ) ) {
				wprss_premium_help_display();
			} else {
				wprss_free_help_display();
			}
			?>
            <h3><?php _e( 'Built-in Help Beacon', WPRSS_TEXT_DOMAIN ) ?></h3>
            <form method="POST">
                <p>
                    <?php _e('The help beacon is an interactive button that appears on the bottom-right section of WP RSS Aggregator admin pages.', WPRSS_TEXT_DOMAIN); ?>
                    <?php _e('It provides access to our extensive knowledge base where you can find the answers to the most commonly asked questions.', WPRSS_TEXT_DOMAIN); ?>
                </p>
                <p>
                    <?php _e('The beacon only works on WP RSS Aggregator admin pages and does not track your mouse clicks and/or keyboard input.', WPRSS_TEXT_DOMAIN); ?>
                </p>
                <?php if (wprss_is_help_beacon_enabled()): ?>
                    <p><?php _e('The support beacon is currently <b>enabled</b>.', WPRSS_TEXT_DOMAIN); ?></p>
                    <button type="submit" name="wprss_hs_beacon_enabled" value="0" class="button button-secondary">
                        <?php _e('Disable support beacon', WPRSS_TEXT_DOMAIN); ?>
                    </button>
                <?php else: ?>
                    <p><?php _e('By enabling the help beacon, you are consenting to this data collection.', WPRSS_TEXT_DOMAIN); ?></p>
                    <button type="submit" name="wprss_hs_beacon_enabled" value="1" class="button button-primary">
                        <?php _e('Enable support beacon', WPRSS_TEXT_DOMAIN); ?>
                    </button>
                <?php endif; ?>

                <?php wp_nonce_field('wprss_hs_beacon_enabled'); ?>
            </form>
		</div>
	    <?php
        do_action('wpra/help_page/bottom');
	}

	// Handler to update the HS beacon enabled option
	add_action('init', function () {
	    if (!is_admin()) {
	        return;
        }

	    $enabled = filter_input(INPUT_POST, 'wprss_hs_beacon_enabled', FILTER_VALIDATE_INT);

	    if ($enabled !== null) {
            check_admin_referer('wprss_hs_beacon_enabled');
            update_option('wprss_hs_beacon_enabled', $enabled);
        }
    });

    /**
     * Print the premium help section, linking to the contact us page on the site.
     *
     * @since 4.11.3
     */
    function wprss_premium_help_display() {
        printf('<h3>%s</h3>', __( 'Premium Support', WPRSS_TEXT_DOMAIN ));
        printf(
            __(
                'Contact us <a href="%s" target="%s=">here</a> for pre-sales and premium support.',
                WPRSS_TEXT_DOMAIN
            ),
            "https://www.wprssaggregator.com/contact/",
            "wpra-premium-contact-us-form"
        );
    }

	/**
	 * Print the premium help section with inline support form.
	 *
	 * (Currently unused)
	 *
	 * @since 4.7
	 */
	function wprss_premium_help_support_form() {
		// Addon and license object, both detected in the below algorithm that searches for a
		// premium addon that is activated with a valid license
		$addon = null;
		$license = null;
		// Get license statuses option
		$statuses = get_option( 'wprss_settings_license_statuses', array() );
		// Iterate all statuses
		foreach ( $statuses as $_key => $_value ) {
			// If not a license status key, continue to next
			$_keyPos = strpos($_key, '_license_status');
			if ( $_keyPos === FALSE ) {
				continue;
			}
			// If the status is not valid, contine to next
			if ($_value !== 'valid') {
				continue;
			}
			// Get the addon ID
			$_addonId = substr( $_key, 0, $_keyPos );
			// Get the license
			$_license = wprss_licensing_get_manager()->checkLicense( $_addonId, 'ALL' );
			// If the license is not null
			if ($_license !== null) {
				// Save its details
				$addon = $_addonId;
				$license = $_license;
				// And stop iterating
				break;
			}
		}

		// If we didn't find an add-on with a valid license, show the free help text.
		if ( $addon === null || $license === null ) {
			wprss_free_help_display();
			return;
		}

		// Get the full license info so we can prefill the name and email
		$customer_name = is_object($license) ? $license->customer_name : '';
		$customer_email = is_object($license) ? $license->customer_email : '';

		echo '<h3>' . __( 'Email Support', WPRSS_TEXT_DOMAIN ) . '</h3>';
		echo wpautop( __( "If you still can't find an answer to your query after reading the documentation and going through the FAQ, just fill out the support request form below. We'll be happy to help you out.", WPRSS_TEXT_DOMAIN ) );

		?>

		<form method="post">
			<table>
				<tr>
					<td><strong><?php _e('From: ', WPRSS_TEXT_DOMAIN); ?></strong></td>
					<td><input type='text' name='support-name' value="<?php echo esc_attr($customer_name); ?>" placeholder='<?php echo esc_attr('Name', WPRSS_TEXT_DOMAIN); ?>' style='width:100%;'></td>
					<td><input type='text' name='support-email' value="<?php echo esc_attr($customer_email); ?>" placeholder='<?php echo esc_attr('Email', WPRSS_TEXT_DOMAIN); ?>' style='width:100%;'></td>
				</tr>
				<tr>
					<td colspan="3" style="text-align:right;"><small><?php _e('Replies will be sent to this email address.'); ?></small></td>
				</tr>
				<tr>
					<td colspan="3"><input type='text' name='support-subject' placeholder='<?php echo esc_attr('Subject', WPRSS_TEXT_DOMAIN); ?>' style='width:100%;'></td>
				</tr>
				<tr>
					<td colspan="3"><textarea name='support-message' rows='10' cols='80' placeholder='<?php echo esc_attr('Message', WPRSS_TEXT_DOMAIN); ?>'></textarea></td>
				</tr>
				<tr>
					<td colspan="3"><strong><?php _e('Attachments', WPRSS_TEXT_DOMAIN);?>: </strong></td>
				</tr>
				<tr>
					<td colspan="3"><input type='checkbox' name='support-include-log' value='checked' checked><?php _e('WP RSS Aggregator log file', WPRSS_TEXT_DOMAIN); ?></td>
				</tr>
				<tr>
					<td colspan="3"><input type='checkbox' name='support-include-sys' value='checked' checked><?php _e('WordPress debugging information', WPRSS_TEXT_DOMAIN); ?></td>
				</tr>
			</table>
		</form>
		<div style='line-height:2.3em; margin-top:10px;'>
			<button id='send-message-btn' class='button button-primary'><?php _e('Send Message', WPRSS_TEXT_DOMAIN); ?></button>
			<div id='support-error'></div>
		</div>

		<?php
	}

	/**
	 * Print the free help section with link to forums.
	 *
	 * @since 4.7
	 */
	function wprss_free_help_display() {
		echo '<h3>' . __( 'Support Forums', WPRSS_TEXT_DOMAIN ) . '</h3>';
		printf(
			wpautop(
				__( 'Users of the free version of WP RSS Aggregator can ask questions on the <a href="%s">support forum</a>.', WPRSS_TEXT_DOMAIN )
			),
			'https://wordpress.org/support/plugin/wp-rss-aggregator'
		);
	}


	add_action( 'wp_ajax_wprss_ajax_send_premium_support', 'wprss_ajax_send_premium_support' );
	/**
	 * Handles the AJAX request to send the support form. Returns a JSON status.
	 *
	 * @since 4.7
	 */
	function wprss_ajax_send_premium_support() {
		$ret = array();

		// Validate the form fields that were submitted and send any errors.
		$error = wprss_validate_support_request();
		if ($error !== FALSE) {
			$ret['error'] = $error;
			echo json_encode($ret);
			die();
		}

		// Create the email content.
		$subject = sanitize_text_field($_GET['support-subject']);
		$message = wprss_create_support_message();
		$headers  = wprss_create_support_headers();

		// Send the email.
		$sent = wp_mail( "support@wprssaggregator.com", $subject, $message, $headers );

		// NB, the retval is a best-guess about email sending. According to the WP Codex it
		// doesn't mean the user received the email, it "only means that the method used
		// was able to  process the request without any errors."
		if ($sent === FALSE) {
			$ret['error'] = sprintf(__('There was an error sending the form. Please use the <a href="%s" target="_blank">contact form on our site.</a>'), esc_attr('https://www.wprssaggregator.com/contact/'));
			$ret['message'] = $message;
		} else {
			$ret['status'] = 'OK';
		}

		echo json_encode($ret);
		die();
	}


	/**
	 * Ensures that all support form fields have been filled out. Returns TRUE
	 *
	 * @since 4.7
	 * @return FALSE when all fields are valid, or a string containing an error they aren't.
	 */
	function wprss_validate_support_request() {
		$fields = array(
			'support-name',
			'support-email',
			'support-subject',
			'support-message'
		);

		// Ensure that each required field is present and filled out.
		foreach ($fields as $field) {
			if (!isset($_GET[$field]) || $_GET[$field] === "") {

				return sprintf(
					__('Please fill out all the fields in the form, including the <strong>%s</strong> field.', WPRSS_TEXT_DOMAIN),
					ucfirst(substr($field, strpos($field, '-') + 1))
				);
			}
		}

		// Ensure the email is of a valid format.
		if (is_email($_GET['support-email']) === FALSE) {
			return __('Please enter a valid email address.', WPRSS_TEXT_DOMAIN);
		}

		return FALSE;
	}


	/**
	 * Creates and returns the support request email's message body.
	 *
	 * @since 4.7
	 */
	function wprss_create_support_message() {
		// Get the WP RSS Aggregator log.
		$log = 'Customer did not send log';
		if ($_GET['support-include-log'] === 'true') {
			$log = wprss_get_log();
		}

		// Get the system information.
		$sys_info = 'Customer did not send system information';
		if ($_GET['support-include-sys'] === 'true') {
			ob_start();
			wprss_print_system_info();
			$sys_info = ob_get_contents();
			ob_end_clean();
		}

		// Get the license keys.
		$keys = json_encode( get_option( 'wprss_settings_license_keys', array() ), JSON_PRETTY_PRINT );

			// Get the message they entered.
		$message  = sanitize_text_field($_GET['support-message']);

		// Remove any generated system data that may be present from previous form submission attempts.
		$idx = strpos($message, "----------------------------------------------");
		if ($idx !== FALSE) {
			$message  = substr($message, 0, $idx);
		}

		// Append the generated system data.
		$message .= "\n\n----------------------------------------------\n";
		$message .= "\nLicense Information:\n" . $keys;
		$message .= "\n\n\nError Log:\n" . $log;
		$message .= "\n\n\nSystem Information:\n" . $sys_info . "\n";

		$message = apply_filters( 'wprss_support_message', $message );

		return $message;
	}


	/**
	 * Creates and returns the support request email's headers.
	 *
	 * @since 4.7
	 */
	function wprss_create_support_headers() {
		$headers  = "From: no-reply@wprssaggregator.com\r\n";
		$headers .= "Reply-to: " . sanitize_text_field($_GET['support-name']) . " <" . sanitize_email($_GET['support-email']) . ">\r\n";

		$headers = apply_filters( 'wprss_support_headers', $headers );

		return $headers;
	}


/**
 * Encapsulates features for providing inline help in the admin interface.
 *
 * The following filters are introduced:
 *
 * - `wprss_help_default_options` - The default options to be extended.
 *
 *	1.	The array of options
 *
 * - `wprss_help_template_path` - The path of template retrieved by WPRSS_Help::get_template().
 *
 *	1. The path to the template.
 *  2. The array of variables passed.
 *
 * - `wprss_help_template_vars` - The variables for the template, received by WPRSS_Help::get_template().
 *
 *	1. The variables array.
 *	2. The path to the template, filtered by `wprss_help_template_path`.
 *
 * - `wprss_help_tooltip_options` - Options that are in effect when adding tooltips with WPRSS_Help::add_tooltip().
 * - `wprss_help_tooltip_handle_html_options` - Options that are in effect when retrieving tooltip handle HTML with WPRSS_Help::wprss_help_tooltip_handle_html_options.
 *
 *
 * Also, the following options are available:
 *
 * - `tooltip_id_prefix` - The HTML element ID prefix that will be used for tooltips.
 * - `tooltip_handle_text` - The text that will appear inside the handle HTML elements.
 * - `tooltip_handle_class` - The CSS class that will be assigned to tooltip handles.
 * - `tooltip_content_class` - The CSS class that will be assigned to tooltip content HTML elements.
 * - `enqueue_tooltip_content` - Whether or not content is to be enqueued, instead of being output directly.
 *
 *	1. The absolute path to the core plugin directory
 */
class WPRSS_Help {

	static $_instance;

	protected $_options;
	protected $_enqueued_tooltip_content = array();
	protected $_tooltips = array();

	const OPTION_NAME = 'wprss_settings_help';
	const CODE_PREFIX = 'wprss_help_';
	const OVERRIDE_DEFAULT_PREFIX = '!';
	const TEXT_DOMAIN = WPRSS_TEXT_DOMAIN;
	const HASHING_CONCATENATOR = '|';
	const OPTIONS_FILTER_SUFFIX = '_options';

	const TOOLTIP_DATA_KEY_ID = 'id';
	const TOOLTIP_DATA_KEY_TEXT = 'text';
	const TOOLTIP_DATA_KEY_OPTIONS = 'options';

	/**
	 * Retrieve the singleton instance
	 *
	 * @return WPRSS_Help
	 */
	public static function get_instance() {
		if ( is_null( self::$_instance ) ) {
			$class_name = __CLASS__; // Late static bindings not allowed
			self::$_instance = new $class_name();
		}

		return self::$_instance;
	}

        /**
         * @since 4.10
         */
	public static function init()
        {
            if (static::get_instance()->_isEnqueueScripts()) {
		add_action( 'admin_enqueue_scripts', array( self::get_instance(), '_admin_enqueue_scripts' ) );
		add_action( 'admin_footer', array( self::get_instance(), '_admin_footer' ) );
            }
	}

        /**
         * Determines if the admin scripts should get enqueued.
         *
         * @since 4.10
         *
         * @return bool True if admin scripts should be enqueued; false otherwise.
         */
        protected function _isEnqueueScripts()
        {
            return $this->_isWprssPage();
        }

        /**
         * Determines if the current page is related to WPRSS.
         *
         * @since 4.10
         *
         * @return bool True if the current page is related to WPRSS; false otherwise.
         */
        protected function _isWprssPage()
        {
            return wprss_is_wprss_page();
        }


	/**
	 * Filters used:
	 *
	 * - `wprss_help_default_options`
	 *
	 * @param array $options Options that will overwrite defaults.
	 */
	public function __construct( $options = array() ) {
		$defaults = apply_filters( 'wprss_help_default_options', array(
			'tooltip_id_prefix'				=> 'wprss-tooltip-',
			'tooltip_handle_text'			=> '',
			'tooltip_handle_class'			=> 'wprss-tooltip-handle', // Used in logic to identify handle elements
			'tooltip_handle_class_extra'	=> 'fa fa-question-circle', // Not used in logic
			'tooltip_content_class'			=> 'wprss-tooltip-content',
			'tooltip_class'					=> 'wprss-ui-tooltip', // Overrides default jQuery UI class
			'is_enqueue_tooltip_content'	=> '0',
			'tooltip_handle_template'		=> '%1$s/help-tooltip-handle.php',
			'tooltip_content_template'		=> '%1$s/help-tooltip-content.php',
			'admin_footer_js_template'		=> '%1$s/help-footer-js.php',
			'tooltip_not_found_handle_html'	=> '',
			'text_domain'					=> self::TEXT_DOMAIN
		));
		$db_options = $this->get_options_db();
		$this->_set_options( $this->array_merge_recursive_distinct( $db_options, $defaults ) );

		$this->_construct();
	}


	/**
	 * Used for parameter-less extension of constructor logic
	 */
	protected function _construct() {

	}


	/**
	 * Return an option value, or the whole array of internal options.
	 * These options are a product of the defaults, the database, and anything
	 * set later on, applied on top of eachother and overwriting in that order.
	 *
	 * @param null|string $key The key of the option to return.
	 * @param null|mixed $default What to return if options with the specified key not found.
	 * @return array|mixed|null The option value, or an array of options.
	 */
	public function get_options( $key = null, $default = null ) {
		$options = $this->_options;

		if ( is_null( $key ) ) {
			return $options;
		}

		if( is_array( $key ) ) {
			return $this->array_merge_recursive_distinct( $options, $key );
		}

		return isset( $options[ $key ] ) ? $options[ $key ] : $default;
	}


	/**
	 * Set the value of an internal option or options.
	 * Existing options will be overwritten. New options will be added.
	 * Database options will not be modified.
	 *
	 * @param string|array $key The key of the option to set, or an array of options.
	 * @param null|mixed $value The value of the option to set.
	 * @return WPRSS_Help This instance.
	 */
	public function set_options( $key, $value = null ) {
		if ( is_array( $key ) ) {
			foreach ( $key as $_key => $_value ) {
				$this->_set_options( $_key, $_value );
			}

			return $this;
		}

		$this->_set_options( $key, $value );
	}


	/**
	 * Set an option value, or all options.
	 * In latter case completely overrides the whole options array.
	 *
	 * @param string|array $key The key of the option to set, or the whole options array.
	 * @param null|mixed $value Value of the option to set.
	 * @return WPRSS_Help This instance.
	 */
	protected function _set_options( $key, $value = null ) {
		if ( is_array( $key ) ) {
			$this->_options = $key;
			return $this;
		}

		$this->_options[ $key ] = $value;
		return $this;
	}


	/**
	 * Returns a WPRSS_Help option or options from the database.
	 *
	 * @param string $key The key of the option to return.
	 * @param null|mixed $default What to return if option identified by $key is not found.
	 * @return null|array|mixed The options or option value.
	 */
	public function get_options_db( $key = null, $default = null ) {
		$options = (array) get_option( self::OPTION_NAME, array() );

		if ( is_null( $key ) ) {
			return $options;
		}

		return isset( $options[ $key ] ) ? $options[ $key ] : $default;
	}


	/**
	 * Get content of a template.
	 *
	 * Filters used
	 *
	 * - `wprss_help_template_path`
	 * - `wprss_help_template_vars`
	 *
	 * @param string $path Full path to the template
	 * @param array $vars This will be passed to the template
	 */
	public function get_template( $path, $vars = array() ) {
		$vars = (array) $vars;

		// Entry points
		$path = apply_filters( 'wprss_help_template_path', $path, $vars );
		$vars = apply_filters( 'wprss_help_template_vars', $vars, $path );

		ob_start();
		include($path);
		$content = ob_get_contents();
		ob_end_clean();

		return $content;
	}


	/**
	 * This is called during the `admin_enqueue_scripts` action, and will
	 * enqueue scripts needed for the backend.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_admin_scripts`
	 *
	 * @return WPRSS_Help This instance.
	 */
	public function _admin_enqueue_scripts()
        {
            if (!wprss_is_wprss_page()) {
                return $this;
            }

		$scripts = $this->apply_filters( 'admin_scripts', array(
			'jquery-ui-tooltip'				=> array()
		));

		foreach ( $scripts as $_handle => $_args ) {
			// Allows numeric array with handles as values
			if ( is_numeric( $_handle ) ) {
				$_handle = $_args;
			}

			// Allows specifying null as value to simply enqueue handle
			if ( empty( $_args ) ){
				$_args = array();
			}

			array_unshift( $_args, $_handle );
			call_user_func_array( 'wp_enqueue_script', $_args );
		}

		return $this;
	}


	public function _admin_footer() {
		$html = '';
		$html .= $this->get_enqueued_tooltip_content_html() . "\n";
		$html .= $this->get_admin_footer_js_html();
		$html = $this->apply_filters( 'admin_footer', $html );

		echo $html;
	}


	public function is_overrides_default_prefix( $string ) {
		return strpos( $string, self::OVERRIDE_DEFAULT_PREFIX ) === 0;
	}


	/**
	 * @return string This class's text domain
	 */
	public function get_text_domain() {
		return self::TEXT_DOMAIN;
	}

	/**
	 * Format this string, replacing placeholders with values, and translate it
	 * in the class's text domain.
	 *
	 * @see sprintf()
	 * @param string $string The string to translate.
	 * @param mixed $argN,.. Additional arguments.
	 */
	public function __( $string, $argN = null ) {
		$args = func_get_args();
		$args[0] = $string = __( $string, $this->get_text_domain() );

		$string = call_user_func_array( 'sprintf', $args );

		return $string;
	}

	/**
	 * Hashes all the given values into a single hash.
	 * Accepts an infinite number of parameters, all of which will be first
	 * glued together by a separator, then hashed.
	 * Non-scalar values will be serialized.
	 *
	 * @param mixed $value The value to hash.
	 * @param mixed $argN Other values to hash.
	 * @return string The hash.
	 */
	public function get_hash( $value ) {
		$args = func_get_args();
		$glue = self::HASHING_CONCATENATOR;

		$blob = '';
		foreach ( $args as $_idx => $_arg ) {
			$blob .= is_scalar( $_arg ) ? $_arg : serialize( $_arg );
			$blob .= $glue;
		}

		$blob = substr( $blob, 0, -1 );

		return sha1( $blob );
	}

	/**
	 * Get the class code prefix, or the specified prefixed with it.
	 *
	 * @param string $string A string to prefix.
	 * @return string The code prefix or the prefixed string.
	 */
	public function get_code_prefix( $string = '' ) {
		return self::CODE_PREFIX . (string)$string;
	}

	/**
	 * Optionally prefix a string with the class code prefix, unless it
	 * contains the "!" character in the very beginning, in which case it will
	 * simply be removed.
	 *
	 * @param string $string The string to consider for prefixing.
	 * @return string The prefixed or clean string.
	 */
	public function prefix( $string ) {
		return $this->is_overrides_default_prefix( $string )
				? substr( $string, 1 )
				: $this->get_code_prefix( $string );
	}

	/**
	 * Applies filters, but prefixes the filter name with 'wprss_help_',
	 * unless '!' is specified as the first character of the filter.
	 *
	 * @param string $filter_name Name or "tag" of the filter.
	 * @param mixed $subject The value to apply filters to.
	 * @param mixed $argN,.. Additional filter arguments
	 * @return mixed Result of filtering
	 */
	public function apply_filters( $filter_name, $subject, $argN = null ) {
		$args = func_get_args();

		$args[0] = $filter_name = $this->prefix( $filter_name );

		return call_user_func_array( 'apply_filters', $args );
	}


	/**
	 * Applies a filters with the specified name to the options that were
	 * applied on top of defaults.
	 * The name will be prefixed with the class prefix 'wprss_help_', and
	 * suffixed with '_options'.
	 *
	 * @param string $filter_name Name of the filter to apply to the options
	 * @param array $options The options to filter
	 * @param mixed $filter_argN,.. Other filter arguments to be passed to filter
	 */
	public function apply_options_filters( $filter_name, $options = array(), $filter_argN = null ) {
		$args = func_get_args();

		// Adding sufix
		$args[0] = $filter_name .= self::OPTIONS_FILTER_SUFFIX;

		// Applying defaults
		$args[1] = $options = $this->get_options( $options );

		// Entry point. Order of args is already correct.
		$options = call_user_func_array( array( $this, 'apply_filters' ), $args );

		return $options;
	}


	/**
	 * Parses the tooltip handle template path for placeholders.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_admin_footer_js_html_template`
	 *
	 * @param null|string $path Optional path to parse and retrieve. Default: value of the 'admin_footer_js_template' option.
	 * @return string Path to the template.
	 */
	public function get_admin_footer_js_html_template( $path = null ) {
		// Default is from options
		if ( is_null( $path ) ) {
			$path = $this->get_options( 'admin_footer_js_template' );
		}

		// Entry point
		$path = $this->apply_filters( 'admin_footer_js_html_template', $path );

		return $this->parse_path( $path );
	}


	/**
	 * Get the HTML of the JavaScript for the footer in Admin Panel.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_admin_footer_js_html`
	 *
	 * @param array $options Any additional options to be used with defaults.
	 * @return string The HTML.
	 */
	public function get_admin_footer_js_html( $options = array() ) {
		$options = $this->apply_options_filters( 'admin_footer_js_html', $options);

		$templatePath = $this->get_admin_footer_js_html_template( $options['admin_footer_js_template'] );

		return $this->get_template($templatePath, $options);
	}


	/**
	 * Parses the tooltip handle template path for placeholders.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_tooltip_handle_html_template`
	 *
	 * @param null|string $path Optional path to parse and retrieve. Default: value of the 'tooltip_handle_template' option.
	 * @return string Path to the template.
	 */
	public function get_tooltip_handle_html_template( $path = null ) {
		// Default is from options
		if ( is_null( $path ) ) {
			$path = $this->get_options( 'tooltip_handle_template' );
		}

		// Entry point
		$path = $this->apply_filters( 'tooltip_handle_html_template', $path );

		return $this->parse_path( $path );
	}


	/**
	 * Get the HTML of the tooltip handle.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_tooltip_handle_html_options`
	 *
	 * @param string $text Content of the tooltip text.
	 * @param string $id ID of the tooltip.
	 * @param array $options Any additional options to be used with defaults.
	 * @return string The HTML.
	 */
	public function get_tooltip_handle_html( $text, $id, $options = array() ) {
		$options = $this->apply_options_filters( 'tooltip_handle_html', $options, $text, $id);

		// Add template varialbes
		$options['tooltip_id'] = $id;
		$options['tooltip_text'] = $text;

		$templatePath = $this->get_tooltip_handle_html_template( $options['tooltip_handle_template'] );

		return $this->get_template($templatePath, $options);
	}


	/**
	 * Parses the tooltip content template path for placeholders.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_tooltip_content_html_template`
	 *
	 * @param null|string $path Optional path to parse and retrieve. Default: value of the 'tooltip_handle_template' option.
	 * @return string Path to the template.
	 */
	public function get_tooltip_content_html_template( $path = null ) {
		// Default is from options
		if ( is_null( $path ) ) {
			$path = $this->get_options( 'tooltip_content_template' );
		}

		// Entry point
		$path = $this->apply_filters( 'tooltip_content_html_template', $path );

		return $this->parse_path( $path  );
	}


	/**
	 * Get the HTML of the tooltip content.
	 *
	 * Filters used:
	 *
	 * - `wprss_help_tooltip_content_html_options`
	 *
	 * @param string $text Content of the tooltip text.
	 * @param string $id ID of the tooltip.
	 * @param array $options Any additional options to be used with defaults.
	 * @return string The HTML.
	 */
	public function get_tooltip_content_html( $text, $id, $options = array() ) {
		$options = $this->apply_options_filters( 'tooltip_content_html', $options, $text, $id );

		// Add template varialbes
		$options['tooltip_id'] = $id;
		$options['tooltip_text'] = $text;

		$templatePath = $this->get_tooltip_content_html_template( $options['tooltip_content_template'] );

		return $this->get_template( $templatePath, $options );
	}


	/**
	 * Add tooltip and get tooltip HTML.
	 * If $text is null, just get the HTML of tooltip with specified ID.
	 * The `is_enqueue_tooltip_content` option determines whether to enqueue
	 * the content, instead of outputting it after the handle.
	 *
	 * @param string $id ID for this tooltip
	 * @param string|null $text Text of this tooltip. If null, tooltip will not be added, but only retrieved.
	 * @param array|bool $options The options for this operation, or a boolean indicating whether or not content is to be enqueued
	 * @return string The tooltip handle and, optionally, content.
	 */
	public function tooltip( $id, $text = null, $options = array() ) {
		$this->add_tooltip( $id, $text, $options );
		return $this->do_tooltip( $id );
	}


	/**
	 * Add tooltips in a batch, with optionally prefixed ID.
	 *
	 * @param array $tooltips An array where key is tooltip ID and value is tooltip text.
	 * @param string $prefix A prefix to add to all tooltip IDs.
	 * @param array $options Arra of options for all the tooltips to add.
	 * @return \WPRSS_Help
	 */
	public function add_tooltips( $tooltips, $prefix = null, $options = array() ) {
		$prefix = (string) $prefix;
		if ( !is_array($options) ) $options = array();

		foreach ( $tooltips as $_id => $_text ) {
			$this->add_tooltip( $prefix . $_id, $_text, $options );
		}

		return $this;
	}


	/**
	 * Add a tooltip for later display.
	 * Text and options will be replaced by existing text and options, if they
	 * are empty, and a tooltip with the same ID is already registered.
	 *
	 * @param string $id The ID of this tooltip
	 * @param string $text Text for this tooltip
	 * @param array $options Options for this tooltip.
	 * @return WPRSS_Help This instance.
	 */
	public function add_tooltip( $id, $text = null, $options = array() ) {
		if ( $tooltip = $this->get_tooltip( $id ) ) {
			if ( is_null( $text ) ) $text = isset( $tooltip[ self::TOOLTIP_DATA_KEY_TEXT ] ) ? $tooltip[ self::TOOLTIP_DATA_KEY_TEXT ] : $text;
			if ( empty( $options ) ) $options = isset( $tooltip[ self::TOOLTIP_DATA_KEY_OPTIONS ] ) ? $tooltip[ self::TOOLTIP_DATA_KEY_OPTIONS ] : $options;
		}

		$this->set_tooltip( $id, $text, $options );

		return $this;
	}


	/**
	 * Set a tooltip, existing or not.
	 *
	 * @param string $id The ID of this tooltip
	 * @param string $text Text for this tooltip
	 * @param array $options Options for this tooltip.
	 * @return WPRSS_Help This instance.
	 */
	public function set_tooltip( $id, $text = null, $options = array() ) {
		$this->_tooltips[ $id ] = array(
			self::TOOLTIP_DATA_KEY_ID			=> $id,
			self::TOOLTIP_DATA_KEY_TEXT			=> $text,
			self::TOOLTIP_DATA_KEY_OPTIONS		=> $options
		);

		return $this;
	}


	/**
	 * Retrieve one tooltip, or an array containing all tooltips.
	 *
	 * @param string|null $id The ID of the tooltip to retrieve.
	 * @param mixed|null $default What to return if tooltip with specified ID not found.
	 * @return array An array that contains the following indexes: 'id', 'text', 'options'. See {@link add_tooltip()} for details.
	 */
	public function get_tooltip( $id = null, $default = null ) {
		if ( is_null( $id ) ) {
			return $this->_tooltips;
		}

		return $this->has_tooltip( $id ) ? $this->_tooltips[ $id ] : $default;
	}


	/**
	 * Check whether a tooltip with the specified ID exists.
	 *
	 * @param string $id ID of the tooltip to check for.
	 * @return boolean True if a tooltip with the specified ID exists; false otherwise.
	 */
	public function has_tooltip( $id ) {
		return isset( $this->_tooltips[ $id ] );
	}

	/**
	 * Get registered tooltip HTML.
	 *
	 * Filters used:
	 *
	 *  - `wprss_help_tooltip_options` - Filters options used for tooltip
	 *
	 * @param string $id ID for this tooltip
	 * @param string $text Text of this tooltip
	 * @param array|bool $options The options for this operation, or a boolean indicating whether or not content is to be enqueued
	 * @return string The tooltip handle and, optionally, content.
	 */
	public function do_tooltip( $id ) {
		$options = $this->get_options();

		if ( !($tooltip = $this->get_tooltip( $id )) || !isset($tooltip[ self::TOOLTIP_DATA_KEY_TEXT ]) || !$tooltip[ self::TOOLTIP_DATA_KEY_TEXT ] ) {
			return isset( $options['tooltip_not_found_handle_html'] )
					? $options['tooltip_not_found_handle_html']
					: null;
		}

		$options = isset( $tooltip[ self::TOOLTIP_DATA_KEY_OPTIONS ] ) ? $tooltip[ self::TOOLTIP_DATA_KEY_OPTIONS ] : null;
		$text = isset( $tooltip[ self::TOOLTIP_DATA_KEY_TEXT ] ) ? $tooltip[ self::TOOLTIP_DATA_KEY_TEXT ] : null;

		if ( !is_array( $options ) ) {
			$options = array( 'is_enqueue_tooltip_content' => $options );
		}

		// Entry point
		$options = $this->apply_options_filters( 'tooltip', $options, $id, $text );

		// Get handle HTML
		$output = $this->get_tooltip_handle_html( $text, $id, $options );

		if ( $this->evaluate_boolean( $options['is_enqueue_tooltip_content'] ) ) {
			$this->enqueue_tooltip_content($text, $id, $options);
		}
		else {
			$output .= $this->get_tooltip_content_html( $text, $id, $options );
		}

		return $output;
	}


	/**
	 * Enqueue tooltip content to be displayed in another part of the page.
	 *
	 * @param string $text The text of the tooltip content to enqueue.
	 * @param string $id ID of the tooltip, the content of which to enqueue.
	 * @param array $options This tooltip's options.
	 * @return \WP_Error|\WPRSS_Help This instance, or error if enqueue method is invalid.
	 */
	public function enqueue_tooltip_content( $text, $id, $options = array() ) {
		$queue_method = $this->apply_filters( 'enqueue_tooltip_content_method', array( $this, '_enqueue_tooltip_content' ), $options, $id, $text );

		// "Error handling" WP style
		if ( !is_callable( $queue_method ) ) {
			return new WP_Error( $this->prefix( 'invalid_queue_method' ), $this->__( 'Could not enqueue tooltip content: the queue method is not a valid callable.' ), array(
				'queue_method'			=> $queue_method,
				'text'					=> $text,
				'id'					=> $id,
				'options'				=> $options
			));
		}

		call_user_func_array( $queue_method, array( $text, $id, $options ) );

		return $this;
	}


	public function _enqueue_tooltip_content( $text, $id, $options = array() ) {
		$hash = $this->get_hash( $text, $id, $options );
		$this->_enqueued_tooltip_content[ $hash ] = array(
			self::TOOLTIP_DATA_KEY_TEXT			=> $text,
			self::TOOLTIP_DATA_KEY_ID			=> $id,
			self::TOOLTIP_DATA_KEY_OPTIONS		=> $options
		);

		return $this;
	}


	public function get_enqueued_tooltip_content() {
		return $this->_enqueued_tooltip_content;
	}


	public function get_enqueued_tooltip_content_html() {
		$output = '';
		foreach ( $this->get_enqueued_tooltip_content() as $_hash => $_vars ) {
			$options = is_array( $_vars[ self::TOOLTIP_DATA_KEY_OPTIONS ] ) ? $_vars[ self::TOOLTIP_DATA_KEY_OPTIONS ] : array();
			$output = $this->get_tooltip_content_html( $_vars[ self::TOOLTIP_DATA_KEY_ID ], $_vars[ self::TOOLTIP_DATA_KEY_ID ], $options );
		}

		echo $output;
	}


	/**
	 * Check whether or not the given value is false.
	 * False values are all {@link empty()} values, and also strings 'false' and 'no'.
	 *
	 * @param mixed $value The value to check.
	 * @return boolean Whether or not the value is considered to be false.
	 */
	public function evaluate_boolean( $value ) {
		return (empty( $value ) || strtolower( $value ) === 'false' || strtolower( $value ) === 'no')
				? false
				: true;
	}


	/**
	 * Merge two arrays in an intuitive way.
	 * Input arrays remain unchanged.
	 *
	 * @see http://php.net/manual/en/function.array-merge-recursive.php#92195
	 * @param array $array1 The array to merge.
	 * @param array $array2 The array to merge into.
	 * @return array The merged array.
	 */
	public function array_merge_recursive_distinct( array &$array1, array &$array2 ) {
		$merged = $array1;

		foreach ( $array2 as $key => &$value ) {
			if ( is_array( $value ) && isset( $merged[ $key ] ) && is_array( $merged[ $key ] ) ) {
				$merged[ $key ] = $this->array_merge_recursive_distinct( $merged[ $key ], $value );
			} else {
				$merged[ $key ] = $value;
			}
		}

		return $merged;
	}


	/**
	 * Converts an array to a numeric array.
	 * If $map is empty, assumes that the array keys are already in order.
	 * If $map is a number, assumes it's the amount of elements to return.
	 * If $map is an array, assumes it is the map of intended numeric indexes to their value in the input array.
	 *
	 * @param array $array The array to convert to a numeric array
	 * @param false|null|array $map The map of the array indexes, or number of array elements to slice, or nothing.
	 * @return array The resulting numeric array.
	 */
	public function array_to_numeric( $array, $map = null ) {
		$result = array();

		// If map is not an array, assume it's an indicator
		if ( !is_array( $map ) ) {
			$array = array_values( $array );
		}

		// If map is empty, assume keys are in order
		if ( empty( $map ) ) {
			return $array;
		}

		// If map is a number, assume it's the amount of elements to return
		if ( is_numeric( $map ) ) {
			$map = intval( $map );
			return array_slice( $array, 0, $map );
		}

		foreach( $map as $_idx => $_key ) {
			$result[ $_idx ] = $array[ $_key ];
		}

		return $result;
	}


	/**
	 * Parses the template and replaces placeholders with their values.
	 * This function uses {@see sprintf()} to format the template string using
	 * the values provided in $data.
	 * It is also possible for $data to be an associative array of key-value pairs.
	 * To achieve the same result, a map can be provided, mapping data keys to
	 * their placeholder positions.
	 * If no map is provided,
	 *
	 * @param string $string The template string.
	 * @param array $data The key-value pairs of template data.
	 * @param false|null|array $map {@see array_to_numeric()} The template value map.
	 * @return string The parsed and modified template.
	 */
	public function parse_template( $string, $data, $map = null ) {
		$data = $this->array_to_numeric( $data, $map );
		array_unshift( $data, $string );
		return call_user_func_array( 'sprintf', $data );
	}


	/**
	 * Parses a path template specifically with WPRSS_Help path placeholders.
	 *
	 * Filters used (in order):
	 *
	 *  1. `parse_path_data_default`;
	 *  2. `parse_path_data`;
	 *  3. `parse_path_map`;
	 *  4. `parse_path_path`.
	 *
	 * @see WPRSS_Help::parse_template()
	 * @param string $path The path to parse.
	 * @param null|array $data Any additional data. Will be merged with defaults.
	 * @param null|array $map The map for parsing.
	 * @return string The path with placeholders replaced
	 */
	public function parse_path( $path, $data = null, $map = null ) {
		if( is_null( $data ) ) {
			$data = array();
		}

		$defaults = $this->apply_filters( 'parse_path_data_default', array(
			'wprss_templates_dir'			=> wprss_get_templates_dir()
		));
		$data = $this->array_merge_recursive_distinct( $data, $defaults );
		$data = $this->apply_filters( 'parse_path_data', $data, $path, $map );
		$map = $this->apply_filters( 'parse_path_map', $map, $data, $path );
		$path = $this->apply_filters( 'parse_path_path', $path, $data, $map );

		return $this->parse_template( $path, $data, $map );
	}
}

WPRSS_Help::init();


File Name:
admin-intro-page.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-intro-page.php
Code:
<?php

if (!defined('ABSPATH')) {
    die;
}

define('WPRSS_INTRO_PAGE_SLUG', 'wpra-intro');
define('WPRSS_FIRST_ACTIVATION_OPTION', 'wprss_first_activation_time');
define('WPRSS_DB_VERSION_OPTION', 'wprss_db_version');
define('WPRSS_INTRO_DID_INTRO_OPTION', 'wprss_did_intro');
define('WPRSS_INTRO_FEED_ID_OPTION', 'wprss_intro_feed_id');
define('WPRSS_INTRO_FEED_LIMIT', 20);
define('WPRSS_INTRO_STEP_OPTION', 'wprss_intro_step');
define('WPRSS_INTRO_NONCE_NAME', 'wprss_intro_nonce');
define('WPRSS_INTRO_STEP_POST_PARAM', 'wprss_intro_step');
define('WPRSS_INTRO_FEED_URL_PARAM', 'wprss_intro_feed_url');
define('WPRSS_INTRO_SHORTCODE_PAGE_OPTION', 'wprss_intro_shortcode_page');
define('WPRSS_INTRO_SHORTCODE_PAGE_PREVIEW_PARAM', 'wprss_preview_shortcode_page');

/**
 * Registers the introduction page.
 *
 * @since 4.12
 */
add_action('admin_menu', function () {
    add_submenu_page(
        null,
        __('Welcome to WP RSS Aggregator'),
        __('Welcome to WP RSS Aggregator'),
        'manage_options',
        WPRSS_INTRO_PAGE_SLUG,
        'wprss_render_intro_page'
    );
});

/**
 * Renders the intro page.
 *
 * @since 4.12
 *
 * @throws Twig_Error_Loader
 * @throws Twig_Error_Runtime
 * @throws Twig_Error_Syntax
 */
function wprss_render_intro_page()
{
    wprss_update_previous_update_page_version();

    wprss_plugin_enqueue_app_scripts('intro-wizard', WPRSS_APP_JS . 'intro.min.js', array(), '0.1', true);
    wp_enqueue_style('intro-wizard', WPRSS_APP_CSS . 'intro.min.css');

    $nonce = wp_create_nonce(WPRSS_INTRO_NONCE_NAME);
    wp_localize_script('intro-wizard', 'wprssWizardConfig', array(
        'previewUrl' => admin_url('admin.php?wprss_preview_shortcode_page=1&nonce=' . $nonce),
        'feedListUrl' => admin_url('edit.php?post_type=wprss_feed'),
        'addOnsUrl' => 'https://www.wprssaggregator.com/plugins/?utm_source=core_plugin&utm_medium=onboarding_wizard&utm_campaign=onboarding_wizard_addons_button&utm_content=addons_button',
        'supportUrl' => 'https://www.wprssaggregator.com/contact/?utm_source=core_plugin&utm_medium=onboarding_wizard&utm_campaign=onboarding_wizard_support_link&utm_content=support_link',
        'proPlanUrl' => 'https://www.wprssaggregator.com/pricing/?utm_source=core_plugin&utm_medium=onboarding_wizard&utm_campaign=onboarding_wizard_content_link',
        'proPlanCtaUrl' => 'https://www.wprssaggregator.com/pricing/?utm_source=core_plugin&utm_medium=onboarding_wizard&utm_campaign=onboarding_wizard_cta_button',
        'demoImageUrl' => WPRSS_IMG . 'welcome-page/demo.jpg',
        'caseStudyUrl' => 'https://www.wprssaggregator.com/case-study-personal-finance-blogs-content-curation/?utm_source=core_plugin&utm_medium=onboarding_wizard&utm_campaign=onboarding_wizard_case_study_button',
        'knowledgeBaseUrl' => 'https://kb.wprssaggregator.com/',
        'feedEndpoint' => array(
            'url' => admin_url('admin-ajax.php'),
            'defaultPayload' => array(
                'action' => 'wprss_create_intro_feed',
                'nonce' => $nonce,
            ),
        ),
    ));

    echo wprss_render_template('admin/intro-page.twig', array(
        'title' => 'Welcome to WP RSS Aggregator ',
        'subtitle' => 'Follow these introductory steps to get started with WP RSS Aggregator.',
        'path' => array(
            'images' => WPRSS_IMG,
        ),
    ));
}

/**
 * AJAX handler for setting the introduction step the user has reached.
 *
 * @since 4.12
 */
add_action('wp_ajax_wprss_set_intro_step', function () {
    check_ajax_referer(WPRSS_INTRO_NONCE_NAME, 'nonce');
    if (!current_user_can('manage_options')) {
        wp_die('', '', array(
            'response' => 403,
        ));
    }

    $step = filter_input(INPUT_POST, WPRSS_INTRO_STEP_POST_PARAM, FILTER_VALIDATE_INT);

    if ($step === null) {
        wprss_ajax_error_response(
            sprintf(__('Missing intro step param "%s"', WPRSS_TEXT_DOMAIN), WPRSS_INTRO_STEP_POST_PARAM)
        );
    }

    wprss_set_intro_step($step);
    wprss_ajax_success_response(array(
        'wprss_intro_step' => $step,
    ));
});

/**
 * AJAX handler for creating a feed source from the introduction and previewing its items.
 *
 * @since 4.12
 */
add_action('wp_ajax_wprss_create_intro_feed', function () {
    check_ajax_referer(WPRSS_INTRO_NONCE_NAME, 'nonce');
    if (!current_user_can('manage_options')) {
        wp_die('', '', array(
            'response' => 403,
        ));
    }

    $url = filter_input(INPUT_POST, WPRSS_INTRO_FEED_URL_PARAM, FILTER_VALIDATE_URL);

    if ($url === null) {
        wprss_ajax_error_response(
            __('Missing feed URL parameter', WPRSS_TEXT_DOMAIN)
        );
    }
    if ($url === false) {
        wprss_ajax_error_response(
            __('The given feed URL is invalid', WPRSS_TEXT_DOMAIN)
        );
    }

    try {
        wp_schedule_single_event(time(), 'wprss_create_intro_feed_source', array($url));
        $items = wprss_preview_feed_items($url);
        $data = array(
            'feed_items' => $items,
        );
        wprss_set_intro_done(true);
        wprss_ajax_success_response($data);
    } catch (Exception $e) {
        wprss_ajax_error_response($e->getMessage(), 500);
    }
});

/**
 * Handler that redirects to the intro-created page that contains the WP RSS Aggregator shortcode.
 *
 * The page is created automatically if it doesn't exist.
 *
 * @since 4.12
 */
add_action('init', function () {
    if (!filter_input(INPUT_GET, WPRSS_INTRO_SHORTCODE_PAGE_PREVIEW_PARAM, FILTER_VALIDATE_BOOLEAN)) {
        return;
    }

    check_admin_referer(WPRSS_INTRO_NONCE_NAME, 'nonce');
    if (!current_user_can('manage_options')) {
        wp_die('', '', array(
            'response' => 403,
        ));
    }

    try {
        $id = wprss_get_intro_shortcode_page();
        $url = get_preview_post_link($id);

        if ($url === null) {
            throw new Exception('Failed to get the preview URL for the page');
        }

        wp_redirect($url);
    } catch (Exception $e) {
        wp_die($e->getMessage());
    }
});

/**
 * Previews a feed by fetching some feed items.
 *
 * @since 4.12
 *
 * @param string $url The URL of the feed source.
 * @param int    $max The maximum number of items to fetch.
 *
 * @return array An array of feed items, as associative arrays containing the following keys:
 *               * title - The feed title
 *               * permalink - The URL of the original article
 *               * date - The published date of the original article
 *               * author - The name of the author
 *
 * @throws Exception If failed to fetch the feed items.
 */
function wprss_preview_feed_items($url, $max = 10)
{
    $items = wprss_get_feed_items($url, null);

    if ($items === null) {
        throw new Exception(__('Failed to retrieve items'));
    }

    $count = 0;
    $results = array();
    foreach ($items as $item) {
        /* @var $item SimplePie_Item */
        $results[] = array(
            'title' => $item->get_title(),
            'permalink' => $item->get_permalink(),
            'date' => $item->get_date(get_option('date_format')),
            'author' => $item->get_author()->name,
        );

        if ($count++ > $max) {
            break;
        }
    }

    return $results;
}

add_action('wprss_create_intro_feed_source', 'wprss_create_intro_feed_source');
/**
 * Creates the feed source for the onboarding introduction process.
 *
 * @since 4.12
 *
 * @param string $url The URL.
 *
 * @return int The ID of the feed source.
 *
 * @throws Exception If an error occurred while creating the feed source.
 */
function wprss_create_intro_feed_source($url)
{
    $feedId = get_option(WPRSS_INTRO_FEED_ID_OPTION, 0);
    $feed = get_post($feedId, OBJECT);

    if ($feed === null || $feed->post_status != 'publish') {
        $newId = wprss_create_feed_source_with_url($url);
        update_post_meta($newId, 'wprss_limit', WPRSS_INTRO_FEED_LIMIT);
        update_option(WPRSS_INTRO_FEED_ID_OPTION, $newId);

        return $newId;
    }

    // Update the existing feed source with a new generated name and new URL
    wp_update_post(array(
        'ID' => $feedId,
        'post_title' => wprss_feed_source_name_from_url($url),
        'post_status' => 'publish',
        'meta_input' => array(
            'wprss_url' => $url,
            'wprss_limit' => WPRSS_INTRO_FEED_LIMIT
        )
    ));

    // Re-import the items for this feed
    wprss_delete_feed_items($feedId);
    wprss_fetch_insert_single_feed_items($feedId);

    return $feedId;
}

/**
 * Creates a feed source with a given URL.
 *
 * @since 4.12
 *
 * @param string $url The URL of the RSS feed.
 *
 * @return int The ID of the created feed source.
 *
 * @throws Exception If an error occurred while creating the feed source.
 */
function wprss_create_feed_source_with_url($url)
{
    $name = wprss_feed_source_name_from_url($url);
    $result = wprss_import_feed_sources_array(array($url => $name));

    if (empty($result)) {
        throw new Exception(
            sprintf(__('Failed to import the feed source "%s" with URL "%s"', WPRSS_TEXT_DOMAIN), $name, $url)
        );
    }

    if ($result[0] instanceof Exception) {
        throw $result[0];
    }

    return $result[0];
}

/**
 * Imports feed sources from an associative array.
 *
 * @since 4.12
 *
 * @param string[] $array An array of feed source URLs mapping to feed source names.
 *
 * @return array The import results. For each source representation (in order), the result will be one of:
 *               - Integer, representing the ID of the created resource;
 *               - An {@link Exception} if something went wrong during import.
 */
function wprss_import_feed_sources_array($array)
{
    /* @var $importer Aventura\Wprss\Core\Component\BulkSourceImport */
    $importer = wprss_wp_container()->get(\WPRSS_SERVICE_ID_PREFIX . 'array_source_importer');

    return $importer->import($array);
}

/**
 * Generates a feed source name from a feed source URL.
 *
 * @since 4.12
 *
 * @param string $url The URL.
 *
 * @return string The generated name.
 */
function wprss_feed_source_name_from_url($url)
{
    $feed = new SimplePie($url);
    $feed->enable_cache(false);
    $feed->init();

    $name = $feed->get_title();

    if (!empty($name)) {
        return $name;
    }

    $name = parse_url($url, PHP_URL_HOST);
    $name = ($name === null) ? $url : $name;

    return $name;
}

/**
 * Retrieves the ID of the page with the shortcode for the introduction, creating it if necessary.
 *
 * @since 4.12
 *
 * @return int The ID of the page.
 *
 * @throws Exception If failed to create the page.
 */
function wprss_get_intro_shortcode_page()
{
    $id = get_option(WPRSS_INTRO_SHORTCODE_PAGE_OPTION, 0);
    $page = get_post($id);

    if (!$page) {
        $id = wprss_create_shortcode_page();
        update_option(WPRSS_INTRO_SHORTCODE_PAGE_OPTION, $id);
    }

    return $id;
}

/**
 * Creates a page that contains the WP RSS Aggregator shortcode.
 *
 * @since 4.12
 *
 * @param string|null $title  Optional title for the page.
 * @param string      $status Optional status of the page.
 *
 * @return int The ID of the created page.
 *
 * @throws Exception If failed to create the page.
 */
function wprss_create_shortcode_page($title = null, $status = 'draft')
{
    $title = ($title === null)
        ? _x('Feeds', 'default name of shortcode page', WPRSS_TEXT_DOMAIN)
        : $title;

    $id = wp_insert_post(array(
        'post_type' => 'page',
        'post_title' => $title,
        'post_content' => '[wp-rss-aggregator]',
        'post_status' => $status,
    ));

    if (is_wp_error($id)) {
        throw new Exception($id->get_error_message(), $id->get_error_code());
    }

    return $id;
}

/**
 * Retrieves the step the user has reached in the introduction.
 *
 * @since 4.12
 *
 * @return int
 */
function wprss_get_intro_step()
{
    return get_option(WPRSS_INTRO_STEP_OPTION, 0);
}

/**
 * Sets the step the user has reached in the introduction.
 *
 * @since 4.12
 *
 * @param int $step A positive integer.
 */
function wprss_set_intro_step($step)
{
    update_option(WPRSS_INTRO_STEP_OPTION, max($step, 0));
}

/**
 * Retrieves the URL of the intro page.
 *
 * @since 4.12
 *
 * @return string
 */
function wprss_get_intro_page_url()
{
    return menu_page_url(WPRSS_INTRO_PAGE_SLUG, false);
}

/**
 * Checks whether the introduction should be shown or not, based on whether the user is new and has not already
 * previously done the introduction.
 *
 * @since 4.12
 *
 * @return bool True if the introduction should be shown, false if not.
 */
function wprss_should_do_intro_page()
{
    return wprss_is_new_user() && intval(get_option(WPRSS_INTRO_DID_INTRO_OPTION, 0)) !== 1 && current_user_can('manage_options');
}

/**
 * Sets the intro as done or not.
 *
 * @since 4.12
 *
 * @param bool $done True to mark the introduction as done, false to show the intro on the next plugin activation.
 */
function wprss_set_intro_done($done = true)
{
    update_option(WPRSS_INTRO_DID_INTRO_OPTION, '1', false);
}

/**
 * Checks if the user is new to WP RSS Aggregator.
 *
 * @since 4.12
 *
 * @return bool True if the user is new, false if not.
 */
function wprss_is_new_user()
{
    $now = time();
    $first = get_option(WPRSS_FIRST_ACTIVATION_OPTION, $now);
    // Check if user activated the plugin within the last minute
    return ($now - $first) < 60;
}

/**
 * Sends an AJAX success response.
 *
 * @since 4.12
 *
 * @param array $data   Optional data to send.
 * @param int   $status Optional HTTP status code of the response.
 */
function wprss_ajax_success_response($data = array(), $status = 200)
{
    echo json_encode(array(
        'success' => true,
        'error' => '',
        'data' => $data,
        'status' => $status,
    ));
    wp_die();
}

/**
 * Sends an AJAX success response.
 *
 * @since 4.12
 *
 * @param string $message Optional error message.
 * @param int    $status  Optional HTTP status code of the response.
 */
function wprss_ajax_error_response($message, $status = 400)
{
    echo json_encode(array(
        'success' => false,
        'error' => $message,
        'data' => array(),
        'status' => $status,
    ));
    wp_die();
}


File Name:
admin-log.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-log.php
Code:
<?php

use Psr\Log\LoggerInterface;
use Psr\Log\LogLevel;
use RebelCode\Wpra\Core\Logger\ClearableLoggerInterface;
use RebelCode\Wpra\Core\Logger\FeedLoggerInterface;
use RebelCode\Wpra\Core\Logger\LogReaderInterface;

define('WPRSS_OPTION_CODE_LOG_LEVEL', 'log_level');
define('WPRSS_LOG_LEVEL_SYSTEM', LogLevel::DEBUG);
define('WPRSS_LOG_LEVEL_INFO', LogLevel::INFO);
define('WPRSS_LOG_LEVEL_NOTICE', LogLevel::NOTICE);
define('WPRSS_LOG_LEVEL_WARNING', LogLevel::WARNING);
define('WPRSS_LOG_LEVEL_ERROR', LogLevel::ERROR);

define('WPRSS_LOG_LEVEL_NONE', WPRSS_LOG_LEVEL_INFO);
define('WPRSS_LOG_LEVEL_DEFAULT', WPRSS_LOG_LEVEL_NONE);

/**
 * Returns the logger.
 *
 * @since 4.13
 *
 * @param int|string|null $feed_id Optional feed ID to retrieve the logger for that feed source.
 *
 * @return LoggerInterface|ClearableLoggerInterface|LogReaderInterface
 */
function wpra_get_logger($feed_id = null)
{
    $logger = wpra_container()->get('wpra/logging/logger');

    return ($feed_id !== null && $logger instanceof FeedLoggerInterface)
        ? $logger->forFeedSource($feed_id)
        : $logger;
}

/**
 * Reads a certain amount of data from the log file.
 *
 * By default, reads that data from the end of the file.
 *
 * @since 4.10
 *
 * @param null|int $length How many characters at most to read from the log.
 *                         Default: {@see WPRSS_LOG_DISPLAY_LIMIT}.
 * @param null|int $start  Position, at which to start reading.
 *                         If negative, represents that number of chars from the end.
 *                         Default: The amount of characters equal to $length away from the end of the file,
 *                         or the beginning of the file if the size of the file is less than or equal to $length.
 *
 * @return string|bool The content of the log, or false if the read operation failed.
 */
function wprss_log_read($length = null, $start = null)
{
    /* @var $reader LogReaderInterface */
    $reader = wpra_container()->get('wpra/logging/reader');
    $logs = $reader->getLogs($length, $start);

    $output = '';
    foreach ($logs as $log) {
        $output .= sprintf('[%s] %s: %s', $log['date'], $log['level'], $log['message']) . PHP_EOL;
    }

    return $output;
}

/**
 * Returns the contents of the log file.
 *
 * @since 3.9.6
 */
function wprss_get_log()
{
    return wprss_log_read();
}

/**
 * Clears the log file.
 *
 * @since 3.9.6
 */
function wprss_clear_log()
{
    /* @var $clearer ClearableLoggerInterface */
    $clearer = wpra_container()->get('wpra/logging/clearer');
    $clearer->clearLogs();
}

/**
 * Alias for wprss_clear_log().
 *
 * Used for code readability.
 *
 * @since 3.9.6
 */
function wprss_reset_log()
{
    wprss_clear_log();
}

/**
 * Adds a log entry to the log file.
 *
 * @since 3.9.6
 */
function wprss_log($message, $src = null, $log_level = null)
{
    $log_level = ($log_level === null)
        ? LogLevel::DEBUG
        : $log_level;

    wpra_get_logger()->log($log_level, $message);
}

/**
 * Dumps an object to the log file.
 *
 * @since 3.9.6
 */
function wprss_log_obj($message, $obj, $src = '', $log_level = null)
{
    $message = sprintf('%s: %s', $message, print_r($obj, true));

    wprss_log($message, $src, $log_level);
}

/**
 * Downloads the log file.
 *
 * @since 4.7.8
 */
function wprss_download_log()
{
    $log = wprss_log_read();

    header('Content-Description: File Transfer');
    header('Content-type: text/plain');
    header('Content-Disposition: attachment; filename="wpra-log.txt"');
    header('Expires: 0');
    header('Cache-Control: must-revalidate');
    header('Pragma: public');
    header('Content-Length: ' . strlen($log));
    echo $log;
    exit;
}


File Name:
admin-metaboxes.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-metaboxes.php
Code:
<?php

    add_action( 'add_meta_boxes', function () {
        // Remove some plugin's metaboxes because they're not relevant to the wprss_feed post type.
        wprss_remove_unrelated_meta_boxes();

        // Remove the default WordPress Publish box, because we will be using custom ones
        remove_meta_box( 'submitdiv', 'wprss_feed', 'side' );
        // Custom Publish box
        add_meta_box(
            'submitdiv',
            __( 'Save Feed Source', WPRSS_TEXT_DOMAIN ),
            'post_submit_meta_box',
            'wprss_feed',
            'side',
            'high'
        );
    });

    add_action( 'add_meta_boxes', 'wprss_add_meta_boxes', 99);
    /**
     * Set up the input boxes for the wprss_feed post type
     *
     * @since 2.0
     */
    function wprss_add_meta_boxes() {
        global $wprss_meta_fields;

        add_meta_box(
            'preview_meta_box',
            __( 'Feed Preview', WPRSS_TEXT_DOMAIN ),
            'wprss_preview_meta_box_callback',
            'wprss_feed',
            'side',
            'high'
        );

         add_meta_box(
            'wprss-feed-processing-meta',
            __( 'Feed Processing', WPRSS_TEXT_DOMAIN ),
            'wprss_feed_processing_meta_box_callback',
            'wprss_feed',
            'side',
            'high'
        );

        if ( !defined('WPRSS_FTP_VERSION') && !defined('WPRSS_ET_VERSION') && !defined('WPRSS_C_VERSION') ) {
            add_meta_box(
                'wprss-like-meta',
                __( 'Share The Love', WPRSS_TEXT_DOMAIN ),
                'wprss_like_meta_box_callback',
                'wprss_feed',
                'side',
                'low'
            );
        }

        add_meta_box(
            'custom_meta_box',
            __( 'Feed Source Details', WPRSS_TEXT_DOMAIN ),
            'wprss_show_meta_box_callback',
            'wprss_feed',
            'normal',
            'high'
        );

    }


    /**
     * Removes some other plugin's metaboxes because they're not relevant to the wprss_feed post type.
     *
     * @since 4.7
     */
    function wprss_remove_unrelated_meta_boxes() {
        $post_type = 'wprss_feed';
        remove_meta_box( 'wpseo_meta', $post_type, 'normal');                 // WP SEO Yoast
        remove_meta_box( 'ta-reviews-post-meta-box', $post_type, 'normal');   // Author hReview
        remove_meta_box( 'wpdf_editor_section', $post_type, 'advanced');      // ImageInject
    }


    /**
     * Set up fields for the meta box for the wprss_feed post type
     *
     * @since 2.0
     */
    function wprss_get_custom_fields() {
        $prefix = 'wprss_';

        // Field Array
        $wprss_meta_fields[ 'url' ] = array(
            'label'			=> __( 'URL', WPRSS_TEXT_DOMAIN ),
            'id'			=> $prefix .'url',
            'type'			=> 'url',
            'after'			=> 'wprss_after_url',
			'placeholder'	=>	'https://'
        );

        $wprss_meta_fields[ 'limit' ] = array(
            'label' => __( 'Limit', WPRSS_TEXT_DOMAIN ),
            'id'    => $prefix . 'limit',
            'type'  => 'number'
        );

        $wprss_meta_fields[ 'unique_titles' ] = array(
            'label' => __( 'Unique titles only', WPRSS_TEXT_DOMAIN ),
            'id'    => $prefix . 'unique_titles',
            'type'  => 'select',
            'options' => [
                ['value' => '', 'label' => 'Default'],
                ['value' => '1', 'label' => 'Yes'],
                ['value' => '0', 'label' => 'No'],
            ]
        );

        $wprss_meta_fields[ 'enclosure' ] = array(
            'label' => __( 'Link to enclosure', WPRSS_TEXT_DOMAIN ),
            'id'    => $prefix . 'enclosure',
            'type'  => 'checkbox'
        );

        if (wprss_is_et_active()) {
            $wprss_meta_fields[ 'source_link' ] = array(
                'label' => __( 'Link source', WPRSS_TEXT_DOMAIN ),
                'id'    => $prefix . 'source_link',
                'type'  => 'boolean_fallback'
            );
        }

        $wprss_meta_fields[ 'import_source' ] = array(
            'label'   => __( 'Use source info', WPRSS_TEXT_DOMAIN ),
            'id'      => $prefix . 'import_source',
            'type'    => 'checkbox',
        );

        // for extensibility, allows more meta fields to be added
        return apply_filters( 'wprss_fields', $wprss_meta_fields );
    }


    /**
     * Set up the meta box for the wprss_feed post type
     *
     * @since 2.0
     */
    function wprss_show_meta_box_callback() {
        global $post;
        $meta_fields = wprss_get_custom_fields();
		$field_tooltip_id_prefix = 'field_';
		$help = WPRSS_Help::get_instance();

        // Use nonce for verification
        wp_nonce_field( 'wpra_feed_source', 'wprss_meta_box_nonce' );

            // Fix for WordpRess SEO JS issue
            ?><input type="hidden" id="content" value="" /><?php

            // Begin the field table and loop
            ?><table class="form-table wprss-form-table"><?php

            foreach ( $meta_fields as $field ) {
                // get value of this field if it exists for this post
                $meta = get_post_meta( $post->ID, $field['id'], true );
                // begin a table row with
                ?><tr>
                        <th><label for="<?php echo $field['id'] ?>"><?php echo $field['label'] /* Should be already translated */ ?></label></th>
                        <td><?php

                        if ( isset( $field['before'] ) && !empty( $field['before'] ) ) {
                            call_user_func( $field['before'] );
                        }

						// Add default placeholder value
						$field = wp_parse_args( $field, array(
                            'desc'          => '',
                            'placeholder'   => '',
                            'type'          => 'text'
                        ) );

						$tooltip = isset( $field['tooltip'] ) ? trim( $field['tooltip'] ) : null;
						$tooltip_id = isset( $field['id'] ) ? $field_tooltip_id_prefix . $field['id'] : uniqid( $field_tooltip_id_prefix );

						$field_description = __( $field['desc'], WPRSS_TEXT_DOMAIN );

						/*
						 * So, here's how tooltips work here.
						 * Tooltip output will be attempted in any case.
						 * If 'tooltip' index is not defined, or is null, then
						 * a registered tooltip will be attempted. If that is
						 * not found, default value will be output. This value
						 * is by default an empty string, but can be altered
						 * by the `tooltip_not_found_handle_html` option of `WPRSS_Help`.
						 */

                        switch( $field['type'] ) {

                            // text/url
                            case 'url':
                            case 'text':
                                ?><input type="<?php echo $field['type'] ?>" name="<?php echo $field['id'] ?>" id="<?php echo $field['id'] ?>" value="<?php echo esc_attr( $meta ) ?>" placeholder="<?php _e( $field['placeholder'], WPRSS_TEXT_DOMAIN ) ?>" class="wprss-text-input"/><?php
								echo $help->tooltip( $tooltip_id, $tooltip );
                                if ( strlen( trim( $field['desc'] ) ) > 0 ) {
                                    ?><br /><label for="<?php echo $field['id'] ?>"><span class="description"><?php _e( $field['desc'], WPRSS_TEXT_DOMAIN ) ?></span></label><?php
                                }
                            break;

                            // textarea
                            case 'textarea':
                                ?><textarea name="<?php echo $field['id'] ?>" id="<?php echo $field['id'] ?>" cols="60" rows="4"><?php echo esc_attr( $meta ) ?></textarea><?php
                                echo $help->tooltip( $tooltip_id, $tooltip );
                                if ( strlen( trim( $field['desc'] ) ) > 0 ) {
                                    ?><br /><label for="<?php echo $field['id'] ?>"><span class="description"><?php echo $field_description ?></span></label><?php
                                }
                            break;

                            // checkbox
                            case 'checkbox':
                                ?>
								<input type="hidden" name="<?php echo $field['id'] ?>" value="false" />
                                <input type="checkbox" name="<?php echo $field['id'] ?>" id="<?php echo $field['id'] ?>" value="true" <?php checked( $meta, 'true' ) ?> />
                                <?php
                                echo $help->tooltip( $tooltip_id, $tooltip );
                                if ( strlen( trim( $field['desc'] ) ) > 0 ) {
                                    ?><label for="<?php echo $field['id'] ?>"><span class="description"><?php echo $field_description ?></span></label><?php
                                }
                            break;

                            // improved checkbox
                            case 'checkbox2':
                                ?>
                                <input type="hidden" name="<?php echo $field['id'] ?>" value="0" />
                                <input type="checkbox"
                                       id="<?php echo $field['id'] ?>"
                                       name="<?php echo $field['id'] ?>"
                                       value="1"
                                        <?php checked( $meta, '1' ) ?>
                                />
                                <?php
                                echo $help->tooltip( $tooltip_id, $tooltip );
                                if ( strlen( trim( $field['desc'] ) ) > 0 ) {
                                    ?><label for="<?php echo $field['id'] ?>"><span class="description"><?php echo $field_description ?></span></label><?php
                                }
                                break;

                            // select
                            case 'select':
								?><select name="<?php echo $field['id'] ?>" id="<?php $field['id'] ?>"><?php
                                foreach ($field['options'] as $option) {
                                    ?><option<?php if ( $meta == $option['value'] ): ?> selected="selected"<?php endif ?> value="<?php echo $option['value'] ?>"><?php echo $option['label'] ?></option><?php
                                }

                                ?></select><?php
								echo $help->tooltip( $tooltip_id, $tooltip );
								if ( strlen( trim( $field['desc'] ) ) > 0 ) {
                                    ?><label for="<?php echo $field['id'] ?>"><span class="description"><?php echo $field_description ?></span></label><?php
                                }
                            break;

                            // A select with "On" and "Off" values, and a special option to fall back to General setting
                            case 'boolean_fallback':
                                $options = wprss_settings_get_feed_source_boolean_options();
                                if ($meta === '') {
                                    $meta = -1;
                                }
                                echo wprss_settings_render_select($field['id'], $field['id'], $options, $meta);
								echo $help->tooltip( $tooltip_id, $tooltip );
                            break;

                            // number
                            case 'number':
                                ?><input class="wprss-number-roller" type="number" placeholder="<?php _e( 'Default', WPRSS_TEXT_DOMAIN ) ?>" min="0" name="<?php echo $field['id'] ?>" id="<?php echo $field['id'] ?>" value="<?php echo esc_attr( $meta ) ?>" /><?php
								echo $help->tooltip( $tooltip_id, $tooltip );
                                if ( strlen( trim( $field['desc'] ) ) > 0 ) {
                                    ?><label for="<?php echo $field['id'] ?>"><span class="description"><?php echo $field_description ?></span></label><?php
                                }
                            break;

                        } //end switch

                        if ( isset( $field['after'] ) && !empty( $field['after'] ) ) {
                            call_user_func( $field['after'] );
                        }

                ?></td></tr><?php
            } // end foreach
            ?></table><?php
    }


    /**
     * Renders content after the URL field
     *
     * @since 3.9.5
     */
    function wprss_after_url() {
        ?>
            <i id="wprss-url-spinner" class="fa fa-fw fa-refresh fa-spin wprss-updating-feed-icon" title="<?php _e( 'Updating feed source', WPRSS_TEXT_DOMAIN ) ?>"></i>
            <div id="wprss-url-error" style="color:red"></div>
            <a href="#" id="validate-feed-link" class="wprss-after-url-link">Validate feed</a>
            <span> | </span>
            <a href="https://kb.wprssaggregator.com/article/55-how-to-find-an-rss-feed"
               class="wprss-after-url-link"
                target="_blank">
                <?= __('How to find an RSS feed', 'wprss') ?>
            </a>
            <script type="text/javascript">
                (function($){
                    // When the DOM is ready
                    $(document).ready( function(){
                        // Move the link immediately after the url text field, and add the click event handler
                        $('#validate-feed-link').click(function(e){
                            // Get the url and proceed only if the url is not empty
                            var url = $('#wprss_url').val();
                            if ( url.trim().length > 0 ) {
                                // Encode the url and generate the full url to the w3 feed validator
                                var encodedUrl = encodeURIComponent( url );
                                var fullURL = 'https://validator.w3.org/feed/check.cgi?url=' + encodedUrl;
                                // Open the window / tab
                                window.open( fullURL, 'wprss-feed-validator' );
                            }
                            // Suppress the default link click behaviour
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        });
                    });
                })(jQuery);
            </script>
        <?php
    }



    add_action( 'save_post', 'wprss_save_custom_fields', 10, 2 );
    /**
     * Save the custom fields
     *
     * @since 2.0
     */
    function wprss_save_custom_fields( $post_id, $post ) {
        $meta_fields = wprss_get_custom_fields();

        /* Verify the nonce before proceeding. */
        if ( !isset( $_POST['wprss_meta_box_nonce'] ) ||
             !wp_verify_nonce( $_POST['wprss_meta_box_nonce'], 'wpra_feed_source' ) ) {
            return $post_id;
        }

        /* Get the post type object. */
        $post_type = get_post_type_object( $post->post_type );

        /* Check if the current user has permission to edit the post. */
        if ( !current_user_can( $post_type->cap->edit_post, $post_id ) )
            return $post_id;

     /*  // Stop WP from clearing custom fields on autosave - maybe not needed
        if (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)
            return;

        // Prevent quick edit from clearing custom fields - maybe not needed
        if (defined('DOING_AJAX') && DOING_AJAX)
            return;     */

        /** Bail out if running an autosave, ajax or a cron */
        if ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE )
            return;
        if ( defined( 'DOING_AJAX' ) && DOING_AJAX )
            return;
        if ( defined( 'DOING_CRON' ) && DOING_CRON )
            return;

        $postType = class_exists('WPRSS_FTP_Meta')
            ? WPRSS_FTP_Meta::get_instance()->get($post_id, 'post_type')
            : 'wprss_feed_item';

        if ($postType === 'wprss_feed_item' && isset($_POST['wpra_feed_def_ft_image']) ) {
            $def_ft_image_id = $_POST['wpra_feed_def_ft_image'];

            if (empty($def_ft_image_id)) {
                // Does not actually delete the image
                delete_post_thumbnail( $post_id );
            } else {
                set_post_thumbnail( $post_id, $def_ft_image_id );
            }
        }

        // Change the limit, if it is zero, to an empty string
        if ( isset( $_POST['wprss_limit'] ) && strval( $_POST['wprss_limit'] ) == '0' ) {
            $_POST['wprss_limit'] = '';
        }

        // loop through fields and save the data
        foreach ( $meta_fields as $field ) {
            $old = get_post_meta( $post_id, $field[ 'id' ], true );
            $new = trim( $_POST[ $field[ 'id' ] ] );
            if ( $new !== $old || empty($old) ) {
                update_post_meta( $post_id, $field[ 'id' ], $new );
            } elseif ( empty($new) && !empty($old) ) {
                delete_post_meta( $post_id, $field[ 'id' ], $old );
            }
        } // end foreach

        $force_feed = filter_input(INPUT_POST, 'wprss_force_feed', FILTER_VALIDATE_BOOLEAN) ? 'true' : 'false';

        $state = filter_input(INPUT_POST, 'wprss_state', FILTER_SANITIZE_STRING);
        $state = strtolower(trim($state)) === 'paused' ? 'paused' : 'active';

        $activate = filter_input(INPUT_POST, 'wprss_activate_feed', FILTER_SANITIZE_STRING);
        $activate = $activate ? : '';

        $pause = filter_input(INPUT_POST, 'wprss_pause_feed', FILTER_SANITIZE_STRING);
        $pause = $pause ? : '';

        $age_limit = filter_input(INPUT_POST, 'wprss_age_limit', FILTER_VALIDATE_INT);
        $age_limit = (is_int($age_limit) && $age_limit > 0) ? (string) $age_limit : '';

        $age_unit = filter_input(INPUT_POST, 'wprss_age_unit', FILTER_SANITIZE_STRING);
        $age_unit = $age_unit ? strtolower($age_unit) : '';
        $age_unit = in_array($age_unit, wprss_age_limit_units()) ? $age_unit : '';

        $update_interval = filter_input(INPUT_POST, 'wprss_update_interval', FILTER_SANITIZE_STRING);
        $update_interval = $update_interval ? $update_interval : wprss_get_default_feed_source_update_interval();
        $old_update_interval = get_post_meta( $post_id, 'wprss_update_interval', TRUE );

        // Update the feed source meta
        update_post_meta( $post_id, 'wprss_force_feed', $force_feed );
        update_post_meta( $post_id, 'wprss_activate_feed', $activate );
        update_post_meta( $post_id, 'wprss_pause_feed', $pause );
        update_post_meta( $post_id, 'wprss_age_limit', $age_limit );
        update_post_meta( $post_id, 'wprss_age_unit', $age_unit );
        update_post_meta( $post_id, 'wprss_update_interval', $update_interval );

        // Check if the state or the update interval has changed
        if ( get_post_meta( $post_id, 'wprss_state', TRUE ) !== $state || $old_update_interval !== $update_interval ) {
            // Pause the feed source, and if it is active, re-activate it.
            // This should update the feed's scheduling
            wprss_pause_feed_source( $post_id );
            if ( $state === 'active' )
                wprss_activate_feed_source( $post_id );
        }

        // Update the schedules
        wprss_update_feed_processing_schedules( $post_id );

        // If the feed source uses the global updating system, update the feed on publish
        if ( $update_interval === wprss_get_default_feed_source_update_interval() ) {
            wp_schedule_single_event( time(), 'wprss_fetch_single_feed_hook', array( $post_id ) );
        }
    }


    /**
     * Generate a preview of the latest 5 posts from the feed source being added/edited
     *
     * @since 2.0
     */
    function wprss_preview_meta_box_callback() {
        global $post;
        $feed_url = get_post_meta( $post->ID, 'wprss_url', true );

		$help = WPRSS_Help::get_instance();
		/* @var $help WPRSS_Help */

        echo '<div id="feed-preview-container">';

        if ( ! empty( $feed_url ) ) {
            $feed = wprss_fetch_feed( $feed_url, $post->ID );
            if ( ! is_wp_error( $feed ) ) {
                ob_start();
                // Figure out how many total items there are
                $total = @$feed->get_item_quantity();
                // Get the number of items again, but limit it to 5.
                $maxitems = $feed->get_item_quantity(5);

                // Build an array of all the items, starting with element 0 (first element).
                $items = $feed->get_items( 0, $maxitems );
                ob_clean();
                ?>
				<h4><?php echo sprintf( __( 'Latest %1$s feed items out of %2$s available from %3$s' ), $maxitems, $total, get_the_title() ) ?></h4>
                <ul>
				<?php
                foreach ( $items as $item ) {
                    $date = $item->get_date( 'U' );
                    $has_date = $date ? true : false;

                    // Get human date
                    if ( $has_date ) {
                        $item_date = human_time_diff( $date, current_time('timestamp')).' '.__( 'ago', 'wprss' );
                    } else {
                        $item_date = '<em>[' . __( 'No Date', WPRSS_TEXT_DOMAIN ) . ']</em>';
                    }

                    // Start displaying item content within a <li> tag
                    echo '<li>';
                    // create item link
                    //echo '<a href="'.esc_url( $item->get_permalink() ).'" title="'.$item_date.'">';
                    // Get item title
                    echo esc_html( $item->get_title() );
                    //echo '</a>';
                    // Display date
                    echo ' <div class="rss-date"><small>'.$item_date.'</small></div>';
                    // End <li> tag
                    echo '</li>';
                }
                ?>
				</ul>
				<?php
            }
            else {
                ?>
                <span class="invalid-feed-url">
                    <?php _e( '<strong>Invalid feed URL</strong> - Double check the feed source URL setting above.', WPRSS_TEXT_DOMAIN ) ?>
                    <?php wprss_log_obj( 'Failed to preview feed.', $feed->get_error_message(), NULL, WPRSS_LOG_LEVEL_INFO ); ?>
                </span>
				<?php
				echo wpautop(
				        sprintf(
				                __('Not sure where to find the RSS feed on a website? <a target="_blank" href="%1$s">Click here</a> for a visual guide.', 'wprss'),
                                'https://kb.wprssaggregator.com/article/55-how-to-find-an-rss-feed'
                        )
                );
            }
            
        }
        else {
            echo '<p>' . __( 'No feed URL defined yet', WPRSS_TEXT_DOMAIN ) . '</p>';
        }
        echo '</div>';

        echo '<div id="force-feed-container">';
        wprss_render_force_feed_option( $post->ID, TRUE );
        echo '</div>';
    }


    /**
     * Renders the Force Feed option for the Feed Preview.
     *
     * @param int|string $feed_source_id (Optional) The ID of the feed source for the option will be rendered. If not given or
     *                                   its value is null, the option will not be checked.
     * @param bool       $echo           (Optional) If set to true, the function will immediately echo the option,
     *                                   rather than return a string of the option's markup. Default: False.
     * @return string|null               A string containing the HTML for the rendered option if $echo is set to false,
     *                                   or null if $echo is set to true.
     * @since 4.6.12
     */
    function wprss_render_force_feed_option( $feed_source_id = NULL, $echo = FALSE ) {
        if ( ! $echo ) ob_start();
        $force_feed = $feed_source_id === NULL ? '' : get_post_meta( $feed_source_id, 'wprss_force_feed', TRUE ); ?>
        <p>
            <label for="wprss-force-feed"><?php _e('Force the feed') ?></label>
            <input type="hidden" name="wprss_force_feed" value="false" />
            <input type="checkbox" name="wprss_force_feed" id="wprss-force-feed" value="true" <?php echo checked( $force_feed, 'true' ); ?> />
            <?php echo WPRSS_Help::get_instance()->tooltip( 'field_wprss_force_feed' ) ?>
        </p>
        <?php
        if ( ! $echo ) return ob_get_clean();
        return NULL;
    }


    /**
     * Renders the Feed Processing metabox
     *
     * @since 3.7
     */
    function wprss_feed_processing_meta_box_callback() {
        global $post;
        // Get the post meta
        $state = get_post_meta( $post->ID, 'wprss_state', TRUE );
        $activate = get_post_meta( $post->ID, 'wprss_activate_feed', TRUE );
        $pause = get_post_meta( $post->ID, 'wprss_pause_feed', TRUE );
        $update_interval = get_post_meta( $post->ID, 'wprss_update_interval', TRUE );
        $update_time = get_post_meta( $post->ID, 'wprss_update_time', TRUE );

        $age_limit = get_post_meta( $post->ID, 'wprss_age_limit', true );
        $age_unit = get_post_meta( $post->ID, 'wprss_age_unit', true );

        // Set default strings for activate and pause times
        $default_activate = 'immediately';
        $default_pause = 'never';

        // Prepare the states
        $states = array(
            'active'    =>  __( 'Active', WPRSS_TEXT_DOMAIN ),
            'paused'    =>  __( 'Paused', WPRSS_TEXT_DOMAIN ),
        );

        // Prepare the schedules
        $default_interval = __( 'Default', WPRSS_TEXT_DOMAIN );
        $wprss_schedules = apply_filters( 'wprss_schedules', wprss_get_schedules() );
        $default_interval_key = wprss_get_default_feed_source_update_interval();
        $schedules = array_merge(
            array(
                $default_interval_key => array(
                    'display'   =>  $default_interval,
                    'interval'  =>  $default_interval,
                ),
            ),
            $wprss_schedules
        );

		// Inline help
		$help = WPRSS_Help::get_instance();
		$help_options = array('tooltip_handle_class_extra' => $help->get_options('tooltip_handle_class_extra') . ' ' . $help->get_options('tooltip_handle_class') . '-side');

        ?>

        <div class="wprss-meta-side-setting">
            <label for="wprss_state">Feed state:</label>
            <select id="wprss_state" name="wprss_state">
                <?php foreach( $states as $value => $label ) : ?>
                    <option value="<?php echo $value; ?>" <?php selected( $state, $value ) ?> ><?php echo $label; ?></option>
                <?php endforeach; ?>
            </select>
			<?php echo $help->tooltip( 'field_wprss_state', null, $help_options ) ?>
        </div>

        <div class="wprss-meta-side-setting">
            <p>
                <label for="">Activate feed: </label>
                <strong id="wprss-activate-feed-viewer"><?php echo ( ( $activate !== '' )? $activate : $default_activate ); ?></strong>
                <a href="#">Edit</a>
				<?php echo $help->tooltip( 'field_wprss_activate_feed', null, $help_options ) ?>
            </p>
            <div class="wprss-meta-slider" data-collapse-viewer="wprss-activate-feed-viewer" data-default-value="<?php echo $default_activate; ?>">
                <input id="wprss_activate_feed" class="wprss-datetimepicker-from-today" name="wprss_activate_feed" value="<?php echo $activate; ?>" />
                <span class="description">
                    Current UTC time is:<br/><code><?php echo date( 'd/m/Y H:i:s', current_time('timestamp',1) ); ?></code>
                </span>
            </div>
        </div>

        <div class="wprss-meta-side-setting">
            <p>
                <label for="">Pause feed: </label>
                <strong id="wprss-pause-feed-viewer"><?php echo ( ( $pause !== '' )? $pause : $default_pause ); ?></strong>
                <a href="#">Edit</a>
				<?php echo $help->tooltip( 'field_wprss_pause_feed', null, $help_options ) ?>
            </p>
            <div class="wprss-meta-slider" data-collapse-viewer="wprss-pause-feed-viewer" data-default-value="<?php echo $default_pause; ?>">
                <input id="wprss_pause_feed" class="wprss-datetimepicker-from-today" name="wprss_pause_feed" value="<?php echo $pause; ?>" />
                <span class="description">
                    Current UTC time is:<br/><code><?php echo date( 'd/m/Y H:i:s', current_time('timestamp',1) ); ?></code>
                </span>
            </div>
        </div>


        <div class="wprss-meta-side-setting">
            <p>
                <label for="">Update interval: </label>
                <strong id="wprss-feed-update-interval-viewer">
                    <?php
                        if ( $update_interval === '' || $update_interval === wprss_get_default_feed_source_update_interval() ) {
                            echo $default_interval;
                        }
                        else {
                            echo wprss_interval( $schedules[$update_interval]['interval'] );
                        }
                    ?>
                </strong>
                <a href="#">Edit</a>
				<?php echo $help->tooltip( 'field_wprss_update_interval', null, $help_options ) ?>
            </p>
            <div class="wprss-meta-slider" data-collapse-viewer="wprss-feed-update-interval-viewer" data-default-value="<?php echo $default_interval; ?>">
                <select id="feed-update-interval" name="wprss_update_interval">
                <?php foreach ( $schedules as $value => $schedule ) : ?>
                    <?php $text = ( $value === wprss_get_default_feed_source_update_interval() )? $default_interval : wprss_interval( $schedule['interval'] ); ?>
                    <option value="<?php echo $value; ?>" <?php selected( $update_interval, $value ); ?> ><?php echo $text; ?></option>
                <?php endforeach; ?>
                </select>
                <label>
                    <input type="time" name="wpra_feed[update_time]" value="<?php echo esc_attr($update_time); ?>">
                </label>
            </div>
        </div>


        <div class="wprss-meta-side-setting">
            <p>
                <label id="wprss-age-limit-feed-label" for="" data-when-empty="Limit items by age:">
                    <?php _e( 'Limit items by age:', 'wprss' ); ?>
                </label>
                <strong id="wprss-age-limit-feed-viewer">
                    <?php _e( 'Default', WPRSS_TEXT_DOMAIN ); ?>
                </strong>
                <a href="#">Edit</a>
				<?php echo $help->tooltip( 'field_wprss_age_limit', null, $help_options ) ?>
            </p>
            <div class="wprss-meta-slider" data-collapse-viewer="wprss-age-limit-feed-viewer" data-label="#wprss-age-limit-feed-label" data-default-value="" data-empty-controller="#limit-feed-items-age" data-hybrid="#limit-feed-items-age, #limit-feed-items-age-unit">
                <input id="limit-feed-items-age" name="wprss_age_limit" type="number" min="0" class="wprss-number-roller" placeholder="No limit" value="<?php echo $age_limit; ?>" />

                <select id="limit-feed-items-age-unit" name="wprss_age_unit">
                <?php foreach ( wprss_age_limit_units() as $unit ) : ?>
                    <option value="<?php echo $unit; ?>" <?php selected( $age_unit, $unit ); ?> ><?php echo $unit; ?></option>
                <?php endforeach; ?>
                </select>
            </div>
        </div>


        <?php
    }



    /**
     * Generate Help meta box
     *
     * @since 2.0
     *
     */
    function wprss_help_meta_box_callback() {
       echo '<p><a href="https://www.wprssaggregator.com/documentation/">View the documentation</p>';
       echo '<p><strong>';
       _e( 'Need help?', WPRSS_TEXT_DOMAIN );
       echo '</strong> <a target="_blank" href="https://wordpress.org/support/plugin/wp-rss-aggregator">';
       _e( 'Check out the support forum', WPRSS_TEXT_DOMAIN );
       echo '</a></p>';
       echo '</strong> <a target="_blank" href="https://www.wprssaggregator.com/feature-requests/">';
       _e( 'Suggest a new feature', WPRSS_TEXT_DOMAIN );
       echo '</a></p>';
    }

    /**
     * Generate Like this plugin meta box
     *
     * @since 2.0
     *
     */
    function wprss_like_meta_box_callback()
    {
        ?>
        <ul>
            <li><a href="https://wordpress.org/support/view/plugin-reviews/wp-rss-aggregator?rate=5#postform" target="_blank"><?php _e( 'Give it a 5 star rating on WordPress.org', WPRSS_TEXT_DOMAIN ) ?></a></li>
        </ul>
        <?php
        do_action('wpra_share_the_love_metabox');
    }


    /**
     * Generate Follow us plugin meta box
     *
     * @since 2.0
     *
     */
    function wprss_follow_meta_box_callback() {
        ?>
        <ul>
            <li class="twitter"><a href="https://twitter.com/wpmayor"><?php _e( 'Follow WP Mayor on Twitter.', WPRSS_TEXT_DOMAIN ) ?></a></li>
            <li class="facebook"><a href="https://www.facebook.com/wpmayor"><?php _e( 'Like WP Mayor on Facebook.', WPRSS_TEXT_DOMAIN ) ?></a></li>
        </ul>
    <?php }


    add_action( 'add_meta_boxes', 'wprss_remove_meta_boxes', 100 );
    /**
     * Remove unneeded meta boxes from add feed source screen
     *
     * @since 2.0
     */
    function wprss_remove_meta_boxes() {
        if ( 'wprss_feed' !== get_current_screen()->id ) return;
        // Remove meta boxes of other plugins that tend to appear on all posts
        //remove_meta_box( 'wpseo_meta', 'wprss_feed' ,'normal' );
        remove_meta_box( 'postpsp', 'wprss_feed' ,'normal' );
        remove_meta_box( 'su_postmeta', 'wprss_feed' ,'normal' );
        remove_meta_box( 'woothemes-settings', 'wprss_feed' ,'normal' );
        remove_meta_box( 'wpcf-post-relationship', 'wprss_feed' ,'normal' );
        remove_meta_box( 'wpar_plugin_meta_box ', 'wprss_feed' ,'normal' );
        remove_meta_box( 'sharing_meta', 'wprss_feed' ,'advanced' );
        remove_meta_box( 'content-permissions-meta-box', 'wprss_feed' ,'advanced' );
        remove_meta_box( 'theme-layouts-post-meta-box', 'wprss_feed' ,'side' );
        remove_meta_box( 'post-stylesheets', 'wprss_feed' ,'side' );
        remove_meta_box( 'hybrid-core-post-template', 'wprss_feed' ,'side' );
        remove_meta_box( 'wpcf-marketing', 'wprss_feed' ,'side' );
        remove_meta_box( 'trackbacksdiv22', 'wprss_feed' ,'advanced' );
        remove_meta_box( 'aiosp', 'wprss_feed' ,'advanced' );
        remove_action( 'post_submitbox_start', 'fpp_post_submitbox_start_action' );
    }


File Name:
admin-options-legacy.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-options-legacy.php
Code:
<?php

add_action('plugins_loaded', function () {
    if (defined('WPRSS_ET_VERSION')) {
        add_filter('wprss_settings_sections_array', 'wpra_add_legacy_display_settings_sections');
    }
});

/**
 * Adds the sections for the legacy display settings.
 *
 * @since 4.13
 *
 * @param array $sections The settings section.
 *
 * @return array
 */
function wpra_add_legacy_display_settings_sections($sections)
{
    $sections['display'] = [
        'title' => __('Display settings', 'wprss'),
        'fields' => [
            'link-enable' => [
                'label' => __('Link title', 'wprss'),
                'callback' => 'wprss_setting_title_link_callback',
            ],
            'title-limit' => [
                'label' => __('Title maximum length', 'wprss'),
                'callback' => 'wprss_setting_title_length_callback',
            ],
            'authors-enable' => [
                'label' => __('Show authors', 'wprss'),
                'callback' => 'wprss_setting_authors_enable_callback',
            ],
            'video-links' => [
                'label' => __('For video feed items use', 'wprss'),
                'callback' => 'wprss_setting_video_links_callback',
            ],
            'pagination' => [
                'label' => __('Pagination type', 'wprss'),
                'callback' => 'wprss_setting_pagination_type_callback',
            ],
            'feed-limit' => [
                'label' => __('Feed display limit', 'wprss'),
                'callback' => 'wprss_setting_feed_limit_callback',
            ],
            'open-dd' => [
                'label' => __('Open links behaviour', 'wprss'),
                'callback' => 'wprss_setting_open_dd_callback',
            ],
            'follow-dd' => [
                'label' => __('Set links as nofollow', 'wprss'),
                'callback' => 'wprss_setting_follow_dd_callback',
            ],
        ],
    ];

    $sections['source'] = [
        'title' => __('Source Display settings', 'wprss'),
        'fields' => [
            'source-enable' => [
                'label' => __('Show source', 'wprss'),
                'callback' => 'wprss_setting_source_enable_callback',
            ],
            'text-preceding-source' => [
                'label' => __('Text preceding source', 'wprss'),
                'callback' => 'wprss_setting_text_preceding_source_callback',
            ],
            'source-link' => [
                'label' => __('Link source', 'wprss'),
                'callback' => 'wprss_setting_source_link_callback',
            ],
        ],
    ];

    $sections['date'] = [
        'title' => __('Date Display settings', 'wprss'),
        'fields' => [
            'date-enable' => [
                'label' => __('Show date', 'wprss'),
                'callback' => 'wprss_setting_date_enable_callback',
            ],
            'text-preceding-date' => [
                'label' => __('Text preceding date', 'wprss'),
                'callback' => 'wprss_setting_text_preceding_date_callback',
            ],
            'date-format' => [
                'label' => __('Date format', 'wprss'),
                'callback' => 'wprss_setting_date_format_callback',
            ],
            'time-ago-format-enable' => [
                'label' => __('Time ago format', 'wprss'),
                'callback' => 'wprss_setting_time_ago_format_enable_callback',
            ],
        ],
    ];

    return $sections;
}

/**
 * General settings display section header
 *
 * @since 3.5
 */
function wprss_settings_display_callback()
{
    printf(
        '<p>%s</p>',
        __('In this section you can find some general options that control how the feed items are displayed.', 'wprss')
    );
}

/**
 * Display settings for source section header
 *
 * @since 4.2.4
 */
function wprss_settings_source_callback()
{
    printf(
        '<p>%s</p>',
        __("Options that control how the feed item's source is displayed.", 'wprss')
    );
}

/**
 * Display settings for date section header
 *
 * @since 4.2.4
 */
function wprss_settings_date_callback()
{
    printf(
        '<p>%s</p>',
        __("Options that control how the feed item's date is displayed.", 'wprss')
    );
}

/**
 * Enable linked title options.
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_title_link_callback($field)
{
    $title_link = wprss_get_general_setting('title_link');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'title_link',
        $title_link,
        '1'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Title length limit option.
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_title_length_callback($field)
{
    $title_limit = wprss_get_general_setting('title_limit');

    echo wprss_settings_render_input(
        $field['field_id'],
        'wprss_settings_general[title_limit]',
        $title_limit,
        'number',
        [
            'placeholder' => __('No limit', 'wprss'),
            'class' => 'wprss-number-roller',
        ]
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Shows the feed item authors option
 *
 * @since 4.2.4
 *
 * @param array $field The field information.
 */
function wprss_setting_authors_enable_callback($field)
{
    $authors_enable = wprss_get_general_setting('authors_enable');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'authors_enable',
        $authors_enable,
        '1'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Use original video link, or embedded video links dropdown.
 *
 * @since 3.4
 *
 * @param array $field The field information.
 */
function wprss_setting_video_links_callback($field)
{
    $video_link = wprss_get_general_setting('video_link');
    $items = [
        'false' => __('Original page link', 'wprss'),
        'true' => __('Embedded video player link', 'wprss'),
    ];

    echo wprss_settings_render_select($field['field_id'], 'wprss_settings_general[video_link]', $items, $video_link);
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);

    printf(
        '<p><span class="description">%s</span></p>',
        __('This will not affect already imported feed items.', 'wprss')
    );
}

/**
 * Pagination Type
 *
 * @since 4.2.3
 *
 * @param array $field The field information.
 */
function wprss_setting_pagination_type_callback($field)
{
    $pagination = wprss_get_general_setting('pagination');
    $items = [
        'default' => __('"Older posts" and "Newer posts" links', 'wprss'),
        'numbered' => __('Page numbers with "Next" and "Previous" page links', 'wprss'),
    ];

    echo wprss_settings_render_select($field['field_id'], 'wprss_settings_general[pagination]', $items, $pagination);
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Set limit for feeds on frontend
 *
 * @since 2.0
 *
 * @param array $field The field information.
 */
function wprss_setting_feed_limit_callback($field)
{
    $feed_limit = wprss_get_general_setting('feed_limit');

    echo wprss_settings_render_input($field['field_id'], 'wprss_settings_general[feed_limit]', $feed_limit);
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Link open setting dropdown
 *
 * @since 1.1
 *
 * @param array $field The field information.
 */
function wprss_setting_open_dd_callback($field)
{
    $open_dd = wprss_get_general_setting('open_dd');
    $items = [
        'lightbox' => __('Lightbox', 'wprss'),
        'blank' => __('New window', 'wprss'),
        'self' => __('Self', 'wprss'),
    ];

    echo wprss_settings_render_select($field['field_id'], 'wprss_settings_general[open_dd]', $items, $open_dd);
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Follow or No Follow dropdown
 *
 * @since 1.1
 *
 * @param array $field The field information.
 */
function wprss_setting_follow_dd_callback($field)
{
    $follow_dd = wprss_get_general_setting('follow_dd');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'follow_dd',
        $follow_dd,
        'no_follow'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Enable source
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_source_enable_callback($field)
{
    $source_enable = wprss_get_general_setting('source_enable');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'source_enable',
        $source_enable,
        '1'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Set text preceding source
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_text_preceding_source_callback($field)
{
    $text_preceding_source = wprss_get_general_setting('text_preceding_source');

    echo wprss_settings_render_input(
        $field['field_id'],
        'wprss_settings_general[text_preceding_source]',
        $text_preceding_source
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Enable linked title
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_source_link_callback($field)
{
    $source_link = wprss_get_general_setting('source_link');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'source_link',
        $source_link,
        '1'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Enable date
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_date_enable_callback($field)
{
    $date_enable = wprss_get_general_setting('date_enable');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'date_enable',
        $date_enable,
        '1'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Set text preceding date
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_text_preceding_date_callback($field)
{
    $text_preceding_date = wprss_get_general_setting('text_preceding_date');

    echo wprss_settings_render_input(
        $field['field_id'],
        'wprss_settings_general[text_preceding_date]',
        $text_preceding_date
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}

/**
 * Set date format
 *
 * @since 3.0
 *
 * @param array $field The field information.
 */
function wprss_setting_date_format_callback($field)
{
    $date_format = wprss_get_general_setting('date_format');

    echo wprss_settings_render_input(
        $field['field_id'],
        'wprss_settings_general[date_format]',
        $date_format
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);

    printf(
        '<p><a href="%s">%s</a></p>',
        'https://codex.wordpress.org/Formatting_Date_and_Time',
        __('PHP Date Format Reference', 'wprss')
    );
}

/**
 * Time ago format checkbox
 *
 * @since 4.2
 *
 * @param array $field The field information.
 */
function wprss_setting_time_ago_format_enable_callback($field)
{
    $time_ago_format = wprss_get_general_setting('time_ago_format_enable');

    echo wprss_options_render_checkbox(
        $field['field_id'],
        'time_ago_format_enable',
        $time_ago_format,
        '1'
    );
    echo wprss_settings_inline_help($field['field_id'], $field['tooltip']);
}


File Name:
admin-options.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-options.php
Code:
<?php  
    /**
     * Plugin settings related functions 
     * 
     * Note: Wording of options and settings is confusing, due to the plugin originally only having 
     * an 'options' page to enter feed sources, and now needing two screens, one for feed sources and one for 
     * general settings. Might implement something cleaner in the future.
     *
     * @package WP PRSS Aggregator
     */ 



    /**
     * Returns the given general setting option value form the database, or the default value if it is not found.
     *
     * @param string $option_name The name of the option to get
     * @param bool $not_empty If true, the default value will be returned if the option exists but is empty.
     * @return mixed
     * @since 3.7.1
     */
    function wprss_get_general_setting( $option_name, $not_empty = false ) {
        $options = get_option( 'wprss_settings_general', array() );
        $defaults = wprss_get_default_settings_general();

        $value = isset($options[$option_name])
            ? $options[$option_name]
            : $defaults[$option_name];

        return ($not_empty && empty($value))
            ? $defaults[$option_name]
            : $value;
    }

    /**
     * Build the plugin settings page, used to save general settings like whether a link should be follow or no follow
     * @since 1.1
     */
    function wprss_settings_page_display() {

        ?>
        <div class="wrap">
            <div id="wpra-settings-app"></div>

            <h2><?php _e( 'WP RSS Aggregator Settings', WPRSS_TEXT_DOMAIN ); ?></h2>

            <?php settings_errors(); ?>

            <?php $active_tab = isset( $_GET['tab'] ) ? $_GET['tab'] : 'general_settings'; ?>

            <?php

            $tabs = array(
                array(
                    'label' => __( 'General', WPRSS_TEXT_DOMAIN ),
                    'slug'  => 'general_settings',
                ),
                array(
                    'label' => __( 'Custom Feed', WPRSS_TEXT_DOMAIN ),
                    'slug'  => 'custom_feed_settings',
                ),
            );

            $tabs = apply_filters( 'wprss_options_tabs', $tabs );

            $tabs[] = array(
                'label' => __( 'Advanced', WPRSS_TEXT_DOMAIN ),
                'slug'  => 'advanced_settings',
            );

            if (count(wprss_get_addons()) > 0 && is_main_site()) {
                $tabs[] = array(
                    'label' => __( 'Licenses', WPRSS_TEXT_DOMAIN ),
                    'slug'  => 'licenses_settings'
                );
            }

            $show_tabs = ( count( $tabs ) > 1 ) || apply_filters( 'wprss_show_settings_tabs_condition', FALSE );

            if ( $show_tabs ) { ?>
            <h2 class="nav-tab-wrapper">
                <?php
                foreach ( $tabs as $tab => $tab_property ) { ?>
                    <a href="?post_type=wprss_feed&page=wprss-aggregator-settings&tab=<?php echo esc_attr( $tab_property['slug'] ); ?>"
                       class="nav-tab <?php echo $active_tab == $tab_property['slug']  ? 'nav-tab-active' : ''; ?>"><?php echo esc_html( $tab_property['label'] ); ?></a>
                <?php } ?>
                <?php } ?>
            </h2>

            <form action="options.php" method="post">

                <?php

                if ( $active_tab === 'general_settings' ) {
                    settings_fields( 'wprss_settings_general' );
                    do_settings_sections( 'wprss_settings_general' );
                }
                elseif ( $active_tab === 'advanced_settings' ) {
                    settings_fields( 'wprss_settings_advanced' );
                    do_settings_sections( 'wprss_settings_advanced' );
                }
                elseif ( $active_tab === 'custom_feed_settings' ) {
                    settings_fields( 'wprss_settings_custom_feed' );
                    do_settings_sections( 'wprss_settings_custom_feed' );
                }
                elseif ( $show_tabs ) {

                    if ( $active_tab === 'licenses_settings') {

                        if (!is_main_site()) {
                            printf(
                                '<p><strong>%s</strong></p>',
                                __('You do not have access to this page', 'wprss')
                            );

                            return;
                        }

                        settings_fields( 'wprss_settings_license_keys' );
                        do_settings_sections( 'wprss_settings_license_keys' );
                    }

                    do_action( 'wprss_add_settings_fields_sections', $active_tab );
                }

                submit_button( __( 'Save Settings', WPRSS_TEXT_DOMAIN ) );

                ?>
            </form>
        </div>
        <?php
    }

    function wprss_settings_fields_array()
    {
        // Define the settings per section
        $settings = apply_filters(
            'wprss_settings_array',
            array(
                'import'   =>  array(
                    'cron-interval' => array(
                        'label'     =>  __( 'Update interval', 'wprss' ),
                        'callback'  =>  'wprss_setting_cron_interval_callback'
                    ),
                    'unique-titles' => array(
                        'label'     =>  __( 'Unique titles only', 'wprss'),
                        'callback'  =>  'wprss_setting_unique_titles'
                    ),
                    'feed_items_import_order' => array(
                        'label'     => __( 'Import order', 'wprss' ),
                        'callback'  => 'wprss_setting_feed_items_import_order_callback'
                    ),
                    'limit-feed-items-by-age' => array(
                        'label'     =>  __( 'Limit items by age', 'wprss' ),
                        'callback'  =>  'wprss_setting_limit_feed_items_age_callback'
                    ),
                    'limit-feed-items-imported' => array(
                        'label'     => __( 'Limit feed items stored per feed', 'wprss' ),
                        'callback'  => 'wprss_setting_limit_feed_items_imported_callback'
                    ),
                    'limit-feed-items-db' => array(
                        'label'     => __( 'Limit feed items stored', 'wprss' ),
                        'callback'  => 'wprss_setting_limit_feed_items_callback'
                    ),
                    'limit_feed_items_per_import' => array(
                        'label'     => __( 'Limit feed items per import', 'wprss' ),
                        'callback'  => 'wprss_setting_limit_feed_items_per_import_callback'
                    ),
                    'schedule_future_items' => array(
                        'label'     => __( 'Schedule future items', 'wprss' ),
                        'callback'  => 'wprss_setting_schedule_future_items_callback'
                    ),
                ),

                'custom_feed' => array(
                    'custom-feed-url' => array(
                        'label'     =>  __( 'Custom feed URL', 'wprss' ),
                        'callback'  =>  'wprss_settings_custom_feed_url_callback'
                    ),
                    'custom-feed-title' => array(
                        'label'     =>  __( 'Custom feed title', 'wprss' ),
                        'callback'  =>  'wprss_settings_custom_feed_title_callback'
                    ),
                    'custom-feed-limit' => array(
                        'label'     =>  __( 'Custom feed limit', 'wprss' ),
                        'callback'  =>  'wprss_settings_custom_feed_limit_callback'
                    ),
                ),
            )
        );

        if ( apply_filters( 'wprss_use_fixed_feed_limit', false ) === false ) {
            unset( $settings['import']['limit-feed-items-db'] );
        }

        $settings['styles']  = array(
            'styles-disable' => array(
                'label'     =>  __( 'Disable styles', 'wprss' ),
                'callback'  =>  'wprss_setting_styles_disable_callback'
            )
        );

        if ( apply_filters( 'wprss_use_fixed_feed_limit', false ) === false ) {
            unset( $settings['general']['limit-feed-items-db'] );
        }

        return $settings;
    }

    
    add_action( 'admin_init', 'wprss_admin_init' );
    /**
     * Register and define options and settings
     * @since 2.0
     *
     * Note: In the future might change to
     * the way EDD builds the settings pages, cleaner method.
     */
    function wprss_admin_init() {
        $fields = wprss_settings_fields_array();

        // page => sections -> fields
        $settings = [
            'general' => [
                'sections' => apply_filters(
                    'wprss_settings_sections_array',
                    [
                        'import'  =>  [
                            'title' => __( 'Import Settings', 'wprss' ),
                            'fields' => $fields['import'],
                        ],
                    ]
                ),
                'option' => 'wprss_settings_general',
                'callback' => 'wprss_settings_general_validate',
            ],
            'custom_feed' => [
                'sections' => [
                    'custom_feed' => [
                        'title' => __('Custom RSS Feed', 'wprss'),
                        'fields' => $fields['custom_feed'],
                    ],
                ],
                'option' => 'wprss_settings_general',
                'callback' => 'wprss_settings_general_validate',
            ],
            'advanced' => [
                'sections' => [
                    'advanced' => [
                        'title' => __('Advanced Settings', 'wprss'),
                        'fields' => $fields['advanced'],
                    ],
                    'styles' => [
                        'title' => __('Styles', 'wprss'),
                        'fields' => $fields['styles'],
                    ],
                ],
                'option' => 'wprss_settings_general',
                'callback' => 'wprss_settings_general_validate',
            ],
            'license_keys' => [
                'sections' => [],
                'option' => 'wprss_settings_license_keys',
                'callback' => 'wprss_settings_license_keys_validate',
            ],
        ];

        $setting_field_id_prefix = 'wprss-settings-';

        foreach ($settings as $pageKey => $page) {
            $groupId = "wprss_settings_${pageKey}";

            register_setting(
                $groupId,
                $page['option'],
                $page['callback']
            );

            foreach ($page['sections'] as $sectionKey => $section) {
                $sectionId = "wprss_settings_${sectionKey}_section";

                add_settings_section(
                    $sectionId,
                    $section['title'],
                    "wprss_settings_${sectionKey}_callback",
                    $groupId
                );

                foreach ($section['fields'] as $fieldId => $field) {
                    /**
                     * This will be passed to the field callback as the only argument
                     * @see http://codex.wordpress.org/Function_Reference/add_settings_field#Parameters
                     */
                    $callback_args = array(
                        'field_id'				=> $fieldId,
                        'field_id_prefix'		=> $setting_field_id_prefix,
                        'section_id'			=> $sectionKey,
                        'field_label'			=> isset( $field['label'] ) ? $field['label'] : null,
                        'tooltip'				=> isset( $field['tooltip'] ) ? $field['tooltip'] : null
                    );

                    add_settings_field(
                        $setting_field_id_prefix . $fieldId,
                        $field['label'],
                        $field['callback'],
                        $groupId,
                        $sectionId,
                        $callback_args
                    );
                }
            }
        }

        do_action( 'wprss_admin_init' );
    }
	
	
	/**
	 * Returns the HTML of a tooltip handle.
	 * 
	 * Filters used:
	 * - `wprss_settings_inline_help_default_options` - The default options for "Settings" page's tooltips
	 * - `wprss_settings_inline_help_id_prefix` - The prefix for all tooltip IDs for the "Settings" page.
	 * 
	 * @param string $id The ID of the tooltip
	 * @param string|null $text Text for this tooltip, if any.
	 * @param array $options Any options for this setting.
	 * @return string Tooltip handle HTML. See {@link WPRSS_Help::tooltip()}.
	 */
	function wprss_settings_inline_help( $id, $text = null, $options = array() ) {
		$help = WPRSS_Help::get_instance();
		
		// Default options, entry point
		$defaults = apply_filters( 'wprss_settings_inline_help_default_options', array(
			'tooltip_handle_class_extra'	=> $help->get_options('tooltip_handle_class_extra') . ' ' . $help->get_options('tooltip_handle_class') . '-setting'
		));

		$options = $help->array_merge_recursive_distinct( $defaults, $options );
		
		// ID Prefix
		$id = apply_filters( 'wprss_settings_inline_help_id_prefix', 'setting-' ) . $id;
		
		return $help->tooltip( $id, $text, $options );
	}
	
	
	/**
	 * 
	 * @param type $string
	 * @return type
	 */
	function wprss_settings_field_name_prefix( $string = '' ) {
		$string = (string) $string;
		$prefix = apply_filters( 'wprss_settings_field_name_prefix', 'wprss_settings_', $string );
		return $prefix . $string;
	}
	
	
	/**
	 * Generates a uniform setting field name for use in HTML.
	 * The parts used are the ID of the field, the section it is in, and an optional prefix.
	 * All parts are optional, but, if they appear, they shall appear in this order: $prefix, $section, $id.
	 * 
	 * If only the section is not specified, the $id will be simply prefixed by $prefix.
	 * If either the $id or the $section are empty (but not both), $prefix will be stripped of known separators.
	 * Empty parts will be excluded.
	 * 
	 * @param string $id ID of the field.
	 * @param string|null $section Name of the section, to which this field belongs.
	 * @param string|null $prefix The string to prefix the name with; appears first. If boolean false, no prefix will be applied. Default: return value of {@link wprss_settings_field_name_prefix()}.
	 * @return string Name of the settings field, namespaced and optionally prefixed.
	 */
	function wprss_settings_field_name( $id = null, $section = null, $prefix = null ) {
		if( $prefix !== false ) $prefix = is_null( $prefix ) ? wprss_settings_field_name_prefix() : $prefix;
		else $prefix = '';
		
		$section = (string) $section;
		
		$format = '';
		if( !strlen( $section ) xor !strlen($id) ) $prefix = trim ( $prefix, "\t\n\r _-:" );
		if( strlen( $prefix ) ) $format .= '%3$s';
		if( strlen( $section ) ) $format .= '%2$s';
		if( strlen( $id ) ) $format .= ( !strlen( $section ) ? '%1$s' : '[%1$s]' );
		
		return apply_filters( 'wprss_settings_field_name', sprintf( $format, $id, $section, $prefix ), $id, $section, $prefix );
	}


    /** 
     * General settings section header
     *
     * @since 3.0
     */
    function wprss_settings_import_callback() {
        echo wpautop( __( 'Configure how WP RSS Aggregator imports RSS feed items.', 'wprss' ) );
    }


    /** 
     * Custom feed settings section header
     *
     * @since 4.13
     */
    function wprss_settings_custom_feed_callback() {
        echo wpautop( __( 'WP RSS Aggregator creates a custom RSS feed on your site that includes all of your imported items. Use the below options to set it up.', 'wprss' ) );
    }

    /**
     * Advanced settings section header
     *
     * @since 4.13
     */
    function wprss_settings_advanced_callback() {
        echo wpautop( __( 'Only change these options if you know what you are doing!', WPRSS_TEXT_DOMAIN ) );
    }

    /** 
     * General settings styles section header
     *
     * @since 3.0
     */
    function wprss_settings_styles_callback() {
        echo wpautop( __( 'If you would like to disable all styles used in this plugin, tick the checkbox.', WPRSS_TEXT_DOMAIN ) );
    }



    /** 
     * Limit number of feed items stored by their age
     * @since 3.0
     */
    function wprss_setting_limit_feed_items_age_callback( $field ) {
        $limit_feed_items_age = wprss_get_general_setting( 'limit_feed_items_age' );
        $limit_feed_items_age_unit = wprss_get_general_setting( 'limit_feed_items_age_unit' );
        $units = wprss_age_limit_units();
//		echo wprss_settings_field_name( $field_info['field_id'], $field_info['section_id'], $field_info['field_name_prefix'] )
        ?>
		
        <input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[limit_feed_items_age]" type="number" min="0"
            class="wprss-number-roller" placeholder="<?php _e( 'No limit', WPRSS_TEXT_DOMAIN ) ?>" value="<?php echo $limit_feed_items_age; ?>" />

        <select id="limit-feed-items-age-unit" name="wprss_settings_general[limit_feed_items_age_unit]">
        <?php foreach ( $units as $unit ) : ?>
            <option value="<?php echo $unit ?>" <?php selected( $limit_feed_items_age_unit, $unit ) ?> ><?php _e( $unit, WPRSS_TEXT_DOMAIN ) ?></option>
        <?php endforeach ?>
        </select>
        <?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] ) ?>
		
        <br/>
        <?php
    }



    /** 
     * Limit number of feed items stored
     * @since 3.0
     */
    function wprss_setting_limit_feed_items_callback( $field ) {
        $limit_feed_items_db = wprss_get_general_setting( 'limit_feed_items_db' );
        ?>
		<input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[limit_feed_items_db]" type="text" value="<?php echo $limit_feed_items_db ?>" />
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }


    /** 
     * Limit number of feed items imported per feed
     * @since 3.1
     */
    function wprss_setting_limit_feed_items_imported_callback( $field ) {
        $limit_feed_items_imported = wprss_get_general_setting( 'limit_feed_items_imported' );
        ?>
		<input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[limit_feed_items_imported]" type="text" value="<?php echo $limit_feed_items_imported ?>" placeholder="<?php _e( 'No Limit', WPRSS_TEXT_DOMAIN ) ?>" />
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }


    /**
     * Gets a sorted (according to interval) list of the cron schedules
     * @since 3.0
     */
    function wprss_get_schedules() {
        $schedules = wp_get_schedules();
        uasort( $schedules, function($a, $b) {
            return $a['interval'] - $b['interval'];
        } );
        return $schedules;
    }


    /** 
     * Cron interval dropdown callback
     * @since 3.0
     */
    function wprss_setting_cron_interval_callback( $field ) {
        $current = wprss_get_general_setting('cron_interval');

        $schedules = wprss_get_schedules();    
        // Set the allowed Cron schedules, we don't want any intervals that can lead to issues with server load 
        $wprss_schedules = apply_filters( 
                            'wprss_schedules',
                            array( 'fifteen_min', 'thirty_min', 'hourly', 'two_hours', 'twicedaily', 'daily' )
        );        
        ?>
		<select id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[cron_interval]">
		<?php
        foreach( $schedules as $schedule_name => $schedule_data ):
            if ( in_array( $schedule_name, $wprss_schedules ) ): ?>
                <option value="<?php echo $schedule_name ?>" <?php selected( $current, $schedule_name ) ?> >
                    <?php echo $schedule_data['display'] ?> (<?php echo wprss_interval( $schedule_data['interval'] ) ?>)
                </option>
            <?php endif ?>
        <?php endforeach ?>
        </select>
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] ) ?><?php
    }


    /**
     * Unique titles only checkbox callback
     * @since 4.7
     */
    function wprss_setting_unique_titles( $field ) {
        $unique_titles = wprss_get_general_setting( 'unique_titles' );

        echo wprss_options_render_checkbox( $field['field_id'], 'unique_titles', $unique_titles );
        echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }


    /**
     * Sets the custom feed URL
     * @since 3.3
     */
    function wprss_settings_custom_feed_url_callback( $field ) {
        $siteUrl = trailingslashit(get_site_url());
        $custom_feed_url = wprss_get_general_setting( 'custom_feed_url' );
        $fullUrl = $siteUrl . $custom_feed_url;
        ?>
		<code><?= $siteUrl ?></code>
        <input id="<?php echo $field['field_id'] ?>"
               name="wprss_settings_general[custom_feed_url]"
               type="text"
               value="<?php echo $custom_feed_url ?>" />

		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] ); ?>

        <p style="font-style: normal">
            <a href="<?php echo esc_attr($fullUrl); ?>" target="_blank">
                <?php _e('Open custom feed', 'wprss') ?>
            </a>
        </p>
        <?php
    }

    /**
     * Sets the custom feed title
     * @since 4.1.2
     */
    function wprss_settings_custom_feed_title_callback( $field ) {
        $custom_feed_title = wprss_get_general_setting( 'custom_feed_title' );
        ?>
		<input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[custom_feed_title]" type="text" value="<?php echo $custom_feed_title ?>" />
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /**
     * Sets the custom feed limit
     * @since 3.3
     */
    function wprss_settings_custom_feed_limit_callback( $field ) {
        $custom_feed_limit = wprss_get_general_setting( 'custom_feed_limit' );
        ?>
		<input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[custom_feed_limit]" placeholder="<?php _e( 'Default', WPRSS_TEXT_DOMAIN ) ?>" min="0" class="wprss-number-roller" type="number" value="<?php echo $custom_feed_limit ?>" />
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /** 
     * Disable styles
     * @since 3.0
     */
    function wprss_setting_styles_disable_callback( $field ) {
        $styles_disable = wprss_get_general_setting( 'styles_disable' );
        echo wprss_options_render_checkbox( $field['field_id'], 'styles_disable', $styles_disable );
        echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /**
     * Renders the `limit_feed_items_per_import` setting.
     *
     * @since 4.11.2
     *
     * @param array $field Field data.
     */
    function wprss_setting_limit_feed_items_per_import_callback($field)
    {
        $id = $field['field_id'];
        $mainOptionName = 'wprss_settings_general';
        $value = wprss_get_general_setting($id);
        echo \Aventura\Wprss\Core\Model\SettingsAbstract::getTextHtml($value, array(
            'id'                => $id,
            'name'              => \Aventura\Wprss\Core\Model\SettingsAbstract::getNameHtml(array($mainOptionName, $id)),
            'placeholder'       => __( 'No Limit', WPRSS_TEXT_DOMAIN )
        ));
        ?>
        <?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /**
     * Renders the `limit_feed_items_per_import` setting.
     *
     * @since 4.17
     *
     * @param array $field Field data.
     */
    function wprss_setting_schedule_future_items_callback($field)
    {
        $id = $field['field_id'];
        $value = wprss_get_general_setting($id);

        echo wprss_options_render_checkbox( $field['field_id'], 'schedule_future_items', $value );
        echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /**
     * Renders the `feed_items_import_order` setting.
     *
     * @since 4.11.2
     *
     * @param array $field Field data.
     */
    function wprss_setting_feed_items_import_order_callback($field)
    {
        $id = $field['field_id'];
        $mainOptionName = 'wprss_settings_general';
        $value = wprss_get_general_setting($id);
        $items = array(
            'latest'               => __('Latest items first', WPRSS_TEXT_DOMAIN),
            'oldest'               => __('Oldest items first', WPRSS_TEXT_DOMAIN),
            ''                     => __('Original feed order', WPRSS_TEXT_DOMAIN),
        );
        ?>
		<select id="<?php echo $id ?>" name="<?php echo \Aventura\Wprss\Core\Model\SettingsAbstract::getNameHtml(array($mainOptionName, $id)) ?>">
		<?php
        foreach( $items as $_value => $_label ): ?>
            <option value="<?php echo esc_attr($_value) ?>" <?php selected( $value, $_value ) ?> >
                <?php echo esc_html($_label) ?>
            </option>
        <?php endforeach ?>
        </select>
        <?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }



    /**
     * Secure Reset section
     *
     * @since 3.7.1
     */
    function wprss_settings_secure_reset_code_callback( $args ) {
        $reset_code = get_option( 'wprss_secure_reset_code', '' );
        ?>
        <input id="wprss-secure-reset-code" name="wprss_secure_reset_code" type="input" value="<?php echo $reset_code; ?>" />
        <button type="button" role="button" id="wprss-secure-reset-generate"><?php _e( 'Generate Random Code', WPRSS_TEXT_DOMAIN ) ?></button>

        <br/>

        <label class="description" for="wprss-secure-reset-code">
            <?php _e( 'Enter the code to use to securely reset the plugin and deactivate it. Be sure to save this code somewhere safe.', WPRSS_TEXT_DOMAIN ) ?><br/>
        </label>

        <br/>

        <p>
            <?php _e( 'Leave this empty to disable the secure reset function.<br/>
            You use this code by adding any of the following to any URL on your site.', WPRSS_TEXT_DOMAIN ) ?>
            <ol>
                <li>"?wprss_action=reset&wprss_security_code=&lt;your_code&gt;" - <b><?php _e( 'Resets your WP RSS Aggregator settings', WPRSS_TEXT_DOMAIN ) ?></b></li>
                <li>"?wprss_action=deactivate&wprss_security_code=&lt;your_code&gt;" - <b><?php _e( 'Deactivates WP RSS Aggregator', WPRSS_TEXT_DOMAIN ) ?></b></li>
                <li>"?wprss_action=reset_and_deactivate&wprss_security_code=&lt;your_code&gt;" - <b><?php _e( 'Does both of the above', WPRSS_TEXT_DOMAIN ) ?></b></li>
            </ol>
        </p>
        <p class="description">
            <?php _e( 'Use the above actions only when absolutely necessary, or when instructed to by support staff.', WPRSS_TEXT_DOMAIN ) ?>
        </p>
        <?php
    }


    /**
     * Gets options that should go in a dropdown which represents a
     * feed-source-specific boolean setting.
     *
     * @since 4.10
     * @return array An array with options.
     */
    function wprss_settings_get_feed_source_boolean_options()
    {
        return array(
            1           => __('On', WPRSS_TEXT_DOMAIN),
            0           => __('Off', WPRSS_TEXT_DOMAIN),
            -1          => __('Default', WPRSS_TEXT_DOMAIN),
        );
    }

    /**
     * Renders a <select> HTML tag from its parameters.
     *
     * @since 4.10
     * @return string The HTML of a <select> tag.
     */
    function wprss_settings_render_select($id, $name, $items, $selected = null, $attributes = [])
    {
        ob_start();
        $attributes = array_merge($attributes, [
            'id' => $id,
            'name' => $name,
        ]);

        $attributePairs = $attributes;
        array_walk($attributePairs, function (&$v, $k) {
            $v = sprintf('%1$s="%2$s"', $k, $v);
        });
        $attributesString = implode(' ', $attributePairs);
        ?>
        <select <?php echo $attributesString ?>>
            <?php
            foreach ($items as $_key => $_item) {
                $_key = (string) $_key;
                $_item = (string) $_item;
                $isSelected = $selected == $_key;
                ?>
                <option value="<?php echo $_key ?>"<?php if ($isSelected): ?> selected="selected"<?php endif ?>><?php echo htmlspecialchars($_item) ?></option><?php
            }
            ?>
        </select>
        <?php
        $html = ob_get_clean();

        return $html;
    }

    /**
     * Renders an <input> HTML tag from its parameters.
     *
     * @since 4.13
     * @return string The HTML of an <input> tag.
     */
    function wprss_settings_render_input($id, $name, $value, $type ='text', $attributes = [])
    {
        $attributes = array_merge($attributes, [
            'id' => $id,
            'name' => $name,
            'type' => $type,
            'value' => esc_attr($value)
        ]);

        $attributePairs = $attributes;

        array_walk($attributePairs, function (&$v, $k) {
            $v = sprintf('%1$s="%2$s"', $k, $v);
        });

        $attributesString = implode(' ', $attributePairs);

        return sprintf('<input %s />', $attributesString);
    }

    /**
     * Renders an <input> checkbox HTML tag from its parameters.
     *
     * @since 4.13
     * @return string The HTML of an <input> checkbox tag.
     */
    function wprss_settings_render_checkbox($id, $name, $value, $checked = false)
    {
        $attributes = [];

        if ($checked) {
            $attributes['checked'] = '';
        }

        return wprss_settings_render_input($id, $name, $value, 'checkbox', $attributes);
    }

    /**
     * Pretty-prints the difference in two times.
     *
     * @since 3.0
     * @param time $older_date
     * @param time $newer_date
     * @return string The pretty time_since value
     * @link http://wordpress.org/extend/plugins/wp-crontrol/
     */
    function wprss_time_since( $older_date, $newer_date ) {
        return wprss_interval( $newer_date - $older_date );
    }    

    /**
     * Calculates difference between times
     * 
     * Taken from the WP-Crontrol plugin 
     * @link http://wordpress.org/extend/plugins/wp-crontrol/
     * @since 3.0
     *
     */
    function wprss_interval( $since ) {
        if ( $since === wprss_get_default_feed_source_update_interval() ) {
            return __( 'Default', WPRSS_TEXT_DOMAIN );
        }
        // array of time period chunks
        $chunks = array(
            array(60 * 60 * 24 * 365 , _n_noop('%s year', '%s years', 'crontrol')),
            array(60 * 60 * 24 * 30 , _n_noop('%s month', '%s months', 'crontrol')),
            array(60 * 60 * 24 * 7, _n_noop('%s week', '%s weeks', 'crontrol')),
            array(60 * 60 * 24 , _n_noop('%s day', '%s days', 'crontrol')),
            array(60 * 60 , _n_noop('%s hour', '%s hours', 'crontrol')),
            array(60 , _n_noop('%s minute', '%s minutes', 'crontrol')),
            array( 1 , _n_noop('%s second', '%s seconds', 'crontrol')),
        );


        if( $since <= 0 ) {
            return __( 'now', WPRSS_TEXT_DOMAIN );
        }

        // we only want to output two chunks of time here, eg:
        // x years, xx months
        // x days, xx hours
        // so there's only two bits of calculation below:

        // step one: the first chunk
        for ($i = 0, $j = count($chunks); $i < $j; $i++)
            {
            $seconds = $chunks[$i][0];
            $name = $chunks[$i][1];

            // finding the biggest chunk (if the chunk fits, break)
            if (($count = floor($since / $seconds)) != 0)
                {
                break;
                }
            }

        // set output var
        $output = sprintf(_n($name[0], $name[1], $count, WPRSS_TEXT_DOMAIN), $count);

        // step two: the second chunk
        if ($i + 1 < $j)
            {
            $seconds2 = $chunks[$i + 1][0];
            $name2 = $chunks[$i + 1][1];

            if (($count2 = floor(($since - ($seconds * $count)) / $seconds2)) != 0)
                {
                // add to output var
                $output .= ' '.sprintf(_n($name2[0], $name2[1], $count2, WPRSS_TEXT_DOMAIN), $count2);
                }
            }

        return $output;
    }


    /** 
     * Validate inputs from the general settings page
     * @since 3.0
     */
    function wprss_settings_general_validate( $input ) {
        $current_cron_interval = wprss_get_general_setting( 'cron_interval');

        // Create our array for storing the validated options
        $output = get_option('wprss_settings_general', []);

        // Loop through each of the incoming options
        foreach ($input as $key => $value) {
            // Check to see if the current option has a value. If so, process it.
            if (!isset($input[$key])) {
                continue;
            }

            // Strip all HTML and PHP tags and properly handle quoted strings
            $output[$key] = strip_tags(stripslashes($input[$key]));
        }

        if ( isset($input['styles_disable']) ) {
            $output['styles_disable'] = (int) $input['styles_disable'];
        }

        if ( isset($input['unique_titles']) ) {
            $output['unique_titles'] = $input['unique_titles'];
        }

        if ( isset($input['cron_interval']) && $input['cron_interval'] != $current_cron_interval ) {
            wp_clear_scheduled_hook( 'wprss_fetch_all_feeds_hook' );
            wp_schedule_event( time(), $input['cron_interval'], 'wprss_fetch_all_feeds_hook' );
        }

        // Return the array processing any additional functions filtered by this action
        return apply_filters( 'wprss_settings_general_validate', $output, $input );
    }


    /**
     * Validates the licenses settings
     * 
     * @since 3.8
     */
    function wprss_settings_license_keys_validate( $input ) {
        // Get the current licenses option
        $licenses = get_option( 'wprss_settings_license_keys' );
        // If no licenses have been defined yet, create an empty array
        if ( !is_array( $licenses ) ) {
            $licenses = array();
        }
        // For each entry in the received input
        foreach ( $input as $addon => $license_code ) {
			$addon_code = explode( '_', $addon );
			$addon_code = isset( $addon_code[0] ) ? $addon_code[0] : null;
            // Only save if the entry does not exist OR the code is different
            if ( array_key_exists( $addon, $licenses ) && $license_code === $licenses[ $addon ] )
				continue;
			
			$is_valid = apply_filters( 'wprss_settings_license_key_is_valid', true, $license_code );
			if( $addon_code )
				$is_valid = apply_filters( "wprss_settings_license_key_{$addon_code}_is_valid", $is_valid, $license_code );
			if( !$is_valid ) continue;
			
			// Save it to the licenses option
			$licenses[ $addon ] = $license_code;
        }
        wprss_check_license_statuses();
        // Return the new licenses
        return $licenses;
    }



    add_action( 'wprss_check_license_statuses', 'wprss_check_license_statuses' );
    /**
     * Checks the license statuses
     * 
     * @since 3.8.1
     */
    function wprss_check_license_statuses() {
        $license_statuses = get_option( 'wprss_settings_license_statuses', array() );

        if ( count( $license_statuses ) === 0 ) return;

        $found_inactive = FALSE;
        foreach ( $license_statuses as $addon => $status ) {
            if ( $status !== 'active' ) {
                $found_inactive = TRUE;
                break;
            }
        }

        if ( $found_inactive ) {
            set_transient( 'wprss_notify_inactive_licenses', 1, 0 );
        }
    }



    /**
     * Validates the wprss_secure_reset_code option
     * 
     * @since 3.7.1
     */
    function wprss_secure_reset_code_validate( $input ) {
        return $input;
    }



    /**
     * Validates the presstrends setting
     *
     * @since 3.6
     */
    function wprss_tracking_validate ( $input ) {
        $output = $input;
        if ( ! isset( $input['wprss_tracking'] ) ) {
            $output['wprss_tracking'] = 0;
        }
        return $output;
    }



    /**
     * Returns the units used for the limit by age option.
     * 
     * @since 3.8
     */
    function wprss_age_limit_units() {
        return apply_filters(
            'wprss_age_limit_units',
            array(
                'days',
                'weeks',
                'months',
                'years'
            )
        );
    }

    /**
     * Renders a checkbox with a hidden field for the default value (when unchecked).
     *
     * @param string $id
     * @param string $name
     * @param string $value
     * @param string $checked_value
     * @param string $default_value
     *
     * @return string
     */
    function wprss_options_render_checkbox($id, $name, $value, $checked_value = '1', $default_value = '0') {
        $nameAttr = esc_attr(sprintf('wprss_settings_general[%s]', $name));
        ob_start();

        ?>
        <input type="hidden" name="<?= $nameAttr; ?>" value="<?= esc_attr($default_value) ?>"/>
        <input type="checkbox"
               id="<?= $id ?>"
               name="<?= $nameAttr ?>"
               value="<?= esc_attr($checked_value) ?>"
               <?= checked( $checked_value, $value, false ) ?> />
        <?php

        return ob_get_clean();
    }


File Name:
admin-plugins.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-plugins.php
Code:
<?php

if (!defined('ABSPATH')) {
    die;
}

/**
 * Adds deactivate poll application on plugin's page.
 *
 * @since 4.12.1
 */
add_action('admin_init', function () {
    $page = trim($_SERVER["REQUEST_URI"], '/');
    $isPluginsPage = strpos($page, 'plugins.php') !== false;

    if (!$isPluginsPage) {
        return;
    }

    add_action('admin_footer', function () {
        wprss_plugin_enqueue_app_scripts('wpra-plugins', WPRSS_APP_JS . 'plugins.min.js', array(), '0.1', true);
        wp_enqueue_style('wpra-plugins', WPRSS_APP_CSS . 'plugins.min.css');

        $addons = wprss_find_installed_addon_names();
        $addons = array_fill_keys($addons, 1);

        wp_localize_script('wpra-plugins', 'WrpaDisablePoll', array(
            'image' => WPRSS_IMG,
            'url' => 'https://hooks.zapier.com/hooks/catch/305784/puf5uf/',
            'audience' => 50, // how many people should see the disable poll (in percents)
            'model' => array(
                'reason' => 'Other',
                'follow_up' => null,
                'date' => date('j M Y'),
                'addons' => $addons,
            ),
            'form' => array(
                array(
                    'label' => '',
                    'type' => 'radio',
                    'name' => 'reason',
                    'options' =>
                        array(
                            array(
                                'value' => 'I no longer need the plugin',
                                'label' => __('I no longer need the plugin', WPRSS_TEXT_DOMAIN),
                            ),
                            array(
                                'value' => 'I found a better alternative',
                                'label' => __('I found a better alternative', WPRSS_TEXT_DOMAIN),
                            ),
                            array(
                                'value' => 'I couldn\'t get the plugin to work',
                                'label' => __('I couldn\'t get the plugin to work', WPRSS_TEXT_DOMAIN),
                            ),
                            array(
                                'value' => 'I\'m temporarily deactivating the plugin, but I\'ll be back',
                                'label' => __('I\'m temporarily deactivating the plugin, but I\'ll be back', WPRSS_TEXT_DOMAIN),
                            ),
                            array(
                                'value' => 'I have a WP RSS Aggregator add-on',
                                'label' => __('I have a WP RSS Aggregator add-on', WPRSS_TEXT_DOMAIN),
                            ),
                            array(
                                'value' => 'Other',
                                'label' => __('Other', WPRSS_TEXT_DOMAIN),
                            ),
                        ),
                ),
                array(
                    'label' => __('Would you mind sharing its name?', WPRSS_TEXT_DOMAIN),
                    'type' => 'textarea',
                    'name' => 'follow_up',
                    'condition' =>
                        array(
                            'field' => 'reason',
                            'operator' => '=',
                            'value' => 'I found a better alternative',
                        ),
                ),
                array(
                    'type' => 'content',
                    'label' => __('Have you <a target="_blank" href="https://wordpress.org/support/plugin/wp-rss-aggregator/">contacted our support team</a> or checked out our <a href="https://kb.wprssaggregator.com/" target="_blank">Knowledge Base</a>?', WPRSS_TEXT_DOMAIN),
                    'condition' =>
                        array(
                            'field' => 'reason',
                            'operator' => '=',
                            'value' => 'I couldn\'t get the plugin to work',
                        ),
                ),
                array(
                    'type' => 'content',
                    'className' => 'error',
                    'label' => __('This core plugin is required for all our premium add-ons. Please don\'t deactivate it if you currently have premium add-ons installed and activated.', WPRSS_TEXT_DOMAIN),
                    'condition' =>
                        array(
                            'field' => 'reason',
                            'operator' => '=',
                            'value' => 'I have a WP RSS Aggregator add-on',
                        ),
                ),
                array(
                    'label' => __('Please share your reason...', WPRSS_TEXT_DOMAIN),
                    'type' => 'textarea',
                    'name' => 'follow_up',
                    'condition' =>
                        array(
                            'field' => 'reason',
                            'operator' => '=',
                            'value' => 'Other',
                        ),
                ),
            )
        ));

        echo '<div id="wpra-plugins-app"></div>';
    });
});


File Name:
admin-update-page.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin-update-page.php
Code:
<?php

define('WPRSS_UPDATE_PAGE_SLUG', 'wpra-update');
define('WPRSS_UPDATE_PAGE_PREV_VERSION_OPTION', 'wprss_prev_update_page_version');

/**
 * Registers the update page.
 *
 * @since 4.12.1
 */
add_action('admin_menu', function () {
    add_submenu_page(
        null,
        __('Thank you for updating WP RSS Aggregator', WPRSS_TEXT_DOMAIN),
        __('Thank you for updating WP RSS Aggregator', WPRSS_TEXT_DOMAIN),
        'manage_options',
        WPRSS_UPDATE_PAGE_SLUG,
        'wprss_render_update_page'
    );
});

/**
 * Renders the update page.
 *
 * @since 4.12.1
 *
 * @throws Twig_Error_Loader
 * @throws Twig_Error_Runtime
 * @throws Twig_Error_Syntax
 */
function wprss_render_update_page()
{
    wprss_update_previous_update_page_version();

    wp_enqueue_style('update-page', WPRSS_APP_CSS . 'update.min.css');
    wp_enqueue_script('wpra-colorbox', WPRSS_JS . 'jquery.colorbox-min.js', ['jquery'], WPRSS_VERSION);
    wp_enqueue_style('colorbox', WPRSS_CSS . 'colorbox.css', [], '1.4.33');

    $changelog = wpra_get('core/changelog_dataset');
    $parsedown = wpra_get('parsedown');

    echo wprss_render_template('admin/update-page.twig', array(
        'title' => __('What\'s new in WP RSS Aggregator', 'wprss'),
        'version' => WPRSS_VERSION,
        'url' => array(
            'main' => admin_url('edit.php?post_type=wprss_feed'),
            'website' => 'https://www.wprssaggregator.com/',
            'support' => 'https://www.wprssaggregator.com/contact/',
            'kb' => 'https://kb.wprssaggregator.com/',
        ),
        'path' => array(
            'images' => WPRSS_IMG,
        ),
        'changelog' => $parsedown->text($changelog[WPRSS_VERSION]['raw'])
    ));
}

/**
 * Retrieves the URL of the update page.
 *
 * @since 4.12.1
 *
 * @return string
 */
function wprss_get_update_page_url()
{
    return menu_page_url(WPRSS_UPDATE_PAGE_SLUG, false);
}

/**
 * Checks whether the update should be shown or not, based on whether the user is new and previously had an older
 * version of the plugin.
 *
 * @since 4.12.1
 *
 * @return bool True if the update page should be shown, false if not.
 */
function wprss_should_do_update_page()
{
    // Temporarily disabled
    return false && !wprss_is_new_user() && current_user_can('manage_options') && wprss_user_had_previous_version();
}

/**
 * Checks whether the user had a previous version of WP RSS Aggregator.
 *
 * @since 4.12.1
 *
 * @return mixed
 */
function wprss_user_had_previous_version()
{
    $previous = wprss_get_previous_update_page_version();
    $is_newer = version_compare(WPRSS_VERSION, $previous, '>');

    return $is_newer;
}

/**
 * Updates the previous update page version to the current plugin version.
 *
 * @since 4.12.1
 */
function wprss_update_previous_update_page_version()
{
    update_option(WPRSS_UPDATE_PAGE_PREV_VERSION_OPTION, WPRSS_VERSION);
}

/**
 * Retrieves the previous update page version seen by the user, if at all.
 *
 * @since 4.12.1
 *
 * @return string The version string, or '0.0.0' if the user is new nad has not used WPRA before.
 */
function wprss_get_previous_update_page_version()
{
    wprss_migrate_welcome_page_to_update_page();

    return get_option(WPRSS_UPDATE_PAGE_PREV_VERSION_OPTION, '0.0.0');
}

/**
 * Migrates the previously used "welcome screen" version DB option.
 *
 * @since 4.12.1
 */
function wprss_migrate_welcome_page_to_update_page()
{
    // Get the previous welcome screen version - for when the page was called the "welcome screen"
    $pwsv = get_option('wprss_pwsv', null);

    // If the option exists, move it to the new option
    if ($pwsv !== null) {
        update_option(WPRSS_UPDATE_PAGE_PREV_VERSION_OPTION, $pwsv);
        delete_option('wprss_pwsv');
    }
}


File Name:
admin.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\admin.php
Code:
<?php
    /**
     * Plugin administration related functions
     *
     * @package WPRSSAggregator
     */

    add_action( 'admin_head', 'wprss_custom_post_type_icon' );
    /**
     * Custom Post Type Icon for Admin Menu & Post Screen
     * @since  2.0
     */
    function wprss_custom_post_type_icon() {
        ?>
        <style>
            /* Post Screen - 32px */
            .icon32-posts-wprss_feed {
                background: transparent url( <?php echo WPRSS_IMG . 'icon-adminpage32.png'; ?> ) no-repeat left top !important;
            }
            /* Post Screen - 32px */
            .icon32-posts-wprss_feed_item {
                background: transparent url( <?php echo WPRSS_IMG . 'icon-adminpage32.png'; ?> ) no-repeat left top !important;
            }
        </style>
    <?php }

    add_action('admin_menu', function () {
        add_submenu_page( 'edit.php?post_type=wprss_feed', __( 'WP RSS Aggregator Settings', WPRSS_TEXT_DOMAIN ), __( 'Settings', WPRSS_TEXT_DOMAIN ), apply_filters( 'wprss_capability', 'manage_feed_settings' ), 'wprss-aggregator-settings', 'wprss_settings_page_display' );
    }, 30);

    add_action('admin_menu', function () {
        add_submenu_page( 'edit.php?post_type=wprss_feed', __( 'Help & Support', WPRSS_TEXT_DOMAIN ), __( 'Help & Support', WPRSS_TEXT_DOMAIN ), apply_filters( 'wprss_capability', 'manage_feed_settings'), 'wprss-help', 'wprss_help_page_display' );
    }, 60);

    // Hides the "Add New" submenu
    add_action('admin_menu', function () {
        global $submenu;
        unset( $submenu['edit.php?post_type=wprss_feed'][10] );
    });

    add_filter('admin_body_class', 'wprss_base_admin_body_class');
    /**
     * Set body class for admin screens
     * http://www.kevinleary.net/customizing-wordpress-admin-css-javascript/
     * @since 2.0
     */
    function wprss_base_admin_body_class( $classes )
    {
        // Current action
        if ( is_admin() && isset($_GET['action']) ) {
            $classes .= ' action-'.$_GET['action'];
        }
        // Current post ID
        if ( is_admin() && isset($_GET['post']) ) {
            $classes .= ' post-'.$_GET['post'];
        }
        // New post type & listing page
        if ( isset($_GET['post_type']) ) $post_type = $_GET['post_type'];
        if ( isset($post_type) ) {
            $classes .= ' post-type-'.$post_type;
        }
        // Editting a post type
        if ( isset( $_GET['post'] ) ) {
            $post_query = $_GET['post'];
        }
        if ( isset($post_query) ) {
            $current_post_edit = get_post($post_query);
            $current_post_type = $current_post_edit->post_type;
            if ( !empty($current_post_type) ) {
                $classes .= ' post-type-'.$current_post_type;
            }
        }
        // Return the $classes array
        return $classes;
    }


    /**
     * Change title on wprss_feed post type screen
     *
     * @since  2.0
     *
     * @param string $original The original title placeholder.
     *
     * @return string
     */
    function wprss_change_title_text($original) {
        if (get_post_type() === 'wprss_feed') {
            return __('Name this feed', WPRSS_TEXT_DOMAIN);
        }

        return $original;
    }


    add_filter( 'plugin_action_links', 'wprss_plugin_action_links', 10, 2 );
    /**
     * Add Settings action link in plugin listing
     *
     * @since  3.0
     * @param  array  $action_links
     * @param  string $plugin_file
     * @return array
     */
    function wprss_plugin_action_links( $action_links, $plugin_file ) {
        // check to make sure we are on the correct plugin
        if ( $plugin_file == 'wp-rss-aggregator/wp-rss-aggregator.php' ) {
            // the anchor tag and href to the URLs we want.
            $settings_link = '<a href="' . admin_url() . 'edit.php?post_type=wprss_feed&page=wprss-aggregator-settings">' . __( 'Settings', WPRSS_TEXT_DOMAIN ) . '</a>';
            $docs_link = '<a href="https://www.wprssaggregator.com/documentation/">' . __( 'Documentation', WPRSS_TEXT_DOMAIN ) . '</a>';
            // add the links to the beginning of the list
            array_unshift( $action_links, $settings_link, $docs_link );
        }
        return $action_links;
    }

    /**
     * Function for registering application's scripts that depends on advanced libraries.
     * It will enqueue manifest and vendor scripts, which contains all required logic
     * for bootstrapping application and dependencies.
     *
     * Use only for Vue-related apps that use Webpack for being built.
     *
     * @since 4.12.1
     *
     * @param $handle
     * @param string $src
     * @param array $deps
     * @param bool $ver
     * @param bool $in_footer
     */
    function wprss_plugin_enqueue_app_scripts( $handle, $src = '', $deps = array(), $ver = false, $in_footer = false ) {
        /*
         * Manifest file holds function used for bootstrapping and ordered
         * loading of dependencies and application.
         */
        wp_enqueue_script('wpra-manifest', WPRSS_APP_JS . 'wpra-manifest.min.js', array(), '0.1', true);

        /*
         * Vendor file holds all common dependencies for "compilable" applications.
         *
         * For example, `intro` pages application's and plugin's page application's files
         * holds only logic for that particular application. Common dependencies like Vue
         * live in this file and loaded before that application.
         */
        wp_enqueue_script('wpra-vendor', WPRSS_APP_JS . 'wpra-vendor.min.js', array(
            'wpra-manifest'
        ), '0.1', true);

        /*
         * Enqueue requested script.
         */
        $deps = array_merge(array(
            'wpra-manifest',
            'wpra-vendor',
        ), $deps);
        wp_enqueue_script($handle, $src, $deps, $ver, $in_footer);
    }

    add_filter('admin_footer_text', 'wprss_admin_footer');
    /**
     * Adds footer text on the plugin pages.
     *
     * @param string $footer The footer text to filter
     *
     * @return string         The filtered footer text with added plugin text, or the param
     *                        value if the page is not specific to the plugin.
     */
    function wprss_admin_footer($footer)
    {
        // Current post type
        global $typenow;
        // Check if type is a plugin type. If not, stop
        // Plugin type is in the form 'wprss_*'' where * is 'feed', 'blacklist', etc)
        if (stripos($typenow, 'wprss_') !== 0) {
            return $footer;
        }

        // Prepare fragments of the message
        $thank_you = sprintf(
            __('Thank you for using <a href="%1$s" target="_blank">WP RSS Aggregator</a>.', 'wprss'),
            'https://www.wprssaggregator.com/'
        );
        $rate_us = sprintf(
            __('Please <a href="%1$s" target="_blank">rate us</a>!', 'wprss'),
            'https://wordpress.org/support/view/plugin-reviews/wp-rss-aggregator?filter=5#postform'
        );

        // Return the final text
        return sprintf('<span class="wp-rss-footer-text">%1$s %2$s</span>', $thank_you, $rate_us);
    }


File Name:
autoload.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\autoload.php
Code:
<?php

!defined('WPRSS_CORE_DISABLE_AUTOLOAD') &&
    define('WPRSS_CORE_DISABLE_AUTOLOAD', false);

if (!function_exists('wprss_autoloader')) {
    /**
     *
     * @return Aventura\Wprss\Core\Loader The loader singleton instance
     */
    function wprss_autoloader() {
        static $loader = null;
        $className = 'Aventura\\Wprss\\Core\\Loader';

        $composerAutoloader = '/vendor/autoload.php';
        if (!WPRSS_CORE_DISABLE_AUTOLOAD) {
            foreach(array(
                untrailingslashit(WPRSS_DIR) . $composerAutoloader, // Standalone
                realpath(WPRSS_DIR . '/../../..') . $composerAutoloader, // Vanilla WP, or another root package
            ) as $wprssAutoloadPath) {
                if (file_exists($wprssAutoloadPath)) {
                    require_once($wprssAutoloadPath);
                    break;
                }
            }
        }

        if (!class_exists($className)) {
            $dir = dirname(__FILE__);
            $classPath = str_replace('\\', DIRECTORY_SEPARATOR, $className);
            $classPath = "{$dir}/{$classPath}.php";
            require_once($classPath);
        }

        if ($loader === null) {
            $loader = new $className();
            /* @var $loader Aventura\Wprss\Core\Loader */
            !WPRSS_CORE_DISABLE_AUTOLOAD &&
                $loader->register();
        }

        return $loader;
    }
}


File Name:
cpt-feeds.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\cpt-feeds.php
Code:
<?php

	add_action( 'wp_head', 'wprss_cpt_feeds' );
	/**
	 * Adds Link tags to the head of the page, for CPTs' feeds.
	 */
	function wprss_cpt_feeds() {
		// Get all post types
		$post_types = get_post_types(array(
			'public'		=>	true,
			'_builtin'		=>	false
		));

		// If current page is archive page for a particular post type
		if ( is_post_type_archive() ) {
			// Remove post type from the post types list
			unset( $post_types[ get_post_type() ] );
		}
		
		// Filter which post types to use
		// False: none
		// True: all
		// Array: particular post types
		// String: Single post type
		$post_type_feeds = apply_filters( 'wprss_cpt_feeds', FALSE );
		switch( gettype( $post_type_feeds ) ) {
			// If it's a boolean ...
			case 'boolean':
				// If it is FALSE, exit function. Do nothing. Simply.
				if ( $post_type_feeds === FALSE ) return;
				// Otherwise, if TRUE, no further action is needed.
				break;
			// If it's a string ...
			case 'string':
				// If the post type does not exist, stop
				if ( !isset( $post_types[ $post_type_feeds ] ) ) return;
				// Otherwise, only use this post type
				$single = $post_types[ $post_type_feeds ];
				$post_types = array( $single => $single );
				break;
			// If it's an array ...
			case 'array':
				$post_types = array_intersect($post_types, $post_type_feeds);
				break;
			// If any other type, stop.
			default: return;
		}

		// Get only the values of the post types
		$post_types = array_values( $post_types );

		// Get the site name and RSS feed URL, parsed as an array
		$siteName = get_bloginfo("name");
		$feedURL = parse_url( get_bloginfo( 'rss2_url' ) );

		// Foreach post type
		foreach ( $post_types as $i => $post_type ) {
			// Get its RSS feed URL
			$feed = get_post_type_archive_feed_link( $post_type );

			// If it doesnt have one, use the interal WP feed URL using the post_type query arg
			if ( $feed === '' || !is_string( $feed ) ) {
				// Start with the feed URL of the site
				$feed = $feedURL;
				// If there are no query args, set to an emprty string
				if ( !isset( $feed['query'] ) )
					$feed['query'] = '';
				// If the query is not empty, we need to add an ampersand
				if ( strlen( $feed['query'] ) > 0  )
					$feed['query'] .= '&';
				// Add the post_type query arg
				$feed['query'] .= "post_type=$post_type";
				// Unparse the URL array into a string
				$feed = wprss_unparse_url( $feed );
			}

			// Get the Post Type Pretty Name
			$obj = get_post_type_object( $post_type );
			$name = $obj->labels->name;

			// Print the <link> tag
			$feedname = sprintf( __( '%1$s &raquo; %2$s Feed', WPRSS_TEXT_DOMAIN ), $siteName, $name ); 
			printf( __( '<link rel="%1$s" type="%2$s" title="%3$s" href="%4$s" />'."\n", WPRSS_TEXT_DOMAIN ),"alternate","application/rss+xml", $feedname, $feed );
		}
	}


	if ( !function_exists('wprss_unparse_url') ) {
		function wprss_unparse_url( $parsed_url ) {
			$scheme   = isset($parsed_url['scheme']) ? $parsed_url['scheme'] . '://' : ''; 
			$host     = isset($parsed_url['host']) ? $parsed_url['host'] : ''; 
			$port     = isset($parsed_url['port']) ? ':' . $parsed_url['port'] : ''; 
			$user     = isset($parsed_url['user']) ? $parsed_url['user'] : ''; 
			$pass     = isset($parsed_url['pass']) ? ':' . $parsed_url['pass']  : ''; 
			$pass     = ($user || $pass) ? "$pass@" : ''; 
			$path     = isset($parsed_url['path']) ? $parsed_url['path'] : ''; 
			$query    = isset($parsed_url['query']) ? '?' . $parsed_url['query'] : ''; 
			$fragment = isset($parsed_url['fragment']) ? '#' . $parsed_url['fragment'] : ''; 
			return "$scheme$user$pass$host$port$path$query$fragment"; 
		} 
	}

File Name:
cron-jobs.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\cron-jobs.php
Code:
<?php

define('WPRA_FETCH_ALL_FEEDS_HOOK', 'wprss_fetch_all_feeds_hook');
define('WPRA_FETCH_FEED_HOOK', 'wprss_fetch_single_feed_hook');
define('WPRA_TRUNCATE_ITEMS_HOOK', 'wprss_truncate_posts_hook');
define('WPRA_ACTIVATE_FEED_HOOK', 'wprss_activate_feed_schedule_hook');
define('WPRA_PAUSE_FEED_HOOK', 'wprss_pause_feed_schedule_hook');

define('WPRA_TRUNCATE_ITEMS_INTERVAL', 'daily');

/**
 * Alias for add_action, primarily used for readability to distinguish between cron-events and normal hooks.
 *
 * @since 4.17
 *
 * @param string   $cron     The cron hook event.
 * @param callable $callback The callback to invoke for the cron.
 */
function wpra_on_cron_do($cron, $callback)
{
    add_action($cron, $callback);
}

// Cron events
wpra_on_cron_do(WPRA_FETCH_ALL_FEEDS_HOOK, 'wprss_fetch_insert_all_feed_items_from_cron');
wpra_on_cron_do(WPRA_TRUNCATE_ITEMS_HOOK, 'wprss_truncate_posts');
wpra_on_cron_do(WPRA_ACTIVATE_FEED_HOOK, 'wprss_activate_feed_source');
wpra_on_cron_do(WPRA_PAUSE_FEED_HOOK, 'wprss_pause_feed_source');

// Initialize crons that must always be scheduled
add_action('init', 'wpra_init_crons');

// When a feed source is activated, schedule its fetch cron
add_action('wprss_on_feed_source_activated', 'wprss_feed_source_update_start_schedule');

// When a feed source is paused, cancel its fetch cron
add_action('wprss_on_feed_source_paused', 'wprss_feed_source_update_stop_schedule');

// Filter the possible cron intervals to add more options
add_filter('cron_schedules', 'wprss_filter_cron_schedules');

/**
 * Initializes the cron jobs.
 *
 * @since 4.17
 */
function wpra_init_crons()
{
    wprss_schedule_fetch_all_feeds_cron();
    wprss_schedule_truncate_posts_cron();
}

/**
 * Creates the cron to fetch feeds.
 *
 * @since 2.0
 */
function wprss_schedule_fetch_all_feeds_cron()
{
    // Check if the global fetch is scheduled
    if (wp_next_scheduled(WPRA_FETCH_ALL_FEEDS_HOOK)) {
        return;
    }

    // If the event is not scheduled, schedule it
    $interval = wprss_get_general_setting('cron_interval');
    wp_schedule_event(time(), $interval, WPRA_FETCH_ALL_FEEDS_HOOK);
}

/**
 * Gets the time of the global fetch cron.
 *
 * @since 4.17
 *
 * @return false|string A time string in the form `H:i`
 */
function wprss_get_global_update_time()
{
    // If the global fetch cron is not scheduled, schedule it
    wprss_schedule_fetch_all_feeds_cron();

    // Get the timestamp for the next run
    $next = wp_next_scheduled(WPRA_FETCH_ALL_FEEDS_HOOK);

    return date('H:i', $next);
}

/**
 * Creates the cron to truncate wprss_feed_item posts daily
 *
 * @since 2.0
 */
function wprss_schedule_truncate_posts_cron()
{
    // Check if the truncatation cron is scheduled
    if (wp_next_scheduled(WPRA_TRUNCATE_ITEMS_HOOK)) {
        return;
    }

    // If not, schedule it
    wp_schedule_event(time(), WPRA_TRUNCATE_ITEMS_INTERVAL, WPRA_TRUNCATE_ITEMS_HOOK);
}

/**
 * Updates the feed processing cron job schedules.
 * Removes the current schedules and adds the ones in the feed source's meta.
 *
 * @since 3.8
 *
 * @param int $feed_id The id of the wprss_feed
 */
function wprss_update_feed_processing_schedules($feed_id)
{
    // Get the feed's activate and pause times
    $activate = get_post_meta($feed_id, 'wprss_activate_feed', true);
    $pause = get_post_meta($feed_id, 'wprss_pause_feed', true);

    // Parse as time strings
    $activate = wprss_strtotime($activate);
    $pause = wprss_strtotime($pause);

    if (!empty($activate)) {
        wpra_reschedule($activate, WPRA_ACTIVATE_FEED_HOOK, null, [$feed_id]);
    }

    if ($pause !== '') {
        wpra_reschedule($pause, WPRA_PAUSE_FEED_HOOK, null, [$feed_id]);
    }
}

/**
 * Starts the looping schedule for a feed source. Runs on a schedule
 *
 * @since 3.9
 *
 * @param int $feed_id The ID of the feed source
 */
function wprss_feed_source_update_start_schedule($feed_id)
{
    // Stop any currently scheduled update operations
    wprss_feed_source_update_stop_schedule($feed_id);

    // Get the interval
    $interval = get_post_meta($feed_id, 'wprss_update_interval', true);
    // Do nothing if the feed source has no update interval (not sure if possible) or if the interval
    // is set to global
    if ($interval === '' || $interval === wprss_get_default_feed_source_update_interval()) {
        return;
    }

    wp_schedule_event(time(), $interval, WPRA_FETCH_FEED_HOOK, [strval($feed_id)]);
}

/**
 * Stops any scheduled update operations for a feed source. Runs on a schedule.
 *
 * @since 3.9
 *
 * @param int $feed_id The ID of the feed source ( wprss_feed )
 */
function wprss_feed_source_update_stop_schedule($feed_id)
{
    $timestamp = wprss_get_next_feed_source_update($feed_id);

    // If a schedule exists, unschedule it
    if ($timestamp !== false) {
        wp_unschedule_event($timestamp, WPRA_FETCH_FEED_HOOK, [strval($feed_id)]);
    }
}

/**
 * Returns the timestamp for the next global update
 *
 * @since 4.18
 *
 * @return int The timestamp of the next global update operation, or false if no update is scheduled.
 */
function wprss_get_next_global_update()
{
    return wp_next_scheduled(WPRA_FETCH_ALL_FEEDS_HOOK, []);
}

/**
 * Returns the timestamp for the next feed source update
 *
 * @since 3.9
 *
 * @param int  $feed_id  The ID of the feed source ( wprss_feed )
 * @param bool $explicit If true, the function won't default to the global update if the feed doesn't use its own
 *                       update interval.
 *
 * @return int The timestamp of the next update operation, or false if no update is scheduled.
 */
function wprss_get_next_feed_source_update($feed_id, $explicit = true)
{
    $next = wp_next_scheduled(WPRA_FETCH_FEED_HOOK, [strval($feed_id)]);

    if ($explicit) {
        return $next;
    }

    $meta = get_post_meta($feed_id, 'wprss_update_interval', true);

    return (empty($meta) || $meta === wprss_get_default_feed_source_update_interval())
        ? wprss_get_next_global_update()
        : $next;
}

/**
 * Reschedules a cron event, unscheduling any existing matching crons.
 *
 * @since 4.17
 *
 * @param int         $timestamp  The timestamp.
 * @param string      $event      The hook event.
 * @param string|null $recurrence The recurrence.
 * @param array       $args       Additional args.
 */
function wpra_reschedule($timestamp, $event, $recurrence = null, $args = [])
{
    $existing = wp_next_scheduled($event, $args);

    if ($existing !== false) {
        wp_unschedule_event($existing, $event, $args);
    }

    if ($recurrence === null) {
        wp_schedule_single_event($timestamp, $event, $args);
    } else {
        wp_schedule_event($timestamp, $recurrence, $event, $args);
    }
}

/**
 * Clears all events scheduled to a particular hook, regardless of their args.
 *
 * @since 4.17.9
 *
 * @param string $hook
 */
function wpra_clear_all_scheduled_hooks($hook)
{
    foreach (wpra_get_crons() as $key => $events) {
        if ($key === $hook) {
            foreach ($events as $event) {
                wp_clear_scheduled_hook($key, $event->args);
            }
        }
    }
}

/**
 * Retrieves all cron jobs from WordPress.
 *
 * @since 4.17.9
 *
 * @return array A mapping of hook names to sub-arrays of even objects.
 */
function wpra_get_crons()
{
    $cronsArray = _get_cron_array();
    $crons = [];
    foreach ($cronsArray as $ts => $list) {
        foreach ($list as $hook => $events) {
            $crons[$hook] = isset($crons[$hook]) ? $crons[$hook] : [];

            foreach ($events as $event) {
                $crons[$hook][] = (object) $event;
            }
        }
    }

    return $crons;
}

/**
 * Retrieves the cron schedules that WPRA uses.
 *
 * @since 4.17
 *
 * @return array
 */
function wpra_get_cron_schedules()
{
    return [
        'five_min' => array(
            'display' => __('Once every 5 minutes', 'wprss'),
            'interval' => MINUTE_IN_SECONDS * 5,
        ),
        'ten_min' => array(
            'display' => __('Once every 10 minutes', 'wprss'),
            'interval' => MINUTE_IN_SECONDS * 10,
        ),
        'fifteen_min' => array(
            'display' => __('Once every 15 minutes', 'wprss'),
            'interval' => MINUTE_IN_SECONDS * 15,
        ),
        'thirty_min' => array(
            'display' => __('Once every 30 minutes', 'wprss'),
            'interval' => MINUTE_IN_SECONDS * 30,
        ),
        'two_hours' => array(
            'display' => __('Once every 2 hours', 'wprss'),
            'interval' => HOUR_IN_SECONDS * 2,
        ),
        'weekly' => array(
            'display' => __('Once weekly', 'wprss'),
            'interval' => WEEK_IN_SECONDS,
        ),
    ];
}

/**
 * Registers the cron schedules to WordPress, avoiding duplicates.
 *
 * @since 3.0
 */
function wprss_filter_cron_schedules($schedules)
{
    // Pluck out the intervals
    $intervals = array_map(function ($schedule) {
        return (isset($schedule['interval']) && is_numeric($schedule['interval']))
            ? $schedule['interval']
            : null;
    }, $schedules);
    // Remove null values
    $intervals = array_filter($intervals);
    // Get a map of intervals -> keys for fast interval lookup
    $intervalsMap = array_flip($intervals);

    // Register each WPRA schedule
    $wpraSchedules = wpra_get_cron_schedules();
    foreach ($wpraSchedules as $key => $schedule) {
        // If the interval already exists, skip the schedule
        if (array_key_exists($schedule['interval'], $intervalsMap)) {
            continue;
        }

        $schedules[$key] = $schedule;
    }

    return $schedules;
}

/**
 * Deletes a custom cron schedule.
 *
 * Credits: WPCrontrol
 *
 * @since 3.7
 *
 * @param string $name The internal_name of the schedule to delete.
 */
function wprss_delete_schedule($name)
{
    $scheds = get_option('crontrol_schedules', array());
    unset($scheds[$name]);
    update_option('crontrol_schedules', $scheds);
}

/**
 * Parses the date time string into a UTC timestamp.
 * The string must be in the format: m/d/y h:m:s
 *
 * @since 3.9
 */
function wprss_strtotime($str)
{
    if (empty($str)) {
        return 0;
    }

    $parts = explode(' ', $str);
    $date = explode('/', $parts[0]);
    $time = explode(':', $parts[1]);

    return mktime($time[0], $time[1], $time[2], $date[1], $date[0], $date[2]);
}

/**
 * Returns the default value for the per feed source update interval
 *
 * @since 3.9
 */
function wprss_get_default_feed_source_update_interval()
{
    return 'global';
}


File Name:
deprecated.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\deprecated.php
Code:
<?php

/**
 * This file contains all legacy deprecated constants and functionality for WP RSS Aggregator.
 *
 * @since 4.13
 */

// The feed source CPT name
define('WPRSS_POST_TYPE_FEED_SOURCE', 'wprss_feed');

add_filter('wp_link_query_args', 'wprss_modify_link_builder_query');
/**
 * Filter the link query arguments to exclude the feed and feed item post types.
 * This filter will only work for WordPress versions 3.7 or higher.
 *
 * @since 3.4.3
 *
 * @deprecated Needs to be refactored/moved into an appropriate module
 *
 * @param array $query An array of WP_Query arguments.
 *
 * @return array $query
 */
function wprss_modify_link_builder_query($query)
{
    // custom post type slugs to be removed
    $toRemove = ['wprss_feed', 'wprss_feed_item', 'wprss_feed_template'];

    // find and remove the array keys
    foreach ($toRemove as $postType) {
        if ($key = array_search($postType, $query['post_type'])) {
            unset($query['post_type'][$key]);
        }
    }

    return $query;
}

/**
 * @deprecated Replaced by PSR Logging since 4.13
 */
function wprss_log_get_level()
{
    return 'Error';
}


File Name:
di.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\di.php
Code:
<?php
/*
 * The DI module
 */

use Aventura\Wprss\Core\CompositeContainer as WpraCompositeContainer;
use Aventura\Wprss\Core\Container;
use Aventura\Wprss\Core\ServiceProvider;
use Dhii\Di\CompositeContainer;
use Dhii\Di\CompositeContainerInterface;
use Dhii\Di\WritableCompositeContainerInterface;
use Dhii\Di\WritableContainerInterface;

define('WPRSS_SERVICE_ID_PREFIX', \WPRSS_PLUGIN_CODE . '.');


if (!function_exists('wprss_wp_container')) {

    /**
     * Gets the global WP container.
     *
     * This is intended to be used everywhere in WP, by all plugins.
     *
     * @since 4.11
     *
     * @staticvar CompositeContainer $container
     * @return CompositeContainerInterface The global composite container.
     */
    function wprss_wp_container()
    {
        static $container = null;

        if (is_null($container)) {
            $container = new CompositeContainer();

            /**
             * Exposes the global container at the moment of its initialization.
             *
             * This allows registration of child containers specific to plugins.
             *
             * @since 4.11
             *
             * @param WritableCompositeContainerInterface The global DI container.
             */
            do_action('wp_container_init', $container);
        }

        return $container;
    }
}

/**
 * Retrieves the container that has access to all services of all WPRA plugins.
 *
 * @since 4.11
 * @staticvar WpraCompositeContainer $container
 * @return CompositeContainerInterface The WPRA hub container.
 */
function wprss_hub_container()
{
    static $container = null;

    if (is_null($container)) {
        $container = new WpraCompositeContainer(wprss_wp_container());


        /**
         * Exposes the WPRA-wide container at the moment of its initialization.
         *
         * This allows registration of child containers specific to WPRA extensions.
         *
         * @since 4.11
         *
         * @param WritableCompositeContainerInterface The WPRA container DI container.
         */
        do_action('wprss_container_init', $container);
    }

    return $container;
}

/**
 * Retrieves the WPRA Core container instance.
 *
 * @since 4.11
 *
 * @staticvar Container $container
 * @return Container The container instance.
 */
function wprss_core_container()
{
    static $container = null;

    if (is_null($container)) {
        $serviceProvider = new ServiceProvider(array(
            'service_id_prefix'         => \WPRSS_SERVICE_ID_PREFIX,
            'event_prefix'              => \WPRSS_EVENT_PREFIX,
        ));
        $container = new Container($serviceProvider, wprss_hub_container());

        /**
         * Exposes the WPRA Core container at the moment of its initialization.
         *
         * @since 4.11
         *
         * @param WritableCompositeContainerInterface The container which has all WPRA Core services.
         */
        do_action('wprss_core_container_init', $container);
    }

    return $container;
}

// Making sure the global container is initialized - 1st tier
add_action('wprss_pre_init', function() {
    wprss_wp_container();
});

// Adding WPRA-wide container - 2nd tier
add_action('wp_container_init', function(WritableCompositeContainerInterface $parent) {
    $container = wprss_hub_container();

    $parent->add($container);
});

// Creating and attaching the WPRA Core container, and feeding service definitions to it
add_action('wprss_container_init', function(WritableCompositeContainerInterface $parent) {
    $container = wprss_core_container();

    $parent->add($container);
});

// Adds the bulk import service provider to the old Aventura container
add_filter('wprss_core_container_init', function (WritableContainerInterface $container) {
    $serviceProvider = new \Aventura\Wprss\Core\Model\BulkSourceImport\ServiceProvider(array(
        'notice_service_id_prefix' => \WPRSS_NOTICE_SERVICE_ID_PREFIX,
        'service_id_prefix' => \WPRSS_SERVICE_ID_PREFIX,
        'event_prefix' => \WPRSS_EVENT_PREFIX,
    ));
    $container->register($serviceProvider);
});


File Name:
fallback-mbstring.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\fallback-mbstring.php
Code:
<?php

/**
 * A utility class that provides compatibility padding for multibyte string
 * functionality.
 * 
 * Taken mostly from {@link https://doc.wikimedia.org/mediawiki-core/master/php/Fallback_8php_source.html here}
 * 
 * @since 4.7
 */
class WPRSS_MBString {


	/**
	 * @since 4.7
	 * @param string $str
	 * @param int $start
	 * @param int|string $count
	 * @return string
	 */
	public static function mb_substr( $str, $start, $count = 'end' ) {
		if ( function_exists( 'mb_substr' ) ) {
			return mb_substr( $str, $start );
		}

		if ( $start != 0 ) {
			$split = self::mb_substr_split_unicode( $str, intval( $start ) );
			$str = substr( $str, $split );
		}

		if ( $count !== 'end' ) {
			$split = self::mb_substr_split_unicode( $str, intval( $count ) );
			$str = substr( $str, 0, $split );
		}

		return $str;
	}


	/**
	 * @since 4.7
	 * @param string $str
	 * @param int $splitPos
	 * @return int
	 */
	public static function mb_substr_split_unicode( $str, $splitPos ) {
		if ( $splitPos == 0 ) {
			return 0;
		}

		$byteLen = strlen( $str );

		if ( $splitPos > 0 ) {
			if ( $splitPos > 256 ) {
			// Optimize large string offsets by skipping ahead N bytes.
			// This will cut out most of our slow time on Latin-based text,
			// and 1/2 to 1/3 on East European and Asian scripts.
				$bytePos = $splitPos;
				while ( $bytePos < $byteLen && $str[$bytePos] >= "\x80" && $str[$bytePos] < "\xc0" ) {
					++$bytePos;
				}
				$charPos = mb_strlen( substr( $str, 0, $bytePos ) );
			} else {
				$charPos = 0;
				$bytePos = 0;
			}

			while ( $charPos++ < $splitPos ) {
				++$bytePos;
				// Move past any tail bytes
				while ( $bytePos < $byteLen && $str[$bytePos] >= "\x80" && $str[$bytePos] < "\xc0" ) {
					++$bytePos;
				}
			}
		} else {
			$splitPosX = $splitPos + 1;
			$charPos = 0; // relative to end of string; we don't care about the actual char position here
			$bytePos = $byteLen;
			while ( $bytePos > 0 && $charPos-- >= $splitPosX ) {
				--$bytePos;
				// Move past any tail bytes
				while ( $bytePos > 0 && $str[$bytePos] >= "\x80" && $str[$bytePos] < "\xc0" ) {
					--$bytePos;
				}
			}
		}

		return $bytePos;
	}


	/**
	 * @since 4.7
	 * @param string $str
	 * @return int
	 */
	public static function mb_strlen( $str, $enc = '' ) {
		if ( function_exists( 'mb_strlen' ) ) {
			return mb_strlen( $str );
		}

		$counts = count_chars( $str );
		$total = 0;

		// Count ASCII bytes
		for ( $i = 0; $i < 0x80; $i++ ) {
			$total += $counts[$i];
		}

		// Count multibyte sequence heads
		for ( $i = 0xc0; $i < 0xff; $i++ ) {
			$total += $counts[$i];
		}
		return $total;
	}


	/**
	 * @since 4.7
	 * @param string $haystack
	 * @param string $needle
	 * @param int $offset
	 * @return int|boolean
	 */
	public static function mb_strpos( $haystack, $needle, $offset = 0, $encoding = '' ) {
		if ( function_exists( 'mb_strpos' ) ) {
			return mb_strpos( $haystack, $needle, $offset );
		}

		$needle = preg_quote( $needle, '/' );

		$ar = array();
		preg_match( '/' . $needle . '/u', $haystack, $ar, PREG_OFFSET_CAPTURE, $offset );

		if ( isset( $ar[0][1] ) ) {
			return $ar[0][1];
		} else {
			return false;
		}
	}


	/**
	 * @since 4.7
	 * @param string $haystack
	 * @param string $needle
	 * @param int $offset
	 * @return int|boolean
	 */
	public static function mb_stripos( $haystack, $needle, $offset = 0, $encoding = '' ) {
		if ( function_exists( 'mb_stripos' ) ) {
			return mb_stripos( $haystack, $needle, $offset );
		}


		$needle = preg_quote( $needle, '/' );

		$ar = array();
		preg_match( '/' . $needle . '/ui', $haystack, $ar, PREG_OFFSET_CAPTURE, $offset );

		if ( isset( $ar[0][1] ) ) {
			return $ar[0][1];
		} else {
			return false;
		}
	}


	/**
	 * @since 4.7
	 * @param string $haystack
	 * @param string $needle
	 * @param int $offset
	 * @return int|boolean
	 */
	public static function mb_strrpos( $haystack, $needle, $offset = 0, $encoding = '' ) {
		if ( function_exists( 'mb_strrpos' ) ) {
			return mb_strrpos( $haystack, $needle, $offset );
		}

		$needle = preg_quote( $needle, '/' );

		$ar = array();
		preg_match_all( '/' . $needle . '/u', $haystack, $ar, PREG_OFFSET_CAPTURE, $offset );

		if ( isset( $ar[0] ) && count( $ar[0] ) > 0 && isset( $ar[0][count( $ar[0] ) - 1][1] ) ) {
			return $ar[0][count( $ar[0] ) - 1][1];
		} else {
			return false;
		}
	}

	/**
	 * Lowercase a UTF-8 string.
	 * This supports accented letters, but nothing more.
	 * Taken from {@link https://github.com/drupal/drupal/blob/9.x/core/includes/unicode.inc#L432 here}.
	 *
	 * @since 4.7
	 * @param string $text The string to run the operation on.
	 * @return string The string in lowercase.
	 */
	public static function mb_strtolower( $text ) {
		if ( function_exists( 'mb_strtolower' ) )
			return mb_strtolower( $text );
		
		// Use C-locale for ASCII-only lowercase
		$text = strtolower( $text );
		// Case flip Latin-1 accented letters
		$text = preg_replace_callback( '/\xC3[\x80-\x96\x98-\x9E]/', array( __CLASS__, '_unicode_caseflip' ), $text );
		return $text;
	}
	

	/**
	 * Flips U+C0-U+DE to U+E0-U+FD and back.
	 *
	 * @since 4.7
	 * @param $matches An array of matches.
	 * @return array The Latin-1 version of the array of matches.
	 * @see mb_strtolower()
	 */
	public static function _unicode_caseflip( $matches ) {
		return $matches[0][0] . chr( ord( $matches[0][1] ) ^ 32 );
	}

}


File Name:
feed-access.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-access.php
Code:
<?php


/**
 * Centralizes control over resource fetching.
 *
 * @since 4.7
 */
class WPRSS_Feed_Access
{

    const RESOURCE_CLASS = 'WPRSS_SimplePie_File';
    const ITEM_CLASS = 'WPRSS_SimplePie_Item';
    const D_REDIRECTS = 5;

    const SETTING_KEY_CERTIFICATE_PATH = 'certificate-path';
    const SETTING_KEY_FEED_REQUEST_USERAGENT = 'feed_request_useragent';
    const SETTING_KEY_CACHE = 'feed_cache_enabled';

    protected static $_instance;

    protected $_certificate_file_path;

	/**
	 * @since 4.7
	 * @return WPRSS_Feed_Access The singleton instance of this class.
	 */
	public static function instance() {
		if ( is_null( self::$_instance ) ) {
			$class_name = __CLASS__;
			self::$_instance = new $class_name;
		}

		return self::$_instance;
	}


	public function __construct() {
		$this->_construct();
	}


	/**
	 * The parameter-less constructor.
	 *
	 * @since 4.7
	 */
	protected function _construct()
        {
            $wprss = wprss();
            add_action( 'wprss_fetch_feed_before', array( $this, 'set_feed_options' ), 10, 2 );
            add_action( 'wprss_settings_array', array( $this, 'add_settings' ) );
            $wprss->on('fields', array($this, 'add_feed_source_fields'));
	}


	/**
	 * Sets the path to the certificate, which will be used by WPRSS to fetch remote content.
	 *
	 * @since 4.7
	 * @param string $path Absolute path to the certificate file.
	 * @return \WPRSS_Feed_Access This instance.
	 */
	public function set_certificate_file_path( $path ) {
		$this->_certificate_file_path = $path;
		return $this;
	}


	/**
	 * Gets the path to the certificate, which will be used by WPRSS to fetch remote content.
	 *
	 * @since 4.7
	 * @see get_certificate_path_setting()
	 * @return string Absolute path to the certificate file. By default will use the option.
	 */
	public function get_certificate_file_path() {
		if ( empty( $this->_certificate_file_path ) )
			$this->_certificate_file_path = $this->get_certificate_path_setting();

		return $this->_certificate_file_path;
	}


	/**
	 * Gets the value of the option that stores the path to the certificate file.
	 * Relative paths will be converted to absolute, as if relative to WP root.
	 *
	 * @since 4.7
	 * @return string Absolute path to the certificate file.
	 */
	public function get_certificate_path_setting() {
		$path = wprss_get_general_setting( self::SETTING_KEY_CERTIFICATE_PATH );

		if ( empty( $path ) )
			return $path;

		if ( !path_is_absolute( $path ) )
			$path = ABSPATH . $path;

		return $path;
	}

    /**
     * Return the value of the useragent setting.
     *
     * The setting key is determined by the SETTING_KEY_FEED_REQUEST_USERAGENT class constant.
     *
     * @since 4.8.2
     * @return string The value of the useragent setting.
     */
    public function get_useragent_setting()
    {
		return wprss_get_general_setting( self::SETTING_KEY_FEED_REQUEST_USERAGENT, true );
    }

    /**
     * Get the useragent string that will be sent with feed requests.
     *
     * @since 4.8.2
     *
     * @param int|null $feedSourceId The ID of the feed source, which to get the useragent for.
     *  Leave `null` to get a useragent independently from any feed source.
     *
     * @return string The useragent string that will be sent together with feed requests.
     *  If empty, the value of SIMPLEPIE_USERAGENT will be used.
     */
    public function get_useragent($feedSourceId = null)
    {
        $useragent = !is_null($feedSourceId)
                ? get_post_meta($feedSourceId, self::SETTING_KEY_FEED_REQUEST_USERAGENT, true)
                : $this->get_useragent_setting();

        if (!strlen(trim($useragent))) {
            $useragent = $this->get_useragent_setting();
        }

        $useragent = !strlen(trim($useragent))
            ? $this->getDefaultUseragent()
            : $useragent;

        wprss()->event('feed_access_useragent', array(
            'useragent'         => &$useragent,
            'feed_source_id'    => $feedSourceId
        ));

        return $useragent;
    }

    /**
     * Retrieve the useragent string that will be used by default.
     *
     * @since 4.10
     *
     * @return string The useragent string.
     */
    public function getDefaultUseragent()
    {
        return SIMPLEPIE_USERAGENT;
    }


	/**
	 * This happens immediately before feed initialization.
	 * Handles the `wprss_fetch_feed_before` action.
	 *
	 * @since 4.7
	 * @param SimplePie $feed The instance of the object that represents the feed to be fetched.
	 * @param int $feedSourceId ID of the feed source, which is accessing the feed.
         *  Leave `null` to skip setting feed source specific options.
	 * @param string $url The URL, from which the feed is going to be fetched.
	 */
	public function set_feed_options($feed, $feedSourceId = null)
        {
            $feed->set_item_class(static::ITEM_CLASS);
            $feed->set_file_class( static::RESOURCE_CLASS );
            $feed->set_useragent($this->get_useragent($feedSourceId));
            WPRSS_SimplePie_File::set_default_certificate_file_path($this->get_certificate_file_path());

            /*
             * Setting the file resource object for the feed to use.
             * Note: this object will only be used if cache is disabled for
             * the feed. This is why running {@see SimplePie::set_file_class()}
             * is still necessary. Like this, the correct file class will
             * still be used, although the file object set below will
             * have absolutely no effect on the feed retrieval process.
             */
            if (!$feed->file) {
                $feed->file = $this->create_resource_from_feed($feed);
            }
	}


	/**
	 * Implements a `wprss_settings_array` filter.
	 *
	 * @since 4.7
	 * @param array $settings The current settings array, where 1st dimension is secion code, 2nd is setting code, 3rd is setting option(s).
	 * @return array The new settings array.
	 */
	public function add_settings( $settings ) {
		$settings['advanced'][ self::SETTING_KEY_CERTIFICATE_PATH ] = array(
			'label'			=> __( 'Certificate path', WPRSS_TEXT_DOMAIN ),
			'callback'		=> array( $this, 'render_certificate_path_setting' )
		);
        /* @since 4.8.2 */
		$settings['advanced'][ self::SETTING_KEY_FEED_REQUEST_USERAGENT ] = array(
			'label'			=> __( 'Feed request useragent', WPRSS_TEXT_DOMAIN ),
			'callback'		=> array( $this, 'render_feed_request_useragent_setting' )
		);
        /* @since 4.14.1 */
        $settings['advanced'][ self::SETTING_KEY_CACHE ] = array(
            'label'			=> __( 'Enable feed cache', WPRSS_TEXT_DOMAIN ),
            'callback'		=> array( $this, 'render_feed_cache_setting' )
        );

		return $settings;
	}

        /**
         * Adding feed source specific settings.
         *
	 * @since 4.10
         *
         * @param array $fields An array containing all existing fields by ID.
         */
        public function add_feed_source_fields($fields)
        {
            $wprss = wprss();

            $fields[self::SETTING_KEY_FEED_REQUEST_USERAGENT] = array(
                'id'            => self::SETTING_KEY_FEED_REQUEST_USERAGENT,
                'label'         => $wprss->__('Feed request useragent'),
                'placeholder'   => $wprss->__('Leave blank to inherit general setting')
            );

            return $fields;
        }

	/**
	 * Renders the setting field for the certificate path.
	 *
	 * @since 4.7
	 * @see wprss_admin_init
	 * @param array $field Data of this field.
	 */
	public function render_certificate_path_setting( $field ) {
        $feed_limit = wprss_get_general_setting( $field['field_id'] );
        ?>
		<input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[<?php echo $field['field_id'] ?>]" type="text" value="<?php echo $feed_limit ?>" />
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
	}

    /**
     * Renders the setting field for the feed request useragent.
     *
     * @since 4.8.2
	 * @see wprss_admin_init
	 * @param array $field Data of this field.
     */
    public function render_feed_request_useragent_setting( $field )
    {
        $value = wprss_get_general_setting( $field['field_id'] );
        ?>
		<input id="<?php echo $field['field_id'] ?>" name="wprss_settings_general[<?php echo $field['field_id'] ?>]" type="text" value="<?php echo $value ?>" placeholder="<?php echo __('Default', WPRSS_TEXT_DOMAIN) ?>" />
		<?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /**
     * Renders the setting field for the feed cache option.
     *
     * @since 4.15
     *
     * @param array $field The information for this field.
     */
    public function render_feed_cache_setting( $field )
    {
        $value = (int) wprss_get_general_setting($field['field_id']);
        ?>
        <input name="wprss_settings_general[<?= $field['field_id'] ?>]" type="hidden" value="0" />
        <input id="<?= $field['field_id'] ?>"
            name="wprss_settings_general[<?= $field['field_id'] ?>]"
            type="checkbox"
            value="1"
            <?= checked(1, $value, false) ?>
            />
        <?php echo wprss_settings_inline_help( $field['field_id'], $field['tooltip'] );
    }

    /**
     * Retrieve default headers that should be used for feed requests.
     *
     * Use the `wprss_feed_default_headers` filter to amend the whole return value.
     * Use the `wprss_feed_default_headers_accept` to amend the types in the "Accept" header.
     *
     * @since 4.10
     * @see array_merge_recursive_distinct()
     * @param array $additionalHeaders Optional headers to merge with the default ones.
     *  Merging is done recursively.
     * @return array An array of headers, where keys are header names, and values are header values.
     */
    public function default_headers(array $additionalHeaders = array())
    {
        $defaultHeaders = array(
            'Accept' => implode(', ', apply_filters('wprss_feed_default_headers_accept', array(
                'application/atom+xml',
                'application/rss+xmlm',
                'application/rdf+xml;q=0.9',
                'application/xml;q=0.8',
                'text/xml;q=0.8',
                'text/html;q=0.7',
                'unknown/unknown;q=0.1',
                'application/unknown;q=0.1',
                '*/*;q=0.1')))
        );

        $headers = array_merge_recursive_distinct($defaultHeaders, $additionalHeaders);
        $headers = apply_filters('wprss_feed_default_headers', $headers);

        return $headers;
    }

    /**
     * Creates a new object that is responsible for retrieving a remote resource.
     *
     * @since 4.10
     *
     * @see SimplePie_File::__construct()
     *
     * @param string $url
     * @param int $timeout
     * @param int $redirects
     * @param array $headers If null, {@link default_headers() default headers} will be used.
     * @param string $useragent
     * @param bool $force_fsockopen
     * @return \SimplePie_File
     */
    public function create_resource($url, $timeout = 10, $redirects = 5, $headers = null, $useragent = null, $force_fsockopen = false)
    {
        if (is_null($headers)) {
            $headers = $this->default_headers();
        }

        if (!class_exists($resourceClass = static::RESOURCE_CLASS)) {
            throw new Exception(sprintf('Could not create resource: resource class "$1$s" does not exist', $resourceClass));
        }

        return new $resourceClass($url, $timeout, $redirects, $headers, $useragent, $force_fsockopen);
    }

    /**
     * Creates a new object that is responsible for retrieving a remote resource, using values from a feed.
     *
     * @since 4.10
     *
     * @see wprss_feed_create_resource()
     *
     * @param \SimplePie $feed The feed, based on which to create the resource.
     * @return \SimplePie_File
     */
    public function create_resource_from_feed(SimplePie $feed)
    {
        return $this->create_resource($feed->feed_url, $feed->timeout, static::D_REDIRECTS, null, $feed->useragent, $feed->force_fsockopen);
    }
}

// Initialize
add_action('wprss_init', function() {
    WPRSS_Feed_Access::instance();
});

class WPRSS_SimplePie_Item extends SimplePie_Item {

    public function sanitize($data, $type, $base = '')
    {
        if ($type & (SIMPLEPIE_CONSTRUCT_HTML | SIMPLEPIE_CONSTRUCT_XHTML | SIMPLEPIE_CONSTRUCT_MAYBE_HTML)) {
            return $data;
        }

        return parent::sanitize($data, $type, $base);
    }
}


/**
 * A padding layer used to give WPRSS more control over fetching of feed resources.
 * @since 4.7
 */
class WPRSS_SimplePie_File extends SimplePie_File {

	protected static $_default_certificate_file_path;
	protected $_certificate_file_path;


	/**
	 * Copied from {@see SimplePie_File#__construct()}.
	 * Adds call to {@see _before_curl_exec()}.
	 *
	 * @since 4.7
	 */
	public function __construct( $url, $timeout = 10, $redirects = 5, $headers = null, $useragent = null, $force_fsockopen = false ) {
		if ( class_exists( 'idna_convert' ) ) {
			$idn = new idna_convert();
			$parsed = SimplePie_Misc::parse_url( $url );
			$url = SimplePie_Misc::compress_parse_url( $parsed['scheme'], $idn->encode( $parsed['authority'] ), $parsed['path'], $parsed['query'], $parsed['fragment'] );
			wprss_log_obj('Converted IDNA URL', $url, null, WPRSS_LOG_LEVEL_SYSTEM);
		}
		$this->url = $url;
		$this->useragent = $useragent;
		if ( preg_match( '/^http(s)?:\/\//i', $url ) ) {
			if ( $useragent === null ) {
				$useragent = ini_get( 'user_agent' );
				$this->useragent = $useragent;
			}
			if ( !is_array( $headers ) ) {
				$headers = array();
			}
			if ( !$force_fsockopen && function_exists( 'curl_exec' ) ) {
				$this->method = SIMPLEPIE_FILE_SOURCE_REMOTE | SIMPLEPIE_FILE_SOURCE_CURL;
				$fp = curl_init();
				$headers2 = array();
				foreach ( $headers as $key => $value ) {
					$headers2[] = "$key: $value";
				}
				if ( version_compare( SimplePie_Misc::get_curl_version(), '7.10.5', '>=' ) ) {
					curl_setopt( $fp, CURLOPT_ENCODING, '' );
				}
				curl_setopt( $fp, CURLOPT_URL, $url );
				curl_setopt( $fp, CURLOPT_HEADER, 1 );
				curl_setopt( $fp, CURLOPT_RETURNTRANSFER, 1 );
				curl_setopt( $fp, CURLOPT_TIMEOUT, $timeout );
				curl_setopt( $fp, CURLOPT_CONNECTTIMEOUT, $timeout );
				curl_setopt( $fp, CURLOPT_USERAGENT, $useragent );
				curl_setopt( $fp, CURLOPT_HTTPHEADER, $headers2 );
				if ( !ini_get( 'open_basedir' ) && !ini_get( 'safe_mode' ) && version_compare( SimplePie_Misc::get_curl_version(), '7.15.2', '>=' ) ) {
					curl_setopt( $fp, CURLOPT_FOLLOWLOCATION, 1 );
					curl_setopt( $fp, CURLOPT_MAXREDIRS, $redirects );
				}

				global $wpraNoSslVerification;
				if ($wpraNoSslVerification) {
				    curl_setopt( $fp, CURLOPT_SSL_VERIFYPEER, 0 );
                }

				$this->_before_curl_exec( $fp, $url );

				$this->headers = curl_exec( $fp );
				if ( curl_errno( $fp ) === 23 || curl_errno( $fp ) === 61 ) {
					curl_setopt( $fp, CURLOPT_ENCODING, 'none' );
					$this->headers = curl_exec( $fp );
				}
				if ( curl_errno( $fp ) ) {
					$this->error = 'cURL error ' . curl_errno( $fp ) . ': ' . curl_error( $fp );
					$this->success = false;
				} else {
					$info = curl_getinfo( $fp );
					curl_close( $fp );
					$this->headers = explode( "\r\n\r\n", $this->headers, $info['redirect_count'] + 1 );
					$this->headers = array_pop( $this->headers );
					$parser = new SimplePie_HTTP_Parser( $this->headers );
					if ( $parser->parse() ) {
						$this->headers = $parser->headers;
						$this->body = $this->_processBody($parser->body);
						$this->status_code = $parser->status_code;
						if ( (in_array( $this->status_code, array( 300, 301, 302, 303, 307 ) ) || $this->status_code > 307 && $this->status_code < 400) && isset( $this->headers['location'] ) && $this->redirects < $redirects ) {
							$this->redirects++;
							$location = SimplePie_Misc::absolutize_url( $this->headers['location'], $url );
							return $this->__construct( $location, $timeout, $redirects, $headers, $useragent, $force_fsockopen );
						}

                        $this->_afterCurlHeadersParsed($info);
					}
				}
			} else {
				$this->method = SIMPLEPIE_FILE_SOURCE_REMOTE | SIMPLEPIE_FILE_SOURCE_FSOCKOPEN;
				$url_parts = parse_url( $url );
				$socket_host = $url_parts['host'];
				if ( isset( $url_parts['scheme'] ) && strtolower( $url_parts['scheme'] ) === 'https' ) {
					$socket_host = "ssl://{$url_parts['host']}";
					$url_parts['port'] = 443;
				}
				if ( !isset( $url_parts['port'] ) ) {
					$url_parts['port'] = 80;
				}
				$fp = @fsockopen( $socket_host, $url_parts['port'], $errno, $errstr, $timeout );
				if ( !$fp ) {
					$this->error = 'fsockopen error: ' . $errstr;
					$this->success = false;
				} else {
					stream_set_timeout( $fp, $timeout );
					if ( isset( $url_parts['path'] ) ) {
						if ( isset( $url_parts['query'] ) ) {
							$get = "{$url_parts['path']}?{$url_parts['query']}";
						} else {
							$get = $url_parts['path'];
						}
					} else {
						$get = '/';
					}
					$out = "GET $get HTTP/1.1\r\n";
					$out .= "Host: {$url_parts['host']}\r\n";
					$out .= "User-Agent: $useragent\r\n";
					if ( extension_loaded( 'zlib' ) ) {
						$out .= "Accept-Encoding: x-gzip,gzip,deflate\r\n";
					}

					if ( isset( $url_parts['user'] ) && isset( $url_parts['pass'] ) ) {
						$out .= "Authorization: Basic " . base64_encode( "{$url_parts['user']}:{$url_parts['pass']}" ) . "\r\n";
					}
					foreach ( $headers as $key => $value ) {
						$out .= "$key: $value\r\n";
					}
					$out .= "Connection: Close\r\n\r\n";
					fwrite( $fp, $out );

					$info = stream_get_meta_data( $fp );

					$this->headers = '';
					while ( !$info['eof'] && !$info['timed_out'] ) {
						$this->headers .= fread( $fp, 1160 );
						$info = stream_get_meta_data( $fp );
					}
					if ( !$info['timed_out'] ) {
						$parser = new SimplePie_HTTP_Parser( $this->headers );
						if ( $parser->parse() ) {
							$this->headers = $parser->headers;
							$this->body = $this->_processBody($parser->body);
							$this->status_code = $parser->status_code;
							if ( (in_array( $this->status_code, array( 300, 301, 302, 303, 307 ) ) || $this->status_code > 307 && $this->status_code < 400) && isset( $this->headers['location'] ) && $this->redirects < $redirects ) {
								$this->redirects++;
								$location = SimplePie_Misc::absolutize_url( $this->headers['location'], $url );
								return $this->__construct( $location, $timeout, $redirects, $headers, $useragent, $force_fsockopen );
							}
							if ( isset( $this->headers['content-encoding'] ) ) {
								// Hey, we act dumb elsewhere, so let's do that here too
								switch ( strtolower( trim( $this->headers['content-encoding'], "\x09\x0A\x0D\x20" ) ) ) {
									case 'gzip':
									case 'x-gzip':
										$decoder = new SimplePie_gzdecode( $this->body );
										if ( !$decoder->parse() ) {
											$this->error = 'Unable to decode HTTP "gzip" stream';
											$this->success = false;
										} else {
											$this->body = $this->_processBody($decoder->data);
										}
										break;

									case 'deflate':
										if ( ($decompressed = gzinflate( $this->body )) !== false ) {
											$this->body = $decompressed;
										} else if ( ($decompressed = gzuncompress( $this->body )) !== false ) {
											$this->body = $decompressed;
										} else if ( function_exists( 'gzdecode' ) && ($decompressed = gzdecode( $this->body )) !== false ) {
											$this->body = $decompressed;
										} else {
											$this->error = 'Unable to decode HTTP "deflate" stream';
											$this->success = false;
										}
										$this->body = $this->_processBody($this->body);
										break;

									default:
										$this->error = 'Unknown content coding';
										$this->success = false;
								}
							}
						}
					} else {
						$this->error = 'fsocket timed out';
						$this->success = false;
					}
					fclose( $fp );
				}
			}
		} else {
			$this->method = SIMPLEPIE_FILE_SOURCE_LOCAL | SIMPLEPIE_FILE_SOURCE_FILE_GET_CONTENTS;
            $this->body = $this->_processBody(file_get_contents($url));
			if ( !$this->body ) {
				$this->error = 'file_get_contents could not read the file';
				$this->success = false;
			}
		}
	}

    /**
     * Processes the raw response body for an RSS feed.
     *
     * @since 4.17
     *
     * @param string $body The raw HTTP response body string.
     *
     * @return string The processed response body string.
     */
	protected function _processBody($body) {
	    return trim($body);
    }

	/**
	 * Additional preparation of the curl request.
	 * Sets the {@link CURLOPT_CAINFO http://php.net/manual/en/function.curl-setopt.php}
	 * cURL option to a value determined by {@see get_default_certificate_file_path}.
	 * If the value is empty, leaves it as is.
	 *
	 * @since 4.7
	 * @param resource $fp Pointer to a resource created by {@see curl_init()}.
	 * @param string $url The URL, to which the cURL request is being made.
	 * @return \WPRSS_SimplePie_File This instance.
	 */
	protected function _before_curl_exec( $fp, $url ) {
		if ( ($ca_path = self::get_default_certificate_file_path()) && !empty( $ca_path ) ) {
			$this->_certificate_file_path = $ca_path;
			curl_setopt( $fp, CURLOPT_CAINFO, $this->_certificate_file_path );
		}
		do_action( 'wprss_before_curl_exec', $fp );

		return $this;
	}


	/**
	 * Gets the path to the certificate, which will be used by this instance
	 * to fetch remote content.
	 *
	 * @since 4.7
	 * @return string Path to the certificate file.
	 */
	public function get_certificate_file_path() {
		return $this->_certificate_file_path;
	}


	/**
	 * Gets the path to the certificate file, which will be used by future
	 * instances of this class.
	 *
	 * @since 4.7
	 * @return string Path to the certificate file.
	 */
	public static function get_default_certificate_file_path() {
		return self::$_default_certificate_file_path;
	}


	/**
	 * Sets the path to the certificate file.
	 * This path will be used by future instances of this class.
	 *
	 * @since 4.7
	 * @param string $path The path to the certificate file.
	 */
	public static function set_default_certificate_file_path( $path ) {
		self::$_default_certificate_file_path = $path;
	}

    /**
     * Called right after a cURL request returns, and headers are parsed.
     *
     * This method will not be called if a cURL error is encountered.
     *
     * @param $curlInfo Result of a call to {@see curl_getinfo()} on the cURL resource.
     * @since 4.8.2
     */
    protected function _afterCurlHeadersParsed($curlInfo)
    {
        $bodyMaxLength = 150;
        $code = $this->status_code;
        $body = $this->body;
        $bodyLength = strlen($body);
        $bodyOutput = strlen($body) < $bodyMaxLength
            ? $body
            : substr($body, 0, $bodyMaxLength);
        $outputLength = strlen($bodyOutput);
        $error = implode("\n", array(
            'The resource could not be retrieved because of a %1$s error with code %2$d',
            'Server returned %3$d characters' . ($outputLength < $bodyMaxLength ? '' : ', of which ' . $outputLength . ' are below') . ':',
            '%4$s'
        ));

        if ($code >= 400 && $code < 500 ) { // Client error
            $this->error = sprintf($error, 'client', $code, $bodyLength, $bodyOutput);
            $this->success = false;
        }
        if ($code >= 500 && $code < 600 ) { // Server error
            $this->error = sprintf($error, 'server', $code, $bodyLength, $bodyOutput);
            $this->success = false;
        }
    }
}


File Name:
feed-blacklist.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-blacklist.php
Code:
<?php

// Check if the 'blacklist' GET param is set
add_action('admin_init', 'wprss_check_if_blacklist_item');
// Checks if the transient is set to show the notice
add_action('admin_init', 'wprss_check_notice_transient');
// Register custom post type
// Add the row actions to the targetted post type
add_filter('post_row_actions', 'wprss_blacklist_row_actions', 10, 1);

/**
 * Creates a blacklist entry for the given feed item.
 *
 * @since 4.4
 *
 * @param int|string The ID of the feed item to add to the blacklist
 */
function wprss_blacklist_item($ID)
{
    // Return if feed item is null
    if (is_null($ID)) {
        return;
    }

    // Get the feed item data
    $item_title = get_the_title($ID);
    $item_permalink = get_post_meta($ID, 'wprss_item_permalink', true);
    // If not an imported item, stop
    if ($item_permalink === '') {
        wpra_get_logger()->warning('Feed item with ID {0} was not blacklisted because its URL was empty', [$ID]);

        return;
    }
    // Prepare the data for blacklisting
    $title = apply_filters('wprss_blacklist_title', trim($item_title));
    $permalink = apply_filters('wprss_blacklist_permalink', trim($item_permalink));

    // Delete the item
    wp_delete_post($ID, true);

    // Add the blacklisted item
    $id = wp_insert_post([
        'post_title' => $title,
        'post_type' => 'wprss_blacklist',
        'post_status' => 'publish',
        'meta_input' => [
            'wprss_permalink' => $permalink,
        ],
    ]);
}

/**
 * Determines whether the given item is blacklist.
 *
 * @since 4.4
 *
 * @param string $permalink The permalink to look for in the saved option
 *
 * @return bool TRUE if the permalink is found, FALSE otherwise.
 */
function wprss_is_blacklisted($permalink)
{
    if (empty($permalink)) {
        return false;
    }

    // Query the blacklist entries, for an item with the given permalink
    $query = new WP_Query([
        'post_type' => 'wprss_blacklist',
        'meta_key' => 'wprss_permalink',
        'meta_value' => $permalink,
    ]);

    // Return TRUE if the query returned a result, FALSE otherwise
    return $query->have_posts();
}

/**
 * Check if the 'blacklist' GET param is set, and prepare to blacklist the item.
 *
 * @since 4.4
 */
function wprss_check_if_blacklist_item()
{
    // If the GET param is not set, do nothing. Return.
    if (empty($_GET['wprss_blacklist'])) {
        return;
    }

    // Get the ID from the GET param
    $id = filter_input(INPUT_GET, 'wprss_blacklist', FILTER_VALIDATE_INT);

    // If the post does not exist, stop. Show a message
    $post = (is_int($id) && $id > 0)
        ? get_post($id)
        : null;
    if ($post === null) {
        wp_die(__('The item you are trying to blacklist does not exist', 'wprss'));
    }

    // If the post type is not correct,
    if (get_post_meta($id, 'wprss_item_permalink', true) === '' || $post->post_status !== 'trash') {
        wp_die(__('The item you are trying to blacklist is not valid!', 'wprss'));
    }

    check_admin_referer('blacklist-item-' . $id, 'wprss_blacklist_item');
    wprss_blacklist_item($id);

    // Get the current post type for the current page
    $postType = filter_input(INPUT_GET, 'post_type', FILTER_SANITIZE_STRING);
    $postType = $postType ? $postType : 'post';

    // Check the current page, and generate the URL query string for the page
    $paged = filter_input(INPUT_GET, 'paged', FILTER_VALIDATE_INT);
    $pagedArg = $paged
        ? '&paged=' . urlencode($paged)
        : '';

    // Set the notice transient
    set_transient('wprss_item_blacklist_notice', 'true');
    // Refresh the page without the GET parameter
    wp_redirect(admin_url("edit.php?post_type=$postType&post_status=trash" . $pagedArg));

    exit;
}

/**
 * Checks if the transient for the blacklist notice is set, and shows the notice
 * if it is set.
 */
function wprss_check_notice_transient()
{
    // Check if the transient exists
    $transient = get_transient('wprss_item_blacklist_notice');
    if ($transient !== false) {
        // Remove the transient
        delete_transient('wprss_item_blacklist_notice');
        // Show the notice
        // add_action( 'admin_notices', 'wprss_blacklist_item_notice' );
        wprss()->getAdminAjaxNotices()->addNotice('blacklist_item_success');
    }
}

/**
 * Adds the row actions to the targetted post type.
 * Default post type = wprss_feed_item
 *
 * @since 4.4
 *
 * @param array $actions The row actions to be filtered
 *
 * @return array The new filtered row actions
 */
function wprss_blacklist_row_actions($actions)
{
    // Check the current page, and generate the URL query string for the page
    $paged = filter_input(INPUT_GET, 'paged', FILTER_VALIDATE_INT);
    $pagedArg = is_int($paged) && $paged > 0
        ? '&paged=' . urlencode($paged)
        : '';

    // Check the post type
    if (get_post_status() !== 'trash') {
        return $actions;
    }

    // Get the Post ID
    $ID = get_the_ID();

    // Get the permalink. If does not exist, then it is not an imported item.
    $permalink = get_post_meta($ID, 'wprss_item_permalink', true);
    if ($permalink === '') {
        return $actions;
    }

    // The post type on the current screen
    $post_type = get_post_type();
    // Prepare the blacklist URL
    $plain_url = apply_filters(
        'wprss_blacklist_row_action_url',
        admin_url("edit.php?post_type=$post_type&wprss_blacklist=$ID"),
        $ID
    );
    $plain_url = $plain_url . $pagedArg;
    // Add a nonce to the URL
    $nonced_url = wp_nonce_url($plain_url, 'blacklist-item-' . $ID, 'wprss_blacklist_item');

    // Prepare the text
    $text = htmlentities(__('Delete Permanently & Blacklist', 'wprss'));
    $text = apply_filters('wprss_blacklist_row_action_text', $text);

    // Prepare the hint
    $hint = apply_filters(
        'wprss_blacklist_row_action_hint',
        __('The item will be deleted permanently, and its permalink will be recorded in the blacklist', 'wprss')
    );
    $hint = esc_attr(__($hint, 'wprss'));

    // Add the blacklist action
    $actions['blacklist-item'] = "<span class='delete'><a title='$hint' href='$nonced_url'>$text</a></span>";

    return $actions;
}


File Name:
feed-importing-images.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-importing-images.php
Code:
<?php

// Save item image info during import
use Psr\Log\LoggerInterface;
use RebelCode\Wpra\Core\Data\DataSetInterface;
use RebelCode\Wpra\Core\Logger\FeedLoggerInterface;

class Wpra_Rss_Namespace {
    const ITUNES = 'http://www.itunes.com/dtds/podcast-1.0.dtd';
}

add_action('wprss_items_create_post_meta', 'wpra_detect_item_type', 10, 3);
add_action('wprss_items_create_post_meta', 'wpra_import_item_images', 11, 3);
add_filter('wprss_ftp_post_meta', function ($meta, $id, $source, $item) {
    wpra_detect_item_type($id, $item, $source);

    return $meta;
}, 11, 4);

/**
 * Imports images for a feed item.
 *
 * The "import" process here basically just fetches the images from the item's content/excerpt, the media:thumbnail
 * tag and the enclosures. The entire list of images is saved, along with the URL of the best image.
 *
 * @param int|string     $itemId   The ID of the feed item.
 * @param SimplePie_Item $item     The simple pie item object.
 * @param int|string     $sourceId The ID of the feed source from which the item was imported.
 */
function wpra_detect_item_type($itemId, $item, $sourceId)
{
    $logger = wpra_get_logger($sourceId);
    $url = parse_url($item->get_permalink());
    $url['query_str'] = isset($url['query']) ? $url['query'] : '';
    parse_str($url['query_str'], $url['query']);

    if (stripos($url['host'], 'youtube.com') !== false && !empty($url['query']['v'])) {
        $logger->info('Detected YouTube feed item');

        $videoCode = $url['query']['v'];
        $embedUrl = sprintf('https://youtube.com/embed/%s', $videoCode);

        update_post_meta($itemId, 'wprss_item_is_yt', '1');
        update_post_meta($itemId, 'wprss_item_yt_embed_url', $embedUrl);
        update_post_meta($itemId, 'wprss_item_embed_url', $embedUrl);
    }
}

/**
 * Retrieves the logger instance to use for image importing.
 *
 * @since 4.15.1
 *
 * @param int $feedId Optional feed source ID to log messages specifically for that feed source.
 *
 * @return LoggerInterface
 */
function wpra_get_images_logger($feedId = null)
{
    $logger = wpra_container()->get('wpra/images/logging/logger');

    return ($feedId !== null && $logger instanceof FeedLoggerInterface)
        ? $logger->forFeedSource($feedId)
        : $logger;
}

/**
 * Imports images for a feed item.
 *
 * The "import" process here basically just fetches the images from the item's content/excerpt, the media:thumbnail
 * tag and the enclosures. The entire list of images is saved, along with the URL of the best image.
 *
 * @param int|string     $itemId   The ID of the feed item.
 * @param SimplePie_Item $item     The simple pie item object.
 * @param int|string     $sourceId The ID of the feed source from which the item was imported.
 */
function wpra_import_item_images($itemId, $item, $sourceId)
{
    // Start with empty meta
    update_post_meta($itemId, 'wprss_images', []);
    update_post_meta($itemId, 'wprss_best_image', '');

    /* @var $logger FeedLoggerInterface */
    $logger = wpra_get_images_logger($sourceId);

    $title = $item->get_title();
    $logger->debug('Importing images for item "{title}"', ['title' => $title]);

    $collection = wpra_container()->get('wpra/feeds/sources/collection');
    try {
        $source = $collection[$sourceId];
    } catch (Exception $exception) {
        $logger->warning('Feed source #{id} could not be found', ['id' => $sourceId]);
        return;
    }

    // Get the featured image option from the feed source
    $ftImageOpt = $source['import_ft_images'];

    // Stop if source has featured images disabled
    if (empty($ftImageOpt)) {
        $logger->debug('Feed source has featured images disabled');
        return;
    }

    // Get all of the item's images
    $allImages = wpra_get_item_images($item);
    // Process the images, removing duds, and find the best image
    $images = wpra_process_images($allImages, $source, $bestImage);

    // If the featured image importing feature is enabled, import the featured image
    if (wpra_image_feature_enabled('import_ft_images')) {
        $ftImageUrl = null;
        switch ($ftImageOpt)
        {
            case 'auto':
                if (!empty($bestImage)) {
                    $ftImageUrl = $bestImage;
                }
                break;

            case 'media':
                if (isset($images['media']) && !empty($images['media'])) {
                    $ftImageUrl = reset($images['media']);
                }
                break;

            case 'enclosure':
                if (isset($images['enclosure']) && !empty($images['enclosure'])) {
                    $ftImageUrl = reset($images['enclosure']);
                }
                break;

            case 'content':
                if (isset($images['content']) && !empty($images['content'])) {
                    $ftImageUrl = reset($images['content']);
                }
                break;

            case 'itunes':
                if (isset($images['itunes']) && !empty($images['itunes'])) {
                    $ftImageUrl = reset($images['itunes']);
                }
                break;

            case 'default':
            default:
                $ftImageUrl = '';
                break;
        }

        // Filter the featured image URL
        $ftImageUrl = apply_filters('wpra/importer/images/ft_image_url', $ftImageUrl, $item, $sourceId);

        if (empty($ftImageUrl)) {
            // If not always using the default image, and items must have an image, delete the item
            if ($ftImageOpt !== 'default' && wpra_image_feature_enabled('must_have_ft_image') && $source['must_have_ft_image']) {
                $logger->debug('Rejecting item "{title}" due to a lack of a featured image.', [
                    'title' => get_post($itemId)->post_title,
                ]);

                wp_delete_post($itemId, true);
            } else {
                // Get the feed source's default featured image
                $defaultFtImage = get_post_thumbnail_id($sourceId);
                // Assign it to the feed item
                $defaultSuccessful = set_post_thumbnail($itemId, $defaultFtImage);
                // The feed item is classified as using the default image if:
                // - the default image was successfully assigned
                // - the user did NOT explicitly want to use the default
                $usedDefault = $defaultSuccessful && $ftImageOpt !== 'default';

                if ($usedDefault) {
                    update_post_meta($itemId, 'wprss_item_is_using_def_image', '1');
                    $logger->notice('Used the feed source\'s default featured image for "{title}"', ['title' => $title]);
                } else {
                    $logger->notice('No featured image was found for item "{title}"', ['title' => $title]);
                }
            }
        } else {
            $logger->info('Set featured image from URL: "{url}"', ['url' => $ftImageUrl]);
            wpra_set_featured_image_from_url($itemId, $ftImageUrl);

            if (wpra_image_feature_enabled('siphon_ft_image') && $source['siphon_ft_image']) {
                $content = get_post($itemId)->post_content;
                $newContent = wpra_remove_image_from_content($content, $ftImageUrl);

                wp_update_post([
                    'ID' => $itemId,
                    'post_content' => $newContent
                ]);
            }
        }
    }

    // Maybe download other images and replace the URLs in the item's content
    if (wpra_image_feature_enabled('download_images') && $source['download_images']) {
        // Flatten the list of images from a 2d array to a 1d array
        $imagesList = call_user_func_array('array_merge', $images);
        // Download the images and attach them to the item
        $urlMapping = wpra_download_item_images($imagesList, $itemId);
        // Replace the URLs in the item's content
        $content = str_replace(
            array_keys($urlMapping),
            array_values($urlMapping),
            get_post($itemId)->post_content
        );
        // Update the post content
        wp_update_post([
            'ID' => $itemId,
            'post_content' => $content
        ]);
    }

    // Save the image URLs in meta
    update_post_meta($itemId, 'wprss_images', $images);
    update_post_meta($itemId, 'wprss_best_image', $bestImage);

    // Log number of found images
    $logger->info('Found {count} images', ['count' => count($images)]);
}

/**
 * Downloads a given list of images and attaches them to an imported item.
 *
 * @since 4.14
 *
 * @param string[] $images The URLs of the images to download.
 * @param int $postId The ID of the WordPress post to which the images will be attached.
 *
 * @return string[] A mapping of the given URLs pointing to the corresponding local URLs of the downloaded images.
 */
function wpra_download_item_images($images, $postId)
{
    $mapping = [];

    foreach ($images as $url) {
        // No need to download
        if (wpra_is_url_local($url)) {
            continue;
        }

        $imageId = wpra_download_item_image($postId, $url);

        // Failed to download
        if ($imageId === null) {
            continue;
        }

        $mapping[$url] = wp_get_attachment_url($imageId);
    }

    return $mapping;
}

/**
 * Retrieves the URLs of all the images in a feed item.
 *
 * @param SimplePie_Item $item The simple pie item object.
 *
 * @return string[] A list of image URLs.
 */
function wpra_get_item_images($item)
{
    return apply_filters('wpra/images/detect_from_item', [
        'thumbnail' => array_filter([wpra_get_sp_thumbnail_image($item)]),
        'image' => wpra_get_item_rss_images($item),
        'media' => [wpra_get_item_media_thumbnail_image($item)],
        'enclosure' => wpra_get_item_enclosure_images($item),
        'content' => wpra_get_item_content_images($item),
        'itunes' => wpra_get_item_itunes_images($item),
        'feed' => array_filter([$item->get_feed()->get_image_url()]),
    ], $item);
}

/**
 * Retrieves the thumbnail as determined by SimplePie.
 *
 * @param SimplePie_Item $item
 *
 * @return string|null
 */
function wpra_get_sp_thumbnail_image($item)
{
    $thumbnail = $item->get_thumbnail();

    if (!is_array($thumbnail) || !isset($thumbnail['url'])) {
        return null;
    }

    return $thumbnail['url'];
}

/**
 * Processes a list of image URLs to strip away images that are unreachable or too small, as well as identify which
 * image in the list is the best image (in terms of dimensions and aspect ratio).
 *
 * @param array $images The image URLs.
 * @param array|DataSetInterface $source The feed source data set.
 * @param string|null $bestImage This variable given as this parameter will be set to the URL of
 *                               the best found image.
 *
 * @return mixed
 */
function wpra_process_images($images, $source, &$bestImage = null)
{
    if (!wpra_container()->has('wpra/images/container')) {
        return [];
    }

    $imgContainer = wpra_container()->get('wpra/images/container');

    // The list of images of keep and their sizes
    $imageInfos = [];
    // The largest image size found so far, as width * height
    $maxSize = 0;

    // The minimum dimensions for an image to be valid
    $minWidth = 0;
    $minHeight = 0;
    if (wpra_image_feature_enabled('image_min_size')) {
        $minWidth = (int)apply_filters('wprss_thumbnail_min_width', $source['image_min_width']);
        $minHeight = (int)apply_filters('wprss_thumbnail_min_height', $source['image_min_height']);
    }

    foreach ($images as $group => $urls) {
        foreach ($urls as $imageUrl) {
            if (empty($imageUrl)) {
                continue;
            }
            try {
                /* @var WPRSS_Image_Cache_Image $tmp_img */
                $tmp_img = $imgContainer->get($imageUrl);

                $dimensions = ($tmp = $tmp_img->get_local_path())
                    ? $tmp_img->get_size()
                    : null;

                // Ignore image if too small in either dimension
                if ($dimensions === null || $dimensions[0] < $minWidth || $dimensions[1] < $minHeight) {
                    continue;
                }

                $area = $dimensions[0] * $dimensions[1];
                $ratio = floatval($dimensions[0]) / floatval($dimensions[1]);

                // If larger than the current best image and its aspect ratio is between 1 and 2,
                // then set this image as the new best image
                if ($maxSize === 0 || ($area > $maxSize && $ratio > 1.0 && $ratio < 2.0)) {
                    $maxSize = $area;
                    $bestImage = $imageUrl;
                }

                // Add to the list of images to save
                $imageInfos[$group][] = [$imageUrl, $dimensions, $area, $ratio];
            } catch (Exception $exception) {
                // If failed to get dimensions, skip the image
                continue;
            }
        }
    }

    $finalImages = [];
    foreach ($imageInfos as $group => $infos) {
        // Do not sort images found in the content
        if ($group !== 'content') {
            // Sort each group by image size in descending order (largest image first)
            usort($infos, function ($img1, $img2) {
                $area1 = $img1[1];
                $area2 = $img2[1];

                return ($area1 >= $area2) ? -1 : 1;
            });
        }
        // Save only the URLs
        $finalImages[$group] = array_map(function ($info) {
            return $info[0];
        }, $infos);
    }

    return $finalImages;
}

/**
 * Returns the images from the RSS <image> tags for the given feed item.
 *
 * @param SimplePie_Item $item The feed item
 *
 * @return array The string URLs of the images.
 */
function wpra_get_item_rss_images($item)
{
    if (isset($item->data['child']['']['image'])) {
        $imageTags = $item->data['child']['']['image'];

        $urls = array_map(function ($tag) {
            return isset($tag['data']) ? trim($tag['data']) : null;
        }, $imageTags);

        return array_filter($urls);
    }

    return [];
}

/**
 * Returns the <media:thumbnail> image for the given feed item.
 *
 * @since 4.14
 *
 * @param SimplePie_Item $item The feed item
 *
 * @return string|null The string URL of the image, or null if the item does not contain a <media:thumbnail> image.
 */
function wpra_get_item_media_thumbnail_image($item)
{
    // Try to get image from enclosure if available
    $enclosure = $item->get_enclosure();

    // Stop if item has no enclosure tag
    if (is_null($enclosure)) {
        return null;
    }

    // Stop if enclosure is not an image
    $type = $enclosure->get_type();
    if (!empty($type) && stripos($type, 'image/') !== 0) {
        return null;
    }

    // Stop if enclosure tag has no link
    $url = $enclosure->get_link();
    if (empty($url)) {
        return null;
    }

    // Check if image can be downloaded
    if (wpra_container()->has('wpra/images/container')) {
        try {
            /* @var $image WPRSS_Image_Cache_Image */
            $image = wpra_container()->get('wpra/images/container')->get($url);
        } catch (Exception $exception) {
            return null;
        }
    }

    if ($image->get_local_path()) {
        return $url;
    }

    return null;
}

/**
 * Returns the enclosure images for the given feed item.
 *
 * @since 4.14
 *
 * @param SimplePie_Item $item The feed item
 *
 * @return string[] The string URLs of the found enclosure images.
 */
function wpra_get_item_enclosure_images($item)
{
    $enclosure = $item->get_enclosure();

    // Stop if item has no enclosure
    if (is_null($enclosure)) {
        return [];
    }

    // Get all the thumbnails from the enclosure
    $thumbnails = (array) $enclosure->get_thumbnails();

    return $thumbnails;
}

/**
 * Returns the images found in the given item's content
 *
 * @since 4.14
 *
 * @param SimplePie_Item $item The feed item
 *
 * @return string[] Returns the string URLs of the images found.
 */
function wpra_get_item_content_images($item)
{
    // Extract all images from the content into the $matches array
    preg_match_all('/<img.*?src=[\'"](.*?)[\'"].*?>/xis', $item->get_content(), $matches);

    $i = 0;
    $images = [];
    while (!empty($matches[1][$i])) {
        $imageUrl = urldecode(trim(html_entity_decode($matches[1][$i])));
        // Increment early to allow the iteration body to use "continue" statements
        $i++;

        // Add http prefix if not included
        if (stripos($imageUrl, '//') === 0) {
            $imageUrl = 'http:' . $imageUrl;
        }

        // Add to the list
        $images[] = $imageUrl;
    }

    return $images;
}

/**
 * Returns the itunes images for the given feed item.
 *
 * @since 4.14
 *
 * @param SimplePie_Item $item The feed item
 *
 * @return string[] Returns the string URLs of the images found.
 */
function wpra_get_item_itunes_images($item)
{
    $tags = $item->get_item_tags(Wpra_Rss_Namespace::ITUNES,'image');

    if (!is_array($tags) || empty($tags)) {
        return [];
    }

    $images = [];
    foreach ($tags as $tag) {
        if (empty($tag['attribs']) || empty($tag['attribs'][''])) {
            continue;
        }

        $attribs = $tag['attribs'][''];

        if (!empty($attribs['href'])) {
            $images[] = $attribs['href'];
        }
    }

    return $images;
}

/**
 * Removes an image tag, matched by an image URL, from a string of HTML content.
 *
 * @since 4.14
 *
 * @param string $content The content in which to search for and remove the image.
 * @param string $url     The URL of the image to remove.
 * @param int    $limit   Optional number of image occurrences to remove.
 *
 * @return string The new content, with any matching `img` HTML tags removed.
 */
function wpra_remove_image_from_content($content, $url, $limit = 1)
{
    $tag_search = array(
        '<img[^<>]*?src="%s"[^<>]*?>',
        '<img[^<>]*?srcset="[^<>]*?%s.[^<>]*?"[^<>]*?>'
    );

    foreach ($tag_search as $regex) {
        // This will transform the expression to match images in html-encoded content
        $regex = wprss_html_regex_encodify($regex);
        // Prepare the URL to be inserted into the sprintf-style regex string
        $regexUrl = preg_quote(esc_attr($url), '!');
        // Insert the URL into the regex string, and add the regex delimiter and modifiers
        $regex = sprintf($regex, $regexUrl);
        $regex = sprintf('!%s!Uis', $regex);
        // Replace the tag with an empty string, and get the new content
        $content = preg_replace($regex, '', $content, $limit);
    }

    $filtered = wp_filter_post_kses($content);
    $trimmed = trim($filtered);

    return $trimmed;
}

/**
 * Downloads a feed item image.
 *
 * This function will attempt to download the image at the given URL. If the image URL is a local URL, the function
 * will skip the downloading process. The post ID is required in order to use WordPress side-loading function.
 *
 * @since 4.14
 *
 * @param int $post_id The ID of the post.
 * @param string $url The URL of the image.
 *
 * @return string|null The ID of the locally downloaded image or null on failure.
 */
function wpra_download_item_image($post_id, $url)
{
    // Download image if needed
    if (wpra_is_url_local($url)) {
        return null;
    }

    $id = wpra_media_sideload_image($url, $post_id, false);

    if ($id instanceof WP_Error) {
        return null;
    }

    return $id;
}

/**
 * Sets a featured image to a post, from a URL.
 *
 * This function will attempt to download the image at the given URL and then assign it to the post with the given ID.
 * If the image URL is a local URL, the function will skip the downloading process.
 *
 * @since 4.14
 *
 * @param int $post_id The ID of the post.
 * @param string $url The URL of the image.
 */
function wpra_set_featured_image_from_url($post_id, $url)
{
    // Download image if needed
    if (!wpra_is_url_local($url)) {
        wpra_media_sideload_image($url, $post_id, true);

        return;
    }

    // Otherwise, get the attachment ID for the URL from the database
    set_post_thumbnail( $post_id, wpra_get_attachment_id_from_url($url) );
}

/**
 * Checks if the given url is a local or external one
 *
 * @since 4.14
 */
function wpra_is_url_local($url, $home_url = null)
{
    if (is_null($home_url)) {
        $home_url = get_option('siteurl');
    }

    // What about the URLs are we comparing?
    $relevant_parts = ['host', 'path'];

    // Get the site's url
    $siteurl = trim(wpra_rebuild_url($home_url, $relevant_parts), '/');
    // The URL in question
    $url = trim(wpra_rebuild_url(wpra_encode_and_parse_url($url), $relevant_parts), '/');

    return strpos($url, $siteurl) === 0;
}

/**
 * Builds a URL from a given URL, using only the specified parts of it.
 *
 * @since 4.14
 *
 * @see   parse_url()
 *
 * @param string|array $url   The URL which is to be rebuilt, or a result of parse_url().
 *
 * @param bool|array   $parts An array of which parts to use for building the new URL. Boolean false for all.
 *
 * @return null|string The rebuilt URL on success, or null of given URL is malformed.
 */
function wpra_rebuild_url($url, $parts = false)
{

    // Allow parsed array
    if (is_string($url)) {
        $url = parse_url($url);
    }

    // malformed or empty URL
    if (!$url) {
        return null;
    }

    // Include all parts
    if ($parts === false) {
        return http_build_url($url);
    }

    // Nothing to do here
    if (empty($parts)) {
        return '';
    }

    $newParts = [];
    foreach ($parts as $_idx => $_part) {
        $_part = trim($_part);
        if (isset($url[$_part])) {
            $newParts[$_part] = $url[$_part];
        }
    }

    // Rebuilding the URL from parts
    return http_build_url($newParts);
}

function wpra_encode_and_parse_url($url)
{
    $encodedUrl = @preg_replace_callback('%[^:/?#&=\.]+%usD', function ($matches) {
        return sprintf('urlencode(\'%s\')', $matches[0]);
    }, $url);
    $components = parse_url($encodedUrl);
    foreach ($components as &$component) {
        $component = urldecode($component);
    }

    return $components;
}

/**
 * Download an image from the specified URL and attach it to a post.
 *
 * Modified version of core function media_sideload_image() in /wp-admin/includes/media.php
 * (which returns an html img tag instead of attachment ID).
 * Additional functionality: ability override actual filename,
 * and to pass $post_data to override values in wp_insert_attachment (original only allowed $desc).
 *
 * Uses image cache to avoid re-downloading images. Keeps cache intact by
 * creating a copy of the cache file, which will eventually be moved.
 *
 * Credits to somatic
 * http://wordpress.stackexchange.com/questions/30284/media-sideload-image-file-name/44115#44115
 *
 * @since 2.7.4
 *
 * @param string $url       (required) The URL of the image to download
 * @param int    $post_id   (required) The post ID the media is to be associated with
 * @param bool   $attach    (optional) Whether to make this attachment the Featured Image for the post.
 * @param string $filename  (optional) Replacement filename for the URL filename (do not include extension)
 * @param array  $post_data (optional) Array of key => values for wp_posts table (ex: 'post_title' => 'foobar',
 *                          'post_status' => 'draft')
 *
 * @return int|object The ID of the attachment or a WP_Error on failure
 */
function wpra_media_sideload_image($url = null, $post_id = null, $attach = null, $filename = null, $post_data = [])
{
    if (!$url || !$post_id) {
        return new WP_Error('missing', "Need a valid URL and post ID...");
    }

    // Allow 30 seconds prior to beginning the actual download
    set_time_limit(apply_filters('wpra/images/time_limit/prepare', 30));

    // Check if the image already exists in the media library
    $existing = get_posts([
        'post_type' => 'attachment',
        'meta_key' => 'wprss_og_image_url',
        'meta_value' => $url,
    ]);
    // If so, use the existing image's ID
    if (!empty($existing)) {
        $att_id = reset($existing)->ID;
    } else {
        if (!wpra_container()->has('wpra/images/container')) {
            return new WP_Error('Images module is not loaded');
        }

        $logger = wpra_get_logger();
        $images = wpra_container()->get('wpra/images/container');

        try {
            /* @var $img WPRSS_Image_Cache_Image */
            $url = apply_filters('wpra/images/url_to_download', $url);

            // Allow 1 minute for the download process
            set_time_limit(apply_filters('wpra/images/time_limit/download', 60));

            $img = $images->get($url);
        } catch (Exception $e) {
            return new WP_Error('could_not_load_image', $e->getMessage(), $url);
        }

        $logger->debug('Image from cache: {url} -> {path}', [
            'url' => $img->get_url(),
            'path' => $img->get_local_path(),
        ]);

        // Get the path
        $tmp = $img->get_local_path();

        // Required for wp_tempnam() function
        require_once(ABSPATH . 'wp-admin/includes/file.php');

        // media_handle_sideload() will move the file, but we need the cache to remain
        copy($tmp, $tmp = wp_tempnam());
        $tmpPath = pathinfo($tmp);
        $ext = isset($tmpPath['extension']) ? trim($tmpPath['extension']) : null;
        $url_filename = $img->get_unique_name();

        // override filename if given, reconstruct server path
        if (!empty($filename)) {
            $filename = sanitize_file_name($filename);
            // build new path
            $new = $tmpPath['dirname'] . "/" . $filename . "." . $ext;
            // renames temp file on server
            rename($tmp, $new);
            // push new filename (in path) to be used in file array later
            $tmp = $new;
        }

        // determine file type (ext and mime/type)
        $url_type = wp_check_filetype($url_filename);

        // If the wp_check_filetype function fails to determine the MIME type
        if (empty($url_type['type'])) {
            $url_type = wpra_check_file_type($tmp, $url);
        }
        $ext = $url_type['ext'];

        // assemble file data (should be built like $_FILES since wp_handle_sideload() will be using)
        $file_array = [];
        // full server path to temp file
        $file_array['tmp_name'] = $tmp;
        $parts = parse_url(trim($img->get_url()));
        $baseName = uniqid($parts['host']);

        $parts['path'] = apply_filters('wpra/images/cache_path', $parts['path']);

        if (!empty($filename)) {
            // user given filename for title, add original URL extension
            $baseName = $filename . "." . $ext;
        } else {
            // The original basename, falling back to auto-generated based on domain
            $base = basename($parts['path']);
            if (strlen($baseName) || trim($baseName) !== '/') {
                $baseName = $base;
            }
        }

        // Fix for Facebook images that come from a PHP endpoint
        if (stripos($baseName, 'safe_image.php') !== false) {
            $hash = crc32(trim($img->get_url()));

            $baseName = str_replace('safe_image.php', $hash . '.jpeg', $baseName);
        }

        $file_array['name'] = $baseName;

        // set additional wp_posts columns
        if (empty($post_data['post_title'])) {
            // just use the original filename (no extension)
            $post_data['post_title'] = $file_array['name'];
        }

        // make sure gets tied to parent
        if (empty($post_data['post_parent'])) {
            $post_data['post_parent'] = $post_id;
        }

        // required files for WP media_handle_sideload
        require_once(ABSPATH . 'wp-admin/includes/media.php');
        require_once(ABSPATH . 'wp-admin/includes/image.php');

        // NO FILENAME FIX
        // WordPress does not allow file images that are not in the form of a filename
        // ex: http://domain.com/thoufiqadsjucpqwuamoshfjnax8mtrh/iorqhewufjasj

        if (apply_filters('wpra_override_upload_security', true) === true) {
            // If we successfully retrieved the MIME type
            if ($url_type !== false && isset($url_type['type']) && !empty($url_type['type'])) {
                $mime_to_ext = wpra_get_mime_type_ext_mapping();

                $mime_type = $url_type['type'];
                $file_ext = isset($mime_to_ext[$mime_type])
                    ? $mime_to_ext[$mime_type]
                    : null;

                // If no file extension, check if the mime type begins with "image/" and if so default to "png"
                $mime_type_parts = explode('/', $mime_type);
                if ($file_ext === null && count($mime_type_parts) > 1 && $mime_type_parts[0] === 'image') {
                    $file_ext = 'png';
                }

                // Add a filter to ensure that the image ext and mime type get passed through WordPress' security
                add_filter('wp_check_filetype_and_ext', function ($image) use ($file_ext, $mime_type) {
                    $image['ext'] = empty($image['ext']) ? $file_ext : $image['ext'];
                    $image['type'] = empty($image['type']) ? $mime_type : $image['type'];

                    // If the image has a `proper_filename` and an `ext`
                    if (!empty($image['proper_filename']) && !empty($image['ext'])) {
                        $filename = strtolower($image['proper_filename']);
                        $extension = strtolower($image['ext']);

                        // Do a case insensitive check for the extension in the proper_filename. If not found, we
                        // add the extension
                        if (!preg_match('/'.$extension.'$/i', $filename)) {
                            $image['proper_filename'] .= '.' . $extension;
                        }
                    }

                    return $image;
                }, 10);
            }
        }

        // do the validation and storage stuff
        // For some reason, deep down filesize() returned 0 for the temporary file without this
        clearstatcache(false, $file_array['tmp_name']);

        // Allocate 30 for WordPress to copy and process the image
        set_time_limit(apply_filters('wpra/images/time_limit/copy', 30));

        // $post_data can override the items saved to wp_posts table,
        // like post_mime_type, guid, post_parent, post_title, post_content, post_status
        $att_id = media_handle_sideload($file_array, $post_id, '', $post_data);

        // If error storing permanently, unlink
        if (is_wp_error($att_id)) {
            $logger->warning('Failed to download and attach image to post #{id}. Image URL: {url}', [
                'id' => $post_id,
                'url' => $url,
            ]);

            // Delete the cache copy needed for media_handle_sideload()
            $img->delete();
            @unlink($tmp);

            return $att_id;
        }
    }

    // set as post thumbnail if desired
    if ($attach) {
        set_post_thumbnail( $post_id, $att_id );
    }

    // Save the original image URL in the attachment's meta data
    update_post_meta($att_id, 'wprss_og_image_url', $url);

    return $att_id;
}

/**
 * Fallback function for determining mime type and extension of an image
 *
 * @since 4.14
 *
 * @param string $local_image_path  Local path of the downloaded image
 * @param string $remote_image_path Remote image url
 *
 * @return array Values with extension first and mime type.
 */
function wpra_check_file_type($local_image_path, $remote_image_path)
{
    $ext = false;
    $type = false;

    $mime_to_ext_mapping = wpra_get_mime_type_ext_mapping();

    $mime_var = 'mime';
    $image_response = @getimagesize($local_image_path);

    // Trying to get MIME type of the image
    if (!isset($image_response) || $image_response == false) {
        $image_response = @get_headers($remote_image_path, 1);
        if ($image_response !== false) {
            $mime_var = 'Content-Type';
        }
    }

    // If mime type successfully determined
    if (!empty($image_response[$mime_var])) {
        $type = $image_response[$mime_var];

        if (isset($mime_to_ext_mapping[$type])) {
            $ext = $mime_to_ext_mapping[$type];
        }
    }

    return compact('ext', 'type');
}

/**
 * Return Mime type and ext mapping array
 *
 * @since 4.14
 * @return array Mime type and ext mapping
 */
function wpra_get_mime_type_ext_mapping()
{

    // Get MIME to extension mappings ( from WordPress wp_check_filetype_and_ext() function )
    return apply_filters(
        'getimagesize_mimes_to_exts', [
            'image/jpeg' => 'jpg',
            'image/png' => 'png',
            'image/gif' => 'gif',
            'image/bmp' => 'bmp',
            'image/tiff' => 'tif',
        ]
    );
}

/**
 * Returns the attachment ID of the image with the given source
 *
 * @since 4.14
 */
function wpra_get_attachment_id_from_url( $image_src ) {
    global $wpdb;
    $query = "SELECT ID FROM {$wpdb->posts} WHERE guid='$image_src'";
    $id = $wpdb->get_var($query);
    return $id;
}

/**
 * Checks if an images feature is enabled.
 *
 * @since 4.14
 *
 * @param string $feature The feature name.
 *
 * @return bool True if the feature is enabled, false if the feature is disabled.
 */
function wpra_image_feature_enabled($feature)
{
    $c = wpra_container();
    $key = 'wpra/images/features/' . $feature;

    return $c->has($key) && $c->get($key) === true;
}


File Name:
feed-importing-new.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-importing-new.php
Code:
<?php

namespace RebelCode\Wpra\Core\Importer;

use SimplePie_Item;
use WP_Post;

/**
 * Fetches new items from a feed.
 *
 * @since [*next-version*]
 *
 * @param int|string $feedId The ID of the feed source.
 *
 * @return SimplePie_Item[]
 */
function fetchNewItems($feedId)
{
    $feed = get_post($feedId);
    $logger = wpra_get_logger($feedId);

    if ($feed instanceof WP_Post) {
        $logger->info('Fetching items');
    } else {
        $logger->error('Feed source #{0} does not exist', [$feedId]);
    }

    // Filter the URL
    $feedUrl = apply_filters('wprss_feed_source_url', $feed->wprss_url, $feedId);
    if ($feedUrl !== $feed->wprss_url) {
        $logger->debug('Filtered RSS URL: {0}', [$feedUrl]);
    }

    // Validate the URL
    if (!wprss_validate_url($feedUrl)) {
        $logger->error('Feed URL is not valid!');

        return [];
    }

    // Get the feed items from the source
    $items = wprss_get_feed_items($feedUrl, $feedId);
    $items = (empty($items) || !is_array($items)) ? [] : $items;

    // See `wprss_item_comparators` filter
    wprss_sort_items($items);

    // Apply fixed limit
    {
        $feedLimit = $feed->wprss_limit;
        $globalLimit = wprss_get_general_setting('limit_feed_items_imported');
        $filteredLimits = array_filter([$feedLimit, $globalLimit], function ($limit) {
            return !empty($limit) && intval($limit) > 0;
        });
        $limit = (int) reset($filteredLimits);

        if ($limit > 0) {
            $preLimitCount = count($items);
            $items = array_slice($items, 0, $limit);

            $logger->debug('{0} items in the feed, {1} items after applying limit', [
                $preLimitCount,
                $limit,
            ]);
        }
    }

    // Process "unique titles only" option
    {
        $feedUto = $feed->wprss_unique_titles;
        $globalUto = wprss_get_general_setting('unique_titles');
        $uto = empty($feedUto) ? $globalUto : $feedUto;
        $uto = filter_var($uto, FILTER_VALIDATE_BOOLEAN);
    }

    $items = apply_filters('wpra/importer/items/before_filters', $items, $feed, $logger);

    // Gather the titles and permalinks of the items that are being fetched
    $existingTitles = [];
    $existingPermalinks = wprss_get_existing_permalinks($feedId);

    $newItems = [];
    foreach ($items as $item) {
        // Filter the item
        $item = apply_filters('wpra/importer/item', $item, $feed, $logger);

        $title = $item->get_title();
        $permalink = wprss_normalize_permalink($item->get_permalink(), $item, $feedId);

        // Check if already imported
        if (array_key_exists($permalink, $existingPermalinks)) {
            $logger->debug('Skipping item "{0}": already imported', [$title]);

            continue;
        }

        // Check if blacklisted
        if (wprss_is_blacklisted($permalink)) {
            $logger->debug('Skipping item "{0}": blacklisted', [$title]);

            continue;
        }

        // Check if title exists
        if ($uto) {
            $existingTitles[$title] = 1;

            if (wprss_item_title_exists($title) || array_key_exists($title, $existingTitles)) {
                $logger->debug('Skipping item "{0}": title is not unique', [$title]);

                continue;
            }
        }

        if (apply_filters('wpra/importer/filter_item', true, $item, $feed, $logger)) {
            $newItems[] = $item;
        }
    }

    $items = apply_filters('wpra/importer/items/after_filters', $items, $feed, $logger);

    $numOgItems = count($items);
    $numNewItems = count($newItems);
    if ($numOgItems !== $numNewItems) {
        $logger->debug('{0} items were skipped', [$numOgItems - $numNewItems]);
    }

    // Apply the "per-import" limit
    $importLimit = (int) wprss_get_general_setting('limit_feed_items_per_import');
    if ($importLimit > 0) {
        $items = array_slice($items, 0, $importLimit);
    }

    return $items;
}

/**
 * Imports a feed item.
 *
 * @since [*next-version*]
 *
 * @param SimplePie_Item $item   The item to import.
 * @param int|string     $feedId The ID of the feed source.
 *
 * @return bool True if the item was imported successfully, false if importing failed.
 */
function importItem(SimplePie_Item $item, $feedId)
{
    $logger = wpra_get_logger($feedId);
    $logger->debug('Importing item "{0}"', [$item->get_title()]);

    set_time_limit(wprss_get_item_import_time_limit());

    $lcc = legacyConditionalCheck($item, $feedId);
    $item = $lcc[0];
    $import = $lcc[1];

    // If item should not be imported,
    // -> return true if the item was imported by other means (not null)
    // -> return false if the item was blocked (is null)
    if (!$import) {
        return $item !== null;
    }

    $title = trim(html_entity_decode($item->get_title()));
    $title = empty($title) ? $item->get_id() : $title;

    $enclosure = $item->get_enclosure();
    $enclosureUrl = $enclosure ? $enclosure->get_link() : null;

    $permalink = htmlspecialchars_decode($item->get_permalink());
    $permalink = wprss_normalize_permalink($permalink, $item, $feedId);

    $dates = getImportDates($item, $feedId);
    $date = $dates[0];
    $dateGmt = $dates[1];
    $isFuture = $dates[2];
    $status = $isFuture ? 'future' : 'publish';

    $excerpt = wprss_sanitize_excerpt($item->get_description());
    $content = $item->get_content();

    $source = getSourceInfo($item);
    $author = getAuthorInfo($item);

    // Do not let WordPress sanitize the excerpt
    // WordPress sanitizes the excerpt because it's expected to be typed by a user and sent in a POST
    // request. However, our excerpt is being inserted as a raw string with custom sanitization.
    remove_all_filters('excerpt_save_pre');

    $postData = apply_filters(
        'wprss_populate_post_data',
        [
            'post_title' => $title,
            'post_content' => $content,
            'post_excerpt' => $excerpt,
            'post_status' => $status,
            'post_type' => 'wprss_feed_item',
            'post_date' => $date,
            'post_date_gmt' => $dateGmt,
            'meta_input' => [
                'wprss_feed_id' => $feedId,
                'wprss_item_date' => $item->get_date(DATE_ISO8601),
                'wprss_item_permalink' => $permalink,
                'wprss_item_enclosure' => $enclosureUrl,
                'wprss_item_source_name' => $source[0],
                'wprss_item_source_url' => $source[1],
                'wprss_item_author' => $author[0],
                'wprss_item_author_email' => $author[1],
                'wprss_item_author_link' => $author[2],
            ],
        ],
        $item
    );

    $postData = apply_filters('wpra/importer/item/post_data', $postData, $item, $feedId);

    if (defined('ICL_SITEPRESS_VERSION')) {
        @include_once(WP_PLUGIN_DIR . '/sitepress-multilingual-cms/inc/wpml-api.php');
    }
    if (defined('ICL_LANGUAGE_CODE')) {
        $_POST['icl_post_language'] = $language_code = ICL_LANGUAGE_CODE;
    }

    // Create and insert post object into the DB
    $postId = wp_insert_post($postData);

    if (is_wp_error($postId)) {
        update_post_meta(
            $feedId,
            'wprss_error_last_import',
            'An error occurred while inserting a feed item into the database.'
        );

        $logger->error('Failed to insert item into the database');

        return false;
    }

    do_action('wprss_items_create_post_meta', $postId, $item, $feedId);
    do_action('wpra/importer/item/inserted', $item, $feedId);

    $logger->notice('Imported item {0}. ID: {1}', [$title, $postId]);

    return true;
}

/**
 * Runs the legacy "post item conditionals" filter for a feed item.
 *
 * @since [*next-version*]
 *
 * @param SimplePie_Item $item   The item.
 * @param int|string     $feedId The ID of the feed source.
 *
 * @return array An array with 2 elements:
 *               1. the filtered item, or null if the item was rejected.
 *               2. a boolean that signifies whether the item should be imported or not.
 *               A return value containing a non-null item and a false boolean signifies a non-rejected item, but that
 *               should still not be imported because it was imported using a non-Core mechanism (ex. Feed to Post).
 */
function legacyConditionalCheck(SimplePie_Item $item, $feedId)
{
    $logger = wpra_get_logger($feedId);

    // Log the callbacks that are hooked into the filter
    $condCallbacks = wpra_get_hook_callbacks('wprss_insert_post_item_conditionals');
    if (count($condCallbacks) > 0) {
        $logger->debug('Hooks for `wprss_insert_post_item_conditionals`:');

        foreach ($condCallbacks as $callback) {
            $logger->debug('-> {0}', [wprss_format_hook_callback($callback)]);
        }
    }

    $title = $item->get_title();
    $permalink = htmlspecialchars_decode($item->get_permalink());
    $permalink = wprss_normalize_permalink($permalink, $item, $feedId);

    $preItem = $item;
    $postItem = apply_filters('wprss_insert_post_item_conditionals', $item, $feedId, $permalink);
    $updateCount = apply_filters('wprss_still_update_import_count', false);

    if (is_bool($postItem) || $postItem === null) {
        // Item is TRUE, or it's FALSE/NULL but it still counts
        if ($postItem || $updateCount) {
            $logger->debug('Item "{0}" was imported by an add-on or filter', [$title]);

            return [$preItem, false];
        }

        // Item was filtered
        if (has_filter('wprss_insert_post_item_conditionals', 'wprss_kf_check_post_item_keywords')) {
            $logger->info('Item "{0}" was rejected by your keyword or tag filtering.', [$title]);
        } else {
            $logger->notice('Item "{0}" was rejected by an add-on or filter.', [$title]);
        }

        return [null, false];
    } else {
        return [$postItem, true];
    }
}

function getImportDates(SimplePie_Item $item, $feedId)
{
    $logger = wpra_get_logger($feedId);

    $dateFormat = 'Y-m-d H:i:s';
    $timestamp = $item->get_gmdate('U');
    $isFuture = false;

    if ($timestamp) {
        if ($timestamp > time()) {
            $scheduleItemsFilter = apply_filters('wpra/importer/allow_scheduled_items', false);
            $scheduleItemsOption = wprss_get_general_setting('schedule_future_items');

            if ($scheduleItemsFilter || $scheduleItemsOption) {
                // If can schedule future items, set the post status to "future" (aka scheduled)
                $isFuture = true;
                $logger->debug('Setting future status due to future date');
            } else {
                // If cannot schedule future items, clamp the timestamp to the current time
                $timestamp = min(time(), $timestamp);
                $logger->debug('Date clamped to present time');
            }
        }
    } else {
        // Item has no date ...
        $logger->debug('Item has no date. Using current time');
        $timestamp = time();
    }

    $date = $item->get_date($dateFormat);
    $dateGmt = gmdate($dateFormat, $timestamp);

    return [$date, $dateGmt, $isFuture];
}

function getSourceInfo(SimplePie_Item $item)
{
    /* @var $item SimplePie_Item */
    $feed = $item->get_feed();

    // Get the source from the RSS item
    $source = $item->get_source();

    // Get the source name if available. If empty, default to the feed source CPT title
    $name = ($source === null) ? '' : $source->get_title();
    $name = empty($name) ? $feed->get_title() : $name;

    // Get the source URL if available. If empty, default to the RSS feed's URL
    $url = ($source === null) ? '' : $source->get_permalink();
    $url = empty($url) ? $feed->get_permalink() : $url;

    return [$name, $url];
}

function getAuthorInfo(SimplePie_Item $item)
{
    $author = $item->get_author();

    if ($author) {
        $name = $author->get_name();
        $email = $author->get_email();
        $link = $author->get_link();
    } else {
        $name = '';
        $email = '';
        $link = '';
    }

    return [$name, $email, $link];
}

function getExcessItems($feedId, $add = 0)
{
    $limit = getLimit($feedId);

    if ($limit <= 0) {
        return 0;
    }

    // Get existing items
    $dbItems = wprss_get_feed_items_for_source($feedId);
    $numDbItems = $dbItems->post_count + $add;

    if ($numDbItems <= $limit) {
        return 0;
    }

    $numExcess = $numDbItems - $limit;

    return array_slice(array_reverse($dbItems->posts), 0, $numExcess);
}

function getLimit($feedId)
{
    $feedLimit = get_post_meta($feedId, 'wprss_limit', true);
    $globalLimit = wprss_get_general_setting('limit_feed_items_imported');

    $filteredLimits = array_filter([$feedLimit, $globalLimit], function ($limit) {
        return !empty($limit) && intval($limit) > 0;
    });

    return (int) reset($filteredLimits);
}


File Name:
feed-importing-sites.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-importing-sites.php
Code:
<?php

// FEED BURNER
// Adds the "format=xml" query parameter if not present
add_filter('wpra/importer/feed/url', function ($url, $parsed) {
    // Check if it's a Youtube URL
    if (stripos($parsed['host'], 'feedburner.com') === false) {
        return $url;
    }

    if (stripos($url, 'format=xml') === false) {
        $url .= empty($parsed['query']) ? '?' : '&';
        $url .= 'format=xml';
    }

    return $url;
}, 10, 2);


File Name:
feed-importing.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-importing.php
Code:
<?php

/**
 * Functions relating to feed importing
 *
 * @package WPRSSAggregator
 */

// Warning: Order may be important
add_filter('wprss_normalize_permalink', 'wprss_google_news_url_fix', 8);
add_filter('wprss_normalize_permalink', 'wprss_bing_news_url_fix', 9);
add_filter('wprss_normalize_permalink', 'wprss_google_alerts_url_fix', 10);
add_filter('wprss_normalize_permalink', 'wprss_convert_video_permalink', 100);

// Adds comparators for item sorting
add_filter('wprss_item_comparators', 'wprss_sort_comparators_default');

add_action( 'wprss_fetch_single_feed_hook', 'wprss_fetch_insert_single_feed_items' );
/**
 * The main feed fetching function.
 * Fetches the feed items from the source provided and inserts them into the DB.
 *
 * Called on hook 'wprss_fetch_single_feed_hook'.
 *
 * @since 3.2
 */
function wprss_fetch_insert_single_feed_items( $feed_ID ) {
    set_transient('wpra/feeds/importing/' . $feed_ID, true, 0);

    global $wprss_importing_feed;
    $wprss_importing_feed = $feed_ID;

    register_shutdown_function('wprss_detect_exec_timeout');

    $importFn = function ($feed_ID) {
        $logger = wpra_get_logger($feed_ID);
        $logger->info('Starting import of feed {id}', ['id' => $feed_ID]);

        $t = microtime(true);

        // Check if the feed source is active.
        if ( ! wprss_is_feed_source_active( $feed_ID ) && ! wprss_feed_source_force_next_fetch( $feed_ID ) ) {
            $logger->info('Feed is not active. Finished');
            return;
        }

        // If the feed source is forced for next fetch, remove the force next fetch data
        if ( wprss_feed_source_force_next_fetch( $feed_ID ) ) {
            delete_post_meta( $feed_ID, 'wprss_force_next_fetch' );
        }

        // Truncate old items first
        wprss_truncate_items_for_source( $feed_ID );

        // Get the feed source URL from post meta, and filter it
        $feed_url = get_post_meta( $feed_ID, 'wprss_url', true );
        $feed_url = apply_filters( 'wprss_feed_source_url', $feed_url, $feed_ID );
        $logger->debug('Feed source URL: {0}', [$feed_url]);

        // Get the feed limit from post meta
        $feed_limit = get_post_meta( $feed_ID, 'wprss_limit', true );

        // If the feed has no individual limit
        if ( $feed_limit === '' || intval( $feed_limit ) <= 0 ) {
            // Get the global limit
            $global_limit = wprss_get_general_setting('limit_feed_items_imported');
            // If no global limit is set, mark as NULL
            if ( $global_limit === '' || intval($global_limit) <= 0 ) {
                $feed_limit = NULL;
            }
            else $feed_limit = $global_limit;
        }

        // Filter the URL for validaty
        if ( ! wprss_validate_url( $feed_url ) ) {
            $logger->error('Feed URL is not valid!');
        } else {
            // Get the feed items from the source
            $items = wprss_get_feed_items( $feed_url, $feed_ID );

            // If got NULL, convert to an empty array
            if ( $items === NULL ) {
                $items_to_insert = array();
            } else {
                // See `wprss_item_comparators` filter
                wprss_sort_items($items);

                // If using a limit ...
                if ( $feed_limit === NULL ) {
                    $items_to_insert = $items;
                } else {
                    $items_to_insert = array_slice( $items, 0, $feed_limit );
                    $logger->debug('{0} items in the feed, {1} items after applying limit', [
                        count($items),
                        count($items_to_insert)
                    ]);
                }
            }

            $unique_titles_only = get_post_meta($feed_ID, 'wprss_unique_titles', true);
            $unique_titles_only = ($unique_titles_only === '')
                ? wprss_get_general_setting('unique_titles')
                : $unique_titles_only;
            $unique_titles_only = filter_var($unique_titles_only, FILTER_VALIDATE_BOOLEAN);
            // Gather the titles of the items that are imported
            // The import process will check not only the titles in the DB but the titles currently in the feed
            $existing_titles = [];

            // Gather the permalinks of existing feed item's related to this feed source
            $existing_permalinks = wprss_get_existing_permalinks( $feed_ID );

            // Generate a list of items fetched, that are not already in the DB
            $new_items = array();
            foreach ( $items_to_insert as $item ) {
                $item_title = $item->get_title();
                $permalink = wprss_normalize_permalink( $item->get_permalink(), $item, $feed_ID );

                // Check if blacklisted
                if (wprss_is_blacklisted($permalink)) {
                    $logger->debug('Item "{0}" is blacklisted', [$item_title]);

                    continue;
                }

                // Check if already imported
                if (array_key_exists($permalink, $existing_permalinks)) {
                    $logger->debug('Item "{0}" already exists in the database', [$item_title]);

                    continue;
                }

                // Check if title exists (if the option is enabled)
                if ($unique_titles_only) {
                    $title_exists_db = wprss_item_title_exists($item->get_title());
                    $title_exists_feed = array_key_exists($item_title, $existing_titles);
                    $title_exists = $title_exists_db || $title_exists_feed;
                    // Add this item's title to the list to check against
                    $existing_titles[$item_title] = 1;

                    if ($title_exists) {
                        $logger->debug('An item with the title "{0}" already exists', [$item_title]);

                        continue;
                    }
                }

                $new_items[] = $item;
            }

            $original_count = count( $items_to_insert );
            $new_count = count( $new_items );

            if ( $new_count !== $original_count ) {
                $logger->debug('{0} will be skipped', [$original_count - $new_count]);
            }

            $items_to_insert = $new_items;
            $per_import = wprss_get_general_setting('limit_feed_items_per_import');
            if (!empty($per_import)) {
                $items_to_insert = array_slice( $items_to_insert, 0, $per_import );
            }

            // If using a limit - delete any excess items to make room for the new items
            if ( $feed_limit !== NULL ) {
                // Get the number of feed items in DB, and their count
                $db_feed_items = wprss_get_feed_items_for_source( $feed_ID );
                $num_db_feed_items = $db_feed_items->post_count;

                // Get the number of feed items we can store until we reach the limit
                $num_can_insert = $feed_limit - $num_db_feed_items;
                // Calculate how many feed items we must delete before importing, to keep to the limit
                $num_new_items = count( $new_items );
                $num_feed_items_to_delete = $num_can_insert > $num_new_items
                        ? 0
                        : $num_new_items - $num_can_insert;

                // Get an array with the DB feed items in reverse order (oldest first)
                $db_feed_items_reversed = array_reverse( $db_feed_items->posts );
                // Cut the array to get only the first few that are to be deleted ( equal to $num_feed_items_to_delete )
                $feed_items_to_delete = array_slice( $db_feed_items_reversed, 0, $num_feed_items_to_delete );

                // Iterate the feed items and delete them
                $num_items_deleted = 0;
                foreach ( $feed_items_to_delete as $key => $post ) {
                    wp_delete_post( $post->ID, TRUE );
                    $num_items_deleted++;
                }

                if ($num_items_deleted > 0) {
                    $logger->info('Deleted the oldest {0} items', [$num_items_deleted]);
                }
            }

            update_post_meta( $feed_ID, 'wprss_last_update', $last_update_time = time() );
            update_post_meta( $feed_ID, 'wprss_last_update_items', 0 );

            // Insert the items into the db
            if ( !empty( $items_to_insert ) ) {
                wprss_items_insert_post( $items_to_insert, $feed_ID );
            }
        }

        $next_scheduled = get_post_meta( $feed_ID, 'wprss_reschedule_event', TRUE );

        if ( $next_scheduled !== '' ) {
            wprss_feed_source_update_start_schedule( $feed_ID );
            delete_post_meta( $feed_ID, 'wprss_reschedule_event' );
            $logger->info('Scheduled next update');
        }

        $t = microtime(true) - $t;

        $logger->info(sprintf('Import completed in %.2f seconds!', $t));
    };

    try {
        $importFn($feed_ID);
    } catch (Exception $e) {
        wpra_get_logger($feed_ID)->error($e->getMessage());
        throw $e;
    }

    delete_transient('wpra/feeds/importing/' . $feed_ID);
    wprss_flag_feed_as_idle($feed_ID);
    $wprss_importing_feed = null;
}

/**
 * Fetches the feed items from a feed at the given URL.
 *
 * Called from 'wprss_fetch_insert_single_feed_items'
 *
 * @since 3.0
 *
 * @return SimplePie_Item[]|null
 */
function wprss_get_feed_items( $feed_url, $source, $force_feed = FALSE ) {
    // Add filters and actions prior to fetching the feed items
    add_filter( 'wp_feed_cache_transient_lifetime' , 'wprss_feed_cache_lifetime' );

    /* Fetch the feed from the soure URL specified */
    $feed = wprss_fetch_feed( $feed_url, $source, $force_feed );

    if (is_wp_error($feed)) {
        wpra_get_logger($source)->error('Failed to fetch the feed from {0}. Error: {1}', [
            $feed_url,
            $feed->get_error_message()
        ]);

        return NULL;
    }

    update_post_meta( $source, 'wprss_site_url', $feed->get_permalink() );
    update_post_meta( $source, 'wprss_feed_image', $feed->get_image_url() );

    // Remove previously added filters and actions
    remove_filter( 'wp_feed_cache_transient_lifetime' , 'wprss_feed_cache_lifetime' );

    return @$feed->get_items();
}

if (defined('WP_DEBUG') && WP_DEBUG) {
    add_action ('cron_request', 'wpse_cron_add_xdebug_cookie', 10) ;
}

/**
 * Allow debugging of wp_cron jobs
 *
 * @param array $cron_request_array
 * @param string $doing_wp_cron
 *
 * @return array $cron_request_array with the current XDEBUG_SESSION cookie added if set
 */
function wpse_cron_add_xdebug_cookie ($cron_request_array)
{
    if (empty ($_COOKIE['XDEBUG_SESSION'])) {
        return ($cron_request_array) ;
    }

    if (empty ($cron_request_array['args']['cookies'])) {
        $cron_request_array['args']['cookies'] = array () ;
    }
    $cron_request_array['args']['cookies']['XDEBUG_SESSION'] = $_COOKIE['XDEBUG_SESSION'] ;

    return ($cron_request_array) ;
}

/**
 * Checks if feed caching is enabled.
 *
 * This function will only return true if the cache option is enabled in the settings AND the cache directory exists
 * or can be successfully created and is writable.
 *
 * @since 4.15
 *
 * @return bool
 */
function wprss_is_feed_cache_enabled()
{
    $cacheOption = wprss_get_general_setting('feed_cache_enabled');
    $cacheOption = filter_var($cacheOption, FILTER_VALIDATE_BOOLEAN);

    if (!$cacheOption) {
        return false;
    }

    $cacheDir = wprss_get_feed_cache_dir();

    if (!file_exists($cacheDir)) {
        @mkdir($cacheDir);
    }

    return is_writable($cacheDir);
}

/**
 * Retrieves the feed cache directory.
 *
 * @since 4.15
 *
 * @return string
 */
function wprss_get_feed_cache_dir()
{
    return wpra_container()->get('wpra/importer/cache/dir');
}


/**
 * A clone of the function 'fetch_feed' in wp-includes/feed.php [line #529]
 *
 * Called from 'wprss_get_feed_items'
 *
 * @since 3.5
 */
function wprss_fetch_feed($url, $source = null, $param_force_feed = false)
{
    // Trim the URL
    $url = trim($url);
    // Parse the URL
    $parsed = wpra_parse_url($url);
    // Filter the URL
    $url = apply_filters('wpra/importer/feed/url', $url, $parsed);

    // Initialize the Feed
    $feed = new SimplePie();
    $feed->set_feed_url($url);
    $feed->set_autodiscovery_level(SIMPLEPIE_LOCATOR_ALL);

    // If a feed source was passed
    if ($source !== null || $param_force_feed) {
        // Get the force feed option for the feed source
        $force_feed = get_post_meta($source, 'wprss_force_feed', true);
        // If turned on, force the feed
        if ($force_feed == 'true' || $param_force_feed) {
            $feed->force_feed(true);
            $feed->set_autodiscovery_level(SIMPLEPIE_LOCATOR_NONE);

            global $wpraNoSslVerification;
            $wpraNoSslVerification = true;
        }
    }

    // Set timeout limit
    $fetch_time_limit = wprss_get_feed_fetch_time_limit();
    $feed->set_timeout($fetch_time_limit);

    $cacheEnabled = wprss_is_feed_cache_enabled();
    $feed->enable_cache($cacheEnabled);

    if ($cacheEnabled) {
        $feed->set_cache_location(wprss_get_feed_cache_dir());
    }

    // Reference array action hook, for the feed object and the URL
    do_action_ref_array('wp_feed_options', array(&$feed, $url));

    // Prepare the tags to strip from the feed
    $tags_to_strip = apply_filters('wprss_feed_tags_to_strip', $feed->strip_htmltags, $source);
    // Strip them
    $feed->strip_htmltags($tags_to_strip);

    do_action('wprss_fetch_feed_before', $feed, $source);

    // Fetch the feed
    $feed->init();
    $feed->handle_content_type();

    do_action('wprss_fetch_feed_after', $feed);

    // Convert the feed error into a WP_Error, if applicable
    if ($feed->error()) {
        if ($source !== null) {
            $msg = sprintf(__('Failed to fetch the RSS feed. Error: %s', WPRSS_TEXT_DOMAIN), $feed->error());
            update_post_meta($source, 'wprss_error_last_import', $msg);
        }
        return new WP_Error('simplepie-error', $feed->error(), array('feed' => $feed));
    }
    // If no error, return the feed and remove any error meta
    delete_post_meta($source, 'wprss_error_last_import');
    return $feed;
}


/**
 * Normalizes the given permalink.
 *
 * @param string $permalink The permalink to normalize
 * @return string The normalized permalink
 * @since 4.2.3
 */
function wprss_normalize_permalink( $permalink, $item, $feed_ID) {
    // Apply normalization functions on the permalink
    $permalink = trim( $permalink );
    $permalink = apply_filters( 'wprss_normalize_permalink', $permalink, $item, $feed_ID);
    // Return the normalized permalink
    return $permalink;
}


/**
 * Extracts the actual URL from a Google News permalink
 *
 * @param string $permalink The permalink to normalize.
 * @since 4.2.3
 */
function wprss_google_news_url_fix($permalink) {
    return wprss_tracking_url_fix($permalink, '!^(https?:\/\/)?' . preg_quote('news.google.com', '!') . '.*!');
}


    /**
 * Extracts the actual URL from a Google Alerts permalink
 *
 * @param string $permalink The permalink to normalize.
     * @since 4.7.3
 */
function wprss_google_alerts_url_fix($permalink) {
    return wprss_tracking_url_fix($permalink, '!^(https?:\/\/)?(www\.)?' . preg_quote('google.com/url', '!') . '.*!');
}


/**
 * Extracts the actual URL from a Bing permalink
 *
 * @param string $permalink The permalink to normalize.
 * @since 4.2.3
 */
function wprss_bing_news_url_fix($permalink) {
    return wprss_tracking_url_fix($permalink, '!^(https?:\/\/)?(www\.)?' . preg_quote('bing.com/news', '!') . '.*!');
}


/**
 * Checks if the permalink is a tracking permalink based on host, and if
 * it is, returns the normalized URL of the proper feed item article,
 * determined by the named query argument.
 *
 * Fixes the issue with equivalent Google News etc. items having
 * different URLs, that contain randomly generated GET parameters.
 * Example:
 *
 * http://news.google.com/news/url?sa=t&fd=R&ct2=us&ei=V3e9U6izMMnm1QaB1YHoDA&url=http://abcd...
 * http://news.google.com/news/url?sa=t&fd=R&ct2=us&ei=One9U-HQLsTp1Aal-oDQBQ&url=http://abcd...
 *
 * @param string $permalink The permalink URL to check and/or normalize.
 * @param string|array $patterns One or an array of host names, for which the URL should be fixed.
 * @param string Name of the query argument that specifies the actual URL.
 * @return string The normalized URL of the original article, as indicated by the `url`
 *					parameter in the URL query string.
 * @since 4.2.3
 */
function wprss_tracking_url_fix( $permalink, $patterns, $argName = 'url' ) {
    // Parse the url
    $parsed = parse_url( urldecode( html_entity_decode( $permalink ) ) );
    $patterns = is_array($patterns) ? $patterns :array($patterns);

    // If parsing failed, return the permalink
    if ( $parsed === FALSE || $parsed === NULL ) return $permalink;

    // Determine if it's a tracking item
    $isMatch = false;
    foreach( $patterns as $_idx => $_pattern ) {
        if( preg_match($_pattern, $permalink) ) {
        $isMatch = true;
        break;
        }
    }

    if( !$isMatch ) return $permalink;

    // Check if the url GET query string is present
    if ( !isset( $parsed['query'] ) ) return $permalink;

    // Parse the query string
    $query = array();
    parse_str( $parsed['query'], $query );

    // Check if the url GET parameter is present in the query string
    if ( !is_array($query) || !isset( $query[$argName] ) ) return $permalink;

    return urldecode( $query[$argName] );
}


/**
 * Converts YouTube, Vimeo and DailyMotion video urls
 * into embedded video player urls.
 * If the permalink is not a video url, the permalink is returned as is.
 *
 * @param	$permalink The string permalink url to convert.
 * @return	A string, with the convert permalink, or the same permalink passed as parameter if
 *			not a video url.
 * @since 4.0
 */
function wprss_convert_video_permalink( $permalink ) {
    // CHECK PERMALINK FOR VIDEO HOSTS : YOUTUBE, VIMEO AND DAILYMOTION
    $found_video_host = preg_match( '/http[s]?:\/\/(www\.)?(youtube|dailymotion|vimeo)\.com\/(.*)/i', $permalink, $matches );

    // If video host was found
    if ( $found_video_host !== 0 && $found_video_host !== FALSE ) {

        // Get general options
        $options = get_option( 'wprss_settings_general' );
        // Get the video link option entry, or false if it does not exist
        $video_link = ( isset($options['video_link']) )? $options['video_link'] : 'false';

        // If the video link option is true, change the video URL to its repective host's embedded
        // video player URL. Otherwise, leave the permalink as is.
        if ( strtolower( $video_link ) === 'true' ) {
            $host = $matches[2];
            switch( $host ) {
                case 'youtube':
                    preg_match( '/(&|\?)v=([^&]+)/', $permalink, $yt_matches );
                    $permalink = 'https://www.youtube.com/embed/' . $yt_matches[2];
                    break;
                case 'vimeo':
                    preg_match( '/(\d*)$/i', $permalink, $vim_matches );
                    $permalink = 'https://player.vimeo.com/video/' . $vim_matches[0];
                    break;
                case 'dailymotion':
                    preg_match( '/(\.com\/)(video\/)(.*)/i', $permalink, $dm_matches );
                    $permalink = 'https://www.dailymotion.com/embed/video/' . $dm_matches[3];
                    break;
            }
        }
    }

    return $permalink;
}


/**
 * Insert wprss_feed_item posts into the DB
 *
 * @since 3.0
 *
 * @param SimplePie_Item[] $items
 * @param int|string $feed_ID
 */
function wprss_items_insert_post( $items, $feed_ID ) {
    update_post_meta( $feed_ID, 'wprss_feed_is_updating', $update_started_at = time() );
    $logger = wpra_get_logger($feed_ID);

    // Gather the permalinks of existing feed item's related to this feed source
    $existing_permalinks = wprss_get_existing_permalinks( $feed_ID );

    // Count of items inserted
    $items_inserted = 0;

    foreach ( $items as $i => $item ) {

        // Normalize the URL
        $permalink = $item->get_permalink(); // Link or enclosure URL
        $permalink = htmlspecialchars_decode( $permalink ); // SimplePie encodes HTML special chars

        $logger->debug('Beginning import for item "{0}"', [$item->get_title()]);

        $permalink = wprss_normalize_permalink( $permalink, $item, $feed_ID );

        // Save the enclosure URL
        $enclosure_url = '';
        $enclosure = $item->get_enclosure(0);

        if ($enclosure && $enclosure->get_link()) {
            $enclosure_url = $enclosure->get_link();
        }

        // Check if newly fetched item already present in existing feed items,
        // if not insert it into wp_posts and insert post meta.
        if ( ! ( array_key_exists( $permalink, $existing_permalinks ) ) ) {
            // Extend the importing time and refresh the feed's updating flag to reflect that it is active
            $time_limit = wprss_get_item_import_time_limit();
            set_time_limit( $time_limit );

            global $wp_filter;
            if (isset($wp_filter['wprss_insert_post_item_conditionals'])) {
                $hook = $wp_filter['wprss_insert_post_item_conditionals'];

                if (count($hook->callbacks) > 0) {
                    $logger->debug('Hooks for `wprss_insert_post_item_conditionals`:');
                }

                foreach ($hook->callbacks as $list) {
                    foreach ($list as $callback) {
                        $logger->debug('-> {0}', [wprss_format_hook_callback($callback)]);
                    }
                }
            }

            $logger->debug('Checking conditionals ...');

            // Apply filters that determine if the feed item should be inserted into the DB or not.
            $ogItem = $item;
            $item = apply_filters( 'wprss_insert_post_item_conditionals', $item, $feed_ID, $permalink );
            /* @var $item SimplePie_Item */

            // Check if the imported count should still be updated, even if the item is NULL
            $still_update_count = apply_filters( 'wprss_still_update_import_count', FALSE );

            // If the item is not NULL, continue to inserting the feed item post into the DB
            if ( $item !== NULL && !is_bool($item) ) {
                $logger->debug('Resuming insertion into DB');

                $post_status = 'publish';

                // Get the date and GMT date and normalize if not valid or not given by the feed
                $format    = 'Y-m-d H:i:s';
                $timestamp = $item->get_date( 'U' );
                $has_date  = $timestamp ? true : false;

                if ($has_date) {
                    $logger->debug('Feed item "{0}" date: {1}', [$item->get_title(), $item->get_date($format)]);

                    if ($timestamp > time()) {
                        // Item has a future timestamp ...
                        $logger->debug('Item "{0}" has a future date', [$item->get_title()]);

                        $schedule_items_filter = apply_filters('wpra/importer/allow_scheduled_items', false);
                        $schedule_items_option = wprss_get_general_setting('schedule_future_items');

                        if ($schedule_items_filter || $schedule_items_option) {
                            // If can schedule future items, set the post status to "future" (aka scheduled)
                            $post_status = 'future';

                            $logger->debug('Setting future status');
                        } else {
                            // If cannot schedule future items, clamp the timestamp to the current time minus
                            // 1 second for each iteration done so far
                            $timestamp = min(time() - $i, $timestamp);

                            $logger->debug('Date was clamped to present time');
                        }
                    }
                } else {
                    // Item has no date ...
                    $logger->debug('Item "{0}" has no date. Using current time', [$item->get_title()]);
                    $timestamp = time();
                }

                $date     = date( $format, $timestamp );
                $date_gmt = gmdate( $format, $item->get_gmdate( 'U' ) );

                $logger->debug('Date for "{0}" will be {1}', [$item->get_title(), $date]);

                // Do not let WordPress sanitize the excerpt
                // WordPress sanitizes the excerpt because it's expected to be typed by a user and sent in a POST
                // request. However, our excerpt is being inserted as a raw string with custom sanitization.
                remove_all_filters( 'excerpt_save_pre' );

                $title = trim(html_entity_decode($item->get_title()));
                $title = empty($title) ? $item->get_id() : $title;

                // Prepare the item data
                $feed_item = apply_filters(
                    'wprss_populate_post_data',
                    array(
                        'post_title'     => $title,
                        'post_content'   => $item->get_content(),
                        'post_excerpt'   => wprss_sanitize_excerpt($item->get_description()),
                        'post_status'    => $post_status,
                        'post_type'      => 'wprss_feed_item',
                        'post_date'      => $date,
                        'post_date_gmt'  => $date_gmt
                    ),
                    $item
                );

                if ( defined('ICL_SITEPRESS_VERSION') )
                    @include_once( WP_PLUGIN_DIR . '/sitepress-multilingual-cms/inc/wpml-api.php' );
                if ( defined('ICL_LANGUAGE_CODE') ) {
                    $_POST['icl_post_language'] = $language_code = ICL_LANGUAGE_CODE;
                }

                // Create and insert post object into the DB
                $inserted_ID = wp_insert_post( $feed_item );

                if ( !is_wp_error( $inserted_ID ) ) {

                    if ( is_object( $inserted_ID ) ) {
                        if ( isset( $inserted_ID['ID'] ) ) {
                            $inserted_ID = $inserted_ID['ID'];
                        }
                        elseif ( isset( $inserted_ID->ID ) ) {
                            $inserted_ID = $inserted_ID->ID;
                        }
                    }

                    $logger->debug('Item "{0}" was inserted into DB, ID: {1}', [
                        $ogItem->get_title(),
                        $inserted_ID,
                    ]);

                    // Create and insert post meta into the DB
                    wprss_items_insert_post_meta( $inserted_ID, $item, $feed_ID, $permalink );

                    $logger->debug('Inserted meta data for item #{0}', [
                        $inserted_ID,
                    ]);

                    // Remember newly added permalink
                    $existing_permalinks[$permalink] = 1;

                    // Increment the inserted items counter
                    $items_inserted++;

                    $logger->notice('Finished import for item {0}, ID {1}', [
                        $ogItem->get_title(),
                        $inserted_ID,
                    ]);
                }
                else {
                    update_post_meta( $feed_ID, 'wprss_error_last_import', 'An error occurred while inserting a feed item into the database.' );

                    $logger->error('Failed to save item "{0}" into the database', [$item->get_title()]);
                }
            }
            // If the item is TRUE, then a hook function in the filter inserted the item.
            // increment the inserted counter
            elseif ( ( is_bool($item) && $item === TRUE ) || ( $still_update_count === TRUE && $item !== FALSE ) ) {
                $logger->debug('Item "{0}" was imported by an add-on or filter', [
                    $ogItem->get_title(),
                ]);
                $items_inserted++;
            } elseif (has_filter('wprss_insert_post_item_conditionals', 'wprss_kf_check_post_item_keywords')) {
                $logger->info('Item "{0}" was rejected by your keyword or tag filtering.', [
                    $ogItem->get_title()
                ]);
            } else {
                $logger->notice('Item "{0}" was rejected by an add-on or filter.', [
                    $ogItem->get_title()
                ]);
            }
        }
    }

    update_post_meta( $feed_ID, 'wprss_last_update_items', $items_inserted );
}

/**
 * Inserts the appropriate post meta for feed items.
 *
 * Called from 'wprss_items_insert_post'
 *
 * @since 2.3
 *
 * @param int            $inserted_ID   The inserted post ID.
 * @param SimplePie_Item $item          The SimplePie item object.
 * @param string         $permalink     The item's permalink.
 */
function wprss_items_insert_post_meta( $inserted_ID, $item, $feed_ID, $permalink ) {
    update_post_meta( $inserted_ID, 'wprss_item_date', $item->get_date(DATE_ISO8601) );
    update_post_meta( $inserted_ID, 'wprss_item_permalink', $permalink );

    $enclosure = $item->get_enclosure(0);
    $enclosureUrl = $enclosure ? $enclosure->get_link() : null;

    if ($enclosureUrl) {
        $enclosureType = $enclosure->get_type();

        update_post_meta( $inserted_ID, 'wprss_item_enclosure', $enclosureUrl );
        update_post_meta( $inserted_ID, 'wprss_item_enclosure_type', $enclosureType );

        if (stripos($enclosureType, 'audio')) {
            update_post_meta( $inserted_ID, 'wprss_item_audio', $enclosureUrl );
        }
    }

    /* @var $item SimplePie_Item */
    $feed = $item->get_feed();

    // Get the source from the RSS item
    $source = $item->get_source();

    // Get the source name if available. If empty, default to the feed source CPT title
    $source_name = ($source === null) ? '' : $source->get_title();
    $source_name = empty($source_name) ? $feed->get_title() : $source_name;

    // Get the source URL if available. If empty, default to the RSS feed's URL
    $source_url = ($source === null) ? '' : $source->get_permalink();
    $source_url = empty($source_url) ? $feed->get_permalink() : $source_url;

    update_post_meta( $inserted_ID, 'wprss_item_source_name', $source_name);
    update_post_meta( $inserted_ID, 'wprss_item_source_url', $source_url);

    $author = $item->get_author();
    if ($author instanceof SimplePie_Author) {
        update_post_meta( $inserted_ID, 'wprss_item_author', $author->get_name() );
        update_post_meta( $inserted_ID, 'wprss_item_author_email', $author->get_email() );
        update_post_meta( $inserted_ID, 'wprss_item_author_link', $author->get_link() );
    }

    update_post_meta( $inserted_ID, 'wprss_feed_id', $feed_ID);
    do_action( 'wprss_items_create_post_meta', $inserted_ID, $item, $feed_ID );
}


/**
 * Returns the time limit for the importing of a single feed item.
 * The value if filtered through 'wprss_item_import_time_limit'. The default value is WPRSS_ITEM_IMPORT_TIME_LIMIT.
 *
 * @since 4.6.6
 * @return int The maximum amount of seconds allowed for a single feed item to import.
 */
function wprss_get_item_import_time_limit() {
    return apply_filters( 'wprss_item_import_time_limit', WPRSS_ITEM_IMPORT_TIME_LIMIT );
}

/**
 * Returns the time limit for a feed fetch operation.
 * The value if filtered through 'wprss_feed_fetch_time_limit'. The default value is WPRSS_FEED_FETCH_TIME_LIMIT.
 *
 * @since 4.6.6
 * @return int The maximum amount of seconds allowed for an RSS feed XML document to be fetched.
 */
function wprss_get_feed_fetch_time_limit() {
    return apply_filters( 'wprss_feed_fetch_time_limit', WPRSS_FEED_FETCH_TIME_LIMIT );
}


/**
 * Fetches all feed items from all feed sources.
 * Iteratively calls 'wprss_fetch_insert_single_feed_items' for all feed sources.
 *
 * This function is used by the cron job or the debugging functions to get all feeds from all feed sources
 *
 * @param $all  If set to TRUE, the function will pull from all feed sources, regardless of their individual
 *              update interval. If set to FALSE, only feed sources using the global update system will be updated.
 *              (Optional) Default: TRUE.
 * @since 3.0
 */
function wprss_fetch_insert_all_feed_items( $all = TRUE ) {
    wpra_get_logger()->info('Beginning import for all feed sources');
    // Get all feed sources
    $feed_sources = wprss_get_all_feed_sources();

    if( $feed_sources->have_posts() ) {
        // Start by getting one feed source, we will cycle through them one by one,
        // fetching feed items and adding them to the database in each pass
        while ( $feed_sources->have_posts() ) {
            $feed_sources->the_post();

            $interval = get_post_meta( get_the_ID(), 'wprss_update_interval', TRUE );
            $using_global_interval = ( $interval === wprss_get_default_feed_source_update_interval() || $interval === '' );

            // Check if fetching from all, or if feed source uses the global interval
            if ( $all === TRUE || $using_global_interval ) {
                wp_schedule_single_event( time(), 'wprss_fetch_single_feed_hook', array( get_the_ID() ) );
            }
        }
        wp_reset_postdata(); // Restore the $post global to the current post in the main query
    }
}


/**
 * Runs the above function with parameter FALSE
 *
 * @since 3.9
 */
function wprss_fetch_insert_all_feed_items_from_cron() {
    wprss_fetch_insert_all_feed_items( FALSE );
}


/**
 * Shutdown function for detecting if the PHP script reaches the maximum execution time limit
 * while importing a feed.
 *
 * @since 4.6.6
 */
function wprss_detect_exec_timeout() {
    global $wprss_importing_feed;
    $feed_ID = (isset($wprss_importing_feed) && !empty($wprss_importing_feed))
        ? $wprss_importing_feed
        : null;

    if ($feed_ID === null) {
        return;
    }

    // Remove the "importing" flag from the feed source
    wprss_flag_feed_as_idle($feed_ID);

    // If no error, stop
    $error = error_get_last();
    if (empty($error)) {
        return;
    }

    $errorDetails = $error['message'];
    if (!empty($error['file'])) {
        $errorDetails .= ' in ' . $error['file'];
    }
    if (!empty($error['line'])) {
        $errorDetails .= ' on line ' . $error['line'];
    }

    $msg = sprintf(
        __('The importing process failed after %d seconds with the message: "%s"', 'wprss'),
        wprss_get_item_import_time_limit(),
        $errorDetails
    );
    // Save the error in the feed source's meta and the plugin log
    update_post_meta($feed_ID, 'wprss_error_last_import', $msg);
    wpra_get_logger($feed_ID)->error($msg);
}

/**
 * Validates a feed item.
 *
 * @since 4.11.2
 *
 * @param \SimplePie_Item|mixed $item The item to validate.
 *
 * @return \SimplePie_Item|null The item, if it passes; otherwise, null.
 */
function wprss_item_filter_valid($item)
{
    return $item instanceof \SimplePie_Item
            ? $item
            : null;
}

/**
 * Sorts items according to settings.
 *
 * Use the `wprss_item_comparators` filter to change the list of comparators
 * used to determine the new order of items. See {@see wprss_items_sort_compare_items()}.
 *
 * @since 4.11.2
 *
 * @param \SimplePie_Item[] $items The items list.
 * @param \WP_Post $feedSource The feed source, for which to sort, if any.
 */
function wprss_sort_items(&$items, $feedSource = null)
{
    // Callbacks used to compare items
    $comparators = apply_filters('wprss_item_comparators', array());
    if (empty($comparators)) {
        return;
    }

    try {
        usort($items, function ($itemA, $itemB) use ($comparators, $feedSource) {
            return wprss_items_sort_compare_items($itemA, $itemB, $comparators, $feedSource);
        });
    } catch (\InvalidArgumentException $e) {
        wpra_get_logger($feedSource)->warning('Encountered an error while sorting the database items: {0}', [
            $e->getMessage()
        ]);
    }
}

/**
 * Recursively compares two items using a list of comparators.
 *
 * If a comparator determines that two items are equal, then the items are
 * evaluated using the next comparator in list, recursively until one of
 * the comparators establishes a difference between items, or the list of
 * comparators is exhausted.
 *
 * @since 4.11.2
 *
 * @param \SimplePie_Item|mixed $itemA The item being compared;
 * @param \SimplePie_Item|mixed $itemB The item being compared to;
 * @param callable[] $comparators A list of functions for item comparison.
 *
 * @return int A result usable as a return value for {@see usort()}.
 *
 * @throws \InvalidArgumentException If the comparator is not callable.
 */
function wprss_items_sort_compare_items($itemA, $itemB, $comparators, $feedSource = null)
{
    if (empty($comparators)) {
        return 0;
    }

    $comparator = array_shift($comparators);
    if (!is_callable($comparator)) {
        throw new \InvalidArgumentException('Comparator must be callable');
    }

    $result = call_user_func_array($comparator, array($itemA, $itemB, $feedSource));
    if (!$result) {
        return wprss_items_sort_compare_items($itemA, $itemB, $comparators);
    }

    return $result;
}

/**
 * Retrieves a custom field of a feed source, or a general setting if the field doesn't exist.
 *
 * @since 4.11.2
 *
 * @param string $key The key of the field or setting.
 * @param \WP_Post|null $feedSource The feed source, if any.
 * @return type
 */
function wprss_get_source_meta_or_setting($key, $feedSource = null)
{
    $value = null;
    if ($feedSource instanceof \WP_Post) {
        $value = $feedSource->{$key};
    }

    return $value !== null && $value !== false
            ? $value
            : wprss_get_general_setting($key);
}

/**
 * Determines date order of two feed items.
 *
 * Which should come first is determined by `feed_items_import_order` setting.
 *
 * @since 4.11.2
 *
 * @param \SimplePie_Item|mixed $itemA The first item.
 * @param \SimplePie_Item|mixed $itemB The second item.
 * @param \WP_Post|null $feedSource The feed source for which the items are being compared, if any.
 * @return int A comparison result for {@see usort()}.
 */
function wprss_item_comparator_date($itemA, $itemB, $feedSource = null)
{
    $sortOrder = wprss_get_source_meta_or_setting('feed_items_import_order', $feedSource);
    if (empty($sortOrder)) {
        return 0;
    }

    if (!wprss_item_filter_valid($itemA) || !wprss_item_filter_valid($itemB)) {
        return 0;
    }

    $aDate = intval($itemA->get_gmdate('U'));
    $bDate = intval($itemB->get_gmdate('U'));

    switch ($sortOrder) {
        case 'latest':
            if ($aDate === $bDate) {
                return null;
            }
            return $aDate > $bDate ? -1 : 1;
            break;

        case 'oldest':
            return $aDate < $bDate ? -1 : 1;
            break;

        case '':
        default:
            return 0;
            break;
    }
}

/**
 * Retrieves default comparators for sorting.
 *
 * @since 4.11.2
 *
 * @param \WP_Post|null $feedSource The feed source, for which to get comparators, if any.
 *
 * @return callable[] The list of comparators.
 */
function wprss_sort_comparators_default($feedSource = null)
{
    $helper = wprss_wp_container()->get('wprss.admin_helper');
    $defaultArgs = array(2 => $feedSource);
    return array(
        $helper->createCommand('wprss_item_comparator_date', $defaultArgs),
    );
}

/**
 * Sanitizes a post excerpt, cleverly removing all HTML markup while preserving text content and whitespace.
 *
 * @since 4.14
 *
 * @param string $excerpt The excerpt to sanitize.
 *
 * @return string
 */
function wprss_sanitize_excerpt($excerpt) {
    // Decode HTML entities back to their respective characters
    $excerpt = html_entity_decode($excerpt);
    // Add a space between any HTML elements
    $excerpt = str_replace('>', ' >', $excerpt);
    // Strip all HTML tags
    $excerpt = strip_tags($excerpt);
    // Remove any redundant spaces
    $excerpt = str_replace('  ', ' ', trim($excerpt));

    return $excerpt;
}

/**
 * Parses a URL, it's query and its path.
 *
 * @since 4.14
 *
 * @param string $url The URL to parse.
 *
 * @return array
 */
function wpra_parse_url($url)
{
    // Parse the URL
    $parsed = parse_url($url);

    // Move the path to "path_str"
    $parsed['path_str'] = isset($parsed['path']) ? $parsed['path'] : '';
    // Explode the path
    $parsed['path'] = explode('/', $parsed['path_str']);

    // Move the query to "query_str"
    $parsed['query_str'] = isset($parsed['query']) ? $parsed['query'] : '';
    // Parse the query
    parse_str($parsed['query_str'], $parsed['query']);

    return $parsed;
}


File Name:
feed-processing.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-processing.php
Code:
<?php

	define( 'WPRSS_TRANSIENT_NAME_IS_REIMPORTING', 'is_reimporting' );

    /**
     * Feed processing related functions
     *
     * @package WPRSSAggregator
     */

    /**
     * Returns whether or not the feed source will forcefully fetch the next fetch,
     * ignoring whether or not it is paused or not.
     *
     * @param $source_id    The ID of the feed soruce
     * @return boolean
     * @since 3.7
     */
    function wprss_feed_source_force_next_fetch( $source_id ) {
        $force = get_post_meta( $source_id, 'wprss_force_next_fetch', TRUE );
        return ( $force !== '' || $force == '1' );
    }


    /**
     * Change the default feed cache recreation period to 2 hours
     *
     * Probably not needed since we are now disabling caching altogether
     *
     * @since 2.1
     */
    function wprss_feed_cache_lifetime( $seconds ) {
        return 1; // one second
    }


    /**
     * Disable caching of feeds in transients, we don't need it as we are storing them in the wp_posts table
     *
     * @since 3.0
     */
    function wprss_do_not_cache_feeds( &$feed ) {
        $feed->enable_cache( false );
    }


    /**
     * Parameters for query to get all feed sources
     *
     * @since 3.0
     */
    function wprss_get_all_feed_sources() {
        // Get all feed sources
        $feed_sources = new WP_Query( apply_filters(
            'wprss_get_all_feed_sources',
            array(
                'post_type'      => 'wprss_feed',
                'post_status'    => 'publish',
                'cache_results'  => false,   // Disable caching, used for one-off queries
                'no_found_rows'  => true,    // We don't need pagination, so disable it
                'posts_per_page' => -1
            )
        ) );
        return $feed_sources;
    }


    /**
     * Retrieves the query to use for retrieving imported items.
     *
     * @since 4.17.4
     */
    function wprss_get_imported_items_query($source_id = null) {
        $args = [
            'post_type'             => array_values(get_post_types()),
            'post_status'           => 'any',
            'cache_results'         => false,
            'no_found_rows'         => true,
            'posts_per_page'        => -1,
            'ignore_sticky_posts'   => 'true',
            'orderby'               => 'date',
            'order'                 => 'DESC',
            'meta_query'            => [
                'relation' => 'AND',
            ],
            'suppress_filters'  => 1
        ];

        if ($source_id !== null) {
            $args['meta_query'][] = [
                'key'       => 'wprss_feed_id',
                'value'     => (string) $source_id,
                'compare'   => '=',
            ];
        } else {
            $args['meta_query'][] = [
                'key'       => 'wprss_feed_id',
                'compare'   => 'EXISTS',
            ];
        }

        return apply_filters('wprss_get_feed_items_for_source_args', $args, $source_id);
    }

    /**
     * Queries for imported items.
     *
     * @since 4.17.4
     */
    function wprss_get_imported_items($source_id = null) {
        return new WP_Query(wprss_get_imported_items_query($source_id));
    }

    /**
     * Returns all the feed items of a source.
     *
     * @since 3.8
     */
    function wprss_get_feed_items_for_source( $source_id ) {
        return wprss_get_imported_items($source_id);
    }


    /**
     * Parameters for query to get feed sources
     *
     * @since 3.0
     */
    function wprss_get_feed_source() {
        // Get all feed sources
        $feed_sources = new WP_Query( apply_filters(
            'wprss_get_all_feed_sources',
            array(
                'post_type'      => 'wprss_feed',
                'post_status'    => 'publish',
                'cache_results'  => false,   // Disable caching, used for one-off queries
                'no_found_rows'  => true,    // We don't need pagination, so disable it
                'posts_per_page' => -1
            )
        ) );
        return $feed_sources;
    }


    /**
     * Database query to get existing permalinks
     *
     * @since 3.0
     */
    function wprss_get_existing_permalinks( $feed_ID ) {
        global $wpdb;

        $cols = $wpdb->get_col(
            "SELECT q.`meta_value`
            FROM {$wpdb->postmeta} AS p
            JOIN {$wpdb->postmeta} AS q ON (q.`meta_key` = 'wprss_item_permalink' AND p.`post_id` = q.`post_id`)
            WHERE p.`meta_key` = 'wprss_feed_id' AND p.`meta_value` = '{$feed_ID}'"
        );

        return @array_flip($cols);
    }

    /**
     * Checks if an item title exists in the database.
     *
     * @since 4.14
     *
     * @param string $title The title to search for.
     *
     * @return bool True if the title exists, false if not.
     */
    function wprss_item_title_exists( $title ) {
        global $wpdb;

        $cols = $wpdb->get_col(
            $wpdb->prepare(
                "SELECT *
                FROM `{$wpdb->posts}` AS p
                JOIN `{$wpdb->postmeta}` AS q ON p.`ID` = q.`post_id`
                WHERE q.`meta_key` = 'wprss_feed_id' AND p.`post_title` = %s",
                [$title]
            )
        );

        return count($cols) > 0;
    }

    /**
     * Database query to get existing titles
     *
     * @since 4.7
     */
    function wprss_get_existing_titles( $feed_ID = NULL ) {
        global $wpdb;

        $condition = ($feed_ID !== NULL) ? "AND q.`meta_value` = '{$feed_ID}'" : '';

        $cols = $wpdb->get_col(
            "SELECT p.`post_title`
            FROM `{$wpdb->posts}` AS p
            JOIN `{$wpdb->postmeta}` AS q ON p.`ID` = q.`post_id`
            WHERE q.`meta_key` = 'wprss_feed_id' $condition"
        );

        return @array_flip($cols);
    }


    /**
     * Checks if a permalink exists.
     *
     * Untested!
     *
     * @param  string $permalink The permalink, expected to be normalized.
     * @return   bool
     */
    function wprss_permalink_exists( $permalink ) {
        global $wpdb;

        $wpdb->query(
            $wpdb->prepare(
                "SELECT *
                FROM {$wpdb->postmeta}
                WHERE `meta_value` = '{$permalink}'"
            )
        );

        return $wpdb->num_rows > 0;
    }


    add_action( 'publish_wprss_feed', 'wprss_fetch_insert_feed_items', 10 );
    /**
     * Fetches feed items from source provided and inserts into db
     *
     * This function is used when inserting or untrashing a new feed source, it only gets feeds from that particular source
     *
     * @since 3.0
     */
    function wprss_fetch_insert_feed_items( $post_id ) {
        wp_schedule_single_event( time(), 'wprss_fetch_single_feed_hook', array( $post_id ) );
    }


    /**
     * Returns the image of the feed.
     * The reason this function exists is for add-ons to be able to detect if the plugin core
     * supports feed image functionality through a simple function_exists() call.
     *
     * @param $source_id The ID of the feed source
     * @return string The link to the feed image
     * @since 1.0
     */
    function wprss_get_feed_image( $source_id ) {
        return get_post_meta( $source_id, 'wprss_feed_image', true );
    }


    add_action( 'post_updated', 'wprss_updated_feed_source', 10, 3 );
    /**
     * This function is triggered just after a post is updated.
     * It checks if the updated post is a feed source, and carries out any
     * updating necassary.
     *
     * @since 3.3
     */
    function wprss_updated_feed_source( $post_ID, $post_after, $post_before ) {
        // Check if the post is a feed source and is published

        if ( ( $post_after->post_type == 'wprss_feed' ) && ( $post_after->post_status == 'publish' ) ) {

            if ( isset( $_POST['wprss_url'] ) && !empty( $_POST['wprss_url'] ) ) {
                $url = $_POST['wprss_url'];
                $feed = wprss_fetch_feed( $url );
                if ( $feed !== NULL && !is_wp_error( $feed ) ) {
                    update_post_meta( $post_ID, 'wprss_site_url', $feed->get_permalink() );
                    update_post_meta( $post_ID, 'wprss_feed_image', $feed->get_image_url() );
                }
            }


        	if ( isset( $_POST['wprss_limit'] ) && !empty( $_POST['wprss_limit'] ) ) {
	            // Checking feed limit change
	            // Get the limit currently saved in db, and limit in POST request
	            //$limit = get_post_meta( $post_ID, 'wprss_limit', true );
	            $limit = $_POST['wprss_limit'];
	            // Get all feed items for this source
	            $feed_sources = new WP_Query(
					array(
						'post_type'      => 'wprss_feed_item',
						'post_status'    => 'publish',
						'cache_results'  => false,   // Disable caching, used for one-off queries
						'no_found_rows'  => true,    // We don't need pagination, so disable it
						'posts_per_page' => -1,
						'orderby' 		 => 'date',
						'order' 		 => 'ASC',
						'meta_query'     => array(
							array(
								'key'     => 'wprss_feed_id',
								'value'   => $post_ID,
								'compare' => 'LIKE'
							)
						)
					)
	            );
	            // If the limit is smaller than the number of found posts, delete the feed items
	            // and re-import, to ensure that most recent feed items are present.
	            $difference = intval( $feed_sources->post_count ) - intval( $limit );
	            if ( $difference > 0 ) {
	            	// Loop and delete the excess feed items
					while ( $feed_sources->have_posts() && $difference > 0 ) {
						$feed_sources->the_post();
						wp_delete_post( get_the_ID(), true );
						$difference--;
					}
	            }
        	}
        }
    }


    add_action( 'added_post_meta', 'wprss_update_feed_meta', 10, 4 );
    add_action( 'updated_post_meta', 'wprss_update_feed_meta', 10, 4 );
    /**
     * This function is run whenever a post is saved or updated.
     *
     * @since 3.4
     */
    function wprss_update_feed_meta( $meta_id, $post_id, $meta_key, $meta_value ) {
        $post = get_post( $post_id );
        if ( $post !== NULL && $post->post_status === 'publish' && $post->post_type === 'wprss_feed' ) {
            if ( $meta_key === 'wprss_url' )
                wprss_change_fb_url( $post_id, $meta_value );
        }
    }


    function wprss_change_fb_url( $post_id, $url ) {
        # Check if url begins with a known facebook hostname.
        if (    stripos( $url, 'http://facebook.com' ) === 0
            ||  stripos( $url, 'http://www.facebook.com' ) === 0
            ||  stripos( $url, 'https://facebook.com' ) === 0
            ||  stripos( $url, 'https://www.facebook.com' ) === 0
        ) {
            # Generate the new URL to FB Graph
            $com_index = stripos( $url, '.com' );
            $fb_page = substr( $url, $com_index + 4 ); # 4 = length of ".com"
            $fb_graph_url = 'https://graph.facebook.com' . $fb_page;
            # Contact FB Graph and get data
            $response = wp_remote_get( $fb_graph_url );
            # If the repsonse successful and has a body
            if ( !is_wp_error( $response ) && isset( $response['body'] ) ) {
                # Parse the body as a JSON string
                $json = json_decode( $response['body'], true );
                # If an id is present ...
                if ( isset( $json['id'] ) ) {
                    # Generate the final URL for this feed and update the post meta
                    $final_url = "https://www.facebook.com/feeds/page.php?format=rss20&id=" . $json['id'];
                    update_post_meta( $post_id, 'wprss_url', $final_url, $url );
                }
            }
        }
    }


    add_action( 'trash_wprss_feed', 'wprss_delete_feed_items' );   // maybe use wp_trash_post action? wp_trash_wprss_feed
    /**
     * Delete feed items on trashing of corresponding feed source
     *
     * @since 2.0
     */
    function wprss_delete_feed_items ($source_id) {
        $force_delete = apply_filters('wprss_force_delete_when_by_source', true);

        // WPML fix: removes the current language from the query WHERE and JOIN clauses
        global $sitepress;
        if ($sitepress !== null) {
            remove_filter('posts_join', [$sitepress,'posts_join_filter']);
            remove_filter('posts_where', [$sitepress,'posts_where_filter']);
        }

        $args = wprss_get_imported_items_query($source_id);
        $items = get_posts($args);

        foreach ($items as $item) {
            wp_delete_post($item->ID, $force_delete);
        }
    }


    add_action( 'wprss_delete_all_feed_items_hook', 'wprss_delete_all_feed_items' );
    /**
     * Delete all feed items
     *
     * @since 3.0
     */
    function wprss_delete_all_feed_items() {
        $args = wprss_get_imported_items_query();
        $items = get_posts($args);

        foreach ($items as $item) {
            wp_delete_post($item->ID, true);
        }
    }


    /**
     * Marks the feed source as 'updating' (importing).
     *
     * @since 4.6.6
     * @return int The time value set in the 'updating' meta field
     */
    function wprss_flag_feed_as_updating( $feed_ID ) {
        update_post_meta( $feed_ID, 'wprss_feed_is_updating', $start_time = time() );
        return $start_time;
    }

    /**
     * Marks the feed source as 'idle' (not importing).
     *
     * @since 4.6.6
     */
    function wprss_flag_feed_as_idle( $feed_ID ) {
        update_post_meta( $feed_ID, 'wprss_feed_is_updating', '' );
    }


	/**
     * Returns whether or not the feed source is updating.
     *
     * @param (string|int) The id of the feed source
     * @return (bool) TRUE if the feed source is currently updating, FALSE otherwise.
     *
     */
    function wprss_is_feed_source_updating( $id ) {
        // Get the 'updating' meta field
        $is_updating_meta = get_post_meta( $id, 'wprss_feed_is_updating', TRUE );

        // Check if the feed has the 'updating' meta field set
        if ( $is_updating_meta === '' ) {
            // If not, then the feed is not updating
            return FALSE;
        }

        // Get the limit used for the feed
        $limit = get_post_meta( $id, 'wprss_limit', true );
        if ( $limit === '' || intval( $limit ) <= 0 ) {
            $global_limit = wprss_get_general_setting('limit_feed_items_imported');
            $limit = ( $global_limit === '' || intval( $global_limit ) <= 0 ) ? NULL : $global_limit;
        }

		// Calculate the allowed maximum time, based on the maximum number of items allowed to be
        // imported from this source.
        // If no limit is used, 60s (1min) is used.
        $single_item_time_limit = wprss_get_feed_fetch_time_limit();
		$allowed_time = $limit === NULL ? 120 : $single_item_time_limit * intval( $limit );

        // Calculate how many seconds have passed since the feed last signalled that it is updating
        $diff = time() - $is_updating_meta;

        // Get the transient that is set when the import function is called and the time of the next scheduled cron
        $is_updating_transient = get_transient('wpra/feeds/importing/' . $id);
        $scheduled = (wprss_get_next_feed_source_update($id) !== false);
        // If more than 5 seconds have passed and the transient is not yet set and the cron was not scheduled
        // then the cron probably failed to be registered
        if ( $diff > 5  && !$is_updating_transient && !$scheduled) {
            wprss_flag_feed_as_idle($id);
            update_post_meta(
                $id,
                'wprss_error_last_import',
                __('The plugin failed to schedule a fetch for this feed. Please try again.', 'wprss')
            );

            return false;
        }

        // If the difference is greater than the allowed maximum amount of time, mark the feed as idle.
		if ( $diff > $allowed_time ) {
			wprss_flag_feed_as_idle( $id );
            // Feed is not updating
			return FALSE;
		}

        // Feed is updating
		return TRUE;
    }


    /**
     * Returns whether or not the feed source is deleting its feeed items.
     *
     * @param (string|int) The id of the feed source
     * @return (bool) TRUE if the feed source is currently deleting its items, FALSE otherwise.
     *
     */
    function wprss_is_feed_source_deleting( $id ) {
        $is_deleting_meta = get_post_meta( $id, 'wprss_feed_is_deleting_items', TRUE );

        if ( $is_deleting_meta === '' ) {
            return FALSE;
        }

		$diff = time() - $is_deleting_meta;

        $items = wprss_get_feed_items_for_source( $id );
        if ( $items->post_count === 0 || $diff > 300 ) {
            delete_post_meta( $id, 'wprss_feed_is_deleting_items' );
            return FALSE;
        }

        return TRUE;
    }


    /**
     * Returns the given parameter as a string. Used in wprss_truncate_posts()
     *
     * @return string The given parameter as a string
     * @since 3.5.1
     */
    function wprss_return_as_string( $item ) {
        return "'$item'";
    }


    /**
     * Returns true if the feed item is older than the given timestamp,
     * false otherwise;
     *
     * @since 3.8
     */
    function wprss_is_feed_item_older_than( $id, $timestamp ) {
        // GET THE DATE
        $age = get_the_time( 'U', $id );
        if ( $age === '' ) return FALSE;
        // Calculate the age difference
        $difference = $age - $timestamp;
        // Return whether the difference is negative ( the age is smaller than the timestamp )
        return ( $difference <= 0 );
    }


    /**
     * Returns the maximum age setting for a feed source.
     *
     * @since 3.8
     */
    function wprss_get_max_age_for_feed_source( $source_id ) {
        $general_settings = get_option( 'wprss_settings_general' );
        // Get the meta data for age for this feed source
        $age_limit = trim( get_post_meta( $source_id, 'wprss_age_limit', TRUE ) );
        $age_unit = get_post_meta( $source_id, 'wprss_age_unit', TRUE );

        // If the meta does not exist, use the global settings
        if( $age_limit === '' ) {
            $age_limit = trim( wprss_get_general_setting( 'limit_feed_items_age' ) );
            $age_unit = wprss_get_general_setting( 'limit_feed_items_age_unit' );
        }

        // If the age limit is an empty string, use no limit
        if ( $age_limit === '' ) {
            return FALSE;
        }

        // Return the timestamp of the max age date
        return strtotime( "-$age_limit $age_unit" );
    }

    /**
     * Truncates the items for a single feed source based on its age limit.
     *
     * @since 4.14
     *
     * @param int|WP_Post $source The source ID or post instance.
     */
    function wprss_truncate_items_for_source( $source )
    {
        $id = ( $source instanceof WP_Post )
            ? $source->ID
            : $source;

        $logger = wpra_get_logger($id);

        // Get the max age setting for this feed source
        $max_age = wprss_get_max_age_for_feed_source( $id );

        // If the data is empty, do not delete
        if ( $max_age === false ) {
            return;
        }

        // Get all feed items for this source
        $feed_items = wprss_get_feed_items_for_source( $id );

        // If there are no feed items, stop
        if ( ! $feed_items->have_posts() ) {
            return;
        }

        // Extend the timeout time limit for the deletion of the feed items
        set_time_limit( wprss_get_item_import_time_limit() );

        $logger->debug('Truncating existing items');

        // For each feed item
        while ( $feed_items->have_posts() ) {
            $feed_items->the_post();
            // If the post is older than the maximum age
            $item_id = get_the_ID();

            if ( wprss_is_feed_item_older_than( $item_id, $max_age ) === true ){
                // Delete the post
                wp_delete_post( $item_id, true );
            }
        }

        // Reset feed items query data
        wp_reset_postdata();
    }

    /**
     * Delete old feed items from the database to avoid bloat.
     * As of 3.8, it uses the new feed age system.
     *
     * @since 3.8
     */
    function wprss_truncate_posts() {
        // Get general settings
        $general_settings = get_option( 'wprss_settings_general' );
        // Get all feed sources
        $feed_sources = wprss_get_all_feed_sources();

        // Check if there are feed sources
        if( $feed_sources->have_posts() ) {
            // Truncate items for each feed source
            while ( $feed_sources->have_posts() ) {
                $feed_sources->the_post();
                wprss_truncate_items_for_source( get_the_ID() );
            }
            // Reset feed sources query data
            wp_reset_postdata();
        }

        // If the filter to use the fixed limit is enabled, call the old truncation function
        if ( apply_filters( 'wprss_use_fixed_feed_limit', FALSE ) === TRUE && isset( $general_settings['limit_feed_items_db'] ) ) {
            wprss_old_truncate_posts();
        }
    }


    /**
     * The old truncation function.
     * This truncation method uses the deprecated fixed feed limit.
     *
     * @since 2.0
     */
    function wprss_old_truncate_posts() {
        global $wpdb;
        $general_settings = get_option( 'wprss_settings_general' );

        if ( $general_settings['limit_feed_items_db'] == 0 ) {
            return;
        }

        // Set your threshold of max posts and post_type name
        $threshold = $general_settings['limit_feed_items_db'];
        $post_types = apply_filters( 'wprss_truncation_post_types', array( 'wprss_feed_item' ) );
        $post_types_str = array_map( 'wprss_return_as_string', $post_types );

        $post_type_list = implode( ',' , $post_types_str );

        // Query post type
        // $wpdb query allows me to select specific columns instead of grabbing the entire post object.
        $query = "
            SELECT ID, post_title FROM $wpdb->posts
            WHERE post_type IN ($post_type_list)
            AND post_status = 'publish'
            ORDER BY post_modified DESC
        ";

        $results = $wpdb->get_results( $query );

        // Check if there are any results
        $i = 0;
        if ( count( $results ) ){
            foreach ( $results as $post ) {
                $i++;

                // Skip any posts within our threshold
                if ( $i <= $threshold )
                    continue;

                // Let the WordPress API do the heavy lifting for cleaning up entire post trails
                $purge = wp_delete_post( $post->ID, true );
            }
        }
    }


    add_filter( 'wprss_insert_post_item_conditionals', 'wprss_check_feed_item_date_on_import', 2, 3 );
    /**
     * When a feed item is imported, it's date is compared against the max age of it's feed source.
     *
     *
     * @since 3.8
     */
    function wprss_check_feed_item_date_on_import( $item, $source, $permalink ){
        if ( $item === NULL ) return NULL;

        // Get the age of the item and the max age setting for its feed source
        $age = $item->get_date( 'U' );
        $max_age = wprss_get_max_age_for_feed_source( $source );

        // If the age is not a valid timestamp, and the max age setting is disabled, return the item
        if ( $age === '' || $age === NULL || $max_age === FALSE || $max_age === NULL ) {
            return $item;
        }

        // Calculate the age difference
        $difference = $age - $max_age;

        if ( $difference <= 0 ) {
            wpra_get_logger()->debug('Item "{0}" was rejected by age limit settings.', [
                $item->get_title()
            ]);

            return NULL;
        } else {
            return $item;
        }
    }


    /**
     * Deletes all imported feeds.
     *
     * @since 3.0
     */
    function wprss_feed_reset() {
        wp_schedule_single_event( time(), 'wprss_delete_all_feed_items_hook' );
    }



	function wprss_schedule_reimport_all($deleted_ids) {
		if( !get_transient( WPRSS_TRANSIENT_NAME_IS_REIMPORTING ) )
			return;

		wprss_log( 'Re-import scheduled...', __FUNCTION__, WPRSS_LOG_LEVEL_SYSTEM);
		delete_transient( WPRSS_TRANSIENT_NAME_IS_REIMPORTING );
		wprss_fetch_insert_all_feed_items( TRUE );
	}


    /**
     * Deletes N oldest feed items for the given source
     *
     * @since 4.2
     * @deprecated
     */
    function wprss_delete_oldest_feed_items( $n, $source ) {
        // If the source does not exist, do nothing
        if ( get_post( $source ) == NULL ) return;

        // Make sure $n is an integer
        $n = intval($n);

        // Do nothing if n is zero or negative
        if ( $n <= 0 ) return;

        // Get the feed items, as an array, not WP_Query.
        // We will need to perform some array operations
        $feed_items = wprss_get_feed_items_for_source( $source );
        $feed_items = $feed_items->get_posts();
        // Get number of feed items
        $count = count( $feed_items );

        // Index of first feed item to delete
        $start = $count - $n;
        // Cut the array of feed items to get the items to delete
        $to_delete = array_slice( $feed_items, $start );
        // log -- for now
        foreach( $to_delete as $fi ) {
            //wprss_log_obj( "To delete" , $fi->ID );
        }
    }


    /**
     * Deletes the required number of feed items for the given source,
     * to keep the number of feed items below its limit.
     *
     * @since 4.2
     * @deprecated
     */
    function wprss_truncate_feed_items_for_source( $source ) {
        // Get the limit setting
        $limit = get_post_meta( $source, 'wprss_limit', true );

        // Calculate the number of feed items to delete
        $feed_items = wprss_get_feed_items_for_source( $source );
        $n = intval($feed_items->found_posts) - intval($limit);

        // Delete the feed items
        wprss_delete_oldest_feed_items( $n, $source );
    }


File Name:
feed-states.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\feed-states.php
Code:
<?php
    /**
     * Functions relating to feed source states
     *
     * @package WPRSSAggregator
     */


    add_action( 'admin_init', 'wprss_bulk_change_state', 2 );
    /**
     * Changes the state of feed sources selected from the table bulk actions.
     * 
     * @since 4.1
     */
    function wprss_bulk_change_state() {
        // If the id and state are in POST data
        if ( isset( $_GET['post_type'] ) && (isset( $_GET['action'] ) || isset( $_GET['action2'] )) && isset( $_GET['post'] ) ) {
            // Get the action and post ids from GET request
            $action = isset($_GET['action']) && $_GET['action'] !== '-1' ? $_GET['action'] : $_GET['action2'];
            $post_ids = $_GET['post'];

            // check the action
            switch ( $action ) {
                // Activate all feed sources in $post_ids
                case 'activate':
                    foreach( $post_ids as $post_id ) {
                        wprss_activate_feed_source( $post_id );
                    }
                    // Set a transient to show the admin notice, after redirection
                    set_transient( 'wprss_notify_bulk_change_state', 'activated', 0 );
                    break;

                // Pause all feed sources in $post_ids
                case 'pause':
                    foreach( $post_ids as $post_id ) {
                        wprss_pause_feed_source( $post_id );
                    }
                    // Set a transient to show the admin notice, after redirection
                    set_transient( 'wprss_notify_bulk_change_state', 'paused', 0 );
                    break;
            }

            /* Note:
             * Transients are used since bulk actions will, after processing, case a redirect to the same page.
             * Thus, using add_action( 'all_admin_notices', ... ) will result in the notice appearing on the first request,
             * and not be shown after redirection.
             * The transient is set to show the notification AFTER redirection.
             */
        }
    }



    add_action( 'admin_init', 'check_for_state_notice_after_redirect', 1 );
    /**
     * Checks if the 'wprss_notify_bulk_change_state' transient is set.
     * If it is, it will show the appropriate admin notice
     *
     * @since 4.1
     */
    function check_for_state_notice_after_redirect() {
        $transient = get_transient( 'wprss_notify_bulk_change_state' );
        if ( $transient !== FALSE ) {
            switch ( $transient ) {
                case 'activated':
                    wprss()->getAdminAjaxNotices()->addNotice('bulk_feed_activated');
                    break;
                case 'paused':
                    wprss()->getAdminAjaxNotices()->addNotice('bulk_feed_paused');
                    break;
            }
            delete_transient( 'wprss_notify_bulk_change_state' );
        }
    }


    
    /**
     * Activates the feed source. Runs on a schedule.
     * 
     * @param $feed_id  The of of the wprss_feed
     * @since 3.7
     */
    function wprss_activate_feed_source( $feed_id ) {
        update_post_meta( $feed_id, 'wprss_state', 'active' );
        update_post_meta( $feed_id, 'wprss_activate_feed', '' );

        // Add an action hook, so functions can be run when a feed source is activated
        do_action( 'wprss_on_feed_source_activated', $feed_id );
    }


    /**
     * Pauses the feed source. Runs on a schedule.
     * 
     * @param $feed_id  The of of the wprss_feed
     * @since 3.7
     */
    function wprss_pause_feed_source( $feed_id ) {
        update_post_meta( $feed_id, 'wprss_state', 'paused' );
        update_post_meta( $feed_id, 'wprss_pause_feed', '' );

        // Add an action hook, so functions can be run when a feed source is paused
        do_action( 'wprss_on_feed_source_paused', $feed_id );
    }






    /**
     * Returns whether or not a feed source is active.
     * 
     * @param $source_id    The ID of the feed soruce
     * @return boolean
     * @since 3.7
     */
    function wprss_is_feed_source_active( $source_id ) {
        $state = get_post_meta( $source_id, 'wprss_state', TRUE );
        return ( $state === '' || $state === 'active' );
    }


File Name:
functions.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\functions.php
Code:
<?php

use Aventura\Wprss\Core\Model\Regex\HtmlEncoder;

/**
 * Helper and misc functions.
 *
 * @todo Make this part of Core instead
 */

/**
 * Checks if developer mode is enabled.
 *
 * @since 4.15.1
 *
 * @return bool
 */
function wpra_is_dev_mode()
{
    return apply_filters('wpra_dev_mode', false) === true;
}

/**
 * WP RSS Aggregator's version of {@link wp_remote_get()}.
 *
 * It ensures that the feed request useragent is used as the HTTP request's User Agent String.
 *
 * @since 4.15.1
 *
 * @see https://developer.wordpress.org/reference/classes/WP_Http/request/ Information on the $args array parameter.
 *
 * @param string $url The URL
 * @param array $args The arguments.
 *
 * @return array|WP_Error
 */
function wpra_remote_get($url, $args)
{
    $args['user-agent'] = wprss_get_general_setting('feed_request_useragent');

    return wp_remote_get($url, $args);
}

/**
 * WP RSS Aggregator's version of {@link wp_safe_remote_get()}.
 *
 * It ensures that the feed request useragent is used as the HTTP request's User Agent String.
 *
 * @since 4.15.1
 *
 * @see https://developer.wordpress.org/reference/classes/WP_Http/request/ Information on the $args array parameter.
 *
 * @param string $url The URL
 * @param array $args The arguments.
 *
 * @return array|WP_Error
 */
function wpra_safe_remote_get($url, $args)
{
    $args['user-agent'] = wprss_get_general_setting('feed_request_useragent');

    return wp_safe_remote_get($url, $args);
}

/**
 * Utility function for checking a plugin's state, even if it's inactive.
 *
 * @since 4.15.1
 *
 * @param string $basename The basename of the plugin.
 *
 * @return int 0 if the plugin is not installed, 1 if installed but not activated, 2 if installed and activated.
 */
function wpra_get_plugin_state($basename)
{
    if (!function_exists('is_plugin_active') && file_exists(ABSPATH . 'wp-admin/includes/plugin.php')) {
        require_once ABSPATH . 'wp-admin/includes/plugin.php';
    }

    // ACTIVE
    if (function_exists('is_plugin_active') && is_plugin_active($basename)) {
        return 2;
    }

    // INSTALLED & INACTIVE
    if (file_exists(WP_PLUGIN_DIR . '/' . $basename) && is_plugin_inactive($basename)) {
        return 1;
    }

    // NOT INSTALLED
    return 0;
}

/**
 * Utillity function for generating a URL that activates a plugin.
 *
 * @since 4.15.1
 *
 * @param string $basename The basename of the plugin.
 *
 * @return string
 */
function wpra_get_activate_plugin_url($basename)
{
    return wp_nonce_url(
        sprintf('plugins.php?action=activate&amp;plugin=%s', $basename),
        sprintf('activate-plugin_%s', $basename)
    );
}

/**
 * Retrieves the callbacks that are attached to a hook.
 *
 * @since 4.18
 *
 * @param string $hook The hook name.
 *
 * @return callable[] A list of callbacks.
 */
function wpra_get_hook_callbacks($hook)
{
    global $wp_filter;

    $results = [];

    if (isset($wp_filter[$hook])) {
        $hook = $wp_filter[$hook];

        foreach ($hook->callbacks as $list) {
            foreach ($list as $callback) {
                $results[] = $callback;
            }
        }
    }

    return $results;
}

/**
 * Returns a representation of an HTML expression that matches all representations of that HTML.
 *
 * @since 4.14
 *
 * @param string      $expr  The expression to encodify.
 * @param string|null $delim The delimiter of the expression.
 *
 * @return string The encodified HTML expression.
 */
function wprss_html_regex_encodify($expr, $delim = null)
{
    static $instance;

    if ($instance === null) {
        $instance = new HtmlEncoder();
    }

    $instance->reset();

    if ($delim !== null) {
        // Not a bug: the `setDelimiter` method call is handled using magic `__call()`
        $instance->setDelimiter($delim);
    }

    return $instance->encodify($expr);
}

if (!function_exists('wprss_get_namespace')) {

    /**
     * Get the namespace of a class
     *
     * @since 1.0
     * @param string|object|null $class The class name or instance, for which to get the namespace.
     * @param int|null $depth The depth of the namespace to retrieve.
     *  If omitted, the whole namespace will be retrieved.
     * @param bool $asString If true, the result will be a string; otherwise, array with namespace parts.
     * @return array|string The namespace of the class.
     */
    function wprss_get_namespace($class, $depth = null, $asString = false)
    {
        $ns = '\\';

        // Can accept an instance
        if (is_object($class)) {
            $class = get_class($class);
        }

        $namespace = explode($ns, (string) $class);

        // This was a root class name, no namespace
        array_pop($namespace);
        if (!count($namespace)) {
            return null;
        }

        $namespace = array_slice($namespace, 0, $depth);

        return $asString ? implode($ns, $namespace) : $namespace;
    }
}

if (!function_exists('wprss_is_root_namespace')) {

    /**
     * Check if a namespace is a root namespace.
     *
     * @since 1.0
     * @param string $namespace The namespace to check.
     * @param bool $checkClass If true, and a class or interface with the name of the specified namespace exists,
     *  will make this function return true. Otherwise, the result depends purely on the namespace string.
     * @return boolean True if the namespace is a root namespace; false otherwise.
     */
    function wprss_is_root_namespace($namespace, $checkClass = true) {
        $isRoot = substr($namespace, 0, 1) === '\\';
        return $checkClass
            ? $isRoot || class_exists($namespace)
            : $isRoot;
    }
}

if (!function_exists('string_had_prefix')) {

    /**
     * Check for and possibly remove a prefix from a string.
     *
     * @since 1.0
     * @param string $string The string to check and normalize.
     * @param string $prefix The prefix to check for.
     * @return string Checks if a string starts with the specified prefix.
     *  If yes, removes it and returns true; otherwise, false;
     */
    function string_had_prefix(&$string, $prefix)
    {
        $prefixLength = strlen($prefix);
        if (substr($string, 0, $prefixLength) === $prefix) {
            $string = substr($string, $prefixLength);
            return true;
        }

        return false;
    }
}

if (!function_exists('uri_is_absolute')) {

    /**
     * Check if the URI is absolute.
     *
     * Check is made based on whether or not there's a '//' sequence
     * somewhere in the beginning.
     *
     * @since 1.0
     * @param string $uri The URI to check.
     * @return boolean True of the given string contains '//' within the first 10 chars;
     *  otherwise, false.
     */
    function uri_is_absolute($uri)
    {
        $beginning = substr($uri, 0, 10);
        return strpos($beginning, '//') !== false;
    }
}

if ( ! function_exists('array_merge_recursive_distinct') ) {
	/**
	* array_merge_recursive does indeed merge arrays, but it converts values with duplicate
	* keys to arrays rather than overwriting the value in the first array with the duplicate
	* value in the second array, as array_merge does. I.e., with array_merge_recursive,
	* this happens (documented behavior):
	*
	* array_merge_recursive(array('key' => 'org value'), array('key' => 'new value'));
	*     => array('key' => array('org value', 'new value'));
	*
	* array_merge_recursive_distinct does not change the datatypes of the values in the arrays.
	* Matching keys' values in the second array overwrite those in the first array, as is the
	* case with array_merge, i.e.:
	*
	* array_merge_recursive_distinct(array('key' => 'org value'), array('key' => 'new value'));
	*     => array('key' => array('new value'));
	*
	* Parameters are passed by reference, though only for performance reasons. They're not
	* altered by this function.
	*
     * @since 1.0
	* @param array $array1
	* @param array $array2
	* @return array
	* @author Daniel <daniel (at) danielsmedegaardbuus (dot) dk>
	* @author Gabriel Sobrinho <gabriel (dot) sobrinho (at) gmail (dot) com>
	*/
	function array_merge_recursive_distinct ( array &$array1, array &$array2 ) {
		$merged = $array1;
		foreach ( $array2 as $key => &$value ) {
			if ( is_array ( $value ) && isset ( $merged [$key] ) && is_array ( $merged [$key] ) ) {
				$merged [$key] = array_merge_recursive_distinct ( $merged [$key], $value );
			}
			else $merged [$key] = $value;
		}
		return $merged;
	}
}

if (!function_exists('array_pick')) {

    /**
     * Picks values with certain keys from an array.
     *
     * @since 1.0
     * @param array $array An array, from which to pick. Will not be modified; passed by refrence for efficiency.
     * @param string|int|array $keys A key or array of keys to pick.
     * @return array
     */
    function array_pick($array, $keys)
    {
        $keys = (array)$keys;
        return array_intersect_key($array, array_flip($keys));
    }
}

/**
 * Retrieve cron jobs ready to be run.
 *
 * @since 4.17
 *
 * @return array Cron jobs ready to be run.
 */
function wpra_get_ready_cron_jobs() {
    if (function_exists('wp_get_ready_cron_jobs')) {
        return wp_get_ready_cron_jobs();
    }

    $pre = apply_filters('pre_get_ready_cron_jobs', null);
    if ($pre !== null) {
        return $pre;
    }

    $crons = _get_cron_array();

    if ($crons === false) {
        return [];
    }

    $keys = array_keys($crons);
    $gmt_time = microtime(true);

    if (isset($keys[0]) && $keys[0] > $gmt_time) {
        return [];
    }

    $results = [];
    foreach ($crons as $timestamp => $cronhooks) {
        if ($timestamp > $gmt_time) {
            break;
        }

        $results[$timestamp] = $cronhooks;
    }

    return $results;
}

/**
 * Retrieves the translation for some text from the "wprss" domain.
 *
 * @since 4.17.3
 *
 * @param string $text The text whose translation to retrieve.
 *
 * @return string
 */
function wprss_translate($text)
{
    $translations = get_translations_for_domain('wprss');

    return $translations->translate($text);
}

/**
 * Retrieves the singular or plural translation for some text from the "wprss" domain.
 *
 * @since 4.17.3
 *
 * @param string $single The singular text.
 * @param string $plural The plural text.
 * @param int    $number The amount, used to determine whether the singular or plural translation will be retrieved.
 *
 * @return string
 */
function wprss_translate_n($single, $plural, $number)
{
    $translations = get_translations_for_domain('wprss');

    return $translations->translate_plural($single, $plural, $number);
}


File Name:
image-caching.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\image-caching.php
Code:
<?php

/**
 * @since 4.6.10
 */
class WPRSS_Image_Cache {

	protected static $_instance;

	protected $_download_request_timeout = 300;
	/** @var string See {@see get_temp_dir() } */
	protected $_temp_dir; // System temp dir + 'remote-image-cache'
	protected $_current_time;
	protected $_ttl = 30; // Time to live, in seconds
        protected $_cache_orig_filename_length = 25; // How much of the original filename to preserve in the cache filename, in addition to the hash

	protected $_image_class_name = 'WPRSS_Image_Cache_Image';
	protected $_images = array();

	/**
	 * @since 4.6.10
	 */
	public function __construct() {
		$this->_construct();
	}

	protected function _construct() {

	}

	/**
	 * Retrieve the singleton instance of this class.
	 *
	 * @since 4.7.3
	 * @return WPRSS_Image_Cache
	 */
	public static function instance() {
		if ( is_null( self::$_instance ) )
			self::$_instance = new self;

		return self::$_instance;
	}


	/**
	 * @since 4.6.10
	 * @param string $class_name The name of the class, instances of which will represent image files.
	 * @return \WPRSS_Image_Cache This instance.
	 */
	public function set_image_class_name( $class_name ) {
		$this->_image_class_name = $class_name;
		return $this;
	}


	/**
	 * @since 4.6.10
	 * @return string The name of the class, instances of which represent image files.
	 */
	public function get_image_class_name() {
		return trim($this->_image_class_name);
	}


	/**
	 * @since 4.6.10
	 * @param int $timeout The number of seconds, for which to wait until
	 *	the remote resource can be considered timed out.
	 * @return \WPRSS_Image_Cache This instance.
	 */
	public function set_download_request_timeout( $timeout ) {
		$this->_download_request_timeout = intval( $timeout );
		return $this;
	}


	/**
	 * @since 4.6.10
	 * @return int The number of seconds, for which the request will wait until
	 *	the remote resource can be considered timed out.
	 */
	public function get_download_request_timeout() {
		return $this->_download_request_timeout;
	}


	/**
	 * Get the unix timestamp, which represents the current moment in time.
	 *
	 * The cache expiration calculations will use this time to determine
	 * whether or not the cache for each resource is expired.
	 *
	 * @since 4.7.3
	 * @return int The unix timestamp, representing the current moment in time.
	 */
	public function get_current_time() {
		if ( !is_null( $this->_current_time ) )
			return $this->_current_time;

		return time();
	}


	/**
	 * Set the unix timestamp, which represents the current moment in time.
	 *
	 * The cache expiration calculations will use this time to determine
	 * whether or not the cache for each resource is expired.
	 *
	 * Use this to determine cache expiration for a moment in time other than now.
	 *
	 * @since 4.7.3
	 * @see normalize_time()
	 * @param int|null $time The unix timestamp, representing the current moment in time. If null, the current timestamp will be used.
	 * @return WPRSS_Image_Cache This instance.
	 */
	public function set_current_time( $time = null ) {
		if ( is_null( $time ) )
			$time = time();

		$time = $this->normalize_time( $time );

		if ( is_int( $time ) || is_object( $time ) )
			$this->_current_time = $time;

		return $this;
	}


	/**
	 * Get the TTL (Time To Live) of cache files.
	 *
	 * This value will be used by default by all instances of cache files.
	 * If a file is older than this, it will be considered to be expired.
	 *
	 * @since 4.7.3
	 * @see set_ttl()
	 * @return int The number of seconds that represents the cache lifetime.
	 */
	public function get_ttl() {
		return $this->_ttl;
	}


	/**
	 * Set the TTL (Time To Live) of cache files.
	 *
	 * This value will be used by default by all instances of cache files.
	 * If a file is older than this, it will be considered to be expired.
	 *
	 * @since 4.7.3
	 * @see get_ttl()
	 * @see normalize_time()
	 * @param int|str $time A representation of the amount of seconds, for which the cache is considered valid.
	 * @return \WPRSS_Image_Cache
	 */
	public function set_ttl( $time ) {
		$time = $this->normalize_time( $time );
		$this->_ttl = $time;

		return $this;
	}


        /**
         * Get the length of the original filename to preserve in cache.
         *
         * This is in addition to the hash. The cache filename will have the
         * following format:
         * [trimmed-orig-filename]-[hash].[orig-extension]
         * The return value determine the length of the `trimmed-orig-filename`
         * segment.
         *
         * @since 4.10
         *
         * @return int The length of the original filename to preserve.
         */
        public function get_cache_orig_filename_length() {
            return $this->_cache_orig_filename_length;
        }


        /**
         * Set the length of the original filename that will be preserved in cache.
         *
         * @see get_cache_orig_filename_length()
         *
         * @param int $length The length of the original filename preserved.
         *
         * @return \WPRSS_Image_Cache
         */
        public function set_cache_orig_filename_length($length) {
            $this->_cache_orig_filename_length = intval($length);

            return $this;
        }


	/**
	 * Converts one of many representations of time into a Unix timestamp.
	 *
	 * Supports: An integer Unix timestamp, a string Unix timestamp, a value
	 * that ca be cast to integer, or a value that can be read by {@see strtotime}.
	 *
	 * @since 4.7.3
	 * @param int|string $time A representation of time.
	 * @return int The Unix timestamp that represents a moment in time.
	 */
	public function normalize_time( $time ) {
		if ( is_string( $time ) )
			$time = is_numeric( $time )
				? intval( $time )
				: (int) strtotime( $time );

		return $time;
	}


	/**
	 * If given a cache file, a URL or a path, converts it into a path.
	 *
	 * @since 4.7.3
	 * @see WPRSS_Image_Cache_Image::get_current_path()
	 * @see is_valid_url()
	 * @see get_unique_filename()
	 * @param WPRSS_Image_Cache_Image|string $file An instance of a cache file, a URL, or path.
	 * @return string A relative path to a cache file.
	 */
	public function normalize_path( $file ) {
		if ( $file instanceof WPRSS_Image_Cache_Image )
			$file = $file->get_current_path();

		if ( $this->is_valid_url( $file ) )
			$file = $this->get_unique_filename( $file );

		return $file;
	}


	/**
	 * Create and retrieve an new instance of a cache file for the specified URL.
	 *
	 * @since 4.6.10
	 * @param string $url
	 * @return \WPRSS_Image_Cache_Image The instance of a new cache file.
	 * @throws Exception If class invalid, or not found
	 */
	public function get_new_file( $url = null ) {
		$error_caption = 'Could not create new cache image';
		$class_name = $this->get_image_class_name();
		if ( empty( $class_name ) ) throw new Exception( sprintf( '%1$s: class name must not be empty' ) );
		if ( !class_exists( $class_name ) ) throw new Exception( sprintf( '%1$s: class "%2$s" does not exist', $class_name ) );

		$image = new $class_name();
		$this->_prepare_image( $image );
		/* @var $image WPRSS_Image_Cache_Image */
		if ( !is_null( $url ) ) $image->set_url( $url );

		return $image;
	}


	/**
	 * Get a new instance of an image cache image, which points to the specified path.
	 *
	 * @param WPRSS_Image_Cache_Image|string $file An image cache instance, URL or path.
	 * @param boolean $must_exist Whether or not the image cache file must exist.
	 * @return WPRSS_Image_Cache_Image|null The new image cache instance if successful;
	 *  null if $must_exist is true, and the image cache file does not exist.
	 */
	public function get_new_file_from_path( $file, $must_exist = false ) {
		$path = $this->normalize_path( $file );

		if ( $must_exist && !$this->check_file_exists( $path ) )
			return null;

		$file = $this->get_new_file();
		$file->set_path( $path );

		return $file;
	}


	/**
	 * @since 4.6.10
	 * @param WPRSS_Image_Cache_Image $image A prepared instance of an image file.
	 */
	protected function _prepare_image( $image ) {
		$image->set_download_request_timeout( $this->get_download_request_timeout() );
		$image->set_ttl( $this->get_ttl() );
	}


	/**
	 * Get all the images that are managed by this cache instance,
	 * or just one instance that corresponds to a resource identified by the
	 * specified URL.
	 *
	 * If no instance exists yet, it will be created.
	 *
	 * @since 4.6.10
	 * @param string|null $url
	 * @return array|WPRSS_Image_Cache_Image
	 */
	public function get_images( $url = null ) {
		if ( is_null( $url ) ) return $this->_images;

		// Gotta cache one
		if ( !isset( $this->_images[ $url ] ) ) {
			$image = $this->_get_file( $url );
			$this->_images[ $url ] = $image;
		}

		return $this->_images[ $url ];
	}


	/**
	 * Delete the cache files for all resources that are managed by this instance.
	 *
	 * @since 4.6.10
	 * @return \WPRSS_Image_Cache This instance
	 */
	public function purge( $expired_only = true, $managed_only = true ) {
		$image_class_name = $this->get_image_class_name();
		$deleted_count = 0;
		foreach( $this->get_images() as $_url => $_image ) {
			/* @var $_image WPRSS_Image_Cache_Image */
			if ( is_a( $_image, $image_class_name ) ) {
				$is_delete = $expired_only
						? $_image->check_expired()
						: true;

				if ( $is_delete )
					$deleted_count += (int) $_image->delete();
			}
		}

		$this->_images = array();
		return $deleted_count;
	}


	/**
	 * @since 4.6.10
	 * @param string $url
	 * @return WPRSS_Image_Cache_Image
	 */
	protected function _get_file( $url ) {
		$image = $this->get_new_file( $url );
		$image->retrieve();

		return $image;
	}


	/**
	 * Checks whether or not the specified image exists.
	 *
	 * @since 4.7.3
	 * @param WPRSS_Image_Cache_Image|string $file An image instance, URL or file path.
	 * @return bool Whether or not the file of the specified image exists locally, and is readable.
	 */
	public function check_file_exists( $file ) {
		$file = $this->normalize_path( $file );
		$file = $this->get_tmp_dir( $file );
		return is_readable( $file );
	}


	/**
	 * Checks whether the file for a resource represented by the given
	 * file instance, URL or path has expired.
	 *
	 * If the file for the resource does not exist, it is considered to be expired.
	 *
	 * @since 4.7.3
	 * @see get_current_time()
	 * @see check_image_exists()
	 * @see get_expiration_time()
	 * @param WPRSS_Image_Cache_Image|string $image An image instance, URL or file path.
	 * @return bool Whether or not the cache of the specified image has expired.
	 */
	public function check_image_expired( $image ) {
		if ( !$this->check_file_exists( $image ) )
			return true;
		return $this->get_current_time() >= $this->get_expiration_time( $image );
	}


	/**
	 * Retrieve the time when the cache file for the specified resource will expire.
	 *
	 * @since 4.7.3
	 * @see get_ttl()
	 * @see get_file_modification_time()
	 * @param WPRSS_Image_Cache_Image|string $image Resource URL, cache file instance or path.
	 * @return int The Unix timestamp representing the moment in time when the
	 *  cache for the specified resource will expire.
	 */
	public function get_expiration_time( $image ) {
		$mod_time = $this->get_image_modification_time( $image );

		$ttl = $image instanceof WPRSS_Image_Cache_Image
			? $image->get_ttl()
			: $this->get_ttl();

		return (int) $mod_time + (int) $ttl;
	}


	/**
	 * Checks whether the specified URL is valid.
	 *
	 * Valid URLs must start with a protocol, even a relative one.
	 *
	 * @since 4.7.3
	 * @see wprss_validate_url()
	 * @param string $url A URL to validate.
	 * @return bool True if the specified string is a valud URL; false otherwize.
	 */
	public function is_valid_url( $url ) {
		$url = trim( $url );
		$protocol_regex = '^([a-z][\w-]+:)?//';
		return !is_object( $url ) && preg_match( sprintf( '!%1$s!', $protocol_regex ), $url ) && wprss_validate_url( $url );
	}


	/**
	 * Gets the modification time of the cache file for the specified resource.
	 *
	 * @since 4.7.3
	 * @todo Maybe fix in accordance with {@link http://php.net/manual/en/function.filemtime.php#100692 this bug}.
	 * @see normalize_path()
	 * @see get_tmp_dir()
	 * @see filemtime()
	 * @param WPRSS_Image_Cache_Image|string $image Resource URL, cache file instance or path.
	 * @return int|null The Unix timestamp representing the time of file modification. Null if cannot be retrieved.
	 */
	public function get_image_modification_time( $image ) {
		$path = $this->normalize_path( $image );
		$path = $this->get_tmp_dir( $path );
		$mod_time = @filemtime( $path );

		return $mod_time
			? intval( $mod_time )
			: null;
	}


	/**
	 * Get the path to the root directory of cache files.
	 *
	 * Optionally, another path can be appended.
	 *
	 * @since 4.7.3
	 * @see trailingslashit()
	 * @see get_temp_dir()
	 * @param string|null $path If specified, will be appended to the resulting path.
	 * @return string A path to the temporary directory, or a file in it. If the primer, it will have a trailing slash.
	 */
	public function get_tmp_dir( $path = null ) {
		if ( is_null( $this->_temp_dir ) )
			$this->_temp_dir = trailingslashit( get_temp_dir() ) . 'remote-image-cache';

		$temp_dir = apply_filters( 'wprss_image_cache_temp_dir', $this->_temp_dir );
		return ( is_null( $path ) )
			? $temp_dir
			: trailingslashit( $temp_dir ) . $path;
	}


	/**
	 * Downloads a resource identified by the parameters.
	 *
	 * If only the first parameter is passed, and it is an instance of a cache
	 * file, downloads the resource described by it.
	 * If it is a URL, the request timeout and target path will be computed by this instance.
	 * Otherwise, they will be overridden by the specified values, respectively.
	 *
	 * If the 'content-md5' header is present in the responce, MD5 checksum
	 * verification will take place.
	 *
	 * @since 4.7.3
	 * @see get_download_request_timeout()
	 * @see WPRSS_Image_Cache_Image::get_download_request_timeout()
	 * @see get_unique_filename()
	 * @see WPRSS_Image_Cache_Image::get_current_path()
	 * @see get_tmp_dir()
	 * @see wp_mkdir_p()
	 * @see wpra_safe_remote_get()
	 * @see verify_file_md5()
	 * @param WPRSS_Image_Cache_Image|string $image An instance of a cache file, or the URL to download.
	 * @param int|null $request_timeout The timeout for the download request.
	 * @param string|null $target_path The relative path to the target file.
	 * @return string| The absolute local path to the downloaded file,
	 *  or false if checksum verification failed.
	 * @throws Exception If the URL is invalid, or the destination path is not writable,
	 *  or the file download library cannot be read, or any other error happens during download.
	 */
	public function download_image( $image, $request_timeout = null, $target_path = null ) {
		if ( $image instanceof WPRSS_Image_Cache_Image ) {
			$url = $image->get_url();
			$timeout = $image->get_download_request_timeout();
			$path = $image->get_current_path();
		}
		else {
			$url = $image;
			$timeout = $this->get_download_request_timeout();
			$path = $this->get_unique_filename( $url );
		}

		if ( !$url ) {
			throw new Exception( sprintf( __( 'Invalid URL provided: "%1$s"' ), $url ) );
		}

		// Since image URLs may be found from "src" attributes of <img> tags, HTML entities may need to be decoded
		$url = html_entity_decode($url);

		if ( !is_null( $target_path ) ) {
			$path = $target_path;
		}

		if ( !is_null( $request_timeout ) ) {
			$timeout = $request_timeout;
		}

		// Absolute path to the cache file
		$tmpfname = $image instanceof WPRSS_Image_Cache_Image
			? $image->get_tmp_dir( $path )
			: $this->get_tmp_dir( $path );

		$this->check_is_image($tmpfname, $url);

		// WARNING: The file is not automatically deleted, The script must unlink() the file.
		$dirname = dirname( $tmpfname );
		if ( !wp_mkdir_p( $dirname ) ) {
			throw new Exception(  sprintf( __( 'Could not create directory: "%1$s". Filename: "%2$s"' ), $dirname, $tmpfname ) );
        }

		// Getting file download lib
		$file_lib_path = ABSPATH . 'wp-admin/includes/file.php';
		if ( !is_readable( $file_lib_path ) ) {
			throw new Exception( sprintf( __( 'The file library cannot be read from %1$s' ), $file_lib_path ) );
        }

		require_once( $file_lib_path );

		// Retrieving the remote resource
		$response = wpra_remote_get(
			$url,
			array(
				'timeout' => $timeout,
				'stream' => true,
				'filename' => $tmpfname,
			)
		);

		// Could not retrieve
		if ( is_wp_error( $response ) ) {
			@unlink( $tmpfname );
			throw new Exception( $response->get_error_message() );
		}

		// Retrieved, but remote server served error instead of resource
		if ( 200 != wp_remote_retrieve_response_code( $response ) ){
			@unlink( $tmpfname );
			throw new Exception( trim( wp_remote_retrieve_response_message( $response ) ) );
		}

		// Checksum verification
		$content_md5 = wp_remote_retrieve_header( $response, 'content-md5' );
		if ( $content_md5 ) {
			$md5_check = verify_file_md5( $tmpfname, $content_md5 );
			if ( is_wp_error( $md5_check ) ) {
				unlink( $tmpfname );
				return $md5_check;
			}
		}

		return $tmpfname;
	}

    /**
     * Checks if a remote resource is an image.
     *
     * This method will first check the file type of the locally downloaded copy.
     * If that fails, the method will attempt to fetch the MIME type from the original remote file.
     *
     * @since 4.14
     *
     * @param string $path The path to the local file.
     * @param string $url The URL to the remote file.
     *
     * @return bool
     */
	public function check_is_image( $path, $url )
    {
        // Determine file type (ext and mime/type)
        $url_type = wp_check_filetype($path);

        // If the wp_check_filetype function fails to determine the MIME type
        if (empty($url_type['type'])) {
            $url_type = wpra_check_file_type($path, $url);
        }

        $mime_type = $url_type['type'];
        $mime_parts = explode('/', $mime_type);

        if (count($mime_parts) < 1) {
            return false;
        }

        if ($mime_parts[0] !== 'image') {
            return false;
        }

        return true;
    }

	/**
	 * Uses one of the registered hashing functions to hash the given value.
	 *
	 * The default functions that will be tried are {@see sha1()} and {@see md5()}
	 * in that order. More can be added using the `wprss_image_cache_hash_functions`
	 * filter.
	 *
	 * @since 4.7.3
	 * @param mixed $value The value to hash.
	 * @param null|mixed $default The value to return if none of the registered caching functions exist.
	 * @return string The hash string.
	 */
	public function hash( $value, $default = null ) {
		$hash_funcs = apply_filters( 'wprss_image_cache_hash_functions', array( 'sha1', 'md5' ) );
		foreach ( $hash_funcs as $_idx => $_func )
			if ( is_callable( $_func ) )
				return call_user_func_array ( $_func, array( $value ) );

		return $default;
	}


	/**
	 * Get a local relative path to for a remote resource, based on it's URL.
	 *
	 * @since 4.7.3
	 * @see generate_unique_file_name()
	 * @param WPRSS_Image_Cache_Image|string $url An instance of a cache file, or a URL of a resource.
	 * @return string|null A relative path to a cache file. If URL is empty, null is returned.
	 */
	public function get_unique_filename( $url ) {
		if ( $url instanceof WPRSS_Image_Cache_Image )
			$url = $url->get_url();

		return $this->generate_unique_file_name( $url );
	}


	/**
	 * Get a local relative path to for a remote URL.
	 *
	 * If the resource is identified by a URL with a relative protocol,
	 * the protocol will be completely ignored.
	 *
	 * @since 4.7.3
	 * @param string $url A remote resource URL.
	 * @return string A local relative path to the file for the remote resource.
	 *  The path may contain several folders, and will be of format:
	 *  [domain inc. subdomain][path to resource][resource name without extension]-[hash of the whole URL][optionally the extension]
	 */
	public function generate_unique_file_name( $url ) {
		if ( !strlen( $url ) )
			return null;

		// In case the URL is specified with a relative protocol
		$url = ltrim( $url, '/' );

		// Validate and extract extension from URL
        $pattern =
              '[^\?#]+?' // Anything that's not a '?' or '#', which denote the query string and fragment respectively
            . '(?:' // Non-matching group, just for quantifier
                . '\.' // Literal period
                . '(jpg|JPG|jpeg|JPEG|jpe|JPE|gif|GIF|png|PNG)' // The actual extension; this is what we're after
            . ')?' // The extension may not appear at all
            . '(?:#|\?|$)' // End our search with query or fragment
        ;
		preg_match( sprintf( '!%1$s!', $pattern ), $url, $ext_matches );
		$extension = isset( $ext_matches[1] ) ? $ext_matches[1] : null;
        // Fragment/query delimiters are included in the whole match
		$url_filename = basename( urldecode( trim( $ext_matches[0], '#?' ) ) );

		// Get the path to the image, without the domain. ex. /news/132456/image
		$path_matches = array();
		if ( !preg_match_all( '![^:]+://([^/]+)/([^\?]+)!', $url, $path_matches ) )
			return null;

		$path = isset( $path_matches[2][0] ) ? $path_matches[2][0] : null;
		$domain = isset( $path_matches[1][0] ) ? $path_matches[1][0] : null;

		$base_filename = $extension
			? basename( $url_filename, '.' . $extension )
			: basename( $url_filename );

		$hash = self::hash( $url );

		$path = trailingslashit( substr( $path, 0, strlen( $path ) - strlen( $url_filename ) ) );
                if ( $orig_path_length = $this->get_cache_orig_filename_length() ) {
                    $base_filename = substr( $base_filename, 0, $orig_path_length );
                }

		$unique_filename = trailingslashit( $domain ) .
                        ($orig_path_length
                            ? "$base_filename-"
                            : '') .
                        $hash .
                        (is_null( $extension )
                            ? ''
                            : ".$extension");

		return $unique_filename;
	}
}


/**
 * @since 4.6.10
 */
class WPRSS_Image_Cache_Image {

	protected $_url;
	protected $_path;
	protected $_tmp_path;
	protected $_tmp_dir;
	protected $_local_path;
	protected $_unique_name;
	protected $_size;
	protected $_download_request_timeout;
	protected $_is_attempted;
	protected $_is_fall_back_to_unsecure;
	protected $_ttl;
	protected $_cache;
	protected $_is_cached;


	/**
	 * @since 4.6.10
	 * @param string|null $data
	 */
	public function __construct( $data = null ) {
		$this->reset();

		if ( is_string( $data ) && !empty( $data ) )
			$this->_set_url( $data );
	}


	/**
	 * Brings all properties of this instance to their original values,
	 * making it re-usable.
	 *
	 * @since 4.6.10
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	public function reset() {
		$this->_url = null;
		$this->_path = null;
		$this->_tmp_path = null;
		$this->_tmp_dir = null;
		$this->_local_path = null;
		$this->_unique_name = null;
		$this->_size = null;
		$this->_download_request_timeout = 300;
		$this->_is_attempted = false;
		$this->_is_fall_back_to_unsecure = true;
		$this->_ttl;
		$this->_cache = null;
		$this->_is_cached = null;

		return $this;
	}


	/**
	 * @since 4.6.10
	 * @param string $url
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	protected function _set_url( $url ) {
		$this->_url = $url;
		return $this;
	}


	/**
	 * Sets the URL of the remote resource, which this instance represents
	 * the cache of.
	 *
	 * @since 4.6.10
	 * @param string $url
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	public function set_url( $url ) {
		$this->reset();
		$this->_set_url($url);

		return $this;
	}


	/**
	 * Retrieves the URL of the remove resource, which this instance represents
	 * the cache of.
	 *
	 * @since 4.6.10
	 * @return string The URL.
	 */
	public function get_url() {
		return $this->_url;
	}


	/**
	 * Whether or not this instance has a URL assigned.
	 *
	 * @since 4.6.10
	 * @return boolean True if this instance has a URL assigned; false otherwise.
	 */
	public function has_url() {
		return isset( $this->_url );
	}


	public function set_path( $path ) {
		$this->_set_path( $path );
		return $this;
	}


	/**
	 * @since 4.6.10
	 * @param string $path
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	protected function _set_path( $path ) {
		$this->_path = $path;
		return $this;
	}


	/**
	 * Get the path to the cache file.
	 *
	 * The path is relative to the root of the cache directory.
	 * It will only be set if the cache file is not expired, or has been
	 * successfully downloaded.
	 *
	 * @since 4.6.10
	 * @return string Relative path to the cache file.
	 */
	public function get_path() {
		return $this->_path;
	}


	/**
	 * Whether or not this instance has a local path assigned.
	 *
	 * @see get_path().
	 * @since 4.6.10
	 * @return boolean
	 */
	public function has_path() {
		return isset( $this->_path );
	}


	/**
	 * Get the local absolute path to the cache file.
	 *
	 * If local path has not yet been set, e.g. before the download of an
	 * expired file, this will return the absolute path to where the file
	 * would be after download.
	 *
	 * If the file is retrieved from cache, no local path is set explicitly,
	 * but this method will retrieve it's location regardless.
	 *
	 * @see get_current_path()
	 * @see get_tmp_dir()
	 * @see has_local_path()
	 * @since 4.7.3
	 * @return string Absolute path to the cache file.
	 */
	public function get_local_path() {
		if ( !is_null( $this->_local_path ) )
			return $this->_local_path;

		return $this->get_tmp_dir( $this->get_current_path() );
	}


	/**
	 * @since 4.7.3
	 * @param string $path The absolute path to the cache file.
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	protected function _set_local_path( $path ) {
		$this->_local_path = $path;
		return $this;
	}


	/**
	 * Whether or not the local path has been set.
	 *
	 * This usually happens after the successful download of an expired file.
	 *
	 * @see get_local_path()
	 * @since 4.7.3
	 * @return bool True if the local absolute path has been set; false otherwise.
	 */
	public function has_local_path() {
		return !is_null( $this->_local_path );
	}


	/**
	 * Whether or not the file was retrieved from cache, if attempted to retrieve.
	 * Before retrieval attempt, indicates whether or not the file cache has expired.
	 *
	 * @see is_attempted()
	 * @see check_expired()
	 * @since 4.7.3
	 * @return bool True if file was retrieved or retrievable from cache; false otherwise.
	 */
	public function is_cached() {
		return $this->is_attempted()
			? $this->_is_cached()
			: !$this->check_expired();
	}


	/**
	 *
	 * @since 4.7.3
	 * @param null|bool $is_cached If not null, will set whether or not the resource is cached.
	 *  Otherwise, will retrieve that value
	 * @return \WPRSS_Image_Cache_Image|bool This instance, if setting, or the value if retrieving.
	 */
	protected function _is_cached( $is_cached = null ) {
		if ( is_null( $is_cached ) )
			return $this->_is_cached;

		$this->_is_cached = (bool) $is_cached;
		return $this;
	}


	/**
	 * Get an instance of this image's cache controller, if set.
	 * Otherwise, get the singleton instance of {@see WPRSS_Image_Cache}.
	 *
	 * @since 4.7.3
	 * @return WPRSS_Image_Cache The instance of this image's cache controller.
	 */
	public function get_cache() {
		if ( is_null( $this->_cache ) )
			return WPRSS_Image_Cache::instance();

		return $this->_cache;
	}


	/**
	 * Set the temporary path to this image's file.
	 *
	 * @since 4.7.3
	 * @param string $path
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	protected function _set_tmp_path( $path = null ) {
		if ( is_null( $path ) )
			$path = $this->get_tmp_path();

		$this->_tmp_path = $path;
		return $this;
	}


	/**
	 * Retrieve the temporary path to this image's file, which is used for
	 * working with it. This may not be the final path.
	 *
	 * @see get_unique_name()
	 * @since 4.7.3
	 * @return string The path.
	 */
	public function get_tmp_path() {
		if ( !is_null( $this->_tmp_path ) )
			return $this->_tmp_path;

		return $this->get_unique_name();
	}


	/**
	 * The current path to the image's file.
	 * Used from outside the class for working with this image's file
	 * while it is not yet ready.
	 *
	 * @see get_path()
	 * @see get_tmp_path()
	 * @since 4.7.3
	 * @return string The path.
	 */
	public function get_current_path() {
		return !is_null( $path = $this->get_path() )
			? $path
			: $this->get_tmp_path();
	}


	/**
	 * Sets the download request timeout.
	 *
	 * @see get_download_request_timeout()
	 * @since 4.6.10
	 * @param int $timeout
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	public function set_download_request_timeout( $timeout ) {
		$this->_download_request_timeout = intval( $timeout );
		return $this;
	}


	/**
	 * Gets the download request timeout.
	 *
	 * This is the maximal number of seconds, for which the request will
	 * wait before terminating with a timeout.
	 *
	 * @see set_download_request_timeout()
	 * @since 4.6.10
	 * @return int
	 */
	public function get_download_request_timeout() {
		return $this->_download_request_timeout;
	}


	/**
	 * @since 4.6.10
	 * @param boolean|null $is_attempted
	 * @return \WPRSS_Image_Cache_Image|boolean Whether was attempted, or this instance.
	 */
	protected function _is_attempted( $is_attempted = null ) {
		if ( is_null( $is_attempted ) )
			return (bool)$this->_is_attempted;

		$this->_is_attempted = (bool) $is_attempted;
		return $this;
	}


	/**
	 * Whether or not the retrieval of the corresponding resource, e.g. file
	 * download, has been attempted.
	 *
	 * @see download()
	 * @since 4.6.10
	 * @return boolean True if retrieval of this resource was attempted; false otherwise.
	 */
	public function is_attempted() {
		return $this->_is_attempted();
	}


	/**
	 * Gets or sets whether this instance should fall back to an unsecure connection,
	 * e.g. try the HTTP protocol, if retrieval of the resource over the secure protocol,
	 * e.g. HTTPS, fails.
	 *
	 * @see download()
	 * @since 4.6.10
	 * @param boolean|null $is_fall_back
	 * @return \WPRSS_Image_Cache_Image|boolean Whether will fall back to unsecure, or this instance.
	 */
	public function is_fall_back_to_unsecure( $is_fall_back = null ) {
		if ( is_null( $is_fall_back ) )
			return (bool) $this->_is_fall_back_to_unsecure;

		$this->_is_fall_back_to_unsecure = (bool) $is_fall_back;
		return $this;
	}


	/**
	 * Retrieves the TTL (Time To Live) for the corresponding resource's cache.
	 *
	 * Falls back to the cache controller's value, if not set.
	 *
	 * @see WPRSS_Image_Cache::get_ttl()
	 * @see get_ttl()
	 * @since 4.7.3
	 * @return int The amount of seconds, for which the cache file may be considered valid.
	 */
	public function get_ttl() {
		return !is_null( $this->_ttl )
			? $this->_ttl
			: $this->get_cache()->get_ttl();
	}


	/**
	 * Sets the TTL (Time To Live) for the corresponding resource's cache.
	 *
	 * @see get_ttl()
	 * @since 4.7.3
	 * @param int $time The amount of seconds, for which the cache file should be considered valid.
	 */
	public function set_ttl( $time ) {
		$this->_ttl = $this->normalize_time( $time );
	}


	/**
	 * Normalizes a time value.
	 *
	 * This is done by converting one of a variety of representations of time
	 * into a Unix timestamp.
	 *
	 * @see WPRSS_Image_Cache::normalize_time()
	 * @since 4.7.3
	 * @param string|int $time A representation of a moment in time.
	 * @return int A timestamp.
	 */
	public function normalize_time( $time ) {
		return $this->get_cache()->normalize_time( $time );
	}


	/**
	 * Retrieves the path to the directory, where the cache file is or will be stored.
	 *
	 * If not set explicitly, falls back to the cache controller's path.
	 * Optionally, can be appended with another path.
	 *
	 * @see WPRSS_Image_Cache::get_tmp_dir()
	 * @since 4.7.3
	 * @param null|string $path A path to append to the cache directory path.
	 * @return string The path to the cache directory, optionally appended with the specified path.
	 *  It will not contain the trailing directory separator, but if appended with another path, the separator will be put in between them.
	 */
	public function get_tmp_dir( $path = null ) {
		if ( !is_null( $this->_tmp_dir ) )
			return is_null( $path )
				? $this->_tmp_dir
				: trailingslashit( $this->_tmp_dir ) . $path;

		return $this->get_cache()->get_tmp_dir( $path );
	}


	/**
	 * Retrieves the resource identified by this instance's URL.
	 *
	 * If the resource is cached, and the cache is not expired, the resource
	 * will be retrieved from cache.
	 *
	 * @see download()
	 * @since 4.7.3
	 * @return string The path to the resource's cache file.
	 */
	public function retrieve() {
		// Prepare image
		$this->_is_attempted( true )
				->_set_path( null )
				->_set_local_path( null );
		$relative_path = $this->get_current_path();

		// Cache still valid
		if ( !$this->check_expired() ) {
			$this->_set_path ( $relative_path )
					->_is_cached( true );
			return $this->get_local_path();
		}

		$local_path = $this->_retrieve();
		$this->_set_path( $relative_path );
		$this->_set_local_path( $local_path );
		$this->_is_cached( false );

		return $this->get_local_path();
	}


	/**
	 * An internal method that does just the actual retrieval of the resource.
	 *
	 * @since 4.7.3
	 * @return string The absolute local path to the retrieved file.
	 * @throws Exception If the file cannot be retrieved, due to read or write errors of some kind.
	 */
	protected function _retrieve() {
		return $this->download();
	}


	/**
	 * Downloads a file.
	 *
	 * @see get_url()
	 * @see get_local_path()
	 * @since 4.6.10
	 * @param string|null $url The URL of the file to download. If null, the URL used is that of this instance.
	 * @return string The absolute local path to the downloaded file.
	 * @throws Exception If no URL is set, or the resource is unreadable, or something went wrong.
	 */
	public function download( $url = null ) {
		if ( !is_null( $url ) )
			$this->set_url( $url );

		// Downloading the file
		$tmp_path = $this->_download();

		return $tmp_path;
	}


	/**
	 * @since 4.6.10
	 * @param string $url
	 * @param int $timeout
	 * @return string The local path to the downloaded image, if successful; an error instance if download failed.
	 */
	protected function _download() {
		$cache = $this->get_cache();

		try {
			$tmp_path = $cache->download_image( $this );
		} catch ( Exception $e ) {
			$https = 'https';
			$url = $this->get_url();
			// Should we try unsecure protocol?
			if ( $this->is_fall_back_to_unsecure() && (stripos( $url, $https ) === 0) ) {
				$orig_url = $url;
				$url = 'http' . substr( $url, strlen( $https ) );
				$this->set_url( $url );
				$tmp_path = $cache->download_image( $this );
				$this->set_url( $orig_url );
			}
			else throw $e;
		}

		return $tmp_path;
	}


	/**
	 * Retrieves the time, at which the cache file was last modified.
	 *
	 * @since 4.7.3
	 * @return int|null The timestamp that represents the time when the cache file was last modified on success;
	 *  null if timestamp could not be retrieved.
	 */
	public function get_modification_time() {
		return $this->get_cache()->get_image_modification_time( $this );
	}


	/**
	 * Checks whether or not the cache file exists.
	 *
	 * @since 4.7.3
	 * @return bool True if the cache file exists; false otherwise.
	 */
	public function check_exists() {
		return $this->get_cache()->check_file_exists( $this );
	}


	/**
	 * Checks whether or not the cache file has expired.
	 *
	 * @see get_ttl()
	 * @see WPRSS_Image_Cache::check_image_expired()
	 * @since 4.7.3
	 * @return bool True if the cache file has expired; false otherwise.
	 */
	public function check_expired() {
		return $this->get_cache()->check_image_expired( $this );
	}


	/**
	 * Get the time, at which the cache file of this instance will expire.
	 *
	 * @since 4.7.3
	 * @see WPRSS_Image_Cache::get_expiration_time()
	 * @return int Unix timestamp representing the time when the cache file of this instance will expire.
	 *  If file doesn't exist, or it's modification date cannot be retrieved, will return 0.
	 */
	public function get_expiration_time() {
		return $this->get_cache()->get_expiration_time( $this );
	}


	/**
	 * Deletes the cache file of this instance.
	 *
	 * @since 4.6.10
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	public function delete() {
		if ( $path = $this->get_path() )
			if ( file_exists( $path ) )
				return @unlink( $path );

		return false;
	}


	/**
	 * Generates and stores for subsequent use a filename, which is unique for this instance's URL.
	 *
	 * This file name is relative to the base directory of cache.
	 *
	 * @see get_tmp_dir().
	 * @since 4.6.10
	 * @return string A unique name for a local cache file, based on the URL of the resource.
	 */
	public function get_unique_name() {
		if( !isset($this->_unique_name) )
			$this->_set_unique_name( $this->get_cache()->get_unique_filename( $this ) );

		return $this->_unique_name;
	}


	/**
	 * @since 4.6.10
	 * @param string $name The relative filename to be used for this instance's cache file.
	 * @return \WPRSS_Image_Cache_Image This instance.
	 */
	protected function _set_unique_name( $name ) {
		$this->_unique_name = $name;
		return $this;
	}


	/**
	 * Get the size of the image, which is locally cached.
	 *
	 * @since 4.6.10
	 * @return array A numeric array, where index 0 holds image width, and index 1 holds image height.
	 * @throws Exception If image file is unreadable.
	 */
	public function get_size() {
		if ( !isset( $this->_size ) ) {
			$path = $this->get_local_path();
			if ( !$this->is_readable() ) throw new Exception( sprintf( '%1$s: image file is not readable', $path ) );

			// Trying simplest way
			$size = @getimagesize( $path );
			if ( $size ) {
				$this->_size = [0 => $size[0], 1 => $size[1]];
			}

            if( !$this->_size && function_exists( 'gd_info' ) ) {
				$image = file_get_contents( $path );
				$image = @imagecreatefromstring( $image );

				if ($image !== false) {
                    $width = imagesx($image);
                    $height = imagesy($image);
                    $this->_size = [0 => $width, 1 => $height];

                    wprss_log(
                        sprintf('Tried GD: %1$s', empty($this->_size) ? 'failure' : 'success'),
                        __METHOD__,
                        WPRSS_LOG_LEVEL_SYSTEM
                    );
                }
            }
		}

		return $this->_size;
	}


	/**
	 * @since 4.6.10
	 * @return boolean
	 */
	public function is_readable() {
		$path = $this->get_local_path();
		if ( !$path ) return false;
		return is_readable( $path );
	}
}


File Name:
leave-review-notification.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\leave-review-notification.php
Code:
<?php

/**
 * This is a module responsible for facilitating the "Leave a Review" notification.
 *
 * Use the `WPRSS_LEAVE_REVIEW_NOTIFICATION_DELAY` constant to change the amount of time (in seconds)
 * that the notice will be delayed by after first installation date. This date is determined by an option created
 * during plugin activation, if not already present. When retrieving this value, if it does not exist
 * (perhaps because this update was installed after activation happened), it will be deduced from the creation time
 * of the oldest feed source. If no feed sources exist, the time at that moment will be determined as the
 * first activation time from that point onward.
 */

// How much time must pass from activation to display notice
if (!defined('WPRSS_LEAVE_REVIEW_NOTIFICATION_DELAY')) {
    define('WPRSS_LEAVE_REVIEW_NOTIFICATION_DELAY', 60 * 60 * 24 * 7 * 4 * 1); // 1 month
}

// How many active feed sources to display notice
if (!defined('WPRSS_LEAVE_REVIEW_NOTIFICATION_MIN_ACTIVE_FEED_SOURCES')) {
    define('WPRSS_LEAVE_REVIEW_NOTIFICATION_MIN_ACTIVE_FEED_SOURCES', 1);
}

add_action('wprss_init', function() {
    wprss()->getLeaveReviewNotification();
});


File Name:
legacy-feed-display.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\legacy-feed-display.php
Code:
<?php
    /**
     * Feed display related functions
     *
     * @package WPRSSAggregator
     */

    /**
     * Display template for a feed source. Simulates a shortcode call.
     *
     * @since 4.6.6
     * @deprecated 4.13 This function was left here because the ET addon references it.
     */
    function wprss_render_feed_view( $content ) {
        return $content;
    }

    /**
     * Display template for a feed source. Simulates a shortcode call.
     *
     * @since 4.6.6
     * @deprecated 4.13 This function was left here because the ET addon references it.
     */
    function wprss_render_feed_item_view( $content ) {
        return $content;
    }

    /**
     * Redirects to wprss_display_feed_items
     * It is used for backwards compatibility to versions < 2.0
     *
     * @since 2.1
     */
    function wp_rss_aggregator( $args = array() ) {
        $template = wpra_get('feeds/templates/master_template');
        $fullArgs = $args;

        // Use legacy mode if arg was not explicitly given
        if (!isset($fullArgs['legacy'])) {
            $fullArgs['legacy'] = true;
        }

        return $template->render($args);
    }

    /**
     * Handles the display for a single feed item.
     *
     * @since 4.6.6
     */
    function wprss_display_single_feed_item( $atts = array() ) {
        if ( empty( $atts ) ) return;
        $id = empty( $atts['id'] ) ? FALSE : $atts['id'];
        if ( $id === FALSE || get_post_type( $id ) !== 'wprss_feed_item' || ( $item = get_post( $id ) ) === FALSE ) {
            return '';
        }
        //Enqueue scripts / styles
        wp_enqueue_script( 'jquery.colorbox-min', WPRSS_JS . 'jquery.colorbox-min.js', array( 'jquery' ) );
        wp_enqueue_script( 'wprss_custom', WPRSS_JS . 'custom.js', array( 'jquery', 'jquery.colorbox-min' ) );

        setup_postdata( $item );
        $output = wprss_render_feed_item( $id );
        $output = apply_filters( 'wprss_shortcode_single_output', $output );
        wp_reset_postdata();
        return $output;
    }

    /**
     * Renders a single feed item.
     *
     * @param int    $ID      The ID of the feed item to render
     * @param string $default The default text to return if something fails.
     * @return string The output
     * @since 4.6.6
     */
    function wprss_render_feed_item( $ID = NULL, $default = '', $args = array() ) {
        $ID = ( $ID === NULL )? get_the_ID() : $ID;
        if ( is_feed() ) return $default;

        // Prepare the options
        $general_settings = get_option( 'wprss_settings_general' );
        $display_settings = wprss_get_display_settings( $general_settings );
        $excerpts_settings = get_option( 'wprss_settings_excerpts' );
        $thumbnails_settings = get_option( 'wprss_settings_thumbnails' );

		$args = wp_parse_args($args, array(
			'link_before'			=> '',
			'link_after'			=> ''
		));
        $extra_options = apply_filters( 'wprss_template_extra_options', array(), $args);

        // Declare each item in $args as its own variable
        extract( $args, EXTR_SKIP );

        // Get the item meta
        $permalink       = get_post_meta( $ID, 'wprss_item_permalink', true );
        $enclosure       = get_post_meta( $ID, 'wprss_item_enclosure', true );
        $feed_source_id  = get_post_meta( $ID, 'wprss_feed_id', true );
        $link_enclosure  = get_post_meta( $feed_source_id, 'wprss_enclosure', true );
        $source_name     = get_the_title( $feed_source_id );
        $source_url      = get_post_meta( $feed_source_id, 'wprss_site_url', true );
        $timestamp       = get_the_time( 'U', $ID );

        $general_source_link = isset( $general_settings['source_link'] ) ? $general_settings['source_link'] : 0;
        $feed_source_link = get_post_meta( $feed_source_id, 'wprss_source_link', true );
        $source_link = ( $feed_source_link === '' || intval($feed_source_link) < 0 ) // If not explicit value
            ? $general_source_link // Fall back to general setting
            : $feed_source_link; // Otherwise, use value
        $source_link = intval(trim($source_link));

        // Fallback for feeds created with older versions of the plugin
        if ( $source_url === '' ) $source_url = get_post_meta( $feed_source_id, 'wprss_url', true );
        // convert from Unix timestamp
        $date = wprss_date_i18n( $timestamp );

        // Prepare the title
        $feed_item_title = get_the_title();
        $feed_item_title = wprss_shorten_title($feed_item_title, $ID);
        $feed_item_title_link = ( $link_enclosure === 'true' && $enclosure !== '' )? $enclosure : $permalink;

        // Prepare the text that precedes the source
        $text_preceding_source = wprss_get_general_setting('text_preceding_source');
        $text_preceding_source = ltrim( __( $text_preceding_source, WPRSS_TEXT_DOMAIN ) . ' ' );

        $text_preceding_date = wprss_get_general_setting('text_preceding_date');
        $text_preceding_date = ltrim( __( $text_preceding_date, WPRSS_TEXT_DOMAIN ) . ' ' );

        do_action( 'wprss_get_post_data' );

        $meta = $extra_options;
        $extra_meta = apply_filters( 'wprss_template_extra_meta', $meta, $args, $ID );

        ///////////////////////////////////////////////////////////////
        // BEGIN TEMPLATE

        // Prepare the output
        $output = '';
        // Begin output buffering
        ob_start();
        // Print the links before
        echo $link_before;

        // The Title
        $item_title = wprss_link_display( $feed_item_title_link, $feed_item_title, wprss_get_general_setting('title_link') );
        $item_title = apply_filters('wprss_item_title', $item_title, $feed_item_title_link, $feed_item_title, wprss_get_general_setting('title_link'));
        echo $item_title;

        do_action( 'wprss_after_feed_item_title', $extra_meta, $display_settings, $ID );

        // FEED ITEM META
        echo '<div class="wprss-feed-meta">';

        // SOURCE
        if ( wprss_get_general_setting('source_enable') == 1 ) {
            echo '<span class="feed-source">';
            $source_link_text = apply_filters('wprss_item_source_link', wprss_link_display( $source_url, $source_name, $source_link ) );
            $source_link_text = $text_preceding_source . $source_link_text;
            echo $source_link_text;
            echo '</span>';
        }

        // DATE
        if ( wprss_get_general_setting('date_enable') == 1 ) {
            echo '<span class="feed-date">';
            $date_text = apply_filters( 'wprss_item_date', $date );
            $date_text = $text_preceding_date . $date_text;
            echo $date_text;
            echo '</span>';
        }

        // AUTHOR
        $author = get_post_meta( $ID, 'wprss_item_author', TRUE );
        if ( wprss_get_general_setting('authors_enable') == 1 && $author !== NULL && is_string( $author ) && $author !== '' ) {
            echo '<span class="feed-author">';
            $author_text = apply_filters( 'wprss_item_author', $author );
            $author_prefix_text = apply_filters( 'wprss_author_prefix_text', 'By' );
            _e( $author_prefix_text, WPRSS_TEXT_DOMAIN );
            echo ' ' . $author_text;
            echo '</span>';
        }

        echo '</div>';

        // TIME AGO
        if ( wprss_get_general_setting('date_enable') == 1 && wprss_get_general_setting('time_ago_format_enable') == 1 ) {
            $time_ago = human_time_diff( $timestamp, time() );
            echo '<div class="wprss-time-ago">';
            $time_ago_text = apply_filters( 'wprss_item_time_ago', $time_ago );
            printf( __( '%1$s ago', WPRSS_TEXT_DOMAIN ), $time_ago_text );
            echo '</div>';
        }

        // END TEMPLATE - Retrieve buffered output
        $output .= ob_get_clean();
        $output = apply_filters( 'wprss_single_feed_output', $output, $permalink );
        $output .= "$link_after";

        // Print the output
        return $output;
    }


    /**
     * Retrieve settings and prepare them for use in the display function
     *
     * @since 3.0
     */
    function wprss_get_display_settings( $settings = NULL ) {
        if ( $settings === NULL ) {
            $settings = get_option( 'wprss_settings_general' );
        }
        // Parse the arguments together with their default values
        $args = wp_parse_args(
            $settings,
            array(
                'open_dd'   =>  'blank',
                'follow_dd' =>  '',
            )
        );

        // Prepare the 'open' setting - how to open links for feed items
        $open = '';
        switch ( $args['open_dd'] ) {
            case 'lightbox' :
                $open = 'class="colorbox"';
                break;
            case 'blank' :
                $open = 'target="_blank"';
                break;
        }

        // Prepare the 'follow' setting - whether links marked as nofollow or not
        $follow = ( $args['follow_dd'] == 'no_follow' )? 'rel="nofollow"' : '';

        // Prepare the final settings array
        $display_settings = array(
            'open'      =>  $open,
            'follow'    =>  $follow
        );

        do_action( 'wprss_get_settings' );

        return $display_settings;
    }


    /**
     * Merges the default arguments with the user set arguments
     *
     * @since 3.0
     */
    function wprss_get_shortcode_default_args( $args ) {
        // Default shortcode/function arguments for displaying feed items
        $shortcode_args = apply_filters(
                            'wprss_shortcode_args',
                            array(
                                  'links_before' => '<ul class="rss-aggregator">',
                                  'links_after'  => '</ul>',
                                  'link_before'  => '<li class="feed-item">',
                                  'link_after'   => '</li>'
                            )
        );

        // Parse incoming $args into an array and merge it with $shortcode_args
        $args = wp_parse_args( $args, $shortcode_args );

        return $args;
    }


    /**
     * Prepares and builds the query for fetching the feed items
     *
     * @since 3.0
     */
    function wprss_get_feed_items_query( $settings ) {
		if( isset( $settings['feed_limit'] ) ) {
			$posts_per_page = $settings['feed_limit'];
		} else {
			$posts_per_page = wprss_get_general_setting('feed_limit');
		}
        global $paged;
        if ( get_query_var('paged') ) {
            $paged = get_query_var('paged');
        } elseif ( get_query_var('page') ) {
            $paged = get_query_var('page');
        } else {
            $paged = 1;
        }

		$feed_items_args = array(
		    'post_type'           => get_post_types(),
            'posts_per_page'      => $posts_per_page,
			'orderby'             => 'date',
			'order'               => 'DESC',
            'paged'               => $paged,
            'suppress_filters'    => true,
            'ignore_sticky_posts' => true,
            'meta_query' => array(
                'relation' => 'AND',
                array(
                    'key' => 'wprss_feed_id',
                    'compare' => 'EXISTS',
                )
            )
		);

        if ( isset($settings['pagination']) ) {
            $pagination = strtolower( $settings['pagination'] );
            if ( in_array( $pagination, array('false','off','0') ) ) {
                unset( $feed_items_args['paged'] );
            }
        }

        if ( isset( $settings['no-paged'] ) && $settings['no-paged'] === TRUE ) {
            unset( $feed_items_args['no-paged'] );
        }

		// If either the source or exclude arguments are set (but not both), prepare a meta query
		if ( isset( $settings['source'] ) xor isset( $settings['exclude'] ) ) {
			// Set the appropriate setting and operator
			$setting = 'source';
			$operator = 'IN';
			if ( isset( $settings['exclude'] ) ) {
				$setting = 'exclude';
				$operator = 'NOT IN';
			}
			$feeds = array_filter( array_map( 'intval', explode( ',', $settings[$setting] ) ) );
            foreach ( $feeds as $feed )
                trim( $feed );
			if ( !empty( $feeds ) ) {
				$feed_items_args['meta_query'] = array(
					array(
						'key'     => 'wprss_feed_id',
						'value'   => $feeds,
						'type'    => 'numeric',
						'compare' => $operator,
					),
				);
			}
		}

        // Arguments for the next query to fetch all feed items
        $feed_items_args = apply_filters( 'wprss_display_feed_items_query', $feed_items_args, $settings );

        // Query to get all feed items for display
        $feed_items = new WP_Query( $feed_items_args );

        if ( isset( $settings['get-args'] ) && $settings['get-args'] === TRUE ) {
            return $feed_items_args;
        } else return $feed_items;
    }


    add_action( 'wprss_display_template', 'wprss_default_display_template', 10, 3 );
    /**
     * Default template for feed items display
     *
     * @since 3.0
     * @param $args       array    The shortcode arguments
     * @param $feed_items WP_Query The feed items to display
     */
    function wprss_default_display_template( $args, $feed_items ) {
        global $wp_query;
        global $paged;

        // Swap the current WordPress Query with our own
        $old_wp_query = $wp_query;
        $wp_query = $feed_items;

        // Prepare the output
        $output = '';

        // Check if our current query returned any feed items
        if ( $feed_items->have_posts() ) {
            // PRINT LINKS BEFORE LIST OF FEED ITEMS
            $output .= $args['links_before'];

            // FOR EACH ITEM
            while ( $feed_items->have_posts() ) {
                // Get the item
                $feed_items->the_post();
                // Add the output
                $output .= wprss_render_feed_item( NULL, '', $args );
            }

            // OUTPUT LINKS AFTER LIST OF FEED ITEMS
            $output .= $args['links_after'];

            // Add pagination if needed
            if ( !isset( $args['pagination'] ) || !in_array( $args['pagination'], array('off','false','0',0) ) ) {
                $output = apply_filters( 'wprss_pagination', $output );
            }

            // Filter the final output, and print it
            echo apply_filters( 'feed_output', $output );
        } else {
            // No items found message
            echo apply_filters( 'no_feed_items_found', __( 'No feed items found.', WPRSS_TEXT_DOMAIN ) );
        }

        // Reset the WordPress query
        $wp_query = $old_wp_query;
        wp_reset_postdata();
    }


    /**
     * Generates an HTML link, using the saved display settings.
     *
     * @param string $link The link URL
     * @param string $text The link text to display
     * @param string $bool Optional boolean. If FALSE, the text is returned unlinked. Default: TRUE.
     * @return string The generated link
     * @since 4.2.4
     */
    function wprss_link_display( $link, $text, $bool = TRUE ) {
        $display_settings = wprss_get_display_settings( get_option( 'wprss_settings_general' ) );
        $a = $bool ? "<a {$display_settings['open']} {$display_settings['follow']} href='$link'>$text</a>" : $text;
        return $a;
    }


    add_filter( 'wprss_pagination', 'wprss_pagination_links' );
    /**
     * Display pagination links
     *
     * @since 3.5
     */
    function wprss_pagination_links( $output ) {
		// Get the general setting
		$pagination = wprss_get_general_setting( 'pagination' );;

		// Check the pagination setting, if using page numbers
		if ( $pagination === 'numbered' ) {
			global $wp_query;
			$big = 999999999; // need an unlikely integer
			$output .= paginate_links( array(
				'base'		=> str_replace( $big, '%#%', esc_url( get_pagenum_link( $big ) ) ),
				'format'	=> '?paged=%#%',
				'current'	=> max( 1, get_query_var('paged') ),
				'total'		=> $wp_query->max_num_pages
			) );
			return $output;
		}
		// Otherwise, using default paginations
		else {
			$output .= '<div class="nav-links">';
			$output .= '    <div class="nav-previous alignleft">' . get_next_posts_link( __( 'Older posts', WPRSS_TEXT_DOMAIN ) ) . '</div>';
			$output .= '    <div class="nav-next alignright">' . get_previous_posts_link( __( 'Newer posts', WPRSS_TEXT_DOMAIN ) ) . '</div>';
			$output .= '</div>';
			return $output;
		}
    }


    /**
     * Checks the title limit option and shortens the title when necessary.
     *
     * @since 1.0
     *
     * @param string          $title The title of tge feed item.
     * @param int|string|null $id    The ID of the feed item.
     *
     * @return string
     */
    function wprss_shorten_title( $title, $id = null ) {
        if (isset($id) && get_post_type($id) === 'wprss_feed_item') {
            $settings = get_option('wprss_settings_general');
            $limit = isset($settings['title_limit'])
                ? intval($settings['title_limit'])
                : 0;

            if ($limit > 0 && strlen($title) > $limit) {
                $suffix = apply_filters('wprss_shortened_title_ending', '...');
                $title = substr($title, 0, $limit) . $suffix;
            }
        }

        return $title;
    }


    /**
     * Display feed items on the front end (via shortcode or function)
     *
     * @since 2.0
     */
    function wprss_display_feed_items( $args = array() ) {
        $settings = get_option( 'wprss_settings_general' );
        $args = wprss_get_shortcode_default_args( $args );

        $args = apply_filters( 'wprss_shortcode_args', $args );

        $query_args = $settings;
		if ( isset( $args['limit'] ) ) {
			$query_args['feed_limit'] = filter_var( $args['limit'], FILTER_VALIDATE_INT, array(
				'options' => array(
					'min_range' => 1,
					'default'   => $query_args['feed_limit'],
				),
			) );
		}

        if ( isset( $args['pagination'] ) ) {
            $query_args['pagination'] = $args['pagination'];
        }

		if ( isset( $args['source'] ) ) {
			$query_args['source'] = $args['source'];
		}
		elseif ( isset( $args['exclude'] ) ) {
			$query_args['exclude'] = $args['exclude'];
		}

        $query_args = apply_filters( 'wprss_process_shortcode_args', $query_args, $args );

		$feed_items = wprss_get_feed_items_query( $query_args );

        do_action( 'wprss_display_template', $args, $feed_items );
    }


    /**
     * Limits a phrase/content to a defined number of words
     *
     * NOT BEING USED as we're using the native WP function, although the native one strips tags, so I'll
     * probably revisit this one again soon.
     *
     * @since  3.0
     * @param  string  $words
     * @param  integer $limit
     * @param  string  $append
     * @return string
     */
    function wprss_limit_words( $words, $limit, $append = '' ) {
           /* Add 1 to the specified limit becuase arrays start at 0 */
           $limit = $limit + 1;
           /* Store each individual word as an array element
              up to the limit */
           $words = explode( ' ', $words, $limit );
           /* Shorten the array by 1 because that final element will be the sum of all the words after the limit */
           array_pop( $words );
           /* Implode the array for output, and append an ellipse */
           $words = implode( ' ', $words ) . $append;
           /* Return the result */
           return rtrim( $words );
    }


File Name:
licensing.php
Directory Path:
sourcecodefiles\wp-rss-aggregator\includes\licensing.php
Code:
<?php

/**
 * Gets the singleton instance of the Settings class, creating it if it doesn't exist.
 *
 * @since 4.7.8
 * @return Aventura\Wprss\Core\Licensing\Settings
 */
function wprss_licensing_get_settings_controller() {
	static $instance = null;
	return is_null( $instance )
            ? $instance = new Aventura\Wprss\Core\Licensing\Settings()
            : $instance;
}


/**
 * Gets the singleton instance of the Manager class, creating it if it doesn't exist.
 *
 * @since 4.7.8
 * @return Aventura\Wprss\Core\Licensing\Manager
 */
function wprss_licensing_get_manager() {
	static $manager = null;

	if ( is_null( $manager ) ) {
        $manager = new Aventura\Wprss\Core\Licensing\Manager();
        $manager->setExpirationNoticePeriod( wprss_get_general_setting( 'expiration_notice_period' ) );
        $manager->setDefaultAuthorName( 'Jean Galea' );
    }

    return $manager;
}

/**
 * Gets the singleton instance of the AjaxController class, creating it if it doesn't exist.
 *
 * @since 4.7.8
 * @return Aventura\Wprss\Core\Licensing\AjaxController
 */
function wprss_licensing_get_ajax_controller() {
	static $instance = null;
	return is_null( $instance )
            ? $instance = new Aventura\Wprss\Core\Licensing\AjaxController()
            : $instance;
}

/**
 * Returns all registered addons.
 *
 * @since 4.4.5
 * @param bool $noCache If true, the add-ons filter will be ran again; if false, it will only be ran if not ran before.
 * @return array Array of add-on codes.
 */
function wprss_get_addons($noCache = false) {
	static $addons = null;
	return is_null( $addons ) || $noCache
            ? $addons = apply_filters( 'wprss_register_addon', array() )
            : $addons;
}

/**
 * Finds all WPRA addons installed, even if they are deactivated.
 *
 * @since 4.12.1
 *
 * @return array An array of WordPress plugin info arrays.
 */
function wprss_find_installed_addons()
{
    $all_plugins = get_plugins();
    $addons = array();
    foreach ($all_plugins as $plugin_path => $plugin) {
        if ($plugin_path !== WPRSS_FILE_CONSTANT && strpos($plugin['Name'], 'WP RSS Aggregator - ') === 0) {
            $addons[$plugin_path] = $plugin;
        }
    }
    return $addons;
}

/**
 * Retrieves the names of the installed addons, even if they are deactivated.
 *
 * @since 4.12.1
 *
 * @return string[] A list of the names of installed addons.
 */
function wprss_find_installed_addon_names()
{
    return array_map(function ($plugin_info) {
        return substr($plugin_info['Name'], strlen('WP RSS Aggregator - '));
    }, wprss_find_installed_addons());
}

/**
 * Hooks the licensing system into WordPress.
 */
function wprss_licensing() {
    static $licensing = null;

    if ( is_null( $licensing ) ) {
        // Get licensing class instances
        $manager = wprss_licensing_get_manager();
        $settingsController = wprss_licensing_get_settings_controller();
        $ajaxController = wprss_licensing_get_ajax_controller();

        // Set up Ajax Controller pointers
        $ajaxController->setManager( $manager );
        $ajaxController->setSettingsController( $settingsController );

        // Licensing Ajax Controller hooks
        add_action( 'wp_ajax_wprss_ajax_manage_license', array( $ajaxController, 'handleAjaxManageLicense' ) );
        add_action( 'wp_ajax_wprss_ajax_fetch_license', array( $ajaxController, 'handleAjaxFetchLicense' ) );

        // Licensing Settings Controller hooks
        add_action( 'wprss_admin_init', array( $settingsController, 'registerSettings' ), 100 );
        add_action( 'admin_init', array( $settingsController, 'handleLicenseStatusChange' ), 10 );
        add_action( 'wprss_settings_license_key_is_valid', array( $settingsController, 'validateLicenseKeyForSave' ), 10, 2 );

        $licensing = (object) compact( 'manager', 'settingsController', 'ajaxController' );

        // Action for hooking after licensing has been initialized
        do_action( 'wprss_init_licensing' );

        // Backwards compatibility with old licensing lib
        // This ensures that, if an addon is loading an older version of the licensing library, the old method for initializing the updaters is called.
        if ( method_exists($manager, 'initUpdaterInstances') ) {
            add_action( 'admin_init', array($manager, 'initUpdaterInstances') );
        }
    }

    return $licensing;
}


